(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{67:()=>{},2061:()=>{},2370:(e,t,r)=>{Promise.resolve().then(r.bind(r,3033))},3033:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>C});var a=r(7437),o=r(2265),n=r(7800);function l(e){if(!e)return"";let t=e.trim(),r=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/사이즈\s*:\s*/g,"")).replace(/컬러\s*:\s*/g,"")).replace(/색상\s*:\s*/g,"")).replace(/사이즈\s*선택\s*:\s*/g,"")).replace(/컬러\s*선택\s*:\s*/g,"")).replace(/색상\s*선택\s*:\s*/g,"")).replace(/\([^)]*\)/g,"")).replace(/\b[Oo]ne\s*[Ss]ize\b/g,"")).replace(/\s+/g," ").trim()).split("/").map(e=>e.trim());if(r.length>=2)return r.filter(e=>e).join("/");{let e=r[0];return/^[SMLX]+$/i.test(e)?e.toUpperCase():e}}async function c(e){return new Promise((t,r)=>{let a=new FileReader;a.onload=e=>{try{let r=new Uint8Array(e.target.result),a=n.ij(r,{type:"array"}),o=a.SheetNames[0],c=a.Sheets[o],s=n.P6.sheet_to_json(c,{header:1}),i=-1;for(let e=0;e<Math.min(10,s.length);e++)if(s[e].map(e=>String(e||"").toLowerCase()).some(e=>e.includes("주문번호")||e.includes("상품명")||e.includes("고객명"))){i=e;break}if(-1===i)throw Error("유효한 헤더를 찾을 수 없습니다. 엑셀 형식을 확인해주세요.");let d=s[i],u=e=>d.findIndex(t=>"string"==typeof t&&t.toLowerCase().includes(e.toLowerCase())),m=(e,t)=>{for(let r of t){let t=u(r);if(-1!==t&&e[t])return String(e[t])}return""},p=[];for(let e=i+1;e<s.length;e++){let t=s[e];if(!t||0===t.length)continue;let r=m(t,["주문번호","주문 번호","주문no","주문 no","order","오더 번호"]),a=m(t,["상품명","품명","item","제품명","상품 명"]);if(!r||!a)continue;let o=m(t,["옵션명","옵션","옵션정보","옵션 정보","선택 옵션","옵션 내역"]),n=l(o),c={id:function(e,t,r,a){let o=(e||"").toString().trim(),n=(t||"").toString().trim(),l=(r||"").toString().trim(),c=Date.now(),s=Math.floor(1e4*Math.random());return"".concat(o,"_").concat(n.substring(0,10),"_").concat(l.substring(0,5),"_").concat(a,"_").concat(c,"_").concat(s)}(r,a,n,parseInt(m(t,["수량","주문수량","입고수량","반품수량","quantity"]),10)||1),orderNumber:r,customerName:m(t,["고객명","주문자","구매자","customer","구매자명","고객 이름"]),productName:a,optionName:n,quantity:parseInt(m(t,["수량","주문수량","입고수량","반품수량","quantity"]),10)||1,returnReason:m(t,["반품사유","반품 사유","사유","메모","반품메모","반품 메모"]),returnTrackingNumber:m(t,["반품송장번호","반품운송장","반품 송장","반품송장","송장번호","송장"]),pickupTrackingNumber:m(t,["수거송장번호","수거운송장","수거 송장","수거송장","픽업송장번호","픽업 송장번호"]),status:"PENDING",barcode:"",zigzagProductCode:m(t,["자체상품코드","지그재그코드","상품코드"]),customProductCode:m(t,["자체상품코드","지그재그코드","상품코드"])};p.push(c)}console.log("".concat(p.length,"개의 반품 항목이 추출되었습니다.")),t(p)}catch(e){console.error("엑셀 파싱 오류:",e),r(Error("엑셀 파일을 처리하는 중 오류가 발생했습니다."))}},a.onerror=()=>{r(Error("엑셀 파일을 읽는 중 오류가 발생했습니다."))},a.readAsArrayBuffer(e)})}function s(e){return new Promise((t,r)=>{let a=new FileReader;a.onload=e=>{try{if(!e.target||!e.target.result)throw Error("파일 데이터를 읽을 수 없습니다.");let r=new Uint8Array(e.target.result),a=n.ij(r,{type:"array"});if(!a||!a.SheetNames||0===a.SheetNames.length)throw Error("엑셀 파일에 시트가 없습니다.");let o=a.Sheets[a.SheetNames[0]];if(!o)throw Error("엑셀 시트를 읽을 수 없습니다.");let c=n.P6.sheet_to_json(o,{header:1});if(!c||0===c.length)throw Error("엑셀 파일에 데이터가 없습니다.");console.log("엑셀 데이터 로드 완료:",{행수:c.length,첫번째행:c[0]});let s=function(e){for(let t=0;t<Math.min(10,e.length);t++){let r=e[t];if(r&&["상품명","바코드","옵션"].reduce((e,t)=>r.some(e=>"string"==typeof e&&e.includes&&e.includes(t))?e+1:e,0)>=2)return t}return -1}(c);if(-1===s)throw Error("상품 데이터 헤더 행을 찾을 수 없습니다.");let i=c[s].map(e=>String(e||"").trim()),d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=i.findIndex(t=>t===e);if(-1===r&&(r=i.findIndex(t=>t.includes(e))),-1===r&&t.length>0){for(let e of t)if(r=i.findIndex(t=>t===e),-1!==r||(r=i.findIndex(t=>t.includes(e)),-1!==r))break}return r},u=d("상품명",["제품명","품명"]),m=d("바코드번호",["바코드"]),p=d("옵션명",["옵션","옵션정보"]),g=d("사입상품명",["사입명","매입상품명"]),h=d("자체상품코드",["지그재그코드","상품코드"]);if(-1===u||-1===m)throw Error("필수 열(상품명, 바코드번호)을 찾을 수 없습니다.");console.log("컬럼 인덱스:",{상품명:u,바코드번호:m,옵션명:p,사입상품명:g,자체상품코드:h});let x=[],N=new Map;for(let e=s+1;e<c.length;e++){let t=c[e];if(!t||0===t.length)continue;let r="";if(void 0!==t[m]&&null!==t[m]&&(r=String(t[m]).trim()),!r){console.warn("행 ".concat(e+1,": 바코드 없음, 건너뜀"));continue}if(N.has(r)){console.log("중복 바코드 무시: ".concat(r));continue}let a="";if(void 0!==t[u]&&null!==t[u]&&(a=String(t[u]).trim()),!a){console.warn("행 ".concat(e+1,": 상품명 없음, 건너뜀"));continue}let o="";if(-1!==p&&void 0!==t[p]&&null!==t[p]){let e=String(t[p]);o=l(e)}let n="";-1!==g&&void 0!==t[g]&&null!==t[g]&&(n=String(t[g]).trim());let s="",i="";-1!==h&&void 0!==t[h]&&null!==t[h]&&(i=s=String(t[h]).trim());let d={id:function(e,t){let r=(e||"").toString().trim(),a=(t||"").toString().trim(),o=Date.now(),n=Math.floor(1e4*Math.random());return"".concat(r,"_").concat(a.substring(0,10),"_").concat(o,"_").concat(n)}(r,a),productName:a,barcode:r,optionName:o,purchaseName:n||"",zigzagProductCode:s,customProductCode:i};N.set(r,!0),x.push(d)}console.log("".concat(x.length,"개의 상품 데이터가 추출되었습니다.")),t(x)}catch(e){console.error("엑셀 파싱 오류:",e),r(Error("엑셀 파일을 처리하는 중 오류가 발생했습니다."))}},a.onerror=()=>{r(Error("엑셀 파일을 읽는 중 오류가 발생했습니다."))},a.readAsArrayBuffer(e)})}var i=r(2533),d=r(4887);class u{static getInstance(){return u.instance||(u.instance=new u),u.instance}createModalContainer(){if(!this.isClient||"undefined"==typeof document)return;let e=document.getElementById("global-modal-container");e&&e.remove(),this.modalContainer=document.createElement("div"),this.modalContainer.id="global-modal-container",this.modalContainer.style.position="fixed",this.modalContainer.style.top="0",this.modalContainer.style.left="0",this.modalContainer.style.width="100%",this.modalContainer.style.height="100%",this.modalContainer.style.pointerEvents="none",this.modalContainer.style.zIndex="10000",document.body.appendChild(this.modalContainer)}addModal(e,t){this.isClient&&"undefined"!=typeof document&&(this.modalContainer||this.createModalContainer(),this.removeModal(e),this.activeModals.add(e),this.modalElements.set(e,t),this.modalContainer&&(this.modalContainer.appendChild(t),t.style.pointerEvents="auto",console.log("모달 추가: ".concat(e,", 총 모달 수: ").concat(this.activeModals.size))))}removeModal(e){if(!this.isClient)return;let t=this.modalElements.get(e);t&&t.parentNode&&t.parentNode.removeChild(t),this.activeModals.delete(e),this.modalElements.delete(e),console.log("모달 제거: ".concat(e,", 남은 모달 수: ").concat(this.activeModals.size))}bringToFront(e){if(!this.isClient)return;let t=this.modalElements.get(e);t&&this.modalContainer&&(this.modalContainer.appendChild(t),console.log("모달 최상위로 이동: ".concat(e)))}getActiveModals(){return Array.from(this.activeModals)}clearAll(){this.isClient&&(this.activeModals.clear(),this.modalElements.clear(),this.modalContainer&&(this.modalContainer.innerHTML=""))}constructor(){this.modalContainer=null,this.activeModals=new Set,this.modalElements=new Map,this.isClient=!1,this.isClient=!0,this.createModalContainer()}}let m=null,p=()=>(m||(m=u.getInstance()),m),g=(e,t)=>{p().addModal(e,t)},h=e=>{p().removeModal(e)},x=e=>{let{children:t,isOpen:r,onClose:n,zIndex:l}=e,c=(0,o.useRef)(null),s=(0,o.useRef)("modal-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)));if((0,o.useEffect)(()=>(r&&c.current&&(document.body.style.overflow="hidden",g(s.current,c.current),setTimeout(()=>{if(c.current){let e=c.current.querySelector('button, [tabindex]:not([tabindex="-1"]), input, select, textarea, a[href]');e?e.focus():c.current.focus()}},50)),()=>{"undefined"!=typeof document&&(document.body.style.overflow=""),r&&h(s.current)}),[r]),(0,o.useEffect)(()=>{let e=e=>{"Escape"===e.key&&n()};return r&&window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[r,n]),!r)return null;let i=(0,a.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",onClick:e=>{c.current&&!c.current.contains(e.target)&&n()},style:{position:"fixed",inset:0,zIndex:l||1e4},role:"dialog","aria-modal":"true",children:(0,a.jsx)("div",{className:"relative",ref:c,tabIndex:-1,style:{maxWidth:"95vw",maxHeight:"90vh",overflow:"auto",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.2)"},children:t})});return(0,d.createPortal)(i,document.body)},N=e=>{let{isOpen:t,onClose:r,onSave:n,returnItem:l,detailReason:c,setDetailReason:s,zIndex:i}=e,[d,u]=(0,o.useState)(c);return((0,o.useEffect)(()=>{u(c)},[c]),t&&l)?(0,a.jsx)(x,{isOpen:t,onClose:r,zIndex:i,children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-11/12 max-w-xl",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-red-600 to-red-700 p-4 text-white",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"반품 사유 상세"}),(0,a.jsx)("button",{onClick:r,className:"text-white hover:text-gray-200",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),s(d),n(d)},className:"p-6",children:[(0,a.jsxs)("div",{className:"mb-6 grid grid-cols-1 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"주문 정보"}),(0,a.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-200",children:[(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"고객명:"})," ",l.customerName]}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"주문번호:"})," ",l.orderNumber]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"상품 정보"}),(0,a.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-200",children:[(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"상품명:"})," ",l.productName]}),l.optionName&&(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"옵션:"})," ",l.optionName]}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"수량:"})," ",l.quantity]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"반품 사유"}),(0,a.jsx)("div",{className:"bg-pink-50 p-3 rounded-lg border border-pink-200 text-red-800",children:l.returnReason})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{htmlFor:"detailReason",className:"block text-sm font-medium text-gray-700",children:"상세 사유"}),(0,a.jsx)("textarea",{id:"detailReason",className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:4,value:d,onChange:e=>u(e.target.value),placeholder:"반품 상세 사유를 입력하세요"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"취소"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"저장"})]})]})]})}):null},f=e=>{let{isOpen:t,onClose:r,returnItem:n,onSave:l,zIndex:c}=e,[s,i]=(0,o.useState)((null==n?void 0:n.returnTrackingNumber)||"");return t?(0,a.jsx)(x,{isOpen:t,onClose:r,zIndex:c,children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-96 max-w-full",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-800 p-4 text-white",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"반품송장번호 입력"}),(0,a.jsx)("button",{onClick:r,className:"text-white hover:text-gray-200",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}),(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-500 mb-2",children:"주문 정보"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 bg-gray-50 p-3 rounded border border-gray-200",children:[(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"고객명:"})," ",n.customerName]}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"주문번호:"})," ",n.orderNumber]}),(0,a.jsxs)("div",{className:"text-sm sm:col-span-2",children:[(0,a.jsx)("span",{className:"font-medium",children:"상품명:"})," ",n.productName]})]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"반품 송장번호"}),(0,a.jsx)("input",{type:"text",value:s,onChange:e=>i(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"송장번호를 입력하세요"})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"취소"}),(0,a.jsx)("button",{type:"button",onClick:()=>{l(s)},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"저장"})]})]})]})}):null},y=e=>{let{isOpen:t,onClose:r,children:n}=e,l=(0,o.useRef)(null);return((0,o.useRef)("modal-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9))),(0,o.useEffect)(()=>{if(t&&l.current){document.body.style.overflow="hidden";let e=l.current;e.parentNode&&e.parentNode.appendChild(e),setTimeout(()=>{if(l.current){let e=l.current.querySelector('button, [tabindex]:not([tabindex="-1"]), input, select, textarea, a[href]');e?e.focus():l.current.focus()}},50)}return()=>{"undefined"!=typeof document&&(document.body.style.overflow="")}},[t]),(0,o.useEffect)(()=>{let e=e=>{"Escape"===e.key&&r()};return t&&window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[t,r]),t)?(0,a.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",onClick:e=>{l.current&&!l.current.contains(e.target)&&r()},ref:l,style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:9999},role:"dialog","aria-modal":"true",children:(0,a.jsx)("div",{className:"relative",tabIndex:-1,style:{maxWidth:"95vw",maxHeight:"90vh",overflow:"auto",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.2)"},children:n})}):null},b=e=>{let{isOpen:t,onClose:r,returnItem:n,products:l,onMatch:c,zIndex:s}=e,[i,d]=(0,o.useState)(""),[u,m]=(0,o.useState)([]),[p,g]=(0,o.useState)(!1);(0,o.useEffect)(()=>{t&&(d(""),m([]),g(!1))},[t]);let h=()=>{if(!i.trim()){m([]),g(!1);return}let e=i.toLowerCase().trim();m(l.filter(t=>t.productName&&t.productName.toLowerCase().includes(e)||t.purchaseName&&t.purchaseName.toLowerCase().includes(e))),g(!0)};return t?(0,a.jsx)(y,{isOpen:t,onClose:r,children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-11/12 max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-cyan-600 p-4 text-white",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold",children:"상품 매칭"}),(0,a.jsx)("button",{onClick:r,className:"text-white hover:text-gray-200",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,a.jsxs)("div",{className:"p-4 border-b",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h4",{className:"text-lg font-medium mb-2",children:"선택된 반품 항목"}),(0,a.jsx)("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-200",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"상품명:"})," ",n.productName]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"주문번호:"})," ",n.orderNumber]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"고객명:"})," ",n.customerName]}),n.optionName&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"옵션:"})," ",n.optionName]})]})})]}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("input",{type:"text",className:"flex-1 px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:i,onChange:e=>{d(e.target.value)},placeholder:"상품명 또는 사입상품명으로 검색",onKeyPress:e=>{"Enter"===e.key&&h()}}),(0,a.jsx)("button",{className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",onClick:h,children:"검색"})]})})]}),(0,a.jsx)("div",{className:"flex-1 overflow-auto",children:p?u.length>0?(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50 sticky top-0",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-2/3",children:"사입상품명"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"옵션명"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"바코드"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"매칭"})]})}),(0,a.jsx)("tbody",{children:u.map((e,t)=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-500 break-words",children:e.purchaseName||"-"}),(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:e.optionName||"-"}),(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-mono",children:e.barcode||"-"}),(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-medium",children:(0,a.jsx)("button",{onClick:()=>c(n,e),className:"text-blue-600 hover:text-blue-900 bg-blue-100 hover:bg-blue-200 px-3 py-1 rounded-full transition-colors",children:"매칭"})})]},e.id||t))})]}):(0,a.jsx)("div",{className:"p-8 text-center text-gray-500",children:(0,a.jsx)("p",{children:"검색 결과가 없습니다."})}):(0,a.jsx)("div",{className:"p-8 text-center text-gray-500",children:(0,a.jsx)("p",{children:"상품명 또는 사입상품명으로 검색하세요."})})}),(0,a.jsx)("div",{className:"bg-gray-50 p-4 flex justify-end",children:(0,a.jsx)("button",{onClick:r,className:"px-4 py-2 border border-gray-300 bg-white rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none",children:"닫기"})})]})}):null},w=console.error,j=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];try{w(...t)}catch(e){}};function v(e,t){if(!e||!t)return 0;e=e.toLowerCase().trim(),t=t.toLowerCase().trim();let r=e.length,a=t.length;if(Math.abs(r-a)>.3*Math.min(r,a))return 0;let o=Array(r+1).fill(null).map(()=>Array(a+1).fill(0));for(let e=0;e<=r;e++)o[e][0]=e;for(let e=0;e<=a;e++)o[0][e]=e;for(let n=1;n<=r;n++)for(let r=1;r<=a;r++){let a=e[n-1]===t[r-1]?0:1;o[n][r]=Math.min(o[n-1][r]+1,o[n][r-1]+1,o[n-1][r-1]+a)}let n=Math.max(r,a);return 1-o[r][a]/n}function C(){let{returnState:e,dispatch:t}=(0,i.b)(),[r,l]=(0,o.useState)(!1),[d,u]=(0,o.useState)(""),m=(0,o.useRef)(null),p=(0,o.useRef)(null),g=(0,o.useRef)(null),h=(0,o.useRef)(null);(0,o.useRef)(null);let x=(0,o.useRef)(null),[y,w]=(0,o.useState)(!1),[C,R]=(0,o.useState)(null),[S,k]=(0,o.useState)(""),[E,D]=(0,o.useState)([]),[P,z]=(0,o.useState)(!1),[T,L]=(0,o.useState)(null),[_,I]=(0,o.useState)([]),[M,O]=(0,o.useState)(!1),[U,A]=(0,o.useState)(null),[B,F]=(0,o.useState)(!1),[J,q]=(0,o.useState)(null),[H,G]=(0,o.useState)({testButton:"bg-blue-500 hover:bg-blue-600",firebaseButton:"bg-indigo-500 hover:bg-indigo-600",productButton:"bg-green-500 hover:bg-green-600",returnButton:"bg-blue-500 hover:bg-blue-600",productListButton:"bg-purple-500 hover:bg-purple-600",pendingButton:"bg-yellow-500 hover:bg-yellow-600",downloadButton:"bg-teal-500 hover:bg-teal-600",trackingButton:"bg-blue-500 hover:bg-blue-600"}),[K,Y]=(0,o.useState)(!1),[V,W]=(0,o.useState)(null);(0,o.useCallback)((e,t)=>(j("[".concat(t,"] 오류:"),e),u("".concat(t," 중 오류가 발생했습니다: ").concat(e instanceof Error?e.message:"알 수 없는 오류")),null),[]);let X=()=>{try{localStorage.getItem("returnData")&&(console.log("기존 returnData 정리 중..."),localStorage.removeItem("returnData"));let e=e=>{let t=localStorage.getItem(e);if(!t)return[];try{if(t.includes('"pN"')||t.includes('"oN"')||t.includes('"cN"'))return $(t);return JSON.parse(t)}catch(t){return console.error("".concat(e," 데이터 로드 오류:"),t),[]}},r=e("pendingReturns"),a=e("completedReturns"),o=e("products"),n=localStorage.getItem("lastUpdated");(r.length>0||a.length>0||o.length>0)&&(t({type:"SET_RETURNS",payload:{pendingReturns:r,completedReturns:a,products:o}}),u("마지막 업데이트: ".concat(new Date(n||"").toLocaleString())))}catch(e){console.error("로컬 데이터 로드 오류:",e),u("로컬 데이터를 불러오는 중 오류가 발생했습니다.")}},Q=e=>{try{return JSON.stringify(e).replace(/("productName")/g,'"pN"').replace(/("optionName")/g,'"oN"').replace(/("customerName")/g,'"cN"').replace(/("returnReason")/g,'"rR"').replace(/("barcode")/g,'"bc"').replace(/("quantity")/g,'"qty"').replace(/("zigzagProductCode")/g,'"zpc"').replace(/("purchaseName")/g,'"pnm"')}catch(t){return console.error("데이터 압축 오류:",t),JSON.stringify(e)}},$=e=>{try{let t=e.replace(/("pN")/g,'"productName"').replace(/("oN")/g,'"optionName"').replace(/("cN")/g,'"customerName"').replace(/("rR")/g,'"returnReason"').replace(/("bc")/g,'"barcode"').replace(/("qty")/g,'"quantity"').replace(/("zpc")/g,'"zigzagProductCode"').replace(/("pnm")/g,'"purchaseName"');return JSON.parse(t)}catch(t){return console.error("데이터 압축 해제 오류:",t),JSON.parse(e)}},Z=e=>{try{let t=(e,t)=>{try{let r=Q(t);return localStorage.setItem(e,r),!0}catch(r){if("QuotaExceededError"===r.name){if(console.warn("".concat(e," 저장 실패 - 할당량 초과, 데이터 크기 줄이기 시도")),Array.isArray(t)&&t.length>100){let r=t.slice(-100);try{let a=Q(r);return localStorage.setItem(e,a),console.log("".concat(e," 데이터 크기 축소 저장 성공 (").concat(t.length," -> ").concat(r.length,")")),!0}catch(t){console.error("".concat(e," 축소 저장도 실패:"),t)}}return!1}throw r}},r=t("pendingReturns",e.pendingReturns||[]),a=t("completedReturns",e.completedReturns||[]),o=t("products",e.products||[]);return localStorage.setItem("lastUpdated",new Date().toISOString()),r&&a&&o||u("일부 데이터가 크기 제한으로 인해 축소 저장되었습니다."),!0}catch(e){return console.error("로컬 스토리지 저장 오류:",e),u("데이터 저장 중 오류가 발생했습니다. 브라우저 저장공간을 확인해주세요."),!1}},ee=(0,o.useCallback)(()=>{try{Z(e),console.log("로컬 데이터 자동 저장 완료")}catch(e){console.error("자동 저장 실패:",e)}},[e]);(0,o.useEffect)(()=>{if(e.pendingReturns.length>0||e.completedReturns.length>0||e.products.length>0){let e=setTimeout(()=>{ee()},1e3);return()=>clearTimeout(e)}},[e,ee]);let et=()=>{try{let e=0;for(let t in localStorage)localStorage.hasOwnProperty(t)&&(e+=localStorage[t].length);e>5242880&&(console.log("로컬 스토리지 용량 정리 시작..."),["returnData","returnData_backup"].forEach(e=>{localStorage.getItem(e)&&(localStorage.removeItem(e),console.log("".concat(e," 삭제됨")))}),u("로컬 스토리지 정리 완료"))}catch(e){console.error("스토리지 정리 오류:",e)}};(0,o.useEffect)(()=>{et(),X(),localStorage.getItem("pendingReturns")||localStorage.getItem("completedReturns")||u("로컬 저장소에서 데이터를 불러왔습니다. 엑셀 파일을 업로드하여 시작하세요.")},[]),(0,o.useEffect)(()=>{let e=localStorage.getItem("buttonColors");if(e)try{G(JSON.parse(e))}catch(e){console.error("색상 설정 로드 오류:",e)}},[]),(0,o.useCallback)(async(e,t)=>{try{j("".concat("products"===t?"상품":"반품"," 엑셀 파일 처리 시작:"),e.name);let r="products"===t?await s(e):await c(e);return j("".concat("products"===t?"상품":"반품"," 엑셀 파일 처리 완료:"),{파일명:e.name,데이터길이:r.length}),r}catch(e){throw Error("엑셀 파일 처리 오류: ".concat(e instanceof Error?e.message:"알 수 없는 오류"))}},[]),(0,o.useCallback)((e,t)=>{let r=[];for(let a=0;a<e.length;a+=t)r.push(e.slice(a,a+t));return r},[]);let er=()=>{P?D([]):D(e.pendingReturns.map((e,t)=>t)),z(!P),L(null)},ea=e=>{R(e),k(e.detailReason||""),w(!0),eR(e=>e+10)},eo=(0,o.useCallback)(e=>{C&&(t({type:"UPDATE_RETURN_REASON",payload:{id:C.id,detailReason:e}}),w(!1),eR(e=>Math.max(0,e-10)),u("반품 사유 상세 정보가 저장되었습니다."))},[C,t]),en=(e,t,r)=>t>0&&r[t-1].orderNumber===e.orderNumber?"bg-gray-50":"",el=e=>!!e&&"string"==typeof e&&(e.includes("불량")||e.includes("하자")||e.includes("파손"));(0,o.useCallback)(e=>{W(e),Y(!0),eR(e=>e+10)},[]);let ec=()=>{M?I([]):I(eM.map((e,t)=>t)),O(!M),A(null)},es=e=>{if(!e||"string"!=typeof e)return"";let t=e.toLowerCase();return t.includes("불실")||t.includes("변심")||t.includes("단순")?"단순변심":t.includes("실못")||t.includes("잘못")&&t.includes("주문")?"주문실수":t.includes("파손")||t.includes("불량")?"파손 및 불량":e},ei=(0,o.useCallback)(()=>{if(!e.products||0===e.products.length){u("삭제할 상품 데이터가 없습니다.");return}confirm("정말로 모든 상품 데이터를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.")&&(t({type:"SET_PRODUCTS",payload:[]}),Z({...e,products:[]}),u("모든 상품 데이터가 삭제되었습니다."))},[e,t,Z]);(0,o.useCallback)(e=>{q(e),F(!0),eR(e=>e+10)},[]);let ed=(0,o.useCallback)(r=>{if(!J)return;let a={...J,returnTrackingNumber:r.trim()};if(r.trim()){t({type:"REMOVE_PENDING_RETURN",payload:{id:a.id}});let e={...a,status:"COMPLETED",completedAt:new Date};t({type:"ADD_COMPLETED_RETURN",payload:e}),u("".concat(e.productName," 상품이 입고완료 처리되었습니다."))}else t({type:"UPDATE_PENDING_RETURN",payload:a}),u("반품송장번호가 업데이트되었습니다.");Z(e),F(!1),q(null),eR(e=>Math.max(0,e-10))},[J,t,e,Z]),[eu,em]=(0,o.useState)(""),[ep,eg]=(0,o.useState)([]),[eh,ex]=(0,o.useState)(!1),eN=()=>{if(!eu.trim()){ex(!1),eg([]);return}let t=eu.toLowerCase().trim(),r=e.completedReturns.filter(e=>e.customerName&&e.customerName.toLowerCase().includes(t)||e.orderNumber&&e.orderNumber.toLowerCase().includes(t));eg(r),ex(!0),0===r.length?u("검색 결과가 없습니다."):u("".concat(r.length,"개의 검색 결과를 찾았습니다."))},ef=e=>{let t={};return e.forEach(e=>{if(e.completedAt){let r=new Date(e.completedAt),a=new Date(r.getFullYear(),r.getMonth(),r.getDate()).toISOString().split("T")[0];t[a]||(t[a]=[]),t[a].push(e)}}),Object.entries(t).sort((e,t)=>{let[r]=e,[a]=t;return a.localeCompare(r)}).map(e=>{let[t,r]=e;return{date:t,items:r}})};(0,o.useMemo)(()=>Object.entries(e.completedReturns.reduce((e,t)=>{if(!t.completedAt)return e;let r=new Date(t.completedAt),a=new Date(r.getFullYear(),r.getMonth(),r.getDate()).toLocaleDateString();return e[a]||(e[a]=[]),e[a].push(t),e},{})).map(e=>{let[t,r]=e;return{date:t,items:r.sort((e,t)=>new Date(t.completedAt).getTime()-new Date(e.completedAt).getTime())}}).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),[e.completedReturns]);let ey=(0,o.useMemo)(()=>eh&&0!==ep.length?ef(ep):[],[eh,ep]),eb=e=>e.barcode&&"-"!==e.barcode?e.purchaseName&&"-"!==e.purchaseName?(0,a.jsx)("span",{children:e.purchaseName}):(0,a.jsx)("span",{children:e.productName}):(0,a.jsx)("button",{className:"text-blue-600 hover:text-blue-800 underline",onClick:()=>eV(e),children:e.productName});function ew(e,t){let r={...e};if(e.barcode&&"-"!==e.barcode)return e;let a=t=>{if(!e.optionName||0===t.length)return t[0]||null;let r=e.optionName.toLowerCase().trim(),a=t.find(e=>e.optionName&&e.optionName.toLowerCase().trim()===r);if(a)return console.log("✅ 옵션명 정확 매칭: ".concat(e.optionName," → ").concat(a.optionName)),a;let n=null,l=.7;for(let e of t)if(e.optionName){let t=v(r,e.optionName.toLowerCase().trim());t>l&&(l=t,n=e)}if(n)return console.log("✅ 옵션명 유사도 매칭: ".concat(e.optionName," → ").concat(n.optionName," (유사도: ").concat(l.toFixed(2),")")),n;console.log('\uD83D\uDD0D 옵션명 부분 매칭 시도: "'.concat(e.optionName,'"'));let c=null,s=0,i=o(r);for(let e of(console.log("반품 옵션 키워드: [".concat(i.join(", "),"]")),t))if(e.optionName){let t=o(e.optionName.toLowerCase().trim()),r=i.filter(e=>t.some(t=>!!(t===e||e.length>=3&&t.includes(e)||t.length>=3&&e.includes(t))));if(r.length>0){let a=r.length/Math.max(i.length,t.length)*.8+r.length/i.length*.2;console.log("  - ".concat(e.optionName,": 공통키워드 ").concat(r.length,"개 [").concat(r.join(", "),"], 점수: ").concat(a.toFixed(2))),a>s&&a>=.4&&(s=a,c=e,console.log("    → 현재 최고 점수로 선택됨"))}else console.log("  - ".concat(e.optionName,": 공통키워드 없음"))}return c?(console.log("✅ 옵션명 부분 매칭 성공: ".concat(e.optionName," → ").concat(c.optionName," (점수: ").concat(s.toFixed(2),")")),c):(console.log("⚠️ 옵션명 매칭 실패, 매칭 불가: ".concat(e.optionName)),null)},o=e=>e.replace(/[\[\]]/g,"").split(/[,\/:\-\s]+/).map(e=>e.trim()).filter(e=>e.length>0&&"선택"!==e);if(e.customProductCode&&"-"!==e.customProductCode){console.log('\uD83D\uDD0D 자체상품코드 "'.concat(e.customProductCode,'"로 매칭 시도...'));let o=t.filter(t=>t.customProductCode&&t.customProductCode.toLowerCase().trim()===e.customProductCode.toLowerCase().trim()||t.zigzagProductCode&&t.zigzagProductCode.toLowerCase().trim()===e.customProductCode.toLowerCase().trim());if(o.length>0){let t=a(o);if(t)return console.log("✅ 자체상품코드 정확 매칭 성공 (옵션 고려): ".concat(e.customProductCode," → ").concat(t.purchaseName||t.productName," [").concat(t.optionName,"]")),r.barcode=t.barcode,r.purchaseName=t.purchaseName||t.productName,r.zigzagProductCode=t.zigzagProductCode||"",r.matchType="custom_code_exact",r.matchSimilarity=1,r.matchedProductName=t.productName,r;console.log("❌ 자체상품코드 매칭 실패: 옵션명 매칭 불가 (".concat(e.optionName,")"))}console.log('\uD83D\uDD0D 자체상품코드 "'.concat(e.customProductCode,'"와 사입상품명 유사도 매칭 시도...'));let n=null,l=e.customProductCode.toLowerCase().trim();for(let e of t)if(e.purchaseName&&"string"==typeof e.purchaseName){let t=e.purchaseName.toLowerCase().trim();if(t.includes(l)||l.includes(t))(!n||.95>n.similarity)&&(n={product:e,similarity:.95,matchType:"자체상품코드-사입명 포함관계"},console.log("\uD83D\uDCCC 포함관계 발견 (유사도: ".concat("0.95",'): "').concat(l,'" ↔ "').concat(t,'"')));else{let r=v(l,t);r>.4&&(!n||r>n.similarity)&&(n={product:e,similarity:r,matchType:"자체상품코드-사입명 유사도"},console.log("\uD83D\uDCCA 유사도 매칭 (유사도: ".concat(r.toFixed(2),'): "').concat(l,'" ↔ "').concat(t,'"')))}}if(n&&n.similarity>.5)return console.log("✅ 자체상품코드 기반 매칭 성공 (".concat(n.matchType,", 유사도: ").concat(n.similarity.toFixed(2),")")),r.barcode=n.product.barcode,r.purchaseName=n.product.purchaseName||n.product.productName,r.zigzagProductCode=n.product.zigzagProductCode||e.zigzagProductCode,r.customProductCode=n.product.customProductCode||n.product.zigzagProductCode||"",r.matchType=n.matchType,r.matchSimilarity=n.similarity,r.matchedProductName=n.product.productName,r;console.log("❌ 자체상품코드 기반 매칭 실패: ".concat(e.customProductCode))}if(e.purchaseName&&"-"!==e.purchaseName){let o=t.filter(t=>{var r;return t.purchaseName&&t.purchaseName.toLowerCase().trim()===(null===(r=e.purchaseName)||void 0===r?void 0:r.toLowerCase().trim())});if(o.length>0){let t=a(o);if(t)return console.log("✅ 사입상품명 매칭 성공 (옵션 고려): ".concat(e.purchaseName," → ").concat(t.productName," [").concat(t.optionName,"]")),r.barcode=t.barcode,r.customProductCode=t.customProductCode||t.zigzagProductCode||"",r.zigzagProductCode=t.zigzagProductCode||"",r.matchType="purchase_name_match",r.matchSimilarity=1,r.matchedProductName=t.productName,r;console.log("❌ 사입상품명 매칭 실패: 옵션명 매칭 불가 (".concat(e.optionName,")"))}}if(e.zigzagProductCode&&"-"!==e.zigzagProductCode){console.log('\uD83D\uDD0D 지그재그 상품코드 "'.concat(e.zigzagProductCode,'"로 매칭 시도...'));let o=t.filter(t=>t.zigzagProductCode&&t.zigzagProductCode.toLowerCase().trim()===e.zigzagProductCode.toLowerCase().trim());if(o.length>0){let t=a(o);if(t)return console.log("✅ 지그재그 상품코드 정확 매칭 성공 (옵션 고려): ".concat(e.zigzagProductCode," → ").concat(t.productName," [").concat(t.optionName,"]")),r.barcode=t.barcode,r.purchaseName=t.purchaseName||t.productName,r.customProductCode=t.customProductCode||"",r.matchType="zigzag_code_exact",r.matchSimilarity=1,r.matchedProductName=t.productName,r}console.log('\uD83D\uDD0D 지그재그 코드 "'.concat(e.zigzagProductCode,'"와 사입상품명 유사도 매칭 시도...'));let n=null,l=e.zigzagProductCode.toLowerCase().trim();for(let e of t)if(e.purchaseName&&"string"==typeof e.purchaseName){let t=e.purchaseName.toLowerCase().trim();if(t.includes(l)||l.includes(t))(!n||.9>n.similarity)&&(n={product:e,similarity:.9,matchType:"지그재그코드-사입명 포함관계"},console.log("\uD83D\uDCCC 포함관계 발견 (유사도: ".concat("0.90",'): "').concat(l,'" ↔ "').concat(t,'"')));else{let r=v(l,t);r>.4&&(!n||r>n.similarity)&&(n={product:e,similarity:r,matchType:"지그재그코드-사입명 유사도"},console.log("\uD83D\uDCCA 유사도 매칭 (유사도: ".concat(r.toFixed(2),'): "').concat(l,'" ↔ "').concat(t,'"')))}}if(n&&n.similarity>.5)return console.log("✅ 지그재그 코드 기반 매칭 성공 (".concat(n.matchType,", 유사도: ").concat(n.similarity.toFixed(2),")")),r.barcode=n.product.barcode,r.purchaseName=n.product.purchaseName||n.product.productName,r.customProductCode=n.product.customProductCode||n.product.zigzagProductCode||"",r.matchType=n.matchType,r.matchSimilarity=n.similarity,r.matchedProductName=n.product.productName,r;console.log("❌ 지그재그 코드 기반 매칭 실패: ".concat(e.zigzagProductCode))}if(e.productName){let o=t.filter(t=>{var r,a;return t.productName&&t.productName.toLowerCase().trim()===(null===(r=e.productName)||void 0===r?void 0:r.toLowerCase().trim())||t.purchaseName&&t.purchaseName.toLowerCase().trim()===(null===(a=e.productName)||void 0===a?void 0:a.toLowerCase().trim())});if(o.length>0){let t=a(o);if(t)return console.log("✅ 상품명 정확 매칭 성공 (옵션 고려): ".concat(e.productName," → ").concat(t.productName," [").concat(t.optionName,"]")),r.barcode=t.barcode,r.customProductCode=t.customProductCode||t.zigzagProductCode||"",r.purchaseName=t.purchaseName||t.productName,r.zigzagProductCode=t.zigzagProductCode||"",r.matchType="name_exact",r.matchSimilarity=1,r.matchedProductName=t.productName,r;console.log("❌ 상품명 정확 매칭 실패: 옵션명 매칭 불가 (".concat(e.optionName,")"))}let n=t.filter(t=>t.productName&&e.productName&&(t.productName.toLowerCase().includes(e.productName.toLowerCase())||e.productName.toLowerCase().includes(t.productName.toLowerCase()))||t.purchaseName&&e.productName&&(t.purchaseName.toLowerCase().includes(e.productName.toLowerCase())||e.productName.toLowerCase().includes(t.purchaseName.toLowerCase())));if(n.length>0){let t=a(n);if(t)return console.log("✅ 상품명 부분 매칭 성공 (옵션 고려): ".concat(e.productName," → ").concat(t.productName," [").concat(t.optionName,"]")),r.barcode=t.barcode,r.customProductCode=t.customProductCode||t.zigzagProductCode||"",r.purchaseName=t.purchaseName||t.productName,r.zigzagProductCode=t.zigzagProductCode||"",r.matchType="name_partial",r.matchSimilarity=.8,r.matchedProductName=t.productName,r;console.log("❌ 상품명 부분 매칭 실패: 옵션명 매칭 불가 (".concat(e.optionName,")"))}let l=[];for(let r of t){if(r.productName&&e.productName){let t=v(r.productName.toLowerCase(),e.productName.toLowerCase());t>.6&&l.push({product:r,similarity:t})}if(r.purchaseName&&e.productName){let t=v(r.purchaseName.toLowerCase(),e.productName.toLowerCase());t>.6&&l.push({product:r,similarity:t})}}if(l.length>0){l.sort((e,t)=>t.similarity-e.similarity);let t=a(l.filter(e=>e.similarity>=l[0].similarity-.1).map(e=>e.product));if(t){let a=l.find(e=>e.product===t);return console.log("✅ 상품명 유사도 매칭 성공 (옵션 고려): ".concat(e.productName," → ").concat(t.productName," [").concat(t.optionName,"] (유사도: ").concat(null==a?void 0:a.similarity.toFixed(2),")")),r.barcode=t.barcode,r.customProductCode=t.customProductCode||t.zigzagProductCode||"",r.purchaseName=t.purchaseName||t.productName,r.zigzagProductCode=t.zigzagProductCode||"",r.matchType="name_similarity",r.matchSimilarity=(null==a?void 0:a.similarity)||.6,r.matchedProductName=t.productName,r}console.log("❌ 상품명 유사도 매칭 실패: 옵션명 매칭 불가 (".concat(e.optionName,")"))}}return console.log("❌ 매칭 실패: ".concat(e.productName)),r.matchType="no_match",r.matchSimilarity=0,r}let ej=e=>e.map(e=>({trackingNumber:e.pickupTrackingNumber||e.returnTrackingNumber||"no-tracking",items:[e],totalQuantity:e.quantity||1,isGroup:!1})),ev=e=>{let{items:t}=e,r=ej(t);return(0,a.jsxs)("table",{className:"min-w-full border-collapse",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-50",children:[(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 text-center",children:(0,a.jsx)("input",{type:"checkbox",checked:M,onChange:ec,className:"w-5 h-5"})}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 w-24",children:"고객명"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"주문번호"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"사입상품명"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"옵션명"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 w-12",children:"수량"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"반품사유"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"수거송장번호"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"바코드번호"})]})}),(0,a.jsx)("tbody",{children:r.map((e,r)=>{let o=e.items[0],n=t.findIndex(e=>e.id===o.id),l=_.includes(n);return(0,a.jsxs)("tr",{className:"hover:bg-blue-50 ".concat(el(o.returnReason)?"text-red-500":""),children:[(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300",children:(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)("input",{type:"checkbox",checked:l,onChange:e=>{e.target.checked?I(e=>[...e,n]):I(e=>e.filter(e=>e!==n))},className:"w-5 h-5"})})}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 whitespace-nowrap overflow-hidden text-ellipsis max-w-[120px]",children:o.customerName}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 whitespace-nowrap overflow-hidden text-ellipsis",children:o.orderNumber}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300",children:(0,a.jsx)("div",{className:o.barcode?"whitespace-nowrap overflow-hidden text-ellipsis":"whitespace-normal break-words line-clamp-2",children:eb(o)})}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 whitespace-nowrap overflow-hidden text-ellipsis",children:o.optionName}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 whitespace-nowrap text-center",children:o.quantity}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 whitespace-nowrap overflow-hidden text-ellipsis max-w-[150px] cursor-pointer",onClick:()=>el(o.returnReason)&&ea(o),children:eA(o)}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300",children:(0,a.jsx)("div",{className:"font-mono text-sm whitespace-nowrap bg-blue-100 px-2 py-1 rounded text-center",children:"no-tracking"===e.trackingNumber?"-":e.trackingNumber})}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300",children:(0,a.jsx)("span",{className:"font-mono text-sm whitespace-nowrap",children:o.barcode||"-"})})]},o.id)})})]})},[eC,eR]=(0,o.useState)(0),[eS,ek]=(0,o.useState)([]),[eE,eD]=(0,o.useState)(0),[eP,ez]=(0,o.useState)(""),[eT,eL]=(0,o.useState)([]),e_=1e4,eI=e=>{if("string"==typeof e){ek(t=>t.filter(t=>t!==e));let t=document.getElementById(e);t&&t.close()}else if(e.current){let t=e.current.id||"";ek(e=>e.filter(e=>e!==t)),e.current.close()}if(eR(e=>Math.max(0,e-10)),eS.length>0){let e=eS[eS.length-1],t=document.getElementById(e);t&&(e_+=5,t.style.zIndex=String(e_),console.log("최상위 모달 ".concat(e,"로 포커스 이동: z-index ").concat(e_)),t.focus())}};(0,o.useEffect)(()=>{let e=document.createElement("style");return e.innerHTML="\n      dialog {\n        position: fixed !important;\n        margin: auto !important;\n        border: none !important;\n        border-radius: 0.5rem !important;\n        padding: 1rem !important;\n        background: white !important;\n        max-width: 95vw !important;\n        max-height: 90vh !important;\n        overflow: auto !important;\n      }\n      dialog::backdrop {\n        background-color: rgba(0, 0, 0, 0.4) !important;\n      }\n      .popup-layer {\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2) !important;\n      }\n    ",document.head.appendChild(e),()=>{document.head.removeChild(e)}},[]),(0,o.useEffect)(()=>{if(e.completedReturns.length>0){let t=[...new Set(e.completedReturns.map(e=>new Date(e.completedAt).toLocaleDateString()))].sort((e,t)=>new Date(t).getTime()-new Date(e).getTime());eL(t),ez(t[0]||""),eD(0)}},[e.completedReturns]);let eM=(0,o.useMemo)(()=>!eP||eh?[]:e.completedReturns.filter(e=>new Date(e.completedAt).toLocaleDateString()===eP),[e.completedReturns,eP,eh]),eO=e=>{let t;0!==eT.length&&(eD(t="prev"===e&&eE<eT.length-1?eE+1:"next"===e&&eE>0?eE-1:"prev"===e?0:eT.length-1),ez(eT[t]),u("".concat(new Date(eT[t]).toLocaleDateString("ko-KR")," 날짜의 데이터로 이동했습니다.")))},eU=e=>{eO(e)},eA=e=>{let t=e.returnReason;return e.detailReason&&""!==e.detailReason.trim()&&!t.toLowerCase().includes(e.detailReason.toLowerCase())&&(t+=" (".concat(e.detailReason,")")),t},eB=e=>{let t=e.currentTarget.getBoundingClientRect();if(e.clientX<t.left||e.clientX>t.right||e.clientY<t.top||e.clientY>t.bottom){e.currentTarget.close();let t=e.currentTarget.id;t&&(ek(e=>e.filter(e=>e!==t)),eR(e=>Math.max(0,e-10)))}},[eF,eJ]=(0,o.useState)(""),[eq,eH]=(0,o.useState)(null),eG=()=>{let r=eF.trim();if(!r){u("수거송장번호를 입력해주세요.");return}let a=e.pendingReturns.filter(e=>e.pickupTrackingNumber&&e.pickupTrackingNumber===r||e.returnTrackingNumber&&e.returnTrackingNumber===r);if(0===a.length){u("'".concat(r,"' 수거송장번호로 등록된 반품이 없습니다.")),eJ("");return}l(!0);let o=new Date,n=new Date(o.getFullYear(),o.getMonth(),o.getDate());n.setHours(0,0,0,0);let c=a.map(e=>({...e,status:"COMPLETED",completedAt:n})),s=[...c,...e.completedReturns],i=e.pendingReturns.filter(e=>e.returnTrackingNumber!==r);t({type:"SET_RETURNS",payload:{...e,pendingReturns:i,completedReturns:s}}),localStorage.setItem("pendingReturns",JSON.stringify(i)),localStorage.setItem("completedReturns",JSON.stringify(s)),localStorage.setItem("lastUpdated",new Date().toISOString());let d=n.toLocaleDateString();if(d!==eP){ez(d);let e=eT.indexOf(d);e>=0?eD(e):(eL([d,...eT]),eD(0))}u("'".concat(r,"' 수거송장번호로 ").concat(c.length,"개 항목이 입고 처리되었습니다.")),eJ(""),l(!1)},[eK,eY]=(0,o.useState)(null),eV=e=>{W(e),eY(e),Y(!0),eR(e=>e+10)},eW=()=>{if(0===_.length)return;l(!0);let r=_.map(e=>eM[e]),a=r.map(e=>{let{completedAt:t,status:r,...a}=e;return{...a,status:"PENDING"}}),o=e.completedReturns.filter(e=>!r.some(t=>t.orderNumber===e.orderNumber&&t.productName===e.productName&&t.optionName===e.optionName&&t.returnTrackingNumber===e.returnTrackingNumber)),n=[...e.pendingReturns,...a];t({type:"SET_RETURNS",payload:{...e,pendingReturns:n,completedReturns:o}}),localStorage.setItem("pendingReturns",JSON.stringify(n)),localStorage.setItem("completedReturns",JSON.stringify(o)),localStorage.setItem("lastUpdated",new Date().toISOString()),u("".concat(_.length,"개의 항목이 입고전 목록으로 되돌아갔습니다.")),I([]),O(!1),l(!1)};return(0,a.jsxs)("main",{className:"min-h-screen p-4 md:p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"반품 관리 시스템"}),d&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-blue-100 text-blue-800 rounded",children:d}),(0,a.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 mb-6",children:[(0,a.jsx)("button",{className:"px-4 py-2 text-white rounded ".concat(H.testButton),onClick:()=>{try{l(!0),u("로컬 저장소 상태를 확인 중...");let e=localStorage.getItem("pendingReturns"),t=localStorage.getItem("completedReturns"),r=localStorage.getItem("products"),a=localStorage.getItem("lastUpdated"),o=e?JSON.parse(e).length:0,n=t?JSON.parse(t).length:0,c=r?JSON.parse(r).length:0,s=0;for(let e in localStorage)localStorage.hasOwnProperty(e)&&(s+=localStorage[e].length);let i=(s/1048576).toFixed(2),d="\n        로컬 저장소 상태:\n        • 입고전 반품: ".concat(o,"개\n        • 입고완료 반품: ").concat(n,"개  \n        • 상품 데이터: ").concat(c,"개\n        • 저장소 사용량: ").concat(i,"MB\n        • 마지막 업데이트: ").concat(a?new Date(a).toLocaleString():"없음","\n      ");u(d),console.log("로컬 저장소 상태:",{pendingReturns:o,completedReturns:n,products:c,totalSizeMB:i,lastUpdated:a})}catch(e){u("로컬 저장소 확인 실패: ".concat(e instanceof Error?e.message:"알 수 없는 오류")),console.error("로컬 저장소 확인 실패:",e)}finally{l(!1)}},disabled:r,children:"저장소 상태 확인"}),(0,a.jsx)("button",{className:"px-4 py-2 text-white rounded ".concat(H.firebaseButton),onClick:()=>{l(!0),u("데이터를 백업 중입니다...");try{let t={pendingReturns:e.pendingReturns,completedReturns:e.completedReturns,products:e.products,exportDate:new Date().toISOString(),version:"1.0"},r=JSON.stringify(t,null,2),a=new Blob([r],{type:"application/json"}),o=URL.createObjectURL(a),n=document.createElement("a");n.href=o,n.download="반품데이터_백업_".concat(new Date().toISOString().split("T")[0],".json"),n.click(),URL.revokeObjectURL(o),u("데이터 백업이 완료되었습니다. 다운로드 폴더를 확인하세요.")}catch(e){console.error("백업 오류:",e),u("데이터 백업 중 오류가 발생했습니다.")}finally{l(!1)}},disabled:r,children:"데이터 백업"}),(0,a.jsxs)("label",{className:"px-4 py-2 text-white rounded text-center cursor-pointer bg-purple-500 hover:bg-purple-600",htmlFor:"restoreFile",children:["데이터 복원",(0,a.jsx)("input",{type:"file",id:"restoreFile",accept:".json",onChange:e=>{var r;let a=null===(r=e.target.files)||void 0===r?void 0:r[0];if(!a)return;l(!0),u("백업 데이터를 복원 중입니다...");let o=new FileReader;o.onload=r=>{try{var a;let e=JSON.parse(null===(a=r.target)||void 0===a?void 0:a.result);if(!e.version||!e.exportDate)throw Error("유효하지 않은 백업 파일입니다.");let o={pendingReturns:e.pendingReturns||[],completedReturns:e.completedReturns||[],products:e.products||[]};t({type:"SET_RETURNS",payload:o}),Z(o);let n=new Date(e.exportDate).toLocaleString();u("데이터 복원이 완료되었습니다. (백업 날짜: ".concat(n,")")),console.log("데이터 복원 완료:",{pendingReturns:o.pendingReturns.length,completedReturns:o.completedReturns.length,products:o.products.length,backupDate:n})}catch(e){console.error("복원 오류:",e),u("데이터 복원 중 오류가 발생했습니다: ".concat(e instanceof Error?e.message:"알 수 없는 오류"))}finally{l(!1),e.target.value=""}},o.onerror=()=>{u("파일을 읽는 중 오류가 발생했습니다."),l(!1),e.target.value=""},o.readAsText(a)},className:"hidden",disabled:r})]}),(0,a.jsxs)("label",{className:"px-4 py-2 text-white rounded text-center cursor-pointer ".concat(H.productButton),htmlFor:"productFile",children:["상품 업로드",(0,a.jsx)("input",{type:"file",id:"productFile",accept:".xlsx,.xls",onChange:r=>{if(!r.target.files||0===r.target.files.length)return;let a=r.target.files[0];l(!0),u("상품 데이터 파일을 처리 중입니다..."),s(a).then(r=>{if(0===r.length){u("파일에서 유효한 상품 데이터를 찾을 수 없습니다.");return}t({type:"ADD_PRODUCTS",payload:r});let a=[...e.products,...r];localStorage.setItem("products",JSON.stringify(a)),localStorage.setItem("lastUpdated",new Date().toISOString());let o=e.pendingReturns.filter(e=>!e.barcode);if(o.length>0){let e=0;o.forEach(a=>{let o=ew(a,r);o.barcode&&(e++,t({type:"UPDATE_RETURN_ITEM",payload:o}))}),e>0?u("".concat(r.length,"개 상품이 추가되었습니다. ").concat(e,"개 반품 항목이 자동 매칭되었습니다.")):u("".concat(r.length,"개 상품이 추가되었습니다."))}else u("".concat(r.length,"개 상품이 추가되었습니다."))}).catch(e=>{console.error("상품 데이터 처리 오류:",e),u("상품 데이터 처리 중 오류가 발생했습니다: ".concat(e instanceof Error?e.message:String(e)))}).finally(()=>{l(!1),r.target.value=""})},ref:p,className:"hidden",disabled:r})]}),(0,a.jsxs)("label",{className:"px-4 py-2 text-white rounded text-center cursor-pointer ".concat(H.returnButton),htmlFor:"returnFile",children:["반품 업로드",(0,a.jsx)("input",{type:"file",id:"returnFile",accept:".xlsx,.xls",onChange:r=>{if(!r.target.files||0===r.target.files.length)return;let a=r.target.files[0];l(!0),u("반품 데이터 파일을 처리 중입니다..."),c(a).then(r=>{if(0===r.length){u("파일에서 유효한 반품 데이터를 찾을 수 없습니다.");return}let a=r.map(e=>({...e,returnReason:es(e.returnReason)}));t({type:"ADD_RETURNS",payload:a});let o=[...e.pendingReturns,...a];localStorage.setItem("pendingReturns",JSON.stringify(o)),localStorage.setItem("lastUpdated",new Date().toISOString()),u("".concat(a.length,"개 반품 항목이 성공적으로 추가되었습니다."))}).catch(e=>{console.error("반품 데이터 처리 오류:",e),u("반품 데이터 처리 중 오류가 발생했습니다: ".concat(e instanceof Error?e.message:String(e)))}).finally(()=>{l(!1),r.target.value=""})},ref:m,className:"hidden",disabled:r})]}),(0,a.jsx)("button",{className:"px-4 py-2 text-white rounded ".concat(H.productListButton),onClick:()=>{var e;return null===(e=h.current)||void 0===e?void 0:e.showModal()},disabled:r,children:"상품 목록"}),(0,a.jsxs)("button",{className:"px-4 py-2 text-white rounded ".concat(H.pendingButton),onClick:()=>{var e;return null===(e=g.current)||void 0===e?void 0:e.showModal()},disabled:r,children:["입고전 (",e.pendingReturns.length,")"]})]}),r&&(0,a.jsxs)("div",{className:"flex justify-center items-center my-4",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"}),(0,a.jsx)("span",{className:"ml-2",children:"처리 중..."})]}),(0,a.jsxs)("div",{className:"mb-6 p-4 border rounded-lg shadow-sm bg-white",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"수거송장번호로 입고"}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2",children:[(0,a.jsx)("input",{type:"text",placeholder:"수거송장번호 입력 후 Enter 또는 입고 버튼 클릭",className:"flex-1 px-4 py-2 border border-gray-300 rounded",value:eF,onChange:e=>eJ(e.target.value),onKeyDown:e=>{if("Enter"===e.key){if(!eF.trim()){u("수거송장번호를 입력해주세요.");return}eG()}}}),(0,a.jsx)("button",{className:"px-4 py-2 text-white rounded ".concat(H.trackingButton),onClick:eG,disabled:r||!eF.trim(),children:"입고"})]})]}),(0,a.jsxs)("div",{className:"p-4 border rounded-lg shadow-sm bg-white",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"입고완료 반품 목록"}),(0,a.jsx)("div",{className:"flex space-x-2",children:(0,a.jsx)("button",{className:"px-3 py-1 text-white rounded ".concat(H.downloadButton),onClick:()=>{let t=[];if(eh&&ep.length>0?t=ep:eP&&eM.length>0?t=eM:e.completedReturns.length>0&&(t=e.completedReturns),0===t.length){u("다운로드할 입고 완료 데이터가 없습니다.");return}try{let e=t.map(e=>({사입상품명:e.purchaseName||e.productName||"",바코드번호:e.barcode||"",입고수량:e.quantity||1})),r="입고완료_반품_".concat(new Date().toISOString().split("T")[0],".xlsx"),a=n.P6.json_to_sheet(e),o=n.P6.book_new();n.P6.book_append_sheet(o,a,"입고완료목록"),n.NC(o,r);let l="";eh?l="검색 결과 ":eP&&(l="".concat(new Date(eP).toLocaleDateString("ko-KR")," 날짜의 ")),u("".concat(l).concat(e.length,"개 항목이 ").concat(r," 파일로 저장되었습니다."))}catch(e){console.error("엑셀 생성 중 오류:",e),u("엑셀 파일 생성 중 오류가 발생했습니다.")}},disabled:r||0===e.completedReturns.length,children:"목록 다운로드"})})]}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row mb-4 space-y-2 md:space-y-0 md:space-x-2",children:[(0,a.jsx)("input",{type:"text",placeholder:"고객명 또는 주문번호로 검색",className:"flex-1 px-4 py-2 border border-gray-300 rounded",value:eu,onChange:e=>em(e.target.value),onKeyPress:e=>"Enter"===e.key&&eN()}),(0,a.jsx)("button",{className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded",onClick:eN,children:"검색"}),eh&&(0,a.jsx)("button",{className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded",onClick:()=>{em(""),eg([]),ex(!1)},children:"검색 취소"})]}),!eh&&eT.length>0&&(0,a.jsxs)("div",{className:"flex items-center justify-center mb-4 p-2 bg-gray-100 rounded-md",children:[(0,a.jsx)("button",{className:"px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded-l-md",onClick:()=>eU("prev"),children:"<"}),(0,a.jsx)("div",{className:"mx-3 font-medium",children:eP&&new Date(eP).toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"})}),(0,a.jsx)("button",{className:"px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded-r-md",onClick:()=>eU("next"),children:">"})]}),e.completedReturns.length>0?(0,a.jsxs)("div",{className:"space-y-6",children:[eh&&ey.length>0&&ey.map(e=>{let{date:t,items:r}=e;return(0,a.jsxs)("div",{id:"date-group-".concat(t),className:"border border-gray-200 rounded-md overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-gray-100 px-4 py-2 font-medium flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[new Date(t).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric",weekday:"long"}),(0,a.jsxs)("span",{className:"ml-2 text-gray-600 text-sm",children:["(",r.length,"개)"]})]}),_.length>0&&(0,a.jsxs)("button",{className:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded",onClick:eW,children:["되돌리기 (",_.length,")"]})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsx)(ev,{items:r})})]},t)}),!eh&&eP&&(0,a.jsxs)("div",{className:"border border-gray-200 rounded-md overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-gray-100 px-4 py-2 font-medium flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[new Date(eP).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric",weekday:"long"}),(0,a.jsxs)("span",{className:"ml-2 text-gray-600 text-sm",children:["(",eM.length,"개)"]})]}),_.length>0&&(0,a.jsxs)("button",{className:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded",onClick:eW,children:["되돌리기 (",_.length,")"]})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsx)(ev,{items:eM})})]})]}):(0,a.jsx)("p",{children:"입고완료된 반품이 없습니다."})]}),B&&J&&(0,a.jsx)(f,{isOpen:B,onClose:()=>{eJ(""),eH(null),u("수거송장번호 입력이 취소되었습니다.")},returnItem:J,onSave:ed,zIndex:1e3+eC}),(0,a.jsx)("dialog",{ref:g,className:"modal w-11/12 max-w-5xl p-0 rounded-lg shadow-xl popup-layer",onClick:eB,id:"pendingModal",children:(0,a.jsxs)("div",{className:"modal-box bg-white p-6",children:[(0,a.jsxs)("h3",{className:"font-bold text-lg mb-4 flex justify-between items-center",children:[(0,a.jsx)("span",{children:"입고전 반품 목록"}),(0,a.jsx)("button",{onClick:()=>eI(g),className:"btn btn-sm btn-circle",children:"✕"})]}),e.pendingReturns&&e.pendingReturns.length>0?(0,a.jsx)("div",{className:"overflow-x-auto max-h-[70vh]",children:(0,a.jsx)(e=>{let{items:t}=e,r=ej(t);return(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-2 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,a.jsx)("input",{type:"checkbox",checked:P,onChange:er,className:"w-5 h-5"})}),(0,a.jsx)("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24",children:"고객명"}),(0,a.jsx)("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"주문번호"}),(0,a.jsx)("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"사입상품명"}),(0,a.jsx)("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"옵션"}),(0,a.jsx)("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-12",children:"수량"}),(0,a.jsx)("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"반품사유"}),(0,a.jsx)("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"수거송장번호"}),(0,a.jsx)("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"바코드번호"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:r.map((e,r)=>{let o=e.items[0],n=t.findIndex(e=>e.id===o.id),l=E.includes(n);return(0,a.jsxs)("tr",{className:"hover:bg-blue-50 ".concat(en(o,n,t)),children:[(0,a.jsx)("td",{className:"px-2 py-2",children:(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)("input",{type:"checkbox",checked:l,onChange:e=>{e.target.checked?D(e=>[...e,n]):D(e=>e.filter(e=>e!==n))},className:"w-5 h-5"})})}),(0,a.jsx)("td",{className:"px-2 py-2 whitespace-nowrap overflow-hidden text-ellipsis max-w-[120px]",children:o.customerName}),(0,a.jsx)("td",{className:"px-2 py-2 whitespace-nowrap overflow-hidden text-ellipsis",children:o.orderNumber}),(0,a.jsx)("td",{className:"px-2 py-2",children:(0,a.jsx)("div",{className:o.barcode?"whitespace-nowrap overflow-hidden text-ellipsis":"whitespace-normal break-words line-clamp-2",children:eb(o)})}),(0,a.jsx)("td",{className:"px-2 py-2 whitespace-nowrap overflow-hidden text-ellipsis",children:o.optionName}),(0,a.jsx)("td",{className:"px-2 py-2 whitespace-nowrap text-center",children:o.quantity}),(0,a.jsx)("td",{className:"px-2 py-2",children:(0,a.jsx)("div",{className:"cursor-pointer ".concat(el(o.returnReason)?"text-red-500":""," whitespace-nowrap overflow-hidden text-ellipsis max-w-[150px]"),onClick:()=>el(o.returnReason)&&ea(o),children:es(o.returnReason)})}),(0,a.jsx)("td",{className:"px-2 py-2",children:(0,a.jsx)("div",{className:"font-mono text-sm whitespace-nowrap bg-blue-100 px-2 py-1 rounded text-center",children:"no-tracking"===e.trackingNumber?"-":e.trackingNumber})}),(0,a.jsx)("td",{className:"px-2 py-2",children:(0,a.jsx)("span",{className:"font-mono text-sm whitespace-nowrap",children:o.barcode||"-"})})]},o.id)})})]})},{items:e.pendingReturns})}):(0,a.jsx)("p",{children:"대기 중인 반품이 없습니다."}),(0,a.jsxs)("div",{className:"modal-action mt-6 flex flex-wrap gap-2 justify-end",children:[(0,a.jsx)("button",{ref:x,className:"btn btn-primary bg-blue-500 hover:bg-blue-600 text-white",onClick:()=>{if(l(!0),u("데이터를 새로고침 중입니다..."),e.pendingReturns.length>0){let r=new Set(e.completedReturns.map(e=>"".concat(e.customerName,"_").concat(e.orderNumber,"_").concat(e.purchaseName||e.productName,"_").concat(e.optionName,"_").concat(e.returnTrackingNumber))),a=new Map;e.pendingReturns.forEach(e=>{let t="".concat(e.customerName,"_").concat(e.orderNumber,"_").concat(e.purchaseName||e.productName,"_").concat(e.optionName,"_").concat(e.returnTrackingNumber);if(r.has(t)){console.log("중복 항목 제외 (이미 입고완료): ".concat(t));return}a.has(t)||a.set(t,e)});let o=Array.from(a.values()),n=e.pendingReturns.length-o.length;n>0&&(console.log("중복 제거: ".concat(n,"개 항목 제거됨")),t({type:"SET_RETURNS",payload:{...e,pendingReturns:o}}))}if(e.pendingReturns.length>0&&e.products.length>0){let r=e.pendingReturns.map(t=>ew(t,e.products)),a=r.filter(e=>e.barcode).length-e.pendingReturns.filter(e=>e.barcode).length;a>0?(t({type:"SET_RETURNS",payload:{...e,pendingReturns:r}}),u("새로고침 완료: ".concat(a,"개 상품이 자동 매칭되었습니다."))):u("새로고침 완료. 매칭할 상품이 없습니다.")}else u("새로고침 완료.");setTimeout(()=>{l(!1)},500)},children:"새로고침"}),E.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{className:"btn btn-success bg-green-500 hover:bg-green-600 text-white",onClick:()=>{if(0===E.length)return;let r=E.map(t=>e.pendingReturns[t]);e.products.length>0&&(r=r.map(t=>t.barcode&&"-"!==t.barcode?t:ew(t,e.products))),t({type:"PROCESS_RETURNS",payload:r}),D([]),z(!1),u("".concat(r.length,"개 항목을 입고 처리했습니다."))},children:["선택항목 입고처리 (",E.length,"개)"]}),(0,a.jsxs)("button",{className:"btn btn-error bg-red-500 hover:bg-red-600 text-white",onClick:()=>{if(0===E.length){u("삭제할 항목을 선택해주세요.");return}l(!0),u("".concat(E.length,"개 항목을 삭제 중입니다...")),setTimeout(()=>{let r=e.pendingReturns.filter((e,t)=>!E.includes(t));t({type:"SET_RETURNS",payload:{...e,pendingReturns:r}}),D([]),l(!1),u("".concat(E.length,"개 항목이 삭제되었습니다."))},1e3)},children:["선택항목 삭제 (",E.length,"개)"]})]}),(0,a.jsx)("button",{className:"btn bg-gray-500 hover:bg-gray-600 text-white",onClick:()=>{var e;return null===(e=g.current)||void 0===e?void 0:e.close()},children:"닫기"})]})]})}),(0,a.jsx)("dialog",{ref:h,className:"modal w-11/12 max-w-5xl p-0 rounded-lg shadow-xl",onClick:eB,id:"productModal",children:(0,a.jsxs)("div",{className:"modal-box bg-white p-6",children:[(0,a.jsxs)("h3",{className:"font-bold text-lg mb-4 flex justify-between items-center",children:[(0,a.jsx)("span",{children:"상품 데이터 목록"}),(0,a.jsx)("button",{onClick:()=>{var e;return null===(e=h.current)||void 0===e?void 0:e.close()},className:"btn btn-sm btn-circle",children:"✕"})]}),(0,a.jsxs)("div",{className:"mb-4 flex justify-end gap-2",children:[(0,a.jsxs)("button",{className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded flex items-center gap-1",onClick:()=>{l(!0),u("상품 데이터 중복 제거 중입니다...");try{let r=e.products||[];console.log("상품 중복 제거 시작: ".concat(r.length,"개"));let a=new Set,o=r.filter(e=>{let t="".concat(e.productName||"","_").concat(e.optionName||"","_").concat(e.barcode||"");return!a.has(t)&&(a.add(t),!0)}),n=r.length-o.length;n>0?(t({type:"SET_RETURNS",payload:{...e,products:o}}),localStorage.setItem("products",JSON.stringify(o)),u("상품 중복 제거 완료: ".concat(n,"개 중복 항목이 제거되었습니다.")),console.log("상품 중복 제거 완료: ".concat(r.length," → ").concat(o.length," (").concat(n,"개 제거)"))):(u("중복된 상품이 없습니다."),console.log("중복된 상품이 없음"))}catch(e){console.error("상품 중복 제거 오류:",e),u("상품 중복 제거 중 오류가 발생했습니다.")}finally{l(!1)}},disabled:!e.products||0===e.products.length,children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})}),"새로고침 (중복제거)"]}),(0,a.jsx)("button",{className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded",onClick:ei,disabled:!e.products||0===e.products.length,children:"전체 삭제"})]}),e.products&&e.products.length>0?(0,a.jsx)("div",{className:"overflow-x-auto max-h-[70vh]",children:(0,a.jsxs)("table",{className:"min-w-full border-collapse border border-gray-300",children:[(0,a.jsx)("thead",{className:"sticky top-0 bg-white",children:(0,a.jsxs)("tr",{className:"bg-gray-100",children:[(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"번호"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"사입상품명"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"상품명"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"옵션명"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"바코드번호"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"자체상품코드"})]})}),(0,a.jsx)("tbody",{children:e.products.map((e,t)=>(0,a.jsxs)("tr",{className:"border-t border-gray-300 hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300",children:t+1}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300",children:e.purchaseName||"-"}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300",children:e.productName}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300",children:e.optionName||"-"}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 font-mono",children:e.barcode}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300",children:e.zigzagProductCode||"-"})]},e.id))})]})}):(0,a.jsx)("p",{children:"상품 데이터가 없습니다."}),(0,a.jsx)("div",{className:"modal-action mt-6",children:(0,a.jsx)("button",{className:"btn",onClick:()=>{var e;return null===(e=h.current)||void 0===e?void 0:e.close()},children:"닫기"})})]})}),K&&V&&(0,a.jsx)(b,{isOpen:K,onClose:()=>{Y(!1),W(null),eR(e=>Math.max(0,e-10))},returnItem:V,products:e.products||[],onMatch:(r,a)=>{l(!0);let o={...r,barcode:a.barcode,purchaseName:a.purchaseName||a.productName,zigzagProductCode:a.zigzagProductCode||"",customProductCode:a.customProductCode||"",matchType:"manual",matchSimilarity:1,matchedProductName:a.productName};console.log("매칭 완료:",{원래상품명:r.productName,매칭된사입상품명:o.purchaseName,바코드:o.barcode});let n=e.pendingReturns.map(e=>e.id===r.id?o:e);t({type:"SET_RETURNS",payload:{...e,pendingReturns:n}}),localStorage.setItem("pendingReturns",JSON.stringify(n)),localStorage.setItem("lastUpdated",new Date().toISOString()),Y(!1),l(!1),u('"'.concat(r.productName,'" 상품이 "').concat(a.purchaseName||a.productName,'"(으)로 매칭되었습니다.'))},zIndex:1e3+eC}),y&&C&&(0,a.jsx)(N,{isOpen:y,onClose:()=>{w(!1),eR(e=>Math.max(0,e-10))},returnItem:C,detailReason:S||"",onSave:eo,setDetailReason:k,zIndex:1e3+eC})]})}},2533:(e,t,r)=>{"use strict";r.d(t,{b:()=>i,m:()=>s});var a=r(7437),o=r(2265);let n={pendingReturns:[],completedReturns:[],products:[]};function l(e,t){switch(t.type){case"SET_RETURNS":return t.payload;case"ADD_RETURNS":return{...e,pendingReturns:[...e.pendingReturns,...t.payload]};case"ADD_PRODUCTS":return{...e,products:[...e.products,...t.payload]};case"SET_PRODUCTS":return{...e,products:t.payload};case"PROCESS_RETURNS":let r=t.payload,a=new Date,o=new Date(a.getFullYear(),a.getMonth(),a.getDate());o.setHours(0,0,0,0);let n=r.map(e=>({...e,status:"COMPLETED",completedAt:o})),l=e.pendingReturns.filter(e=>!r.some(t=>t.id===e.id));return{...e,pendingReturns:l,completedReturns:[...n,...e.completedReturns]};case"UPDATE_RETURN_REASON":return{...e,pendingReturns:e.pendingReturns.map(e=>e.id===t.payload.id?{...e,detailReason:t.payload.detailReason,returnReason:e.returnReason+(t.payload.detailReason?" (".concat(t.payload.detailReason,")"):"")}:e),completedReturns:e.completedReturns.map(e=>e.id===t.payload.id?{...e,detailReason:t.payload.detailReason,returnReason:e.returnReason.includes("(")?e.returnReason.split("(")[0].trim()+(t.payload.detailReason?" (".concat(t.payload.detailReason,")"):""):e.returnReason+(t.payload.detailReason?" (".concat(t.payload.detailReason,")"):"")}:e)};case"UPDATE_RETURN_ITEM":return{...e,pendingReturns:e.pendingReturns.map(e=>e.id===t.payload.id?t.payload:e)};case"MATCH_PRODUCTS":let c=e.pendingReturns.map(t=>{if(t.barcode&&"-"!==t.barcode)return t;let r=e=>{if(!t.optionName||0===e.length)return e[0]||null;let r=t.optionName.toLowerCase().trim(),a=e.find(e=>e.optionName&&e.optionName.toLowerCase().trim()===r);if(a)return a;let o=null,n=.7;for(let t of e)if(t.optionName){let e=t.optionName.toLowerCase().trim();(e.includes(r)||r.includes(e))&&.9>n&&(n=.9,o=t)}if(o)return o;let l=null,c=0,s=e=>e.replace(/[\[\]]/g,"").split(/[,\/:\-\s]+/).map(e=>e.trim()).filter(e=>e.length>0&&"선택"!==e),i=s(r);for(let t of e)if(t.optionName){let e=s(t.optionName.toLowerCase().trim()),r=i.filter(t=>e.some(e=>!!(e===t||t.length>=3&&e.includes(t)||e.length>=3&&t.includes(e))));if(r.length>0){let a=r.length/Math.max(i.length,e.length)*.8+r.length/i.length*.2;a>c&&a>=.4&&(c=a,l=t)}}return l||null};if(t.zigzagProductCode&&"-"!==t.zigzagProductCode){let a=e.products.filter(e=>e.zigzagProductCode&&e.zigzagProductCode===t.zigzagProductCode);if(a.length>0){let e=r(a);if(e)return{...t,barcode:e.barcode||"",purchaseName:e.purchaseName||e.productName,matchSimilarity:1,matchType:"자체상품코드 정확 매칭"}}let o=null,n=t.zigzagProductCode.toLowerCase().trim();for(let t of e.products)if(t.purchaseName&&"string"==typeof t.purchaseName){let e=t.purchaseName.toLowerCase().trim();if(e.includes(n)||n.includes(e))(!o||.95>o.similarity)&&(o={product:t,similarity:.95,matchType:"자체상품코드-사입명 포함관계"});else{let r=Math.min(n.length,e.length),a=Math.max(n.length,e.length);if(r>0&&a>0){let l=0;for(let t=0;t<r;t++)n[t]===e[t]&&l++;let c=l/a;c>.4&&(!o||c>o.similarity)&&(o={product:t,similarity:c,matchType:"자체상품코드-사입명 유사도"})}}}if(o&&o.similarity>.5)return{...t,barcode:o.product.barcode||"",purchaseName:o.product.purchaseName||o.product.productName,zigzagProductCode:o.product.zigzagProductCode||t.zigzagProductCode,customProductCode:o.product.customProductCode||o.product.zigzagProductCode||"",matchSimilarity:o.similarity,matchType:o.matchType}}if(t.productName){let a=e.products.filter(e=>e.productName&&"string"==typeof e.productName&&"string"==typeof t.productName&&e.productName.toLowerCase().trim()===t.productName.toLowerCase().trim());if(a.length>0){let e=r(a);if(e)return{...t,barcode:e.barcode||"",purchaseName:e.purchaseName||e.productName,zigzagProductCode:e.zigzagProductCode||"",matchSimilarity:1,matchType:"상품명 완전일치"}}let o=e.products.filter(e=>e.purchaseName&&"string"==typeof e.purchaseName&&"string"==typeof t.productName&&e.purchaseName.toLowerCase().trim()===t.productName.toLowerCase().trim());if(o.length>0){let e=r(o);if(e)return{...t,barcode:e.barcode||"",purchaseName:e.purchaseName||e.productName,zigzagProductCode:e.zigzagProductCode||"",matchSimilarity:1,matchType:"사입상품명 완전일치"}}let n=[];for(let r of e.products){if(r.productName&&t.productName&&"string"==typeof r.productName&&"string"==typeof t.productName){let e=r.productName.toLowerCase(),a=t.productName.toLowerCase();(e.includes(a)||a.includes(e))&&n.push(r)}if(r.purchaseName&&t.productName&&"string"==typeof r.purchaseName&&"string"==typeof t.productName){let e=r.purchaseName.toLowerCase(),a=t.productName.toLowerCase();(e.includes(a)||a.includes(e))&&n.push(r)}}if(n.length>0){let e=r(n);if(e)return{...t,barcode:e.barcode||"",purchaseName:e.purchaseName||e.productName,zigzagProductCode:e.zigzagProductCode||"",matchSimilarity:.7,matchType:"상품명 포함관계"}}}return t});return{...e,pendingReturns:c};case"REMOVE_PENDING_RETURNS":{let r=t.payload;return{...e,pendingReturns:e.pendingReturns.filter((e,t)=>!r.includes(t))}}case"REMOVE_PENDING_RETURN":{let r=t.payload.id;return{...e,pendingReturns:e.pendingReturns.filter(e=>e.id!==r)}}case"ADD_COMPLETED_RETURN":if(e.completedReturns.some(e=>e.id===t.payload.id))return e;return{...e,completedReturns:[...e.completedReturns,t.payload]};case"UPDATE_PENDING_RETURN":return{...e,pendingReturns:e.pendingReturns.map(e=>e.id===t.payload.id?t.payload:e)};default:return e}}let c=(0,o.createContext)(void 0);function s(e){let{children:t}=e,[r,s]=(0,o.useReducer)(l,n);return(0,a.jsx)(c.Provider,{value:{returnState:r,dispatch:s},children:t})}function i(){let e=(0,o.useContext)(c);if(void 0===e)throw Error("useReturnState must be used within a ReturnStateProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[425,130,215,744],()=>t(2370)),_N_E=e.O()}]);