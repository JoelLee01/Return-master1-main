(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{67:()=>{},2061:()=>{},2370:(e,t,r)=>{Promise.resolve().then(r.bind(r,4816))},4816:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>R});var a=r(7437),o=r(2265),n=r(7800);function l(e){if(!e)return"";let t=e.trim(),r=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/사이즈\s*:\s*/g,"")).replace(/컬러\s*:\s*/g,"")).replace(/색상\s*:\s*/g,"")).replace(/사이즈\s*선택\s*:\s*/g,"")).replace(/컬러\s*선택\s*:\s*/g,"")).replace(/색상\s*선택\s*:\s*/g,"")).replace(/\([^)]*\)/g,"")).replace(/\b[Oo]ne\s*[Ss]ize\b/g,"")).replace(/\s+/g," ").trim()).split("/").map(e=>e.trim());if(r.length>=2)return r.filter(e=>e).join("/");{let e=r[0];return/^[SMLX]+$/i.test(e)?e.toUpperCase():e}}async function s(e){return new Promise((t,r)=>{let a=new FileReader;a.onload=e=>{try{let r=new Uint8Array(e.target.result),a=n.ij(r,{type:"array"}),o=a.SheetNames[0],s=a.Sheets[o],c=n.P6.sheet_to_json(s,{header:1}),i=-1;for(let e=0;e<Math.min(10,c.length);e++)if(c[e].map(e=>String(e||"").toLowerCase()).some(e=>e.includes("주문번호")||e.includes("상품명")||e.includes("고객명"))){i=e;break}if(-1===i)throw Error("유효한 헤더를 찾을 수 없습니다. 엑셀 형식을 확인해주세요.");let d=c[i],u=e=>d.findIndex(t=>"string"==typeof t&&t.toLowerCase().includes(e.toLowerCase())),m=(e,t)=>{for(let r of t){let t=u(r);if(-1!==t&&e[t])return String(e[t])}return""},p=[];for(let e=i+1;e<c.length;e++){let t=c[e];if(!t||0===t.length)continue;let r=m(t,["주문번호","주문 번호","주문no","주문 no","order","오더 번호"]),a=m(t,["상품명","품명","item","제품명","상품 명"]);if(!r||!a)continue;let o=m(t,["옵션명","옵션","옵션정보","옵션 정보","선택 옵션","옵션 내역"]),n=l(o),s={id:function(e,t,r,a){let o=(e||"").toString().trim(),n=(t||"").toString().trim(),l=(r||"").toString().trim(),s=Date.now(),c=Math.floor(1e4*Math.random());return"".concat(o,"_").concat(n.substring(0,10),"_").concat(l.substring(0,5),"_").concat(a,"_").concat(s,"_").concat(c)}(r,a,n,parseInt(m(t,["수량","주문수량","입고수량","반품수량","quantity"]),10)||1),orderNumber:r,customerName:m(t,["고객명","주문자","구매자","customer","구매자명","고객 이름"]),productName:a,optionName:n,quantity:parseInt(m(t,["수량","주문수량","입고수량","반품수량","quantity"]),10)||1,returnReason:m(t,["반품사유","반품 사유","사유","메모","반품메모","반품 메모"]),returnTrackingNumber:m(t,["반품송장번호","반품운송장","반품 송장","반품송장","송장번호","송장"]),pickupTrackingNumber:m(t,["수거송장번호","수거운송장","수거 송장","수거송장","픽업송장번호","픽업 송장번호"]),status:"PENDING",barcode:"",zigzagProductCode:m(t,["자체상품코드","지그재그코드","상품코드"]),customProductCode:m(t,["자체상품코드","지그재그코드","상품코드"])};p.push(s)}console.log("".concat(p.length,"개의 반품 항목이 추출되었습니다.")),t(p)}catch(e){console.error("엑셀 파싱 오류:",e),r(Error("엑셀 파일을 처리하는 중 오류가 발생했습니다."))}},a.onerror=()=>{r(Error("엑셀 파일을 읽는 중 오류가 발생했습니다."))},a.readAsArrayBuffer(e)})}function c(e){return new Promise((t,r)=>{let a=new FileReader;a.onload=e=>{try{if(!e.target||!e.target.result)throw Error("파일 데이터를 읽을 수 없습니다.");let r=new Uint8Array(e.target.result),a=n.ij(r,{type:"array"});if(!a||!a.SheetNames||0===a.SheetNames.length)throw Error("엑셀 파일에 시트가 없습니다.");let o=a.Sheets[a.SheetNames[0]];if(!o)throw Error("엑셀 시트를 읽을 수 없습니다.");let s=n.P6.sheet_to_json(o,{header:1});if(!s||0===s.length)throw Error("엑셀 파일에 데이터가 없습니다.");console.log("엑셀 데이터 로드 완료:",{행수:s.length,첫번째행:s[0]});let c=function(e){for(let t=0;t<Math.min(10,e.length);t++){let r=e[t];if(r&&["상품명","바코드","옵션"].reduce((e,t)=>r.some(e=>"string"==typeof e&&e.includes&&e.includes(t))?e+1:e,0)>=2)return t}return -1}(s);if(-1===c)throw Error("상품 데이터 헤더 행을 찾을 수 없습니다.");let i=s[c].map(e=>String(e||"").trim()),d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=i.findIndex(t=>t===e);if(-1===r&&(r=i.findIndex(t=>t.includes(e))),-1===r&&t.length>0){for(let e of t)if(r=i.findIndex(t=>t===e),-1!==r||(r=i.findIndex(t=>t.includes(e)),-1!==r))break}return r},u=d("상품명",["제품명","품명"]),m=d("바코드번호",["바코드"]),p=d("옵션명",["옵션","옵션정보"]),h=d("사입상품명",["사입명","매입상품명"]),g=d("자체상품코드",["지그재그코드","상품코드"]);if(-1===u||-1===m)throw Error("필수 열(상품명, 바코드번호)을 찾을 수 없습니다.");console.log("컬럼 인덱스:",{상품명:u,바코드번호:m,옵션명:p,사입상품명:h,자체상품코드:g});let x=[],N=new Map;for(let e=c+1;e<s.length;e++){let t=s[e];if(!t||0===t.length)continue;let r="";if(void 0!==t[m]&&null!==t[m]&&(r=String(t[m]).trim()),!r){console.warn("행 ".concat(e+1,": 바코드 없음, 건너뜀"));continue}if(N.has(r)){console.log("중복 바코드 무시: ".concat(r));continue}let a="";if(void 0!==t[u]&&null!==t[u]&&(a=String(t[u]).trim()),!a){console.warn("행 ".concat(e+1,": 상품명 없음, 건너뜀"));continue}let o="";if(-1!==p&&void 0!==t[p]&&null!==t[p]){let e=String(t[p]);o=l(e)}let n="";-1!==h&&void 0!==t[h]&&null!==t[h]&&(n=String(t[h]).trim());let c="",i="";-1!==g&&void 0!==t[g]&&null!==t[g]&&(i=c=String(t[g]).trim());let d={id:function(e,t){let r=(e||"").toString().trim(),a=(t||"").toString().trim(),o=Date.now(),n=Math.floor(1e4*Math.random());return"".concat(r,"_").concat(a.substring(0,10),"_").concat(o,"_").concat(n)}(r,a),productName:a,barcode:r,optionName:o,purchaseName:n||"",zigzagProductCode:c,customProductCode:i};N.set(r,!0),x.push(d)}console.log("".concat(x.length,"개의 상품 데이터가 추출되었습니다.")),t(x)}catch(e){console.error("엑셀 파싱 오류:",e),r(Error("엑셀 파일을 처리하는 중 오류가 발생했습니다."))}},a.onerror=()=>{r(Error("엑셀 파일을 읽는 중 오류가 발생했습니다."))},a.readAsArrayBuffer(e)})}var i=r(2533);let d=e=>{let{isOpen:t,onClose:r,children:n,modalId:l}=e,s=(0,o.useRef)(l||"modal-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9))),c=(0,o.useRef)(null);return((0,o.useEffect)(()=>(t?("undefined"!=typeof document&&(document.body.style.overflow="hidden"),setTimeout(()=>{if(c.current){let e=c.current.querySelector("textarea"),t=c.current.querySelector("input"),r=c.current.querySelector('button, [tabindex]:not([tabindex="-1"]), input, select, textarea, a[href]');e?e.focus():t?t.focus():r&&r.focus()}},100)):"undefined"!=typeof document&&(document.body.style.overflow=""),()=>{"undefined"!=typeof document&&(document.body.style.overflow="")}),[t]),(0,o.useEffect)(()=>{let e=e=>{"Escape"===e.key&&r()};return t&&window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[t,r]),t)?(0,a.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",onClick:e=>{e.target===e.currentTarget&&r()},style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1e4},role:"dialog","aria-modal":"true","data-modal-id":s.current,children:(0,a.jsx)("div",{className:"relative",ref:c,tabIndex:-1,style:{maxWidth:"95vw",maxHeight:"90vh",overflow:"auto",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.2)"},children:n})}):null},u=e=>{let{isOpen:t,onClose:r,onSave:n,returnItem:l,detailReason:s,setDetailReason:c,zIndex:i}=e,[u,m]=(0,o.useState)(s);return((0,o.useEffect)(()=>{m(s)},[s]),t&&l)?(0,a.jsx)(d,{isOpen:t,onClose:r,children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-11/12 max-w-xl",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-red-600 to-red-700 p-4 text-white",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"반품 사유 상세"}),(0,a.jsx)("button",{onClick:r,className:"text-white hover:text-gray-200",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),c(u),n(u)},className:"p-6",children:[(0,a.jsxs)("div",{className:"mb-6 grid grid-cols-1 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"주문 정보"}),(0,a.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-200",children:[(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"고객명:"})," ",l.customerName]}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"주문번호:"})," ",l.orderNumber]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"상품 정보"}),(0,a.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-200",children:[(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"상품명:"})," ",l.productName]}),l.optionName&&(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"옵션:"})," ",l.optionName]}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"수량:"})," ",l.quantity]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"반품 사유"}),(0,a.jsx)("div",{className:"bg-pink-50 p-3 rounded-lg border border-pink-200 text-red-800",children:l.returnReason})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{htmlFor:"detailReason",className:"block text-sm font-medium text-gray-700",children:"상세 사유"}),(0,a.jsx)("textarea",{id:"detailReason",className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:4,value:u,onChange:e=>m(e.target.value),placeholder:"반품 상세 사유를 입력하세요"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"취소"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"저장"})]})]})]})}):null};var m=r(4887);class p{static getInstance(){return p.instance||(p.instance=new p),p.instance}createModalContainer(){if(!this.isClient||"undefined"==typeof document)return;let e=document.getElementById("global-modal-container");e&&e.remove(),this.modalContainer=document.createElement("div"),this.modalContainer.id="global-modal-container",this.modalContainer.style.position="fixed",this.modalContainer.style.top="0",this.modalContainer.style.left="0",this.modalContainer.style.width="100%",this.modalContainer.style.height="100%",this.modalContainer.style.pointerEvents="none",this.modalContainer.style.zIndex="10000",document.body.appendChild(this.modalContainer)}addModal(e,t){this.isClient&&"undefined"!=typeof document&&(this.modalContainer||this.createModalContainer(),this.removeModal(e),this.activeModals.add(e),this.modalElements.set(e,t),this.modalContainer&&(this.modalContainer.appendChild(t),t.style.pointerEvents="auto",console.log("모달 추가: ".concat(e,", 총 모달 수: ").concat(this.activeModals.size))))}removeModal(e){if(!this.isClient)return;let t=this.modalElements.get(e);t&&t.parentNode&&t.parentNode.removeChild(t),this.activeModals.delete(e),this.modalElements.delete(e),console.log("모달 제거: ".concat(e,", 남은 모달 수: ").concat(this.activeModals.size))}bringToFront(e){if(!this.isClient)return;let t=this.modalElements.get(e);t&&this.modalContainer&&(this.modalContainer.appendChild(t),console.log("모달 최상위로 이동: ".concat(e)))}getActiveModals(){return Array.from(this.activeModals)}clearAll(){this.isClient&&(this.activeModals.clear(),this.modalElements.clear(),this.modalContainer&&(this.modalContainer.innerHTML=""))}constructor(){this.modalContainer=null,this.activeModals=new Set,this.modalElements=new Map,this.isClient=!1,this.isClient=!0,this.createModalContainer()}}let h=null,g=()=>(h||(h=p.getInstance()),h),x=(e,t)=>{g().addModal(e,t)},N=e=>{g().removeModal(e)},f=e=>{let{children:t,isOpen:r,onClose:n,zIndex:l}=e,s=(0,o.useRef)(null),c=(0,o.useRef)("modal-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)));if((0,o.useEffect)(()=>(r&&s.current&&(document.body.style.overflow="hidden",x(c.current,s.current),setTimeout(()=>{if(s.current){let e=s.current.querySelector('button, [tabindex]:not([tabindex="-1"]), input, select, textarea, a[href]');e?e.focus():s.current.focus()}},50)),()=>{"undefined"!=typeof document&&(document.body.style.overflow=""),r&&N(c.current)}),[r]),(0,o.useEffect)(()=>{let e=e=>{"Escape"===e.key&&n()};return r&&window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[r,n]),!r)return null;let i=(0,a.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",onClick:e=>{s.current&&!s.current.contains(e.target)&&n()},style:{position:"fixed",inset:0,zIndex:l||1e4},role:"dialog","aria-modal":"true",children:(0,a.jsx)("div",{className:"relative",ref:s,tabIndex:-1,style:{maxWidth:"95vw",maxHeight:"90vh",overflow:"auto",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.2)"},children:t})});return(0,m.createPortal)(i,document.body)},y=e=>{let{isOpen:t,onClose:r,returnItem:n,onSave:l,zIndex:s}=e,[c,i]=(0,o.useState)((null==n?void 0:n.returnTrackingNumber)||"");return t?(0,a.jsx)(f,{isOpen:t,onClose:r,zIndex:s,children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-96 max-w-full",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-800 p-4 text-white",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"반품송장번호 입력"}),(0,a.jsx)("button",{onClick:r,className:"text-white hover:text-gray-200",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}),(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-500 mb-2",children:"주문 정보"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 bg-gray-50 p-3 rounded border border-gray-200",children:[(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"고객명:"})," ",n.customerName]}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"주문번호:"})," ",n.orderNumber]}),(0,a.jsxs)("div",{className:"text-sm sm:col-span-2",children:[(0,a.jsx)("span",{className:"font-medium",children:"상품명:"})," ",n.productName]})]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"반품 송장번호"}),(0,a.jsx)("input",{type:"text",value:c,onChange:e=>i(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"송장번호를 입력하세요"})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"취소"}),(0,a.jsx)("button",{type:"button",onClick:()=>{l(c)},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"저장"})]})]})]})}):null},b=e=>{let{isOpen:t,onClose:r,returnItem:n,products:l,onMatch:s,zIndex:c}=e,[i,u]=(0,o.useState)(""),[m,p]=(0,o.useState)([]),[h,g]=(0,o.useState)(!1);(0,o.useEffect)(()=>{t&&(u(""),p([]),g(!1))},[t]);let x=()=>{if(!i.trim()){p([]),g(!1);return}let e=i.toLowerCase().trim();p(l.filter(t=>t.productName&&t.productName.toLowerCase().includes(e)||t.purchaseName&&t.purchaseName.toLowerCase().includes(e))),g(!0)};return t?(0,a.jsx)(d,{isOpen:t,onClose:r,children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-11/12 max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-cyan-600 p-4 text-white",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold",children:"상품 매칭"}),(0,a.jsx)("button",{onClick:r,className:"text-white hover:text-gray-200",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,a.jsxs)("div",{className:"p-4 border-b",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h4",{className:"text-lg font-medium mb-2",children:"선택된 반품 항목"}),(0,a.jsx)("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-200",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"상품명:"})," ",n.productName]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"주문번호:"})," ",n.orderNumber]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"고객명:"})," ",n.customerName]}),n.optionName&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"옵션:"})," ",n.optionName]})]})})]}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("input",{type:"text",className:"flex-1 px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:i,onChange:e=>{u(e.target.value)},placeholder:"상품명 또는 사입상품명으로 검색",onKeyPress:e=>{"Enter"===e.key&&x()}}),(0,a.jsx)("button",{className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",onClick:x,children:"검색"})]})})]}),(0,a.jsx)("div",{className:"flex-1 overflow-auto",children:h?m.length>0?(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50 sticky top-0",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-2/3",children:"사입상품명"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"옵션명"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"바코드"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"매칭"})]})}),(0,a.jsx)("tbody",{children:m.map((e,t)=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-500 break-words",children:e.purchaseName||"-"}),(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:e.optionName||"-"}),(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-mono",children:e.barcode||"-"}),(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-medium",children:(0,a.jsx)("button",{onClick:()=>s(n,e),className:"text-blue-600 hover:text-blue-900 bg-blue-100 hover:bg-blue-200 px-3 py-1 rounded-full transition-colors",children:"매칭"})})]},e.id||t))})]}):(0,a.jsx)("div",{className:"p-8 text-center text-gray-500",children:(0,a.jsx)("p",{children:"검색 결과가 없습니다."})}):(0,a.jsx)("div",{className:"p-8 text-center text-gray-500",children:(0,a.jsx)("p",{children:"상품명 또는 사입상품명으로 검색하세요."})})}),(0,a.jsx)("div",{className:"bg-gray-50 p-4 flex justify-end",children:(0,a.jsx)("button",{onClick:r,className:"px-4 py-2 border border-gray-300 bg-white rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none",children:"닫기"})})]})}):null},w=e=>{let{isOpen:t,onClose:r,items:o,selectedItems:n,onRefresh:l,onProcessSelected:s,onDeleteSelected:c,onItemSelect:i,PendingItemsTable:u}=e;return(0,a.jsx)(d,{isOpen:t,onClose:r,children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-11/12 max-w-7xl max-h-[90vh] overflow-hidden flex flex-col",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-cyan-600 p-4 text-white",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold",children:"입고전 반품 목록"}),(0,a.jsx)("button",{onClick:r,className:"text-white hover:text-gray-200",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,a.jsx)("div",{className:"flex-1 overflow-auto p-6",children:o&&o.length>0?(0,a.jsx)("div",{className:"overflow-x-auto max-h-[70vh]",children:(0,a.jsx)(u,{items:o})}):(0,a.jsx)("p",{className:"text-center text-gray-500 py-8",children:"대기 중인 반품이 없습니다."})}),(0,a.jsxs)("div",{className:"bg-gray-50 p-4 flex flex-wrap gap-2 justify-end",children:[(0,a.jsx)("button",{className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-md transition-colors",onClick:l,children:"새로고침"}),n.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{className:"px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-md transition-colors",onClick:s,children:["선택항목 입고처리 (",n.length,"개)"]}),(0,a.jsxs)("button",{className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-md transition-colors",onClick:c,children:["선택항목 삭제 (",n.length,"개)"]})]}),(0,a.jsx)("button",{className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-md transition-colors",onClick:r,children:"닫기"})]})]})})},j=console.error,v=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];try{j(...t)}catch(e){}};function C(e,t){if(!e||!t)return 0;e=e.toLowerCase().trim(),t=t.toLowerCase().trim();let r=e.length,a=t.length;if(Math.abs(r-a)>.3*Math.min(r,a))return 0;let o=Array(r+1).fill(null).map(()=>Array(a+1).fill(0));for(let e=0;e<=r;e++)o[e][0]=e;for(let e=0;e<=a;e++)o[0][e]=e;for(let n=1;n<=r;n++)for(let r=1;r<=a;r++){let a=e[n-1]===t[r-1]?0:1;o[n][r]=Math.min(o[n-1][r]+1,o[n][r-1]+1,o[n-1][r-1]+a)}let n=Math.max(r,a);return 1-o[r][a]/n}function R(){let{returnState:e,dispatch:t}=(0,i.b)(),[r,l]=(0,o.useState)(!1),[d,m]=(0,o.useState)(""),p=(0,o.useRef)(null),h=(0,o.useRef)(null);(0,o.useRef)(null);let g=(0,o.useRef)(null);(0,o.useRef)(null),(0,o.useRef)(null);let[x,N]=(0,o.useState)(!1),[f,j]=(0,o.useState)(null),[R,S]=(0,o.useState)(""),[k,E]=(0,o.useState)([]),[D,P]=(0,o.useState)(!1),[z,T]=(0,o.useState)(null),[L,_]=(0,o.useState)([]),[I,M]=(0,o.useState)(!1),[O,U]=(0,o.useState)(null),[A,B]=(0,o.useState)(!1),[F,q]=(0,o.useState)(null),[J,H]=(0,o.useState)({testButton:"bg-blue-500 hover:bg-blue-600",firebaseButton:"bg-indigo-500 hover:bg-indigo-600",productButton:"bg-green-500 hover:bg-green-600",returnButton:"bg-blue-500 hover:bg-blue-600",productListButton:"bg-purple-500 hover:bg-purple-600",pendingButton:"bg-yellow-500 hover:bg-yellow-600",downloadButton:"bg-teal-500 hover:bg-teal-600",trackingButton:"bg-blue-500 hover:bg-blue-600"}),[K,G]=(0,o.useState)(!1),[Y,V]=(0,o.useState)(null),[W,X]=(0,o.useState)(!1);(0,o.useCallback)((e,t)=>(v("[".concat(t,"] 오류:"),e),m("".concat(t," 중 오류가 발생했습니다: ").concat(e instanceof Error?e.message:"알 수 없는 오류")),null),[]);let Q=()=>{try{localStorage.getItem("returnData")&&(console.log("기존 returnData 정리 중..."),localStorage.removeItem("returnData"));let e=e=>{let t=localStorage.getItem(e);if(!t)return[];try{if(t.includes('"pN"')||t.includes('"oN"')||t.includes('"cN"'))return Z(t);return JSON.parse(t)}catch(t){return console.error("".concat(e," 데이터 로드 오류:"),t),[]}},r=e("pendingReturns"),a=e("completedReturns"),o=e("products"),n=localStorage.getItem("lastUpdated");(r.length>0||a.length>0||o.length>0)&&(t({type:"SET_RETURNS",payload:{pendingReturns:r,completedReturns:a,products:o}}),m("마지막 업데이트: ".concat(new Date(n||"").toLocaleString())))}catch(e){console.error("로컬 데이터 로드 오류:",e),m("로컬 데이터를 불러오는 중 오류가 발생했습니다.")}},$=e=>{try{return JSON.stringify(e).replace(/("productName")/g,'"pN"').replace(/("optionName")/g,'"oN"').replace(/("customerName")/g,'"cN"').replace(/("returnReason")/g,'"rR"').replace(/("barcode")/g,'"bc"').replace(/("quantity")/g,'"qty"').replace(/("zigzagProductCode")/g,'"zpc"').replace(/("purchaseName")/g,'"pnm"')}catch(t){return console.error("데이터 압축 오류:",t),JSON.stringify(e)}},Z=e=>{try{let t=e.replace(/("pN")/g,'"productName"').replace(/("oN")/g,'"optionName"').replace(/("cN")/g,'"customerName"').replace(/("rR")/g,'"returnReason"').replace(/("bc")/g,'"barcode"').replace(/("qty")/g,'"quantity"').replace(/("zpc")/g,'"zigzagProductCode"').replace(/("pnm")/g,'"purchaseName"');return JSON.parse(t)}catch(t){return console.error("데이터 압축 해제 오류:",t),JSON.parse(e)}},ee=e=>{try{let t=(e,t)=>{try{let r=$(t);return localStorage.setItem(e,r),!0}catch(r){if("QuotaExceededError"===r.name){if(console.warn("".concat(e," 저장 실패 - 할당량 초과, 데이터 크기 줄이기 시도")),Array.isArray(t)&&t.length>100){let r=t.slice(-100);try{let a=$(r);return localStorage.setItem(e,a),console.log("".concat(e," 데이터 크기 축소 저장 성공 (").concat(t.length," -> ").concat(r.length,")")),!0}catch(t){console.error("".concat(e," 축소 저장도 실패:"),t)}}return!1}throw r}},r=t("pendingReturns",e.pendingReturns||[]),a=t("completedReturns",e.completedReturns||[]),o=t("products",e.products||[]);return localStorage.setItem("lastUpdated",new Date().toISOString()),r&&a&&o||m("일부 데이터가 크기 제한으로 인해 축소 저장되었습니다."),!0}catch(e){return console.error("로컬 스토리지 저장 오류:",e),m("데이터 저장 중 오류가 발생했습니다. 브라우저 저장공간을 확인해주세요."),!1}},et=(0,o.useCallback)(()=>{try{ee(e),console.log("로컬 데이터 자동 저장 완료")}catch(e){console.error("자동 저장 실패:",e)}},[e]);(0,o.useEffect)(()=>{if(e.pendingReturns.length>0||e.completedReturns.length>0||e.products.length>0){let e=setTimeout(()=>{et()},1e3);return()=>clearTimeout(e)}},[e,et]);let er=()=>{try{let e=0;for(let t in localStorage)localStorage.hasOwnProperty(t)&&(e+=localStorage[t].length);e>5242880&&(console.log("로컬 스토리지 용량 정리 시작..."),["returnData","returnData_backup"].forEach(e=>{localStorage.getItem(e)&&(localStorage.removeItem(e),console.log("".concat(e," 삭제됨")))}),m("로컬 스토리지 정리 완료"))}catch(e){console.error("스토리지 정리 오류:",e)}};(0,o.useEffect)(()=>{er(),Q(),localStorage.getItem("pendingReturns")||localStorage.getItem("completedReturns")||m("로컬 저장소에서 데이터를 불러왔습니다. 엑셀 파일을 업로드하여 시작하세요.")},[]),(0,o.useEffect)(()=>{let e=localStorage.getItem("buttonColors");if(e)try{H(JSON.parse(e))}catch(e){console.error("색상 설정 로드 오류:",e)}},[]),(0,o.useCallback)(async(e,t)=>{try{v("".concat("products"===t?"상품":"반품"," 엑셀 파일 처리 시작:"),e.name);let r="products"===t?await c(e):await s(e);return v("".concat("products"===t?"상품":"반품"," 엑셀 파일 처리 완료:"),{파일명:e.name,데이터길이:r.length}),r}catch(e){throw Error("엑셀 파일 처리 오류: ".concat(e instanceof Error?e.message:"알 수 없는 오류"))}},[]),(0,o.useCallback)((e,t)=>{let r=[];for(let a=0;a<e.length;a+=t)r.push(e.slice(a,a+t));return r},[]);let ea=()=>{D?E([]):E(e.pendingReturns.map((e,t)=>t)),P(!D),T(null)},eo=e=>{j(e),S(e.detailReason||""),N(!0),ek(e=>e+10)},en=(0,o.useCallback)(e=>{f&&(t({type:"UPDATE_RETURN_REASON",payload:{id:f.id,detailReason:e}}),N(!1),ek(e=>Math.max(0,e-10)),m("반품 사유 상세 정보가 저장되었습니다."))},[f,t]),el=(e,t,r)=>t>0&&r[t-1].orderNumber===e.orderNumber?"bg-gray-50":"",es=e=>!!e&&"string"==typeof e&&(e.includes("불량")||e.includes("하자")||e.includes("파손")),ec=()=>{let t=[];if(eN&&eg.length>0?t=eg:eT&&eM.length>0?t=eM:e.completedReturns.length>0&&(t=e.completedReturns),0===t.length){m("다운로드할 입고 완료 데이터가 없습니다.");return}try{!function(e){let t=new Map;e.forEach(e=>{let r=e.pickupTrackingNumber||"no-tracking";t.has(r)||t.set(r,[]),t.get(r).push(e)});let r=[];t.forEach((e,t)=>{if(0===e.length)return;let a=e[0],o=a.customerName,n=a.returnReason,l=a.completedAt?new Date(a.completedAt).toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\./g,"/"):"",s=new Map;e.forEach(e=>{let t=e.purchaseName||e.productName||"",r=e.optionName||"",a=r?"".concat(t,"-").concat(r):t;s.has(a)?s.get(a).quantity+=e.quantity:s.set(a,{quantity:e.quantity,purchaseName:t,optionName:r})});let c=e.reduce((e,t)=>e+t.quantity,0);Array.from(s.entries()).forEach((e,t)=>{let[a,s]=e;r.push([l,0===t?o:"",0===t?n:"",a,0===t?"".concat(c,"개"):""])})});let a=[["날짜","고객명","반품사유","사입상품명","총 수량"],...r],o=n.P6.book_new(),l=n.P6.aoa_to_sheet(a);l["!cols"]=[{wch:12},{wch:10},{wch:15},{wch:30},{wch:10}];let s=[];for(let e=0;e<a.length;e++)s.push({hpt:20});l["!rows"]=s;let c=[],i=1;t.forEach((e,t)=>{if(0===e.length)return;let r=new Map;e.forEach(e=>{let t=e.purchaseName||e.productName||"",a=e.optionName||"",o=a?"".concat(t,"-").concat(a):t;r.has(o)?r.get(o).quantity+=e.quantity:r.set(o,{quantity:e.quantity,purchaseName:t,optionName:a})});let a=Array.from(r.entries()).length;a>1&&(c.push({s:{r:i,c:1},e:{r:i+a-1,c:1}}),c.push({s:{r:i,c:2},e:{r:i+a-1,c:2}}),c.push({s:{r:i,c:4},e:{r:i+a-1,c:4}})),i+=a}),l["!merges"]=c;for(let e=0;e<a.length;e++)for(let t=0;t<a[e].length;t++){let r=n.P6.encode_cell({r:e,c:t});l[r]&&(l[r].s={font:{sz:10},alignment:{horizontal:"center",vertical:"center"},border:{top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}}})}n.P6.book_append_sheet(o,l,"입고완료 반품목록");let d="입고완료_반품목록_".concat(new Date().toISOString().split("T")[0],".xlsx");n.NC(o,d)}(t);let e="";eN?e="검색 결과 ":eT&&(e="".concat(new Date(eT).toLocaleDateString("ko-KR")," 날짜의 ")),m("".concat(e).concat(t.length,"개 항목이 엑셀 파일로 저장되었습니다."))}catch(e){console.error("엑셀 생성 중 오류:",e),m("엑셀 파일 생성 중 오류가 발생했습니다.")}};(0,o.useCallback)(e=>{V(e),G(!0),ek(e=>e+10)},[]);let ei=()=>{I?_([]):_(eM.map((e,t)=>t)),M(!I),U(null)},ed=e=>{if(!e||"string"!=typeof e)return"";let t=e.toLowerCase();return t.includes("불실")||t.includes("변심")||t.includes("단순")?"단순변심":t.includes("실못")||t.includes("잘못")&&t.includes("주문")?"주문실수":t.includes("파손")||t.includes("불량")?"파손 및 불량":e},eu=(0,o.useCallback)(()=>{if(!e.products||0===e.products.length){m("삭제할 상품 데이터가 없습니다.");return}confirm("정말로 모든 상품 데이터를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.")&&(t({type:"SET_PRODUCTS",payload:[]}),ee({...e,products:[]}),m("모든 상품 데이터가 삭제되었습니다."))},[e,t,ee]);(0,o.useCallback)(e=>{q(e),B(!0),ek(e=>e+10)},[]);let em=(0,o.useCallback)(r=>{if(!F)return;let a={...F,returnTrackingNumber:r.trim()};if(r.trim()){t({type:"REMOVE_PENDING_RETURN",payload:{id:a.id}});let e={...a,status:"COMPLETED",completedAt:new Date};t({type:"ADD_COMPLETED_RETURN",payload:e}),m("".concat(e.productName," 상품이 입고완료 처리되었습니다."))}else t({type:"UPDATE_PENDING_RETURN",payload:a}),m("반품송장번호가 업데이트되었습니다.");ee(e),B(!1),q(null),ek(e=>Math.max(0,e-10))},[F,t,e,ee]),[ep,eh]=(0,o.useState)(""),[eg,ex]=(0,o.useState)([]),[eN,ef]=(0,o.useState)(!1),ey=()=>{if(!ep.trim()){ef(!1),ex([]);return}let t=ep.toLowerCase().trim(),r=e.completedReturns.filter(e=>e.customerName&&e.customerName.toLowerCase().includes(t)||e.orderNumber&&e.orderNumber.toLowerCase().includes(t));ex(r),ef(!0),0===r.length?m("검색 결과가 없습니다."):m("".concat(r.length,"개의 검색 결과를 찾았습니다."))},eb=e=>{let t={};return e.forEach(e=>{if(e.completedAt){let r=new Date(e.completedAt),a=new Date(r.getFullYear(),r.getMonth(),r.getDate()).toISOString().split("T")[0];t[a]||(t[a]=[]),t[a].push(e)}}),Object.entries(t).sort((e,t)=>{let[r]=e,[a]=t;return a.localeCompare(r)}).map(e=>{let[t,r]=e;return{date:t,items:r}})};(0,o.useMemo)(()=>Object.entries(e.completedReturns.reduce((e,t)=>{if(!t.completedAt)return e;let r=new Date(t.completedAt),a=new Date(r.getFullYear(),r.getMonth(),r.getDate()).toLocaleDateString();return e[a]||(e[a]=[]),e[a].push(t),e},{})).map(e=>{let[t,r]=e;return{date:t,items:r.sort((e,t)=>new Date(t.completedAt).getTime()-new Date(e.completedAt).getTime())}}).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),[e.completedReturns]);let ew=(0,o.useMemo)(()=>eN&&0!==eg.length?eb(eg):[],[eN,eg]),ej=e=>e.barcode&&"-"!==e.barcode?e.purchaseName&&"-"!==e.purchaseName?(0,a.jsx)("span",{children:e.purchaseName}):(0,a.jsx)("span",{children:e.productName}):(0,a.jsx)("button",{className:"text-blue-600 hover:text-blue-800 underline",onClick:()=>eY(e),children:e.productName});function ev(e,t){let r={...e};if(e.barcode&&"-"!==e.barcode)return e;let a=t=>{if(!e.optionName||0===t.length)return t[0]||null;let r=e.optionName.toLowerCase().trim(),a=t.find(e=>e.optionName&&e.optionName.toLowerCase().trim()===r);if(a)return console.log("✅ 옵션명 정확 매칭: ".concat(e.optionName," → ").concat(a.optionName)),a;let n=null,l=.7;for(let e of t)if(e.optionName){let t=C(r,e.optionName.toLowerCase().trim());t>l&&(l=t,n=e)}if(n)return console.log("✅ 옵션명 유사도 매칭: ".concat(e.optionName," → ").concat(n.optionName," (유사도: ").concat(l.toFixed(2),")")),n;console.log('\uD83D\uDD0D 옵션명 부분 매칭 시도: "'.concat(e.optionName,'"'));let s=null,c=0,i=o(r);for(let e of(console.log("반품 옵션 키워드: [".concat(i.join(", "),"]")),t))if(e.optionName){let t=o(e.optionName.toLowerCase().trim()),r=i.filter(e=>t.some(t=>!!(t===e||e.length>=3&&t.includes(e)||t.length>=3&&e.includes(t))));if(r.length>0){let a=r.length/Math.max(i.length,t.length)*.8+r.length/i.length*.2;console.log("  - ".concat(e.optionName,": 공통키워드 ").concat(r.length,"개 [").concat(r.join(", "),"], 점수: ").concat(a.toFixed(2))),a>c&&a>=.4&&(c=a,s=e,console.log("    → 현재 최고 점수로 선택됨"))}else console.log("  - ".concat(e.optionName,": 공통키워드 없음"))}return s?(console.log("✅ 옵션명 부분 매칭 성공: ".concat(e.optionName," → ").concat(s.optionName," (점수: ").concat(c.toFixed(2),")")),s):(console.log("⚠️ 옵션명 매칭 실패, 매칭 불가: ".concat(e.optionName)),null)},o=e=>e.replace(/[\[\]]/g,"").split(/[,\/:\-\s]+/).map(e=>e.trim()).filter(e=>e.length>0&&"선택"!==e);if(e.customProductCode&&"-"!==e.customProductCode){console.log('\uD83D\uDD0D 자체상품코드 "'.concat(e.customProductCode,'"로 매칭 시도...'));let o=t.filter(t=>t.customProductCode&&t.customProductCode.toLowerCase().trim()===e.customProductCode.toLowerCase().trim()||t.zigzagProductCode&&t.zigzagProductCode.toLowerCase().trim()===e.customProductCode.toLowerCase().trim());if(o.length>0){let t=a(o);if(t)return console.log("✅ 자체상품코드 정확 매칭 성공 (옵션 고려): ".concat(e.customProductCode," → ").concat(t.purchaseName||t.productName," [").concat(t.optionName,"]")),r.barcode=t.barcode,r.purchaseName=t.purchaseName||t.productName,r.zigzagProductCode=t.zigzagProductCode||"",r.matchType="custom_code_exact",r.matchSimilarity=1,r.matchedProductName=t.productName,r;console.log("❌ 자체상품코드 매칭 실패: 옵션명 매칭 불가 (".concat(e.optionName,")"))}console.log('\uD83D\uDD0D 자체상품코드 "'.concat(e.customProductCode,'"와 사입상품명 유사도 매칭 시도...'));let n=null,l=e.customProductCode.toLowerCase().trim();for(let e of t)if(e.purchaseName&&"string"==typeof e.purchaseName){let t=e.purchaseName.toLowerCase().trim();if(t.includes(l)||l.includes(t))(!n||.95>n.similarity)&&(n={product:e,similarity:.95,matchType:"자체상품코드-사입명 포함관계"},console.log("\uD83D\uDCCC 포함관계 발견 (유사도: ".concat("0.95",'): "').concat(l,'" ↔ "').concat(t,'"')));else{let r=C(l,t);r>.4&&(!n||r>n.similarity)&&(n={product:e,similarity:r,matchType:"자체상품코드-사입명 유사도"},console.log("\uD83D\uDCCA 유사도 매칭 (유사도: ".concat(r.toFixed(2),'): "').concat(l,'" ↔ "').concat(t,'"')))}}if(n&&n.similarity>.5)return console.log("✅ 자체상품코드 기반 매칭 성공 (".concat(n.matchType,", 유사도: ").concat(n.similarity.toFixed(2),")")),r.barcode=n.product.barcode,r.purchaseName=n.product.purchaseName||n.product.productName,r.zigzagProductCode=n.product.zigzagProductCode||e.zigzagProductCode,r.customProductCode=n.product.customProductCode||n.product.zigzagProductCode||"",r.matchType=n.matchType,r.matchSimilarity=n.similarity,r.matchedProductName=n.product.productName,r;console.log("❌ 자체상품코드 기반 매칭 실패: ".concat(e.customProductCode))}if(e.purchaseName&&"-"!==e.purchaseName){let o=t.filter(t=>{var r;return t.purchaseName&&t.purchaseName.toLowerCase().trim()===(null===(r=e.purchaseName)||void 0===r?void 0:r.toLowerCase().trim())});if(o.length>0){let t=a(o);if(t)return console.log("✅ 사입상품명 매칭 성공 (옵션 고려): ".concat(e.purchaseName," → ").concat(t.productName," [").concat(t.optionName,"]")),r.barcode=t.barcode,r.customProductCode=t.customProductCode||t.zigzagProductCode||"",r.zigzagProductCode=t.zigzagProductCode||"",r.matchType="purchase_name_match",r.matchSimilarity=1,r.matchedProductName=t.productName,r;console.log("❌ 사입상품명 매칭 실패: 옵션명 매칭 불가 (".concat(e.optionName,")"))}}if(e.zigzagProductCode&&"-"!==e.zigzagProductCode){console.log('\uD83D\uDD0D 지그재그 상품코드 "'.concat(e.zigzagProductCode,'"로 매칭 시도...'));let o=t.filter(t=>t.zigzagProductCode&&t.zigzagProductCode.toLowerCase().trim()===e.zigzagProductCode.toLowerCase().trim());if(o.length>0){let t=a(o);if(t)return console.log("✅ 지그재그 상품코드 정확 매칭 성공 (옵션 고려): ".concat(e.zigzagProductCode," → ").concat(t.productName," [").concat(t.optionName,"]")),r.barcode=t.barcode,r.purchaseName=t.purchaseName||t.productName,r.customProductCode=t.customProductCode||"",r.matchType="zigzag_code_exact",r.matchSimilarity=1,r.matchedProductName=t.productName,r}console.log('\uD83D\uDD0D 지그재그 코드 "'.concat(e.zigzagProductCode,'"와 사입상품명 유사도 매칭 시도...'));let n=null,l=e.zigzagProductCode.toLowerCase().trim();for(let e of t)if(e.purchaseName&&"string"==typeof e.purchaseName){let t=e.purchaseName.toLowerCase().trim();if(t.includes(l)||l.includes(t))(!n||.9>n.similarity)&&(n={product:e,similarity:.9,matchType:"지그재그코드-사입명 포함관계"},console.log("\uD83D\uDCCC 포함관계 발견 (유사도: ".concat("0.90",'): "').concat(l,'" ↔ "').concat(t,'"')));else{let r=C(l,t);r>.4&&(!n||r>n.similarity)&&(n={product:e,similarity:r,matchType:"지그재그코드-사입명 유사도"},console.log("\uD83D\uDCCA 유사도 매칭 (유사도: ".concat(r.toFixed(2),'): "').concat(l,'" ↔ "').concat(t,'"')))}}if(n&&n.similarity>.5)return console.log("✅ 지그재그 코드 기반 매칭 성공 (".concat(n.matchType,", 유사도: ").concat(n.similarity.toFixed(2),")")),r.barcode=n.product.barcode,r.purchaseName=n.product.purchaseName||n.product.productName,r.customProductCode=n.product.customProductCode||n.product.zigzagProductCode||"",r.matchType=n.matchType,r.matchSimilarity=n.similarity,r.matchedProductName=n.product.productName,r;console.log("❌ 지그재그 코드 기반 매칭 실패: ".concat(e.zigzagProductCode))}if(e.productName){let o=t.filter(t=>{var r,a;return t.productName&&t.productName.toLowerCase().trim()===(null===(r=e.productName)||void 0===r?void 0:r.toLowerCase().trim())||t.purchaseName&&t.purchaseName.toLowerCase().trim()===(null===(a=e.productName)||void 0===a?void 0:a.toLowerCase().trim())});if(o.length>0){let t=a(o);if(t)return console.log("✅ 상품명 정확 매칭 성공 (옵션 고려): ".concat(e.productName," → ").concat(t.productName," [").concat(t.optionName,"]")),r.barcode=t.barcode,r.customProductCode=t.customProductCode||t.zigzagProductCode||"",r.purchaseName=t.purchaseName||t.productName,r.zigzagProductCode=t.zigzagProductCode||"",r.matchType="name_exact",r.matchSimilarity=1,r.matchedProductName=t.productName,r;console.log("❌ 상품명 정확 매칭 실패: 옵션명 매칭 불가 (".concat(e.optionName,")"))}let n=t.filter(t=>t.productName&&e.productName&&(t.productName.toLowerCase().includes(e.productName.toLowerCase())||e.productName.toLowerCase().includes(t.productName.toLowerCase()))||t.purchaseName&&e.productName&&(t.purchaseName.toLowerCase().includes(e.productName.toLowerCase())||e.productName.toLowerCase().includes(t.purchaseName.toLowerCase())));if(n.length>0){let t=a(n);if(t)return console.log("✅ 상품명 부분 매칭 성공 (옵션 고려): ".concat(e.productName," → ").concat(t.productName," [").concat(t.optionName,"]")),r.barcode=t.barcode,r.customProductCode=t.customProductCode||t.zigzagProductCode||"",r.purchaseName=t.purchaseName||t.productName,r.zigzagProductCode=t.zigzagProductCode||"",r.matchType="name_partial",r.matchSimilarity=.8,r.matchedProductName=t.productName,r;console.log("❌ 상품명 부분 매칭 실패: 옵션명 매칭 불가 (".concat(e.optionName,")"))}let l=[];for(let r of t){if(r.productName&&e.productName){let t=C(r.productName.toLowerCase(),e.productName.toLowerCase());t>.6&&l.push({product:r,similarity:t})}if(r.purchaseName&&e.productName){let t=C(r.purchaseName.toLowerCase(),e.productName.toLowerCase());t>.6&&l.push({product:r,similarity:t})}}if(l.length>0){l.sort((e,t)=>t.similarity-e.similarity);let t=a(l.filter(e=>e.similarity>=l[0].similarity-.1).map(e=>e.product));if(t){let a=l.find(e=>e.product===t);return console.log("✅ 상품명 유사도 매칭 성공 (옵션 고려): ".concat(e.productName," → ").concat(t.productName," [").concat(t.optionName,"] (유사도: ").concat(null==a?void 0:a.similarity.toFixed(2),")")),r.barcode=t.barcode,r.customProductCode=t.customProductCode||t.zigzagProductCode||"",r.purchaseName=t.purchaseName||t.productName,r.zigzagProductCode=t.zigzagProductCode||"",r.matchType="name_similarity",r.matchSimilarity=(null==a?void 0:a.similarity)||.6,r.matchedProductName=t.productName,r}console.log("❌ 상품명 유사도 매칭 실패: 옵션명 매칭 불가 (".concat(e.optionName,")"))}}return console.log("❌ 매칭 실패: ".concat(e.productName)),r.matchType="no_match",r.matchSimilarity=0,r}let eC=e=>e.map(e=>({trackingNumber:e.pickupTrackingNumber||e.returnTrackingNumber||"no-tracking",items:[e],totalQuantity:e.quantity||1,isGroup:!1})),eR=e=>{let{items:t}=e,r=eC(t);return(0,a.jsxs)("table",{className:"min-w-full border-collapse",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-50",children:[(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 text-center",children:(0,a.jsx)("input",{type:"checkbox",checked:I,onChange:ei,className:"w-5 h-5"})}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 w-24",children:"고객명"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"주문번호"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"사입상품명"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"옵션명"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 w-12",children:"수량"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"반품사유"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"수거송장번호"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"바코드번호"})]})}),(0,a.jsx)("tbody",{children:r.map((e,r)=>{let o=e.items[0],n=t.findIndex(e=>e.id===o.id),l=L.includes(n);return(0,a.jsxs)("tr",{className:"hover:bg-blue-50 ".concat(es(o.returnReason)?"text-red-500":""),children:[(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300",children:(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)("input",{type:"checkbox",checked:l,onChange:e=>{e.target.checked?_(e=>[...e,n]):_(e=>e.filter(e=>e!==n))},className:"w-5 h-5"})})}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 whitespace-nowrap overflow-hidden text-ellipsis max-w-[120px]",children:o.customerName}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 whitespace-nowrap overflow-hidden text-ellipsis",children:o.orderNumber}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300",children:(0,a.jsx)("div",{className:o.barcode?"whitespace-nowrap overflow-hidden text-ellipsis":"whitespace-normal break-words line-clamp-2",children:ej(o)})}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 whitespace-nowrap overflow-hidden text-ellipsis",children:o.optionName}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 whitespace-nowrap text-center",children:o.quantity}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 whitespace-nowrap overflow-hidden text-ellipsis max-w-[150px] cursor-pointer",onClick:()=>es(o.returnReason)&&eo(o),children:eA(o)}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300",children:(0,a.jsx)("div",{className:"font-mono text-sm whitespace-nowrap bg-blue-100 px-2 py-1 rounded text-center",children:"no-tracking"===e.trackingNumber?"-":e.trackingNumber})}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300",children:(0,a.jsx)("span",{className:"font-mono text-sm whitespace-nowrap",children:o.barcode||"-"})})]},o.id)})})]})},[eS,ek]=(0,o.useState)(0),[eE,eD]=(0,o.useState)([]),[eP,ez]=(0,o.useState)(0),[eT,eL]=(0,o.useState)(""),[e_,eI]=(0,o.useState)([]);(0,o.useEffect)(()=>{let e=document.createElement("style");return e.innerHTML="\n      dialog {\n        position: fixed !important;\n        margin: auto !important;\n        border: none !important;\n        border-radius: 0.5rem !important;\n        padding: 1rem !important;\n        background: white !important;\n        max-width: 95vw !important;\n        max-height: 90vh !important;\n        overflow: auto !important;\n      }\n      dialog::backdrop {\n        background-color: rgba(0, 0, 0, 0.4) !important;\n      }\n      .popup-layer {\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2) !important;\n      }\n    ",document.head.appendChild(e),()=>{document.head.removeChild(e)}},[]),(0,o.useEffect)(()=>{if(e.completedReturns.length>0){let t=[...new Set(e.completedReturns.map(e=>new Date(e.completedAt).toLocaleDateString()))].sort((e,t)=>new Date(t).getTime()-new Date(e).getTime());eI(t),eL(t[0]||""),ez(0)}},[e.completedReturns]);let eM=(0,o.useMemo)(()=>!eT||eN?[]:e.completedReturns.filter(e=>new Date(e.completedAt).toLocaleDateString()===eT),[e.completedReturns,eT,eN]),eO=e=>{let t;0!==e_.length&&(ez(t="prev"===e&&eP<e_.length-1?eP+1:"next"===e&&eP>0?eP-1:"prev"===e?0:e_.length-1),eL(e_[t]),m("".concat(new Date(e_[t]).toLocaleDateString("ko-KR")," 날짜의 데이터로 이동했습니다.")))},eU=e=>{eO(e)},eA=e=>{let t=e.returnReason;return e.detailReason&&""!==e.detailReason.trim()&&!t.toLowerCase().includes(e.detailReason.toLowerCase())&&(t+=" (".concat(e.detailReason,")")),t},[eB,eF]=(0,o.useState)(""),[eq,eJ]=(0,o.useState)(null),eH=()=>{let r=eB.trim();if(!r){m("수거송장번호를 입력해주세요.");return}let a=e.pendingReturns.filter(e=>e.pickupTrackingNumber&&e.pickupTrackingNumber===r||e.returnTrackingNumber&&e.returnTrackingNumber===r);if(0===a.length){m("'".concat(r,"' 수거송장번호로 등록된 반품이 없습니다.")),eF("");return}l(!0);let o=new Date,n=new Date(o.getFullYear(),o.getMonth(),o.getDate());n.setHours(0,0,0,0);let s=a.map(e=>({...e,status:"COMPLETED",completedAt:n})),c=[...s,...e.completedReturns],i=e.pendingReturns.filter(e=>e.returnTrackingNumber!==r);t({type:"SET_RETURNS",payload:{...e,pendingReturns:i,completedReturns:c}}),localStorage.setItem("pendingReturns",JSON.stringify(i)),localStorage.setItem("completedReturns",JSON.stringify(c)),localStorage.setItem("lastUpdated",new Date().toISOString());let d=n.toLocaleDateString();if(d!==eT){eL(d);let e=e_.indexOf(d);e>=0?ez(e):(eI([d,...e_]),ez(0))}m("'".concat(r,"' 수거송장번호로 ").concat(s.length,"개 항목이 입고 처리되었습니다.")),eF(""),l(!1)},[eK,eG]=(0,o.useState)(null),eY=e=>{V(e),eG(e),G(!0),ek(e=>e+10)},eV=()=>{if(0===L.length)return;l(!0);let r=L.map(e=>eM[e]),a=r.map(e=>{let{completedAt:t,status:r,...a}=e;return{...a,status:"PENDING"}}),o=e.completedReturns.filter(e=>!r.some(t=>t.orderNumber===e.orderNumber&&t.productName===e.productName&&t.optionName===e.optionName&&t.returnTrackingNumber===e.returnTrackingNumber)),n=[...e.pendingReturns,...a];t({type:"SET_RETURNS",payload:{...e,pendingReturns:n,completedReturns:o}}),localStorage.setItem("pendingReturns",JSON.stringify(n)),localStorage.setItem("completedReturns",JSON.stringify(o)),localStorage.setItem("lastUpdated",new Date().toISOString()),m("".concat(L.length,"개의 항목이 입고전 목록으로 되돌아갔습니다.")),_([]),M(!1),l(!1)};return(0,a.jsxs)("main",{className:"min-h-screen p-4 md:p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"반품 관리 시스템"}),d&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-blue-100 text-blue-800 rounded",children:d}),(0,a.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 mb-6",children:[(0,a.jsx)("button",{className:"px-4 py-2 text-white rounded ".concat(J.testButton),onClick:()=>{try{l(!0),m("로컬 저장소 상태를 확인 중...");let e=localStorage.getItem("pendingReturns"),t=localStorage.getItem("completedReturns"),r=localStorage.getItem("products"),a=localStorage.getItem("lastUpdated"),o=e?JSON.parse(e).length:0,n=t?JSON.parse(t).length:0,s=r?JSON.parse(r).length:0,c=0;for(let e in localStorage)localStorage.hasOwnProperty(e)&&(c+=localStorage[e].length);let i=(c/1048576).toFixed(2),d="\n        로컬 저장소 상태:\n        • 입고전 반품: ".concat(o,"개\n        • 입고완료 반품: ").concat(n,"개  \n        • 상품 데이터: ").concat(s,"개\n        • 저장소 사용량: ").concat(i,"MB\n        • 마지막 업데이트: ").concat(a?new Date(a).toLocaleString():"없음","\n      ");m(d),console.log("로컬 저장소 상태:",{pendingReturns:o,completedReturns:n,products:s,totalSizeMB:i,lastUpdated:a})}catch(e){m("로컬 저장소 확인 실패: ".concat(e instanceof Error?e.message:"알 수 없는 오류")),console.error("로컬 저장소 확인 실패:",e)}finally{l(!1)}},disabled:r,children:"저장소 상태 확인"}),(0,a.jsx)("button",{className:"px-4 py-2 text-white rounded ".concat(J.firebaseButton),onClick:()=>{l(!0),m("데이터를 백업 중입니다...");try{let t={pendingReturns:e.pendingReturns,completedReturns:e.completedReturns,products:e.products,exportDate:new Date().toISOString(),version:"1.0"},r=JSON.stringify(t,null,2),a=new Blob([r],{type:"application/json"}),o=URL.createObjectURL(a),n=document.createElement("a");n.href=o,n.download="반품데이터_백업_".concat(new Date().toISOString().split("T")[0],".json"),n.click(),URL.revokeObjectURL(o),m("데이터 백업이 완료되었습니다. 다운로드 폴더를 확인하세요.")}catch(e){console.error("백업 오류:",e),m("데이터 백업 중 오류가 발생했습니다.")}finally{l(!1)}},disabled:r,children:"데이터 백업"}),(0,a.jsxs)("label",{className:"px-4 py-2 text-white rounded text-center cursor-pointer bg-purple-500 hover:bg-purple-600",htmlFor:"restoreFile",children:["데이터 복원",(0,a.jsx)("input",{type:"file",id:"restoreFile",accept:".json",onChange:e=>{var r;let a=null===(r=e.target.files)||void 0===r?void 0:r[0];if(!a)return;l(!0),m("백업 데이터를 복원 중입니다...");let o=new FileReader;o.onload=r=>{try{var a;let e=JSON.parse(null===(a=r.target)||void 0===a?void 0:a.result);if(!e.version||!e.exportDate)throw Error("유효하지 않은 백업 파일입니다.");let o={pendingReturns:e.pendingReturns||[],completedReturns:e.completedReturns||[],products:e.products||[]};t({type:"SET_RETURNS",payload:o}),ee(o);let n=new Date(e.exportDate).toLocaleString();m("데이터 복원이 완료되었습니다. (백업 날짜: ".concat(n,")")),console.log("데이터 복원 완료:",{pendingReturns:o.pendingReturns.length,completedReturns:o.completedReturns.length,products:o.products.length,backupDate:n})}catch(e){console.error("복원 오류:",e),m("데이터 복원 중 오류가 발생했습니다: ".concat(e instanceof Error?e.message:"알 수 없는 오류"))}finally{l(!1),e.target.value=""}},o.onerror=()=>{m("파일을 읽는 중 오류가 발생했습니다."),l(!1),e.target.value=""},o.readAsText(a)},className:"hidden",disabled:r})]}),(0,a.jsxs)("label",{className:"px-4 py-2 text-white rounded text-center cursor-pointer ".concat(J.productButton),htmlFor:"productFile",children:["상품 업로드",(0,a.jsx)("input",{type:"file",id:"productFile",accept:".xlsx,.xls",onChange:r=>{if(!r.target.files||0===r.target.files.length)return;let a=r.target.files[0];l(!0),m("상품 데이터 파일을 처리 중입니다..."),c(a).then(r=>{if(0===r.length){m("파일에서 유효한 상품 데이터를 찾을 수 없습니다.");return}t({type:"ADD_PRODUCTS",payload:r});let a=[...e.products,...r];localStorage.setItem("products",JSON.stringify(a)),localStorage.setItem("lastUpdated",new Date().toISOString());let o=e.pendingReturns.filter(e=>!e.barcode);if(o.length>0){let e=0;o.forEach(a=>{let o=ev(a,r);o.barcode&&(e++,t({type:"UPDATE_RETURN_ITEM",payload:o}))}),e>0?m("".concat(r.length,"개 상품이 추가되었습니다. ").concat(e,"개 반품 항목이 자동 매칭되었습니다.")):m("".concat(r.length,"개 상품이 추가되었습니다."))}else m("".concat(r.length,"개 상품이 추가되었습니다."))}).catch(e=>{console.error("상품 데이터 처리 오류:",e),m("상품 데이터 처리 중 오류가 발생했습니다: ".concat(e instanceof Error?e.message:String(e)))}).finally(()=>{l(!1),r.target.value=""})},ref:h,className:"hidden",disabled:r})]}),(0,a.jsxs)("label",{className:"px-4 py-2 text-white rounded text-center cursor-pointer ".concat(J.returnButton),htmlFor:"returnFile",children:["반품 업로드",(0,a.jsx)("input",{type:"file",id:"returnFile",accept:".xlsx,.xls",onChange:r=>{if(!r.target.files||0===r.target.files.length)return;let a=r.target.files[0];l(!0),m("반품 데이터 파일을 처리 중입니다..."),s(a).then(r=>{if(0===r.length){m("파일에서 유효한 반품 데이터를 찾을 수 없습니다.");return}let a=r.map(e=>({...e,returnReason:ed(e.returnReason)}));t({type:"ADD_RETURNS",payload:a});let o=[...e.pendingReturns,...a];localStorage.setItem("pendingReturns",JSON.stringify(o)),localStorage.setItem("lastUpdated",new Date().toISOString()),m("".concat(a.length,"개 반품 항목이 성공적으로 추가되었습니다."))}).catch(e=>{console.error("반품 데이터 처리 오류:",e),m("반품 데이터 처리 중 오류가 발생했습니다: ".concat(e instanceof Error?e.message:String(e)))}).finally(()=>{l(!1),r.target.value=""})},ref:p,className:"hidden",disabled:r})]}),(0,a.jsx)("button",{className:"px-4 py-2 text-white rounded ".concat(J.productListButton),onClick:()=>{var e;return null===(e=g.current)||void 0===e?void 0:e.showModal()},disabled:r,children:"상품 목록"}),(0,a.jsxs)("button",{className:"px-4 py-2 text-white rounded ".concat(J.pendingButton),onClick:()=>X(!0),disabled:r,children:["입고전 (",e.pendingReturns.length,")"]})]}),r&&(0,a.jsxs)("div",{className:"flex justify-center items-center my-4",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"}),(0,a.jsx)("span",{className:"ml-2",children:"처리 중..."})]}),(0,a.jsxs)("div",{className:"mb-6 p-4 border rounded-lg shadow-sm bg-white",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"수거송장번호로 입고"}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2",children:[(0,a.jsx)("input",{type:"text",placeholder:"수거송장번호 입력 후 Enter 또는 입고 버튼 클릭",className:"flex-1 px-4 py-2 border border-gray-300 rounded",value:eB,onChange:e=>eF(e.target.value),onKeyDown:e=>{if("Enter"===e.key){if(!eB.trim()){m("수거송장번호를 입력해주세요.");return}eH()}}}),(0,a.jsx)("button",{className:"px-4 py-2 text-white rounded ".concat(J.trackingButton),onClick:eH,disabled:r||!eB.trim(),children:"입고"})]})]}),(0,a.jsxs)("div",{className:"p-4 border rounded-lg shadow-sm bg-white",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"입고완료 반품 목록"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{className:"px-3 py-1 text-white rounded ".concat(J.downloadButton),onClick:ec,disabled:r||0===e.completedReturns.length,children:"목록 다운로드"}),(0,a.jsx)("button",{className:"px-3 py-1 text-white rounded bg-purple-500 hover:bg-purple-600",onClick:ec,disabled:r||0===e.completedReturns.length,children:"셀 복사용 다운로드"})]})]}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row mb-4 space-y-2 md:space-y-0 md:space-x-2",children:[(0,a.jsx)("input",{type:"text",placeholder:"고객명 또는 주문번호로 검색",className:"flex-1 px-4 py-2 border border-gray-300 rounded",value:ep,onChange:e=>eh(e.target.value),onKeyPress:e=>"Enter"===e.key&&ey()}),(0,a.jsx)("button",{className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded",onClick:ey,children:"검색"}),eN&&(0,a.jsx)("button",{className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded",onClick:()=>{eh(""),ex([]),ef(!1)},children:"검색 취소"})]}),!eN&&e_.length>0&&(0,a.jsxs)("div",{className:"flex items-center justify-center mb-4 p-2 bg-gray-100 rounded-md",children:[(0,a.jsx)("button",{className:"px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded-l-md",onClick:()=>eU("prev"),children:"<"}),(0,a.jsx)("div",{className:"mx-3 font-medium",children:eT&&new Date(eT).toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"})}),(0,a.jsx)("button",{className:"px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded-r-md",onClick:()=>eU("next"),children:">"})]}),e.completedReturns.length>0?(0,a.jsxs)("div",{className:"space-y-6",children:[eN&&ew.length>0&&ew.map(e=>{let{date:t,items:r}=e;return(0,a.jsxs)("div",{id:"date-group-".concat(t),className:"border border-gray-200 rounded-md overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-gray-100 px-4 py-2 font-medium flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[new Date(t).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric",weekday:"long"}),(0,a.jsxs)("span",{className:"ml-2 text-gray-600 text-sm",children:["(",r.length,"개)"]})]}),L.length>0&&(0,a.jsxs)("button",{className:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded",onClick:eV,children:["되돌리기 (",L.length,")"]})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsx)(eR,{items:r})})]},t)}),!eN&&eT&&(0,a.jsxs)("div",{className:"border border-gray-200 rounded-md overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-gray-100 px-4 py-2 font-medium flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[new Date(eT).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric",weekday:"long"}),(0,a.jsxs)("span",{className:"ml-2 text-gray-600 text-sm",children:["(",eM.length,"개)"]})]}),L.length>0&&(0,a.jsxs)("button",{className:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded",onClick:eV,children:["되돌리기 (",L.length,")"]})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsx)(eR,{items:eM})})]})]}):(0,a.jsx)("p",{children:"입고완료된 반품이 없습니다."})]}),A&&F&&(0,a.jsx)(y,{isOpen:A,onClose:()=>{eF(""),eJ(null),m("수거송장번호 입력이 취소되었습니다.")},returnItem:F,onSave:em,zIndex:1e3+eS}),(0,a.jsx)(w,{isOpen:W,onClose:()=>X(!1),items:e.pendingReturns,selectedItems:k,onRefresh:()=>{if(l(!0),m("데이터를 새로고침 중입니다..."),e.pendingReturns.length>0){let r=new Set(e.completedReturns.map(e=>"".concat(e.customerName,"_").concat(e.orderNumber,"_").concat(e.purchaseName||e.productName,"_").concat(e.optionName,"_").concat(e.returnTrackingNumber))),a=new Map;e.pendingReturns.forEach(e=>{let t="".concat(e.customerName,"_").concat(e.orderNumber,"_").concat(e.purchaseName||e.productName,"_").concat(e.optionName,"_").concat(e.returnTrackingNumber);if(r.has(t)){console.log("중복 항목 제외 (이미 입고완료): ".concat(t));return}a.has(t)||a.set(t,e)});let o=Array.from(a.values()),n=e.pendingReturns.length-o.length;n>0&&(console.log("중복 제거: ".concat(n,"개 항목 제거됨")),t({type:"SET_RETURNS",payload:{...e,pendingReturns:o}}))}if(e.pendingReturns.length>0&&e.products.length>0){let r=e.pendingReturns.map(t=>ev(t,e.products)),a=r.filter(e=>e.barcode).length-e.pendingReturns.filter(e=>e.barcode).length;a>0?(t({type:"SET_RETURNS",payload:{...e,pendingReturns:r}}),m("새로고침 완료: ".concat(a,"개 상품이 자동 매칭되었습니다."))):m("새로고침 완료. 매칭할 상품이 없습니다.")}else m("새로고침 완료.");setTimeout(()=>{l(!1)},500)},onProcessSelected:()=>{if(0===k.length)return;let r=k.map(t=>e.pendingReturns[t]);e.products.length>0&&(r=r.map(t=>t.barcode&&"-"!==t.barcode?t:ev(t,e.products))),t({type:"PROCESS_RETURNS",payload:r}),E([]),P(!1),m("".concat(r.length,"개 항목을 입고 처리했습니다."))},onDeleteSelected:()=>{if(0===k.length){m("삭제할 항목을 선택해주세요.");return}l(!0),m("".concat(k.length,"개 항목을 삭제 중입니다...")),setTimeout(()=>{let r=e.pendingReturns.filter((e,t)=>!k.includes(t));t({type:"SET_RETURNS",payload:{...e,pendingReturns:r}}),E([]),l(!1),m("".concat(k.length,"개 항목이 삭제되었습니다."))},1e3)},onItemSelect:(t,r)=>{let a=e.pendingReturns.findIndex(e=>e.id===t.id);r?E(e=>[...e,a]):E(e=>e.filter(e=>e!==a))},PendingItemsTable:e=>{let{items:t}=e,r=eC(t);return(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-2 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,a.jsx)("input",{type:"checkbox",checked:D,onChange:ea,className:"w-5 h-5"})}),(0,a.jsx)("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24",children:"고객명"}),(0,a.jsx)("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"주문번호"}),(0,a.jsx)("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"사입상품명"}),(0,a.jsx)("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"옵션"}),(0,a.jsx)("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-12",children:"수량"}),(0,a.jsx)("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"반품사유"}),(0,a.jsx)("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"수거송장번호"}),(0,a.jsx)("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"바코드번호"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:r.map((e,r)=>{let o=e.items[0],n=t.findIndex(e=>e.id===o.id),l=k.includes(n);return(0,a.jsxs)("tr",{className:"hover:bg-blue-50 ".concat(el(o,n,t)),children:[(0,a.jsx)("td",{className:"px-2 py-2",children:(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)("input",{type:"checkbox",checked:l,onChange:e=>{e.target.checked?E(e=>[...e,n]):E(e=>e.filter(e=>e!==n))},className:"w-5 h-5"})})}),(0,a.jsx)("td",{className:"px-2 py-2 whitespace-nowrap overflow-hidden text-ellipsis max-w-[120px]",children:o.customerName}),(0,a.jsx)("td",{className:"px-2 py-2 whitespace-nowrap overflow-hidden text-ellipsis",children:o.orderNumber}),(0,a.jsx)("td",{className:"px-2 py-2",children:(0,a.jsx)("div",{className:o.barcode?"whitespace-nowrap overflow-hidden text-ellipsis":"whitespace-normal break-words line-clamp-2",children:ej(o)})}),(0,a.jsx)("td",{className:"px-2 py-2 whitespace-nowrap overflow-hidden text-ellipsis",children:o.optionName}),(0,a.jsx)("td",{className:"px-2 py-2 whitespace-nowrap text-center",children:o.quantity}),(0,a.jsx)("td",{className:"px-2 py-2",children:(0,a.jsx)("div",{className:"cursor-pointer ".concat(es(o.returnReason)?"text-red-500":""," whitespace-nowrap overflow-hidden text-ellipsis max-w-[150px]"),onClick:()=>es(o.returnReason)&&eo(o),children:ed(o.returnReason)})}),(0,a.jsx)("td",{className:"px-2 py-2",children:(0,a.jsx)("div",{className:"font-mono text-sm whitespace-nowrap bg-blue-100 px-2 py-1 rounded text-center",children:"no-tracking"===e.trackingNumber?"-":e.trackingNumber})}),(0,a.jsx)("td",{className:"px-2 py-2",children:(0,a.jsx)("span",{className:"font-mono text-sm whitespace-nowrap",children:o.barcode||"-"})})]},o.id)})})]})}}),(0,a.jsx)("dialog",{ref:g,className:"modal w-11/12 max-w-5xl p-0 rounded-lg shadow-xl",onClick:e=>{let t=e.currentTarget.getBoundingClientRect();if(e.clientX<t.left||e.clientX>t.right||e.clientY<t.top||e.clientY>t.bottom){e.currentTarget.close();let t=e.currentTarget.id;t&&(eD(e=>e.filter(e=>e!==t)),ek(e=>Math.max(0,e-10)))}},id:"productModal",children:(0,a.jsxs)("div",{className:"modal-box bg-white p-6",children:[(0,a.jsxs)("h3",{className:"font-bold text-lg mb-4 flex justify-between items-center",children:[(0,a.jsx)("span",{children:"상품 데이터 목록"}),(0,a.jsx)("button",{onClick:()=>{var e;return null===(e=g.current)||void 0===e?void 0:e.close()},className:"btn btn-sm btn-circle",children:"✕"})]}),(0,a.jsxs)("div",{className:"mb-4 flex justify-end gap-2",children:[(0,a.jsxs)("button",{className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded flex items-center gap-1",onClick:()=>{l(!0),m("상품 데이터 중복 제거 중입니다...");try{let r=e.products||[];console.log("상품 중복 제거 시작: ".concat(r.length,"개"));let a=new Set,o=r.filter(e=>{let t="".concat(e.productName||"","_").concat(e.optionName||"","_").concat(e.barcode||"");return!a.has(t)&&(a.add(t),!0)}),n=r.length-o.length;n>0?(t({type:"SET_RETURNS",payload:{...e,products:o}}),localStorage.setItem("products",JSON.stringify(o)),m("상품 중복 제거 완료: ".concat(n,"개 중복 항목이 제거되었습니다.")),console.log("상품 중복 제거 완료: ".concat(r.length," → ").concat(o.length," (").concat(n,"개 제거)"))):(m("중복된 상품이 없습니다."),console.log("중복된 상품이 없음"))}catch(e){console.error("상품 중복 제거 오류:",e),m("상품 중복 제거 중 오류가 발생했습니다.")}finally{l(!1)}},disabled:!e.products||0===e.products.length,children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})}),"새로고침 (중복제거)"]}),(0,a.jsx)("button",{className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded",onClick:eu,disabled:!e.products||0===e.products.length,children:"전체 삭제"})]}),e.products&&e.products.length>0?(0,a.jsx)("div",{className:"overflow-x-auto max-h-[70vh]",children:(0,a.jsxs)("table",{className:"min-w-full border-collapse border border-gray-300",children:[(0,a.jsx)("thead",{className:"sticky top-0 bg-white",children:(0,a.jsxs)("tr",{className:"bg-gray-100",children:[(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"번호"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"사입상품명"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"상품명"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"옵션명"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"바코드번호"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"자체상품코드"})]})}),(0,a.jsx)("tbody",{children:e.products.map((e,t)=>(0,a.jsxs)("tr",{className:"border-t border-gray-300 hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300",children:t+1}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300",children:e.purchaseName||"-"}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300",children:e.productName}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300",children:e.optionName||"-"}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 font-mono",children:e.barcode}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300",children:e.zigzagProductCode||"-"})]},e.id))})]})}):(0,a.jsx)("p",{children:"상품 데이터가 없습니다."}),(0,a.jsx)("div",{className:"modal-action mt-6",children:(0,a.jsx)("button",{className:"btn",onClick:()=>{var e;return null===(e=g.current)||void 0===e?void 0:e.close()},children:"닫기"})})]})}),K&&Y&&(0,a.jsx)(b,{isOpen:K,onClose:()=>{G(!1),V(null),ek(e=>Math.max(0,e-10))},returnItem:Y,products:e.products||[],onMatch:(r,a)=>{l(!0);let o={...r,barcode:a.barcode,purchaseName:a.purchaseName||a.productName,zigzagProductCode:a.zigzagProductCode||"",customProductCode:a.customProductCode||"",matchType:"manual",matchSimilarity:1,matchedProductName:a.productName};console.log("매칭 완료:",{원래상품명:r.productName,매칭된사입상품명:o.purchaseName,바코드:o.barcode});let n=e.pendingReturns.map(e=>e.id===r.id?o:e);t({type:"SET_RETURNS",payload:{...e,pendingReturns:n}}),localStorage.setItem("pendingReturns",JSON.stringify(n)),localStorage.setItem("lastUpdated",new Date().toISOString()),G(!1),l(!1),m('"'.concat(r.productName,'" 상품이 "').concat(a.purchaseName||a.productName,'"(으)로 매칭되었습니다.'))},zIndex:1e3+eS}),x&&f&&(0,a.jsx)(u,{isOpen:x,onClose:()=>{N(!1),ek(e=>Math.max(0,e-10))},returnItem:f,detailReason:R||"",onSave:en,setDetailReason:S,zIndex:1e3+eS})]})}},2533:(e,t,r)=>{"use strict";r.d(t,{b:()=>i,m:()=>c});var a=r(7437),o=r(2265);let n={pendingReturns:[],completedReturns:[],products:[]};function l(e,t){switch(t.type){case"SET_RETURNS":return t.payload;case"ADD_RETURNS":return{...e,pendingReturns:[...e.pendingReturns,...t.payload]};case"ADD_PRODUCTS":return{...e,products:[...e.products,...t.payload]};case"SET_PRODUCTS":return{...e,products:t.payload};case"PROCESS_RETURNS":let r=t.payload,a=new Date,o=new Date(a.getFullYear(),a.getMonth(),a.getDate());o.setHours(0,0,0,0);let n=r.map(e=>({...e,status:"COMPLETED",completedAt:o})),l=e.pendingReturns.filter(e=>!r.some(t=>t.id===e.id));return{...e,pendingReturns:l,completedReturns:[...n,...e.completedReturns]};case"UPDATE_RETURN_REASON":return{...e,pendingReturns:e.pendingReturns.map(e=>e.id===t.payload.id?{...e,detailReason:t.payload.detailReason,returnReason:e.returnReason+(t.payload.detailReason?" (".concat(t.payload.detailReason,")"):"")}:e),completedReturns:e.completedReturns.map(e=>e.id===t.payload.id?{...e,detailReason:t.payload.detailReason,returnReason:e.returnReason.includes("(")?e.returnReason.split("(")[0].trim()+(t.payload.detailReason?" (".concat(t.payload.detailReason,")"):""):e.returnReason+(t.payload.detailReason?" (".concat(t.payload.detailReason,")"):"")}:e)};case"UPDATE_RETURN_ITEM":return{...e,pendingReturns:e.pendingReturns.map(e=>e.id===t.payload.id?t.payload:e)};case"MATCH_PRODUCTS":let s=e.pendingReturns.map(t=>{if(t.barcode&&"-"!==t.barcode)return t;let r=e=>{if(!t.optionName||0===e.length)return e[0]||null;let r=t.optionName.toLowerCase().trim(),a=e.find(e=>e.optionName&&e.optionName.toLowerCase().trim()===r);if(a)return a;let o=null,n=.7;for(let t of e)if(t.optionName){let e=t.optionName.toLowerCase().trim();(e.includes(r)||r.includes(e))&&.9>n&&(n=.9,o=t)}if(o)return o;let l=null,s=0,c=e=>e.replace(/[\[\]]/g,"").split(/[,\/:\-\s]+/).map(e=>e.trim()).filter(e=>e.length>0&&"선택"!==e),i=c(r);for(let t of e)if(t.optionName){let e=c(t.optionName.toLowerCase().trim()),r=i.filter(t=>e.some(e=>!!(e===t||t.length>=3&&e.includes(t)||e.length>=3&&t.includes(e))));if(r.length>0){let a=r.length/Math.max(i.length,e.length)*.8+r.length/i.length*.2;a>s&&a>=.4&&(s=a,l=t)}}return l||null};if(t.zigzagProductCode&&"-"!==t.zigzagProductCode){let a=e.products.filter(e=>e.zigzagProductCode&&e.zigzagProductCode===t.zigzagProductCode);if(a.length>0){let e=r(a);if(e)return{...t,barcode:e.barcode||"",purchaseName:e.purchaseName||e.productName,matchSimilarity:1,matchType:"자체상품코드 정확 매칭"}}let o=null,n=t.zigzagProductCode.toLowerCase().trim();for(let t of e.products)if(t.purchaseName&&"string"==typeof t.purchaseName){let e=t.purchaseName.toLowerCase().trim();if(e.includes(n)||n.includes(e))(!o||.95>o.similarity)&&(o={product:t,similarity:.95,matchType:"자체상품코드-사입명 포함관계"});else{let r=Math.min(n.length,e.length),a=Math.max(n.length,e.length);if(r>0&&a>0){let l=0;for(let t=0;t<r;t++)n[t]===e[t]&&l++;let s=l/a;s>.4&&(!o||s>o.similarity)&&(o={product:t,similarity:s,matchType:"자체상품코드-사입명 유사도"})}}}if(o&&o.similarity>.5)return{...t,barcode:o.product.barcode||"",purchaseName:o.product.purchaseName||o.product.productName,zigzagProductCode:o.product.zigzagProductCode||t.zigzagProductCode,customProductCode:o.product.customProductCode||o.product.zigzagProductCode||"",matchSimilarity:o.similarity,matchType:o.matchType}}if(t.productName){let a=e.products.filter(e=>e.productName&&"string"==typeof e.productName&&"string"==typeof t.productName&&e.productName.toLowerCase().trim()===t.productName.toLowerCase().trim());if(a.length>0){let e=r(a);if(e)return{...t,barcode:e.barcode||"",purchaseName:e.purchaseName||e.productName,zigzagProductCode:e.zigzagProductCode||"",matchSimilarity:1,matchType:"상품명 완전일치"}}let o=e.products.filter(e=>e.purchaseName&&"string"==typeof e.purchaseName&&"string"==typeof t.productName&&e.purchaseName.toLowerCase().trim()===t.productName.toLowerCase().trim());if(o.length>0){let e=r(o);if(e)return{...t,barcode:e.barcode||"",purchaseName:e.purchaseName||e.productName,zigzagProductCode:e.zigzagProductCode||"",matchSimilarity:1,matchType:"사입상품명 완전일치"}}let n=[];for(let r of e.products){if(r.productName&&t.productName&&"string"==typeof r.productName&&"string"==typeof t.productName){let e=r.productName.toLowerCase(),a=t.productName.toLowerCase();(e.includes(a)||a.includes(e))&&n.push(r)}if(r.purchaseName&&t.productName&&"string"==typeof r.purchaseName&&"string"==typeof t.productName){let e=r.purchaseName.toLowerCase(),a=t.productName.toLowerCase();(e.includes(a)||a.includes(e))&&n.push(r)}}if(n.length>0){let e=r(n);if(e)return{...t,barcode:e.barcode||"",purchaseName:e.purchaseName||e.productName,zigzagProductCode:e.zigzagProductCode||"",matchSimilarity:.7,matchType:"상품명 포함관계"}}}return t});return{...e,pendingReturns:s};case"REMOVE_PENDING_RETURNS":{let r=t.payload;return{...e,pendingReturns:e.pendingReturns.filter((e,t)=>!r.includes(t))}}case"REMOVE_PENDING_RETURN":{let r=t.payload.id;return{...e,pendingReturns:e.pendingReturns.filter(e=>e.id!==r)}}case"ADD_COMPLETED_RETURN":if(e.completedReturns.some(e=>e.id===t.payload.id))return e;return{...e,completedReturns:[...e.completedReturns,t.payload]};case"UPDATE_PENDING_RETURN":return{...e,pendingReturns:e.pendingReturns.map(e=>e.id===t.payload.id?t.payload:e)};default:return e}}let s=(0,o.createContext)(void 0);function c(e){let{children:t}=e,[r,c]=(0,o.useReducer)(l,n);return(0,a.jsx)(s.Provider,{value:{returnState:r,dispatch:c},children:t})}function i(){let e=(0,o.useContext)(s);if(void 0===e)throw Error("useReturnState must be used within a ReturnStateProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[425,130,215,744],()=>t(2370)),_N_E=e.O()}]);