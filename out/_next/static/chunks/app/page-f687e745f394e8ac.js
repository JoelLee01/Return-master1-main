(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{67:()=>{},2061:()=>{},4856:(e,t,o)=>{Promise.resolve().then(o.bind(o,6684))},6684:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>D});var r=o(7437),a=o(2265),n=o(7800);function c(e){if(!e)return"";let t=e.trim(),o=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/사이즈\s*:\s*/g,"")).replace(/컬러\s*:\s*/g,"")).replace(/색상\s*:\s*/g,"")).replace(/사이즈\s*선택\s*:\s*/g,"")).replace(/컬러\s*선택\s*:\s*/g,"")).replace(/색상\s*선택\s*:\s*/g,"")).replace(/길이\s*선택\s*:\s*/g,"")).replace(/\([^)]*\)/g,"")).replace(/\b[Oo]ne\s*[Ss]ize\b/g,"")).replace(/\s+/g," ").trim()).replace(/\//g,",")).split(",").map(e=>e.trim());if(o.length>=2)return o.filter(e=>e).join(",");{let e=o[0];return/^[SMLX]+$/i.test(e)?e.toUpperCase():e}}async function l(e){return new Promise((t,o)=>{let r=new FileReader;r.onload=e=>{try{let o=new Uint8Array(e.target.result),r=n.ij(o,{type:"array"}),a=r.SheetNames[0],l=r.Sheets[a],s=n.P6.sheet_to_json(l,{header:1}),i=-1;for(let e=0;e<Math.min(10,s.length);e++)if(s[e].map(e=>String(e||"").toLowerCase()).some(e=>e.includes("주문번호")||e.includes("상품명")||e.includes("고객명"))){i=e;break}if(-1===i)throw Error("유효한 헤더를 찾을 수 없습니다. 엑셀 형식을 확인해주세요.");let d=s[i];console.log("\uD83D\uDCCB 엑셀 헤더 정보:"),d.forEach((e,t)=>{"string"==typeof e&&e.trim()&&console.log("  ".concat(t,': "').concat(e,'"'))});let u=e=>d.findIndex(t=>{if("string"!=typeof t)return!1;let o=t.toLowerCase(),r=e.toLowerCase();if(r.includes("주문번호")||r.includes("주문 번호")){let e=o.includes(r)&&!o.includes("상품주문번호");return e&&console.log('✅ 주문번호 매칭: "'.concat(t,'" (인덱스: ').concat(d.indexOf(t),")")),e}return o.includes(r)}),m=(e,t)=>{if(t.some(e=>e.includes("주문번호")||e.includes("주문 번호"))){for(let o of(console.log("\uD83D\uDD0D 주문번호 필드 검색 시작..."),t))if(o.includes("주문번호")||o.includes("주문 번호")){let t=u(o);if(-1!==t&&e[t])return console.log('✅ 주문번호 발견: "'.concat(e[t],'" (헤더: "').concat(d[t],'")')),String(e[t])}let o=d.findIndex(e=>"string"==typeof e&&e.toLowerCase().includes("상품주문번호"));return -1!==o&&e[o]?(console.log('⚠️ 주문번호 없음, 상품주문번호 사용: "'.concat(e[o],'" (헤더: "').concat(d[o],'")')),String(e[o])):(console.log("❌ 주문번호 및 상품주문번호 모두 없음"),"")}for(let o of t){let t=u(o);if(-1!==t&&e[t])return String(e[t])}return""},p=[];for(let e=i+1;e<s.length;e++){let t=s[e];if(!t||0===t.length)continue;let o=m(t,["주문번호","주문 번호","주문no","주문 no","order","오더 번호"]),r=m(t,["상품명","품명","item","제품명","상품 명"]);if(!o||!r)continue;let a=m(t,["옵션명","옵션","옵션정보","옵션 정보","선택 옵션","옵션 내역"]),n=c(a),l={id:function(e,t,o,r){let a=(e||"").toString().trim(),n=(t||"").toString().trim(),c=(o||"").toString().trim(),l=Date.now(),s=Math.floor(1e4*Math.random());return"".concat(a,"_").concat(n.substring(0,10),"_").concat(c.substring(0,5),"_").concat(r,"_").concat(l,"_").concat(s)}(o,r,n,parseInt(m(t,["수량","주문수량","입고수량","반품수량","quantity"]),10)||1),orderNumber:o,customerName:m(t,["고객명","주문자","구매자","customer","구매자명","고객 이름"]),productName:r,optionName:n,quantity:parseInt(m(t,["수량","주문수량","입고수량","반품수량","quantity"]),10)||1,returnReason:m(t,["반품사유","반품 사유","사유","메모","반품메모","반품 메모"]),returnTrackingNumber:m(t,["반품송장번호","반품운송장","반품 송장","반품송장","송장번호","송장"]),pickupTrackingNumber:m(t,["수거송장번호","수거운송장","수거 송장","수거송장","픽업송장번호","픽업 송장번호"]),status:"PENDING",barcode:"",zigzagProductCode:m(t,["자체상품코드","지그재그코드","상품코드"]),customProductCode:m(t,["자체상품코드","지그재그코드","상품코드"])};p.push(l)}console.log("".concat(p.length,"개의 반품 항목이 추출되었습니다.")),t(p)}catch(e){console.error("엑셀 파싱 오류:",e),o(Error("엑셀 파일을 처리하는 중 오류가 발생했습니다."))}},r.onerror=()=>{o(Error("엑셀 파일을 읽는 중 오류가 발생했습니다."))},r.readAsArrayBuffer(e)})}function s(e){return new Promise((t,o)=>{let r=new FileReader;r.onload=e=>{try{if(!e.target||!e.target.result)throw Error("파일 데이터를 읽을 수 없습니다.");let o=new Uint8Array(e.target.result),r=n.ij(o,{type:"array"});if(!r||!r.SheetNames||0===r.SheetNames.length)throw Error("엑셀 파일에 시트가 없습니다.");let a=r.Sheets[r.SheetNames[0]];if(!a)throw Error("엑셀 시트를 읽을 수 없습니다.");let l=n.P6.sheet_to_json(a,{header:1});if(!l||0===l.length)throw Error("엑셀 파일에 데이터가 없습니다.");console.log("엑셀 데이터 로드 완료:",{행수:l.length,첫번째행:l[0]});let s=function(e){for(let t=0;t<Math.min(10,e.length);t++){let o=e[t];if(o&&["상품명","바코드","옵션"].reduce((e,t)=>o.some(e=>"string"==typeof e&&e.includes&&e.includes(t))?e+1:e,0)>=2)return t}return -1}(l);if(-1===s)throw Error("상품 데이터 헤더 행을 찾을 수 없습니다.");let i=l[s].map(e=>String(e||"").trim()),d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=i.findIndex(t=>t===e);if(-1===o&&(o=i.findIndex(t=>t.includes(e))),-1===o&&t.length>0){for(let e of t)if(o=i.findIndex(t=>t===e),-1!==o||(o=i.findIndex(t=>t.includes(e)),-1!==o))break}return o},u=d("상품명",["제품명","품명"]),m=d("바코드번호",["바코드"]),p=d("옵션명",["옵션","옵션정보"]),h=d("사입상품명",["사입명","매입상품명"]),g=d("자체상품코드",["지그재그코드","상품코드"]);if(-1===u||-1===m)throw Error("필수 열(상품명, 바코드번호)을 찾을 수 없습니다.");console.log("컬럼 인덱스:",{상품명:u,바코드번호:m,옵션명:p,사입상품명:h,자체상품코드:g});let x=[],b=new Map;for(let e=s+1;e<l.length;e++){let t=l[e];if(!t||0===t.length)continue;let o="";if(void 0!==t[m]&&null!==t[m]&&(o=String(t[m]).trim()),!o){console.warn("행 ".concat(e+1,": 바코드 없음, 건너뜀"));continue}if(b.has(o)){console.log("중복 바코드 무시: ".concat(o));continue}let r="";if(void 0!==t[u]&&null!==t[u]&&(r=String(t[u]).trim()),!r){console.warn("행 ".concat(e+1,": 상품명 없음, 건너뜀"));continue}let a="";if(-1!==p&&void 0!==t[p]&&null!==t[p]){let e=String(t[p]);a=c(e)}let n="";-1!==h&&void 0!==t[h]&&null!==t[h]&&(n=String(t[h]).trim());let s="",i="";-1!==g&&void 0!==t[g]&&null!==t[g]&&(i=s=String(t[g]).trim());let d={id:function(e,t){let o=(e||"").toString().trim(),r=(t||"").toString().trim(),a=Date.now(),n=Math.floor(1e4*Math.random());return"".concat(o,"_").concat(r.substring(0,10),"_").concat(a,"_").concat(n)}(o,r),productName:r,barcode:o,optionName:a,purchaseName:n||"",zigzagProductCode:s,customProductCode:i};b.set(o,!0),x.push(d)}console.log("".concat(x.length,"개의 상품 데이터가 추출되었습니다.")),t(x)}catch(e){console.error("엑셀 파싱 오류:",e),o(Error("엑셀 파일을 처리하는 중 오류가 발생했습니다."))}},r.onerror=()=>{o(Error("엑셀 파일을 읽는 중 오류가 발생했습니다."))},r.readAsArrayBuffer(e)})}var i=o(2533);let d=e=>{let{isOpen:t,onClose:o,children:n,modalId:c}=e,l=(0,a.useRef)(c||"modal-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9))),s=(0,a.useRef)(null);return((0,a.useEffect)(()=>(t?("undefined"!=typeof document&&(document.body.style.overflow="hidden"),setTimeout(()=>{if(s.current){let e=s.current.querySelector("textarea"),t=s.current.querySelector("input"),o=s.current.querySelector('button, [tabindex]:not([tabindex="-1"]), input, select, textarea, a[href]');e?e.focus():t?t.focus():o&&o.focus()}},100)):"undefined"!=typeof document&&(document.body.style.overflow=""),()=>{"undefined"!=typeof document&&(document.body.style.overflow="")}),[t]),(0,a.useEffect)(()=>{let e=e=>{"Escape"===e.key&&o()};return t&&window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[t,o]),t)?(0,r.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",onClick:e=>{e.target===e.currentTarget&&o()},style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1e4},role:"dialog","aria-modal":"true","data-modal-id":l.current,children:(0,r.jsx)("div",{className:"relative",ref:s,tabIndex:-1,style:{maxWidth:"var(--popup-width)",maxHeight:"var(--popup-height)",overflow:"auto",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.2)"},children:n})}):null},u=e=>{let{isOpen:t,onClose:o,onSave:n,returnItem:c,detailReason:l,setDetailReason:s,zIndex:i}=e,[u,m]=(0,a.useState)(l);return((0,a.useEffect)(()=>{m(l)},[l]),t&&c)?(0,r.jsx)(d,{isOpen:t,onClose:o,children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-11/12 max-w-xl",children:[(0,r.jsx)("div",{className:"bg-gradient-to-r from-red-600 to-red-700 p-4 text-white",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h3",{className:"text-lg font-medium",children:"반품 사유 상세"}),(0,r.jsx)("button",{onClick:o,className:"text-white hover:text-gray-200",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}),(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),s(u),n(u)},className:"p-6",children:[(0,r.jsxs)("div",{className:"mb-6 grid grid-cols-1 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"주문 정보"}),(0,r.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-200",children:[(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsx)("span",{className:"font-medium",children:"고객명:"})," ",c.customerName]}),(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsx)("span",{className:"font-medium",children:"주문번호:"})," ",c.orderNumber]})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"상품 정보"}),(0,r.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-200",children:[(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsx)("span",{className:"font-medium",children:"상품명:"})," ",c.productName]}),c.optionName&&(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsx)("span",{className:"font-medium",children:"옵션:"})," ",c.optionName]}),(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsx)("span",{className:"font-medium",children:"수량:"})," ",c.quantity]})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"반품 사유"}),(0,r.jsx)("div",{className:"bg-pink-50 p-3 rounded-lg border border-pink-200 text-red-800",children:c.returnReason})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{htmlFor:"detailReason",className:"block text-sm font-medium text-gray-700",children:"상세 사유"}),(0,r.jsx)("textarea",{id:"detailReason",className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:4,value:u,onChange:e=>m(e.target.value),placeholder:"반품 상세 사유를 입력하세요"})]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)("button",{type:"button",onClick:o,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"취소"}),(0,r.jsx)("button",{type:"submit",className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"저장"})]})]})]})}):null};var m=o(4887);class p{static getInstance(){return p.instance||(p.instance=new p),p.instance}createModalContainer(){if(!this.isClient||"undefined"==typeof document)return;let e=document.getElementById("global-modal-container");e&&e.remove(),this.modalContainer=document.createElement("div"),this.modalContainer.id="global-modal-container",this.modalContainer.style.position="fixed",this.modalContainer.style.top="0",this.modalContainer.style.left="0",this.modalContainer.style.width="100%",this.modalContainer.style.height="100%",this.modalContainer.style.pointerEvents="none",this.modalContainer.style.zIndex="10000",document.body.appendChild(this.modalContainer)}addModal(e,t){this.isClient&&"undefined"!=typeof document&&(this.modalContainer||this.createModalContainer(),this.removeModal(e),this.activeModals.add(e),this.modalElements.set(e,t),this.modalContainer&&(this.modalContainer.appendChild(t),t.style.pointerEvents="auto",console.log("모달 추가: ".concat(e,", 총 모달 수: ").concat(this.activeModals.size))))}removeModal(e){if(!this.isClient)return;let t=this.modalElements.get(e);t&&t.parentNode&&t.parentNode.removeChild(t),this.activeModals.delete(e),this.modalElements.delete(e),console.log("모달 제거: ".concat(e,", 남은 모달 수: ").concat(this.activeModals.size))}bringToFront(e){if(!this.isClient)return;let t=this.modalElements.get(e);t&&this.modalContainer&&(this.modalContainer.appendChild(t),console.log("모달 최상위로 이동: ".concat(e)))}getActiveModals(){return Array.from(this.activeModals)}clearAll(){this.isClient&&(this.activeModals.clear(),this.modalElements.clear(),this.modalContainer&&(this.modalContainer.innerHTML=""))}constructor(){this.modalContainer=null,this.activeModals=new Set,this.modalElements=new Map,this.isClient=!1,this.isClient=!0,this.createModalContainer()}}let h=null,g=()=>(h||(h=p.getInstance()),h),x=(e,t)=>{g().addModal(e,t)},b=e=>{g().removeModal(e)},f=e=>{let{children:t,isOpen:o,onClose:n,zIndex:c}=e,l=(0,a.useRef)(null),s=(0,a.useRef)("modal-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)));if((0,a.useEffect)(()=>(o&&l.current&&(document.body.style.overflow="hidden",x(s.current,l.current),setTimeout(()=>{if(l.current){let e=l.current.querySelector('button, [tabindex]:not([tabindex="-1"]), input, select, textarea, a[href]');e?e.focus():l.current.focus()}},50)),()=>{"undefined"!=typeof document&&(document.body.style.overflow=""),o&&b(s.current)}),[o]),(0,a.useEffect)(()=>{let e=e=>{"Escape"===e.key&&n()};return o&&window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[o,n]),!o)return null;let i=(0,r.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",onClick:e=>{l.current&&!l.current.contains(e.target)&&n()},style:{position:"fixed",inset:0,zIndex:c||1e4},role:"dialog","aria-modal":"true",children:(0,r.jsx)("div",{className:"relative",ref:l,tabIndex:-1,style:{maxWidth:"95vw",maxHeight:"90vh",overflow:"auto",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.2)"},children:t})});return(0,m.createPortal)(i,document.body)},N=e=>{let{isOpen:t,onClose:o,returnItem:n,onSave:c,zIndex:l}=e,[s,i]=(0,a.useState)((null==n?void 0:n.returnTrackingNumber)||"");return t?(0,r.jsx)(f,{isOpen:t,onClose:o,zIndex:l,children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-96 max-w-full",children:[(0,r.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-800 p-4 text-white",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h3",{className:"text-lg font-medium",children:"반품송장번호 입력"}),(0,r.jsx)("button",{onClick:o,className:"text-white hover:text-gray-200",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}),(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-500 mb-2",children:"주문 정보"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 bg-gray-50 p-3 rounded border border-gray-200",children:[(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsx)("span",{className:"font-medium",children:"고객명:"})," ",n.customerName]}),(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsx)("span",{className:"font-medium",children:"주문번호:"})," ",n.orderNumber]}),(0,r.jsxs)("div",{className:"text-sm sm:col-span-2",children:[(0,r.jsx)("span",{className:"font-medium",children:"상품명:"})," ",n.productName]})]})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"반품 송장번호"}),(0,r.jsx)("input",{type:"text",value:s,onChange:e=>i(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"송장번호를 입력하세요"})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)("button",{type:"button",onClick:o,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"취소"}),(0,r.jsx)("button",{type:"button",onClick:()=>{c(s)},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"저장"})]})]})]})}):null},y=e=>{let{isOpen:t,onClose:o,returnItem:n,products:c,onMatch:l,zIndex:s}=e,[i,u]=(0,a.useState)(""),[m,p]=(0,a.useState)([]),[h,g]=(0,a.useState)(!1);(0,a.useEffect)(()=>{t&&(u(""),p([]),g(!1))},[t]);let x=()=>{if(!i.trim()){p([]),g(!1);return}let e=i.toLowerCase().trim();p(c.filter(t=>t.productName&&t.productName.toLowerCase().includes(e)||t.purchaseName&&t.purchaseName.toLowerCase().includes(e))),g(!0)};return t?(0,r.jsx)(d,{isOpen:t,onClose:o,children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-11/12 max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[(0,r.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-cyan-600 p-4 text-white",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h3",{className:"text-xl font-semibold",children:"상품 매칭"}),(0,r.jsx)("button",{onClick:o,className:"text-white hover:text-gray-200",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,r.jsxs)("div",{className:"p-4 border-b",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("h4",{className:"text-lg font-medium mb-2",children:"선택된 반품 항목"}),(0,r.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-200",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:"상품명:"})," ",n.productName]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:"주문번호:"})," ",n.orderNumber]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:"고객명:"})," ",n.customerName]}),n.optionName&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:"옵션:"})," ",n.optionName]})]}),n.orderNumber.includes("Z")&&(!n.customProductCode||"-"===n.customProductCode||""===n.customProductCode.trim())&&(0,r.jsx)("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("svg",{className:"w-5 h-5 text-yellow-600 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-yellow-800 font-medium",children:"지그재그 반품 - 자체상품코드 없음"}),(0,r.jsx)("p",{className:"text-yellow-700 text-sm",children:"상품명으로 검색하여 수동 매칭해주세요."})]})]})})]})]}),(0,r.jsx)("div",{className:"mb-4",children:(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("input",{type:"text",className:"flex-1 px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:i,onChange:e=>{u(e.target.value)},placeholder:"상품명 또는 사입상품명으로 검색",onKeyPress:e=>{"Enter"===e.key&&x()}}),(0,r.jsx)("button",{className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",onClick:x,children:"검색"})]})})]}),(0,r.jsx)("div",{className:"flex-1 overflow-auto",children:h?m.length>0?(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50 sticky top-0",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-2/3",children:"사입상품명"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"옵션명"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"바코드"}),(0,r.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"매칭"})]})}),(0,r.jsx)("tbody",{children:m.map((e,t)=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"px-4 py-3 text-sm text-gray-500 break-words",children:e.purchaseName||"-"}),(0,r.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:e.optionName||"-"}),(0,r.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-mono",children:e.barcode||"-"}),(0,r.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-medium",children:(0,r.jsx)("button",{onClick:()=>l(n,e),className:"text-blue-600 hover:text-blue-900 bg-blue-100 hover:bg-blue-200 px-3 py-1 rounded-full transition-colors",children:"매칭"})})]},e.id||t))})]}):(0,r.jsx)("div",{className:"p-8 text-center text-gray-500",children:(0,r.jsx)("p",{children:"검색 결과가 없습니다."})}):(0,r.jsx)("div",{className:"p-8 text-center text-gray-500",children:(0,r.jsx)("p",{children:"상품명 또는 사입상품명으로 검색하세요."})})}),(0,r.jsx)("div",{className:"bg-gray-50 p-4 flex justify-end",children:(0,r.jsx)("button",{onClick:o,className:"px-4 py-2 border border-gray-300 bg-white rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none",children:"닫기"})})]})}):null},w=e=>{let{isOpen:t,onClose:o,items:a,selectedItems:n,onRefresh:c,onProcessSelected:l,onDeleteSelected:s,onRematchSelected:i,onItemSelect:u,PendingItemsTable:m}=e;return(0,r.jsx)(d,{isOpen:t,onClose:o,children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full overflow-hidden flex flex-col",style:{maxWidth:"var(--popup-width)",maxHeight:"var(--popup-height)"},children:[(0,r.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-cyan-600 p-4 text-white",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h3",{className:"text-xl font-semibold",children:"입고전 반품 목록"}),(0,r.jsx)("button",{onClick:o,className:"text-white hover:text-gray-200",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,r.jsx)("div",{className:"flex-1 overflow-auto p-6",children:a&&a.length>0?(0,r.jsx)("div",{className:"overflow-x-auto max-h-[70vh]",children:(0,r.jsx)(m,{items:a})}):(0,r.jsx)("p",{className:"text-center text-gray-500 py-8",children:"대기 중인 반품이 없습니다."})}),(0,r.jsxs)("div",{className:"bg-gray-50 p-4 flex flex-wrap gap-2 justify-end",children:[(0,r.jsx)("button",{className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-md transition-colors",onClick:c,children:"새로고침"}),n.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("button",{className:"px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-md transition-colors",onClick:l,children:["선택항목 입고처리 (",n.length,"개)"]}),(0,r.jsxs)("button",{className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-md transition-colors",onClick:s,children:["선택항목 삭제 (",n.length,"개)"]})]}),n.length>0&&(0,r.jsxs)("button",{className:"px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-md transition-colors",onClick:i,children:["재매칭 (",n.length,"개)"]}),(0,r.jsx)("button",{className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-md transition-colors",onClick:o,children:"닫기"})]})]})})},j=e=>{let{isOpen:t,onClose:o,selectedItems:n,products:c,onRematch:l}=e,[s,i]=(0,a.useState)(0),[u,m]=(0,a.useState)(""),[p,h]=(0,a.useState)([]),g=n[s];(0,a.useEffect)(()=>{u.trim()?h(c.filter(e=>{var t,o,r,a;return(null===(t=e.productName)||void 0===t?void 0:t.toLowerCase().includes(u.toLowerCase()))||(null===(o=e.purchaseName)||void 0===o?void 0:o.toLowerCase().includes(u.toLowerCase()))||(null===(r=e.optionName)||void 0===r?void 0:r.toLowerCase().includes(u.toLowerCase()))||(null===(a=e.barcode)||void 0===a?void 0:a.toLowerCase().includes(u.toLowerCase()))}).slice(0,20)):h(c.slice(0,20))},[u,c]);let x=e=>{g&&(l(g.id,e.barcode),s<n.length-1?(i(s+1),m("")):(i(0),m(""),o()))},b=()=>{i(0),m(""),o()};return g?(0,r.jsx)(d,{isOpen:t,onClose:o,children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[(0,r.jsx)("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 p-4 text-white",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("h3",{className:"text-xl font-semibold",children:["수동 재매칭 (",s+1,"/",n.length,")"]}),(0,r.jsx)("button",{onClick:b,className:"text-white hover:text-gray-200",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,r.jsxs)("div",{className:"flex-1 overflow-auto p-6",children:[(0,r.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg mb-4",children:[(0,r.jsx)("h4",{className:"font-semibold text-blue-800 mb-2",children:"재매칭할 반품 아이템:"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:"구매자:"})," ",g.customerName]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:"상품명:"})," ",g.purchaseName]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:"옵션:"})," ",g.optionName]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:"현재 바코드:"}),(0,r.jsx)("span",{className:"text-red-600 font-mono",children:g.barcode||"매칭 안됨"})]})]})]}),(0,r.jsx)("div",{className:"mb-4",children:(0,r.jsx)("input",{type:"text",placeholder:"상품명, 옵션명, 바코드로 검색...",value:u,onChange:e=>m(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})}),(0,r.jsxs)("div",{className:"overflow-y-auto max-h-[50vh]",children:[(0,r.jsxs)("table",{className:"w-full border-collapse",children:[(0,r.jsx)("thead",{className:"bg-gray-100 sticky top-0",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"p-2 text-left border",children:"바코드"}),(0,r.jsx)("th",{className:"p-2 text-left border",children:"상품명"}),(0,r.jsx)("th",{className:"p-2 text-left border",children:"사입상품명"}),(0,r.jsx)("th",{className:"p-2 text-left border",children:"옵션명"}),(0,r.jsx)("th",{className:"p-2 text-left border",children:"액션"})]})}),(0,r.jsx)("tbody",{children:p.map((e,t)=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50 border-b",children:[(0,r.jsx)("td",{className:"p-2 border font-mono text-sm",children:e.barcode}),(0,r.jsx)("td",{className:"p-2 border text-sm",children:e.productName}),(0,r.jsx)("td",{className:"p-2 border text-sm",children:e.purchaseName}),(0,r.jsx)("td",{className:"p-2 border text-sm",children:e.optionName}),(0,r.jsx)("td",{className:"p-2 border",children:(0,r.jsx)("button",{onClick:()=>x(e),className:"px-3 py-1 bg-purple-500 hover:bg-purple-600 text-white rounded text-sm transition-colors",children:"선택"})})]},t))})]}),0===p.length&&(0,r.jsx)("p",{className:"text-center text-gray-500 py-4",children:"검색 결과가 없습니다."})]})]}),(0,r.jsxs)("div",{className:"bg-gray-50 p-4 flex justify-between",children:[(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>{s>0&&(i(s-1),m(""))},disabled:0===s,className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 disabled:bg-gray-300 text-white rounded-md transition-colors",children:"이전"}),(0,r.jsx)("button",{onClick:()=>{s<n.length-1&&(i(s+1),m(""))},disabled:s===n.length-1,className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 disabled:bg-gray-300 text-white rounded-md transition-colors",children:"다음"})]}),(0,r.jsx)("button",{onClick:b,className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-md transition-colors",children:"닫기"})]})]})}):null};function v(e){let t=e.toLowerCase();for(let e of["블랙","화이트","화이트","그레이","그레이","네이비","네이비","베이지","베이지","브라운","브라운","레드","레드","핑크","핑크","옐로우","옐로우","그린","그린","블루","블루","퍼플","퍼플","오렌지","오렌지","골드","골드","실버","실버","아이보리","아이보리","크림","크림","차콜","차콜","카키","카키","민트","민트","로즈","로즈","라벤더","라벤더","코랄","코랄","터콰이즈","터콰이즈","버건디","버건디","마린","마린","올리브","올리브","샌드","샌드","타우프","타우프","인디고","인디고"])if(t.includes(e.toLowerCase()))return e;return null}function C(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(e.barcode&&"-"!==e.barcode)return console.log("이미 매칭된 상품 (바코드: ".concat(e.barcode,")")),e;console.log('\n[새로운 3단계 매칭 시작] 상품명: "'.concat(e.productName,'", 옵션명: "').concat(e.optionName,'"')),console.log("[스마트스토어 매칭 대상] 총 ".concat(t.length,"개 상품 중에서 매칭 시도")),console.log('\uD83D\uDD0D 1단계: 스마트스토어에서 상품명 "'.concat(e.productName,'" 매칭 시도...'));let r=null,a=t.find(t=>t.productName.toLowerCase().trim()===e.productName.toLowerCase().trim());if(a)r=a,console.log('✅ 스마트스토어 정확 매칭: "'.concat(a.productName,'"'));else{let o=null,a=e.productName.toLowerCase().trim();for(let e of t){let t=e.productName.toLowerCase().trim(),r=S(a,t);r>.7&&(!o||r>o.similarity)&&(o={product:e,similarity:r},console.log("\uD83D\uDCCC 스마트스토어 유사도 매칭 (유사도: ".concat(r.toFixed(2),'): "').concat(a,'" ↔ "').concat(t,'"')))}o&&(r=o.product,console.log('✅ 스마트스토어 유사도 매칭 성공: "'.concat(o.product.productName,'" (유사도: ').concat(o.similarity.toFixed(2),")")))}if(!r)return console.log("❌ 1단계 실패: 스마트스토어에서 상품을 찾을 수 없음"),e;if(console.log('\uD83D\uDD0D 2단계: 상품코드 "'.concat(r.productCode,'"로 셀메이트 상품목록에서 매칭 시도...')),0===o.length)return console.log("⚠️ 셀메이트 상품목록이 없어서 스마트스토어 데이터만 사용"),{...e,barcode:r.barcode||"",purchaseName:r.productName,zigzagProductCode:e.zigzagProductCode,customProductCode:r.productCode,matchSimilarity:1,matchType:"스마트스토어 단독 매칭",matchedProductName:r.productName,matchedProductOption:r.optionName};let n=o.filter(e=>e.customProductCode===r.productCode||e.zigzagProductCode===r.productCode);if(0===n.length)return console.log('❌ 2단계 실패: 셀메이트 상품목록에서 상품코드 "'.concat(r.productCode,'"를 찾을 수 없음')),{...e,barcode:r.barcode||"",purchaseName:r.productName,zigzagProductCode:e.zigzagProductCode,customProductCode:r.productCode,matchSimilarity:.8,matchType:"스마트스토어 단독 매칭 (셀메이트 없음)",matchedProductName:r.productName,matchedProductOption:r.optionName};console.log("✅ 2단계 성공: 셀메이트에서 ".concat(n.length,"개 상품 발견")),console.log('\uD83D\uDD0D 3단계: 옵션명 "'.concat(e.optionName,'"으로 최종 매칭 시도...'));let c=null;if(e.optionName&&""!==e.optionName.trim()){console.log('\uD83D\uDD0D 3단계: 옵션명 매칭 시작 "'.concat(e.optionName,'" (후보 ').concat(n.length,"개)"));let t=e.optionName.toLowerCase().trim(),o=n.map(e=>{if(!e.optionName)return{product:e,score:0,reason:"옵션명 없음"};let o=e.optionName.toLowerCase().trim(),r=0,a="";if(o===t)r=100,a="정확 일치";else if(o.includes(t)||t.includes(o))r=80,a="부분 일치";else{let e=v(t),n=v(o);if(e&&n&&e===n)r=60,a="색상 일치";else{let e=S(t,o);r=Math.round(50*e),a="유사도 ".concat(e.toFixed(2))}}return{product:e,score:r,reason:a}});o.sort((e,t)=>t.score-e.score),console.log("\uD83D\uDCCA 스마트스토어 옵션명 매칭 결과:"),o.forEach((e,t)=>{console.log("  ".concat(t+1,". ").concat(e.product.optionName," (").concat(e.reason,", 점수: ").concat(e.score,")"))});let r=o[0];r.score>=30?(c=r.product,console.log('✅ 3단계 성공: 옵션명 매칭 "'.concat(r.product.optionName,'" (').concat(r.reason,", 점수: ").concat(r.score,")"))):console.log("❌ 3단계 실패: 최고 점수 ".concat(r.score," (임계값 30 미달)"))}if(c||(c=n[0],console.log('⚠️ 3단계: 옵션명 매칭 실패, 첫 번째 상품 사용 "'.concat(c.productName,'"'))),e.optionName&&c.optionName&&e.optionName.toLowerCase().trim()!==c.optionName.toLowerCase().trim()){console.log('⚠️ 스마트스토어 매칭: 옵션명 불일치 "'.concat(e.optionName,'" ≠ "').concat(c.optionName,'"'));let t=n.find(t=>t.optionName&&t.optionName.toLowerCase().trim()===e.optionName.toLowerCase().trim());t&&(c=t,console.log('✅ 스마트스토어 재매칭 성공: 정확한 옵션명 매칭 "'.concat(t.optionName,'"')))}return console.log('\uD83C\uDFAF 최종 매칭 완료: "'.concat(c.productName,'" - "').concat(c.optionName,'" (바코드: ').concat(c.barcode,")")),{...e,barcode:c.barcode||"",purchaseName:c.purchaseName||c.productName,zigzagProductCode:c.zigzagProductCode||"",customProductCode:r.productCode,matchSimilarity:1,matchType:"3단계 매칭 (스마트스토어→셀메이트→옵션)",matchedProductName:c.productName,matchedProductOption:c.optionName}}function S(e,t){if(!e||!t)return 0;let o=.4*Math.max(e.length,t.length);if(Math.abs(e.length-t.length)>o)return .2;let r=e.length,a=t.length,n=Math.max(r,a);if(0===n)return 1;let c=Array(r+1).fill(null).map(()=>Array(a+1).fill(0));for(let e=0;e<=r;e++)c[e][0]=e;for(let e=0;e<=a;e++)c[0][e]=e;for(let o=1;o<=r;o++)for(let r=1;r<=a;r++){let a=e[o-1]===t[r-1]?0:1;c[o][r]=Math.min(c[o-1][r]+1,c[o][r-1]+1,c[o-1][r-1]+a)}return 1-c[r][a]/n}let z=console.error,P=function(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];try{z(...t)}catch(e){}};function R(e){if(!e)return[];let t=e.toLowerCase().trim(),o=["스판","차르르","편안한","롱","숏","미니","맥시","롱기장","숏기장","쿨소재","시원한","통풍","흡수","속건","드라이","쿨링","냉감","린넨","면","폴리에스터","나일론","스판덱스","레이온","비스코스","프릴","레이스","자수","프린트","스트라이프","도트","체크","플라워","넥라인","라운드넥","브이넥","오프숄더","원숄더","터틀넥","하이넥","슬리브","반팔","긴팔","무지","민소매","나시","크롭","하이웨이스트","플레어","A라인","H라인","오버핏","타이트","루즈","슬림","와이드","마마","ops","블리","프","차르르","편안한","편안","편안함"].filter(e=>t.includes(e));return["여름","원피스","상의","하의","의류","옷","패션","쇼핑","온라인","빅사이즈","사이즈","컬러","색상","색","무료배송","배송","할인","신상","신제품","인기","베스트","추천","특가","세일","sale"].some(e=>t.includes(e)),o}function k(e,t){if(!e||!t)return 0;let o=e.toLowerCase().trim(),r=t.toLowerCase().trim();if(o===r)return 1;let a=o,n=r;if(["봄","여름","가을","겨울","spring","summer","autumn","winter"].forEach(e=>{a=a.replace(RegExp("\\b".concat(e,"\\b"),"g"),"").trim(),n=n.replace(RegExp("\\b".concat(e,"\\b"),"g"),"").trim()}),a===n&&a.length>0)return .95;let c=R(e),l=R(t);if(c.length>0&&l.length>0){let a=c.filter(e=>l.includes(e));if(a.length>0){let n=function(e,t,o){let r=R(e),a=R(t),n=Math.max(r.length,a.length),c=o.length;if(0===n)return 0;let l=Math.min(.2,.05*c);return Math.min(1,c/n+l)}(e,t,a),c=function(e,t,o){let r=e.toLowerCase(),a=t.toLowerCase(),n=0,c=0;for(let e of o){let t=(r.match(RegExp(e,"g"))||[]).length,o=(a.match(RegExp(e,"g"))||[]).length;if(t===o)n+=1;else{let e=Math.abs(t-o),r=Math.max(t,o);n+=r>0?(r-e)/r:0}c++}return c>0?n/c:0}(e,t,a),l=function(e,t,o){let r=e.toLowerCase(),a=t.toLowerCase(),n=o.map(e=>r.indexOf(e)).filter(e=>-1!==e),c=o.map(e=>a.indexOf(e)).filter(e=>-1!==e);if(0===n.length||0===c.length)return 0;let l=0;for(let e=0;e<Math.min(n.length,c.length)-1;e++)5>Math.abs(n[e+1]-n[e]-(c[e+1]-c[e]))&&l++;return n.length>1?l/(n.length-1):1}(e,t,a),s=function(e,t,o){let r=e.toLowerCase(),a=t.toLowerCase(),n=o.reduce((e,t)=>e+(r.match(RegExp(t,"g"))||[]).length*t.length,0),c=o.reduce((e,t)=>e+(a.match(RegExp(t,"g"))||[]).length*t.length,0);return 1-Math.abs(n/r.length-c/a.length)}(e,t,a),i=["니트","골지","바스락","린넨","코튼","실크","데님","가죽"],d=i.filter(e=>o.includes(e)),u=i.filter(e=>r.includes(e)),m=d.length>0&&u.length>0&&!d.some(e=>u.includes(e)),p=.3*n+.4*c+.2*l+.1*s;if(m&&(p-=.2),(p=Math.max(0,p))>.7)return Math.min(.95,p+.1)}}let s=o.length>r.length?o:r,i=o.length>r.length?r:o;if(0===s.length)return 1;let d=((e,t)=>{let o=[];for(let r=0;r<=e.length;r++){let a=r;for(let n=0;n<=t.length;n++)if(0===r)o[n]=n;else if(n>0){let c=o[n-1];e.charAt(r-1)!==t.charAt(n-1)&&(c=Math.min(Math.min(c,a),o[n])+1),o[n-1]=a,a=c}r>0&&(o[t.length]=a)}return o[t.length]})(s,i),u=(s.length-d)/s.length,m=["여름","원피스","상의","하의"].some(e=>o.includes(e)),p=["여름","원피스","상의","하의"].some(e=>r.includes(e));return m&&p?.7*u:u}function D(){var e,t;let{state:o,dispatch:d}=(0,i.b)(),[m,p]=(0,a.useState)(!1),[h,g]=(0,a.useState)(""),x=(0,a.useRef)(null),b=(0,a.useRef)(null);(0,a.useRef)(null);let f=(0,a.useRef)(null);(0,a.useRef)(null),(0,a.useRef)(null);let[v,S]=(0,a.useState)(!1),[z,D]=(0,a.useState)(null),[T,E]=(0,a.useState)(""),[L,F]=(0,a.useState)([]),[O,I]=(0,a.useState)(!1),[_,M]=(0,a.useState)(null),[A,B]=(0,a.useState)([]),[U,H]=(0,a.useState)(!1),[q,J]=(0,a.useState)(null),[W,K]=(0,a.useState)(!1),[V,Y]=(0,a.useState)([]),[X,Z]=(0,a.useState)(!1),[G,$]=(0,a.useState)("smartstore"),[Q,ee]=(0,a.useState)(null),[et,eo]=(0,a.useState)({testButton:"bg-blue-500 hover:bg-blue-600",firebaseButton:"bg-indigo-500 hover:bg-indigo-600",productButton:"bg-green-500 hover:bg-green-600",returnButton:"bg-blue-500 hover:bg-blue-600",productListButton:"bg-purple-500 hover:bg-purple-600",pendingButton:"bg-yellow-500 hover:bg-yellow-600",downloadButton:"bg-teal-500 hover:bg-teal-600",trackingButton:"bg-blue-500 hover:bg-blue-600"}),[er,ea]=(0,a.useState)(!1),[en,ec]=(0,a.useState)(null),[el,es]=(0,a.useState)(!1),[ei,ed]=(0,a.useState)(!1),[eu,em]=(0,a.useState)(!1),[ep,eh]=(0,a.useState)(""),[eg,ex]=(0,a.useState)(!1),[eb,ef]=(0,a.useState)({popupWidth:85,popupHeight:84.5,popupTableFontSize:1,popupBarcodeFontSize:.7,popupCellPadding:.5,popupLineHeight:1,mainTableFontSize:1,mainBarcodeFontSize:.7,mainCellPadding:.5,mainLineHeight:1.1,columnAlignment:{customerName:"center",orderNumber:"center",productName:"left",optionName:"center",quantity:"center",returnReason:"center",trackingNumber:"center",barcode:"left",actions:"center"},columnWidths:{customerName:80,orderNumber:125,productName:140,optionName:115,quantity:30,returnReason:80,trackingNumber:120,barcode:120,mainBarcode:130,actions:30},autoTextSize:{enabled:!0,minFontSize:.6,maxFontSize:1.2,adjustForOverflow:!0},barcodeFormat:{enabled:!1,mainCodeSize:1.1,subInfoSize:.7,lineHeight:1.1}});(0,a.useCallback)((e,t)=>(P("[".concat(t,"] 오류:"),e),g("".concat(t," 중 오류가 발생했습니다: ").concat(e instanceof Error?e.message:"알 수 없는 오류")),null),[]);let eN=()=>{try{localStorage.getItem("returnData")&&(console.log("기존 returnData 정리 중..."),localStorage.removeItem("returnData"));let e=e=>{let t=localStorage.getItem(e);if(!t)return[];try{if(t.includes('"pN"')||t.includes('"oN"')||t.includes('"cN"'))return ew(t);return JSON.parse(t)}catch(t){return console.error("".concat(e," 데이터 로드 오류:"),t),[]}},t=e("pendingReturns"),o=e("completedReturns"),r=e("products"),a=e("smartStoreProducts"),n=localStorage.getItem("lastUpdated");if(a.length>0&&Y(a),t.length>0||o.length>0||r.length>0){let e={pendingReturns:t,completedReturns:o,products:r};if(d({type:"SET_RETURNS",payload:e}),g("마지막 업데이트: ".concat(new Date(n||"").toLocaleString())),a.length>0&&t.length>0){let o=t.filter(e=>!e.barcode||"-"===e.barcode);if(o.length>0){let c=o.map(e=>C(e,a,r)),l=t.map(e=>c.find(t=>t.id===e.id)||e);if(c.some((e,t)=>{let r=o[t];return e.barcode&&"-"!==e.barcode&&e.barcode!==r.barcode})){d({type:"SET_RETURNS",payload:{...e,pendingReturns:l}});let t=c.filter((e,t)=>{let r=o[t];return e.barcode&&"-"!==e.barcode&&e.barcode!==r.barcode}).length;g("마지막 업데이트: ".concat(new Date(n||"").toLocaleString()," | 스마트스토어 매칭: ").concat(t,"개 추가 매칭")),console.log("✅ 스마트스토어 자동 매칭 완료: ".concat(t,"개 추가 매칭"))}}}}}catch(e){console.error("로컬 데이터 로드 오류:",e),g("로컬 데이터를 불러오는 중 오류가 발생했습니다.")}},ey=e=>{try{return JSON.stringify(e).replace(/("productName")/g,'"pN"').replace(/("optionName")/g,'"oN"').replace(/("customerName")/g,'"cN"').replace(/("returnReason")/g,'"rR"').replace(/("barcode")/g,'"bc"').replace(/("quantity")/g,'"qty"').replace(/("zigzagProductCode")/g,'"zpc"').replace(/("purchaseName")/g,'"pnm"')}catch(t){return console.error("데이터 압축 오류:",t),JSON.stringify(e)}},ew=e=>{try{let t=e.replace(/("pN")/g,'"productName"').replace(/("oN")/g,'"optionName"').replace(/("cN")/g,'"customerName"').replace(/("rR")/g,'"returnReason"').replace(/("bc")/g,'"barcode"').replace(/("qty")/g,'"quantity"').replace(/("zpc")/g,'"zigzagProductCode"').replace(/("pnm")/g,'"purchaseName"');return JSON.parse(t)}catch(t){return console.error("데이터 압축 해제 오류:",t),JSON.parse(e)}},ej=e=>{try{let t=(e,t)=>{try{let o=ey(t);return localStorage.setItem(e,o),!0}catch(o){if("QuotaExceededError"===o.name){if(console.warn("".concat(e," 저장 실패 - 할당량 초과, 데이터 크기 줄이기 시도")),Array.isArray(t)&&t.length>100){let o=t.slice(-100);try{let r=ey(o);return localStorage.setItem(e,r),console.log("".concat(e," 데이터 크기 축소 저장 성공 (").concat(t.length," -> ").concat(o.length,")")),!0}catch(t){console.error("".concat(e," 축소 저장도 실패:"),t)}}return!1}throw o}},o=t("pendingReturns",e.pendingReturns||[]),r=t("completedReturns",e.completedReturns||[]),a=t("products",e.products||[]);return localStorage.setItem("lastUpdated",new Date().toISOString()),o&&r&&a||g("일부 데이터가 크기 제한으로 인해 축소 저장되었습니다."),!0}catch(e){return console.error("로컬 스토리지 저장 오류:",e),g("데이터 저장 중 오류가 발생했습니다. 브라우저 저장공간을 확인해주세요."),!1}},ev=(0,a.useCallback)(()=>{try{ej(o),console.log("로컬 데이터 자동 저장 완료")}catch(e){console.error("자동 저장 실패:",e)}},[o]);(0,a.useEffect)(()=>{if(o.pendingReturns.length>0||o.completedReturns.length>0||o.products.length>0){let e=setTimeout(()=>{ev()},1e3);return()=>clearTimeout(e)}},[o,ev]);let eC=()=>{try{let e=0;for(let t in localStorage)localStorage.hasOwnProperty(t)&&(e+=localStorage[t].length);e>5242880&&(console.log("로컬 스토리지 용량 정리 시작..."),["returnData","returnData_backup"].forEach(e=>{localStorage.getItem(e)&&(localStorage.removeItem(e),console.log("".concat(e," 삭제됨")))}),g("로컬 스토리지 정리 완료"))}catch(e){console.error("스토리지 정리 오류:",e)}};(0,a.useEffect)(()=>{eC(),eN(),localStorage.getItem("pendingReturns")||localStorage.getItem("completedReturns")||g("로컬 저장소에서 데이터를 불러왔습니다. 엑셀 파일을 업로드하여 시작하세요.")},[]),(0,a.useEffect)(()=>{let e=localStorage.getItem("buttonColors");if(e)try{eo(JSON.parse(e))}catch(e){console.error("색상 설정 로드 오류:",e)}},[]),(0,a.useEffect)(()=>{let e=localStorage.getItem("tableSettings");if(e)try{let t=JSON.parse(e),o={popupWidth:81,popupHeight:67.5,popupTableFontSize:1,popupBarcodeFontSize:.7,popupCellPadding:.5,popupLineHeight:1.2,mainTableFontSize:1,mainBarcodeFontSize:.7,mainCellPadding:.75,mainLineHeight:1.2,columnAlignment:{customerName:"center",orderNumber:"center",productName:"left",optionName:"center",quantity:"center",returnReason:"center",trackingNumber:"center",barcode:"left",actions:"center"},columnWidths:{customerName:120,orderNumber:100,productName:200,optionName:120,quantity:30,returnReason:80,trackingNumber:120,barcode:180,actions:30},autoTextSize:{enabled:!0,minFontSize:.6,maxFontSize:1.2,adjustForOverflow:!0},barcodeFormat:{enabled:!1,mainCodeSize:1.1,subInfoSize:.7,lineHeight:1.1},...t};ef(o);let r=document.documentElement;r.style.setProperty("--popup-width","".concat(o.popupWidth,"vw")),r.style.setProperty("--popup-height","".concat(o.popupHeight,"vh")),r.style.setProperty("--popup-table-font-size","".concat(o.popupTableFontSize,"rem")),r.style.setProperty("--popup-barcode-font-size","".concat(o.popupBarcodeFontSize,"rem")),r.style.setProperty("--popup-cell-padding","".concat(o.popupCellPadding,"rem")),r.style.setProperty("--popup-line-height",o.popupLineHeight.toString()),r.style.setProperty("--main-table-font-size","".concat(o.mainTableFontSize,"rem")),r.style.setProperty("--main-barcode-font-size","".concat(o.mainBarcodeFontSize,"rem")),r.style.setProperty("--main-cell-padding","".concat(o.mainCellPadding,"rem")),r.style.setProperty("--main-line-height",o.mainLineHeight.toString()),o.columnAlignment&&Object.entries(o.columnAlignment).forEach(e=>{let[t,o]=e;r.style.setProperty("--column-".concat(t,"-alignment"),o)}),o.columnWidths&&(Object.entries(o.columnWidths).forEach(e=>{let[t,o]=e;r.style.setProperty("--column-".concat(t,"-width"),"".concat(o,"px"))}),o.columnWidths.mainBarcode&&r.style.setProperty("--column-main-barcode-width","".concat(o.columnWidths.mainBarcode,"px"))),o.autoTextSize&&Object.entries(o.autoTextSize).forEach(e=>{let[t,o]=e;r.style.setProperty("--auto-text-size-".concat("enabled"===t?"enabled":"minFontSize"===t?"minFontSize":"maxFontSize"===t?"maxFontSize":"adjustForOverflow"===t?"adjustForOverflow":t),String(o))}),o.barcodeFormat&&Object.entries(o.barcodeFormat).forEach(e=>{let[t,o]=e,a="enabled"===t?"enabled":"mainCodeSize"===t?"mainCodeSize":"subInfoSize"===t?"subInfoSize":"lineHeight"===t?"lineHeight":t;r.style.setProperty("--barcode-format-".concat(a),String(o)),console.log("초기화 시 바코드 CSS 변수 설정: --barcode-format-".concat(a," = ").concat(o))}),console.log("설정 로드 완료 - 오버플로우 감지 실행 예정"),setTimeout(()=>{console.log("설정 로드 후 오버플로우 감지 실행 중..."),o.autoTextSize.enabled&&eP()},200)}catch(e){console.error("표 설정 로드 오류:",e)}},[]);let eS=(e,t)=>{console.log("자동 텍스트 크기 설정 변경: ".concat(e," = ").concat(t));let o={...eb};o.autoTextSize[e]=t,ef(o),localStorage.setItem("tableSettings",JSON.stringify(o));let r="enabled"===e?"enabled":"minFontSize"===e?"minFontSize":"maxFontSize"===e?"maxFontSize":"adjustForOverflow"===e?"adjustForOverflow":e;document.documentElement.style.setProperty("--auto-text-size-".concat(r),t.toString()),console.log("CSS 변수 설정: --auto-text-size-".concat(r," = ").concat(t)),console.log("오버플로우 감지 실행 예정..."),setTimeout(()=>{console.log("오버플로우 감지 실행 중..."),eP()},100)},ez=(e,t)=>{console.log("바코드 형식 설정 변경: ".concat(e," = ").concat(t));let o={...eb};o.barcodeFormat[e]=t,ef(o),localStorage.setItem("tableSettings",JSON.stringify(o));let r="enabled"===e?"enabled":"mainCodeSize"===e?"mainCodeSize":"subInfoSize"===e?"subInfoSize":"lineHeight"===e?"lineHeight":e,a=document.documentElement;a.style.setProperty("--barcode-format-".concat(r),t.toString()),console.log("CSS 변수 설정: --barcode-format-".concat(r," = ").concat(t));let n=a.style.getPropertyValue("--barcode-format-".concat(r));console.log("CSS 변수 적용 확인: --barcode-format-".concat(r," = ").concat(n));let c=document.querySelectorAll(".barcode-field");console.log("발견된 바코드 필드 수: ".concat(c.length)),c.forEach((o,r)=>{if("mainCodeSize"===e){let e=o.querySelector(".main-code");e&&(e.style.setProperty("font-size","".concat(t,"rem"),"important"),console.log("바코드 필드 ".concat(r+1," 메인 코드 크기 적용: ").concat(t,"rem")))}else if("subInfoSize"===e){let e=o.querySelector(".sub-info");e&&(e.style.setProperty("font-size","".concat(t,"rem"),"important"),console.log("바코드 필드 ".concat(r+1," 서브 정보 크기 적용: ").concat(t,"rem")))}else"lineHeight"===e&&(o.style.setProperty("line-height",t.toString(),"important"),console.log("바코드 필드 ".concat(r+1," 줄 간격 적용: ").concat(t)))}),setTimeout(()=>{document.querySelectorAll(".barcode-field").forEach((e,t)=>{let r=e.querySelector(".main-code"),a=e.querySelector(".sub-info");r&&r.style.setProperty("font-size","".concat(o.barcodeFormat.mainCodeSize,"rem"),"important"),a&&a.style.setProperty("font-size","".concat(o.barcodeFormat.subInfoSize,"rem"),"important"),e.style.setProperty("line-height",o.barcodeFormat.lineHeight.toString(),"important"),console.log("바코드 필드 ".concat(t+1," 전체 설정 적용 완료"))})},50),console.log("바코드 형식 변경으로 오버플로우 감지 실행 예정..."),setTimeout(()=>{console.log("바코드 형식 변경으로 오버플로우 감지 실행 중..."),eP()},100)},eP=(0,a.useCallback)(()=>{if(console.log("=== 오버플로우 감지 함수 호출 ==="),console.log("현재 설정 상태:",{enabled:eb.autoTextSize.enabled,adjustForOverflow:eb.autoTextSize.adjustForOverflow,minFontSize:eb.autoTextSize.minFontSize,maxFontSize:eb.autoTextSize.maxFontSize}),!eb.autoTextSize.enabled){console.log("자동 텍스트 크기 조정이 비활성화되어 있습니다.");return}console.log("오버플로우 감지 시작...");let e=document.querySelectorAll(".pending-returns-table, .main-table");console.log("발견된 테이블 수: ".concat(e.length));let t=0,o=0;e.forEach((e,r)=>{let a=e.querySelectorAll("td");console.log("테이블 ".concat(r+1,": ").concat(a.length,"개 셀 발견")),a.forEach((e,r)=>{t++;let a=e.textContent||"";if(0===a.trim().length){e.classList.remove("overflow-detected"),e.style.removeProperty("font-size"),e.style.removeProperty("line-height"),e.style.removeProperty("white-space"),e.style.removeProperty("word-break"),e.style.removeProperty("overflow"),e.style.removeProperty("text-overflow");return}e.style.fontSize,e.style.lineHeight,e.style.whiteSpace,e.style.wordBreak,e.style.overflow,e.style.fontSize="",e.style.lineHeight="",e.style.whiteSpace="",e.style.wordBreak="",e.style.overflow="",e.offsetHeight;let n=e.offsetWidth,c=e.scrollWidth;if(c>n&&console.log('오버플로우 감지: "'.concat(a,'" (너비: ').concat(n,"px, 내용: ").concat(c,"px)")),c>n){if(o++,e.classList.add("overflow-detected"),eb.autoTextSize.adjustForOverflow){let t;let o=16*eb.autoTextSize.minFontSize,r=16*eb.autoTextSize.maxFontSize,c=n/(9.6*a.length);t=Math.min(r,t=Math.max(o,t=c<1?16*c*.9:16)),console.log('폰트 크기 조정: "'.concat(a,'" → ').concat(t,"px (기본: 16px)")),e.style.setProperty("font-size","".concat(t,"px"),"important"),e.style.setProperty("line-height","1.2","important"),e.style.setProperty("white-space","normal","important"),e.style.setProperty("word-break","break-word","important"),e.style.setProperty("overflow","visible","important"),e.style.setProperty("text-overflow","clip","important")}}else e.classList.remove("overflow-detected"),e.style.removeProperty("font-size"),e.style.removeProperty("line-height"),e.style.removeProperty("white-space"),e.style.removeProperty("word-break"),e.style.removeProperty("overflow"),e.style.removeProperty("text-overflow")})}),console.log("오버플로우 감지 완료: 총 ".concat(t,"개 셀 중 ").concat(o,"개 오버플로우 감지"))},[eb.autoTextSize]);(0,a.useEffect)(()=>{if(eb.autoTextSize.enabled){let e=setTimeout(eP,50),t=setTimeout(eP,200);return()=>{clearTimeout(e),clearTimeout(t)}}},[o.pendingReturns,o.completedReturns,eb.autoTextSize.enabled,eP]),(0,a.useEffect)(()=>{let e,t;if(!eb.autoTextSize.enabled)return;let o=()=>{clearTimeout(e),e=setTimeout(()=>{eP()},100)};return window.addEventListener("resize",o),t=setInterval(()=>{eP()},5e3),()=>{window.removeEventListener("resize",o),clearTimeout(e),clearInterval(t)}},[eb.autoTextSize.enabled,eP]),(0,a.useCallback)(async(e,t)=>{try{P("".concat("products"===t?"상품":"반품"," 엑셀 파일 처리 시작:"),e.name);let o="products"===t?await s(e):await l(e);return P("".concat("products"===t?"상품":"반품"," 엑셀 파일 처리 완료:"),{파일명:e.name,데이터길이:o.length}),o}catch(e){throw Error("엑셀 파일 처리 오류: ".concat(e instanceof Error?e.message:"알 수 없는 오류"))}},[]),(0,a.useCallback)((e,t)=>{let o=[];for(let r=0;r<e.length;r+=t)o.push(e.slice(r,r+t));return o},[]);let eR=()=>{O?F([]):F(o.pendingReturns.map((e,t)=>t)),I(!O),M(null)},ek=e=>{D(e),E(e.detailReason||""),S(!0),e$(e=>e+10)},eD=(0,a.useCallback)(e=>{z&&(d({type:"UPDATE_RETURN",payload:{...z,detailReason:e}}),S(!1),e$(e=>Math.max(0,e-10)),g("반품 사유 상세 정보가 저장되었습니다."))},[z,d]),eT=(e,t,o)=>t>0&&o[t-1].orderNumber===e.orderNumber?"bg-gray-50":"",eE=e=>!!e&&"string"==typeof e&&(e.includes("불량")||e.includes("하자")||e.includes("파손"));(0,a.useCallback)(e=>{ec(e),ea(!0),e$(e=>e+10)},[]);let eL=()=>{U?B([]):B(e8.map((e,t)=>t)),H(!U),J(null)},eF=e=>{if(!e||"string"!=typeof e)return"";let t=e.toLowerCase();return t.includes("불실")||t.includes("변심")||t.includes("단순")?"단순변심":t.includes("실못")||t.includes("잘못")&&t.includes("주문")?"주문실수":t.includes("파손")||t.includes("불량")?"파손 및 불량":e},eO=(0,a.useCallback)(()=>{var e;if(console.log("전체 삭제 버튼 클릭됨"),console.log("현재 상품 수:",(null===(e=o.products)||void 0===e?void 0:e.length)||0),!o.products||0===o.products.length){g("삭제할 상품 데이터가 없습니다.");return}if(confirm("정말로 모든 상품 데이터(".concat(o.products.length,"개)를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.")))try{console.log("상품 삭제 시작"),d({type:"SET_PRODUCTS",payload:[]});let e={...JSON.parse(localStorage.getItem("returnData")||"{}"),products:[]};try{let t=ey(e);localStorage.setItem("returnData",t),console.log("압축 저장 성공")}catch(t){console.warn("압축 저장 실패, 일반 저장 시도:",t),localStorage.setItem("returnData",JSON.stringify(e)),console.log("일반 저장 성공")}localStorage.removeItem("products"),console.log("products 키 직접 삭제 완료"),setTimeout(()=>{window.location.reload()},1e3),g("모든 상품 데이터(".concat(o.products.length,"개)가 삭제되었습니다. 페이지를 새로고침합니다.")),console.log("상품 삭제 완료")}catch(e){console.error("상품 데이터 삭제 중 오류:",e),g("상품 데이터 삭제 중 오류가 발생했습니다.")}},[d,o.products]);(0,a.useCallback)(e=>{ee(e),K(!0),e$(e=>e+10)},[]);let eI=(0,a.useCallback)(e=>{if(!Q)return;let t={...Q,returnTrackingNumber:e.trim()};if(e.trim()){let e={...t,status:"COMPLETED",completedAt:new Date};d({type:"SET_RETURNS",payload:{pendingReturns:o.pendingReturns.filter(e=>e.id!==t.id),completedReturns:[...o.completedReturns,e],products:o.products}}),g("".concat(e.productName," 상품이 입고완료 처리되었습니다."))}else d({type:"SET_RETURNS",payload:{pendingReturns:o.pendingReturns.map(e=>e.id===t.id?t:e),completedReturns:o.completedReturns,products:o.products}}),g("반품송장번호가 업데이트되었습니다.");ej(o),K(!1),ee(null),e$(e=>Math.max(0,e-10))},[Q,d,o,ej]),[e_,eM]=(0,a.useState)(""),[eA,eB]=(0,a.useState)([]),[eU,eH]=(0,a.useState)(!1),eq=()=>{if(!e_.trim()){eH(!1),eB([]);return}let e=e_.toLowerCase().trim(),t=o.completedReturns.filter(t=>t.customerName&&t.customerName.toLowerCase().includes(e)||t.orderNumber&&t.orderNumber.toLowerCase().includes(e));eB(t),eH(!0),0===t.length?g("검색 결과가 없습니다."):g("".concat(t.length,"개의 검색 결과를 찾았습니다."))},eJ=e=>{let t={};return e.forEach(e=>{if(e.completedAt){let o=new Date(e.completedAt),r=new Date(o.getFullYear(),o.getMonth(),o.getDate()).toISOString().split("T")[0];t[r]||(t[r]=[]),t[r].push(e)}}),Object.entries(t).sort((e,t)=>{let[o]=e,[r]=t;return r.localeCompare(o)}).map(e=>{let[t,o]=e;return{date:t,items:o}})};(0,a.useMemo)(()=>Object.entries(o.completedReturns.reduce((e,t)=>{if(!t.completedAt)return e;let o=new Date(t.completedAt),r=new Date(o.getFullYear(),o.getMonth(),o.getDate()).toLocaleDateString();return e[r]||(e[r]=[]),e[r].push(t),e},{})).map(e=>{let[t,o]=e;return{date:t,items:o.sort((e,t)=>new Date(t.completedAt).getTime()-new Date(e.completedAt).getTime())}}).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),[o.completedReturns]);let eW=(0,a.useMemo)(()=>eU&&0!==eA.length?eJ(eA):[],[eU,eA]),eK=e=>e.includes("Z"),eV=e=>eK(e.orderNumber)&&(!e.customProductCode||"-"===e.customProductCode||""===e.customProductCode.trim())?(0,r.jsx)("button",{className:"text-blue-600 hover:text-blue-800 underline font-medium",onClick:()=>tu(e),title:"자체상품코드 없음 - 수동매칭 필요",children:e.productName}):e.barcode&&"-"!==e.barcode?e.purchaseName&&"-"!==e.purchaseName?(0,r.jsx)("span",{children:e.purchaseName}):(0,r.jsx)("span",{children:e.productName}):(0,r.jsx)("button",{className:"text-blue-600 hover:text-blue-800 underline",onClick:()=>tu(e),children:e.productName});function eY(e,t){var o,r;if(!e.customProductCode||"-"===e.customProductCode||""===e.customProductCode.trim())return console.log('⚠️ 지그재그 반품 자체상품코드 없음: "'.concat(e.productName,'" - 수동매칭 필요')),{...e,matchType:"manual_matching_required",matchSimilarity:0,matchedProductName:e.productName,matchedProductOption:e.optionName||""};if(e.customProductCode&&"-"!==e.customProductCode){console.log('\uD83D\uDD0D 자체상품코드 우선 매칭 시도: "'.concat(e.customProductCode,'"'));let o=t.find(t=>t.customProductCode&&t.customProductCode.toLowerCase().trim()===e.customProductCode.toLowerCase().trim());if(o){if(!e.optionName||!o.optionName||e.optionName.toLowerCase().trim()===o.optionName.toLowerCase().trim())return console.log("✅ 자체상품코드 우선 매칭 성공: ".concat(e.customProductCode," → ").concat(o.productName," [").concat(o.optionName,"]")),{...e,barcode:o.barcode,purchaseName:o.purchaseName||o.productName,zigzagProductCode:o.zigzagProductCode||"",customProductCode:o.customProductCode||"",matchType:"custom_code_priority",matchSimilarity:1,matchedProductName:o.productName,matchedProductOption:o.optionName};console.log('⚠️ 자체상품코드 매칭 실패: 옵션명 불일치 "'.concat(e.optionName,'" ≠ "').concat(o.optionName,'"'))}}if(V.length>0){let o=C(e,V,t);if(o.barcode&&"-"!==o.barcode)return console.log("✅ 3단계 매칭 성공: ".concat(o.productName)),o}let a={...e};if(e.barcode&&"-"!==e.barcode)return e;let n=["봄","여름","가을","겨울","spring","summer","autumn","winter"],c=e.productName.toLowerCase().trim();n.forEach(e=>{c=c.replace(RegExp("\\b".concat(e,"\\b"),"g"),"").trim()}),console.log('\uD83D\uDD0D [matchProductByZigzagCode] 계절 키워드 제거 후: "'.concat(c,'"'));let l=t.find(e=>{if(!e.productName)return!1;let t=e.productName.toLowerCase().trim();return n.forEach(e=>{t=t.replace(RegExp("\\b".concat(e,"\\b"),"g"),"").trim()}),t===c&&t.length>0});if(l)return console.log('✅ [matchProductByZigzagCode] 계절 키워드만 다른 완전 동일 상품 발견: "'.concat(l.productName,'"')),a.barcode=l.barcode||"",a.customProductCode=l.customProductCode||l.zigzagProductCode||"",a.purchaseName=l.purchaseName||l.productName,a.zigzagProductCode=l.zigzagProductCode||"",a.matchType="계절 키워드만 다른 완전 동일 상품",a.matchSimilarity=.95,a;let s=t=>{if(0===t.length)return null;if(!e.optionName||""===e.optionName.trim())return console.log("⚠️ 옵션명 없음, 첫 번째 상품 선택: ".concat(t[0].productName)),t[0];let o=e.optionName.toLowerCase().trim();console.log('\uD83D\uDD0D 옵션명 매칭 시작: "'.concat(e.optionName,'" (후보 ').concat(t.length,"개)"));let r=t.map(e=>{if(!e.optionName)return{product:e,score:0,reason:"옵션명 없음"};let t=e.optionName.toLowerCase().trim(),r=0,a="";if(t===o)r=100,a="정확 일치";else if(t.includes(o)||o.includes(t))r=80,a="부분 일치";else{let e=i(o),n=i(t);if(e&&n&&e===n)r=60,a="색상 일치";else{let e=k(o,t);r=Math.round(50*e),a="유사도 ".concat(e.toFixed(2))}}return{product:e,score:r,reason:a}});r.sort((e,t)=>t.score-e.score),console.log("\uD83D\uDCCA 옵션명 매칭 결과:"),r.forEach((e,t)=>{console.log("  ".concat(t+1,". ").concat(e.product.optionName," (").concat(e.reason,", 점수: ").concat(e.score,")"))});let a=r[0];return a.score>=30?(console.log("✅ 옵션명 매칭 성공: ".concat(e.optionName," → ").concat(a.product.optionName," (").concat(a.reason,", 점수: ").concat(a.score,")")),a.product):(console.log("❌ 옵션명 매칭 실패: 최고 점수 ".concat(a.score," (임계값 30 미달)")),null)},i=e=>{for(let t of["블랙","화이트","네이비","그레이","베이지","레드","블루","그린","옐로우","퍼플","핑크","오렌지","브라운","카멜","민트","아이보리","소라","곤색","연두","다크그레이","연핑크","오트밀","연겨자","회색","검정","곤색","아쿠아블루","메란지","라이트민트","연핑크","베이지"])if(e.includes(t.toLowerCase()))return t.toLowerCase();return null},d=(null===(o=e.purchaseName)||void 0===o?void 0:o.toLowerCase())||"",u=(null===(r=e.optionName)||void 0===r?void 0:r.toLowerCase())||"";if(d.includes("연채원")&&d.includes("607")){if(console.log('\uD83D\uDD0D 연채원 607 특별 매칭 시도: "'.concat(e.purchaseName,'" - "').concat(e.optionName,'"')),u.includes("블랙")&&u.includes("1사이즈")){console.log("\uD83D\uDD0D 블랙,1사이즈 특별 강화 매칭 시도");let e=t.find(e=>"B-10231420001"===e.barcode||"B-10231420001"===e.customProductCode);if(e)return console.log("✅ 블랙,1사이즈 특별 바코드 매칭 성공: B-10231420001"),a.barcode=e.barcode,a.purchaseName=e.purchaseName||e.productName,a.zigzagProductCode=e.zigzagProductCode||"",a.matchType="연채원607_블랙1사이즈_특별매칭",a.matchSimilarity=1,a.matchedProductName=e.productName,a.matchedProductOption=e.optionName,a;let o=t.find(e=>e.optionName&&"블랙,1사이즈"===e.optionName.toLowerCase().trim()&&e.purchaseName&&e.purchaseName.toLowerCase().includes("연채원")&&e.purchaseName.toLowerCase().includes("607"));if(o)return console.log("✅ 블랙,1사이즈 정확 매칭 성공: ".concat(o.barcode)),a.barcode=o.barcode,a.purchaseName=o.purchaseName||o.productName,a.zigzagProductCode=o.zigzagProductCode||"",a.matchType="연채원607_블랙1사이즈_정확매칭",a.matchSimilarity=1,a.matchedProductName=o.productName,a.matchedProductOption=o.optionName,a}let o=t.filter(e=>e.optionName&&e.optionName.toLowerCase().trim()===u.trim());if(o.length>0)return console.log('✅ 연채원 607 정확한 옵션명 매칭: "'.concat(u,'" → "').concat(o[0].optionName,'"')),a.barcode=o[0].barcode,a.purchaseName=o[0].purchaseName||o[0].productName,a.zigzagProductCode=o[0].zigzagProductCode||"",a.matchType="연채원607_정확옵션매칭",a.matchSimilarity=1,a.matchedProductName=o[0].productName,a.matchedProductOption=o[0].optionName,a;let r=u.split(",").map(e=>e.trim()).filter(e=>e.length>0);if(console.log("분리된 옵션 부분: [".concat(r.join(", "),"]")),r.length>=2){let e=r.find(e=>["블랙","화이트","네이비","그레이","베이지","레드","블루","그린"].includes(e)),o=r.find(e=>e.includes("사이즈")||/^\d+$/.test(e)||/^[SMLX]+$/i.test(e));console.log('색상 부분: "'.concat(e,'", 사이즈 부분: "').concat(o,'"'));let n=t.filter(e=>e.purchaseName&&e.purchaseName.toLowerCase().includes("연채원")&&e.purchaseName.toLowerCase().includes("607"));if(console.log("연채원 607 사입상품명 상품들: ".concat(n.length,"개")),n.length>0){if("블랙"===e){let e=n.filter(e=>e.optionName&&e.optionName.toLowerCase().includes("블랙"));if(console.log("연채원 607 + 블랙 색상 상품들: ".concat(e.length,"개")),e.length>0){if(o){let t=e.filter(e=>e.optionName&&e.optionName.toLowerCase().includes(o.toLowerCase()));if(t.length>0)return console.log('✅ 연채원 607 + 블랙 + 사이즈 매칭: "'.concat(u,'" → "').concat(t[0].optionName,'"')),a.barcode=t[0].barcode,a.purchaseName=t[0].purchaseName||t[0].productName,a.zigzagProductCode=t[0].zigzagProductCode||"",a.matchType="연채원607_사입명색상사이즈매칭",a.matchSimilarity=.98,a.matchedProductName=t[0].productName,a.matchedProductOption=t[0].optionName,a}return console.log('✅ 연채원 607 + 블랙 색상 매칭: "'.concat(u,'" → "').concat(e[0].optionName,'"')),a.barcode=e[0].barcode,a.purchaseName=e[0].purchaseName||e[0].productName,a.zigzagProductCode=e[0].zigzagProductCode||"",a.matchType="연채원607_사입명색상매칭",a.matchSimilarity=.95,a.matchedProductName=e[0].productName,a.matchedProductOption=e[0].optionName,a}}let t=null,c=0;for(let e of n){if(!e.optionName)continue;let o=e.optionName.toLowerCase().trim().split(",").map(e=>e.trim()).filter(e=>e.length>0),a=0;for(let e of r)for(let t of o)if(e===t){a++;break}if(a>0){let n=a/Math.max(r.length,o.length);console.log("  - ".concat(e.optionName,": ").concat(a,"/").concat(r.length," 정확 매칭, 점수: ").concat(n.toFixed(2))),n>c&&(c=n,t=e)}}if(t&&c>=.5)return console.log('✅ 연채원 607 + 옵션 부분 매칭: "'.concat(u,'" → "').concat(t.optionName,'" (점수: ').concat(c.toFixed(2),")")),a.barcode=t.barcode,a.purchaseName=t.purchaseName||t.productName,a.zigzagProductCode=t.zigzagProductCode||"",a.matchType="연채원607_사입명옵션매칭",a.matchSimilarity=c,a.matchedProductName=t.productName,a.matchedProductOption=t.optionName,a}}if(u.includes("블랙")){let e=t.find(e=>"B-10231420001"===e.barcode||"B-10231420001"===e.customProductCode);if(e)return console.log("✅ 연채원 607 블랙 바코드 매칭: B-10231420001"),a.barcode=e.barcode,a.purchaseName=e.purchaseName||e.productName,a.zigzagProductCode=e.zigzagProductCode||"",a.matchType="연채원607_바코드매칭",a.matchSimilarity=.8,a.matchedProductName=e.productName,a.matchedProductOption=e.optionName,a}}if(a.barcode&&"-"!==a.barcode)return console.log("✅ 연채원 607 특별 매칭 완료: ".concat(a.barcode)),a;if(e.customProductCode&&"-"!==e.customProductCode){console.log('\uD83D\uDD0D 자체상품코드 "'.concat(e.customProductCode,'"로 매칭 시도...'));let o=t.filter(t=>t.customProductCode&&t.customProductCode.toLowerCase().trim()===e.customProductCode.toLowerCase().trim()||t.zigzagProductCode&&t.zigzagProductCode.toLowerCase().trim()===e.customProductCode.toLowerCase().trim());if(o.length>0){let t=s(o);if(t)return console.log("✅ 자체상품코드 정확 매칭 성공 (옵션 고려): ".concat(e.customProductCode," → ").concat(t.purchaseName||t.productName," [").concat(t.optionName,"]")),a.barcode=t.barcode,a.purchaseName=t.purchaseName||t.productName,a.zigzagProductCode=t.zigzagProductCode||"",a.matchType="custom_code_exact",a.matchSimilarity=1,a.matchedProductName=t.productName,a.matchedProductOption=t.optionName,a;console.log("❌ 자체상품코드 매칭 실패: 옵션명 매칭 불가 (".concat(e.optionName,")"))}console.log('\uD83D\uDD0D 자체상품코드 "'.concat(e.customProductCode,'"와 사입상품명 유사도 매칭 시도...'));let r=null,n=e.customProductCode.toLowerCase().trim();for(let e of t)if(e.purchaseName&&"string"==typeof e.purchaseName){let t=e.purchaseName.toLowerCase().trim();if(t.includes(n)||n.includes(t))(!r||.95>r.similarity)&&(r={product:e,similarity:.95,matchType:"자체상품코드-사입명 포함관계"},console.log("\uD83D\uDCCC 포함관계 발견 (유사도: ".concat("0.95",'): "').concat(n,'" ↔ "').concat(t,'"')));else{let o=k(n,t);o>.4&&(!r||o>r.similarity)&&(r={product:e,similarity:o,matchType:"자체상품코드-사입명 유사도"},console.log("\uD83D\uDCCA 유사도 매칭 (유사도: ".concat(o.toFixed(2),'): "').concat(n,'" ↔ "').concat(t,'"')))}}if(r&&r.similarity>.5)return console.log("✅ 자체상품코드 기반 매칭 성공 (".concat(r.matchType,", 유사도: ").concat(r.similarity.toFixed(2),")")),a.barcode=r.product.barcode,a.purchaseName=r.product.purchaseName||r.product.productName,a.zigzagProductCode=r.product.zigzagProductCode||e.zigzagProductCode,a.customProductCode=r.product.customProductCode||r.product.zigzagProductCode||"",a.matchType=r.matchType,a.matchSimilarity=r.similarity,a.matchedProductName=r.product.productName,a.matchedProductOption=r.product.optionName,a;console.log("❌ 자체상품코드 기반 매칭 실패: ".concat(e.customProductCode))}if(e.purchaseName&&"-"!==e.purchaseName){let o=t.filter(t=>{var o;return t.purchaseName&&t.purchaseName.toLowerCase().trim()===(null===(o=e.purchaseName)||void 0===o?void 0:o.toLowerCase().trim())});if(o.length>0){let t=s(o);if(t)return console.log("✅ 사입상품명 매칭 성공 (옵션 고려): ".concat(e.purchaseName," → ").concat(t.productName," [").concat(t.optionName,"]")),a.barcode=t.barcode,a.customProductCode=t.customProductCode||t.zigzagProductCode||"",a.zigzagProductCode=t.zigzagProductCode||"",a.matchType="purchase_name_match",a.matchSimilarity=1,a.matchedProductName=t.productName,a.matchedProductOption=t.optionName,a;console.log("❌ 사입상품명 매칭 실패: 옵션명 매칭 불가 (".concat(e.optionName,")"))}}if(e.zigzagProductCode&&"-"!==e.zigzagProductCode){console.log('\uD83D\uDD0D 지그재그 상품코드 "'.concat(e.zigzagProductCode,'"로 매칭 시도...'));let o=t.filter(t=>t.zigzagProductCode&&t.zigzagProductCode.toLowerCase().trim()===e.zigzagProductCode.toLowerCase().trim());if(o.length>0){let t=s(o);if(t)return console.log("✅ 지그재그 상품코드 정확 매칭 성공 (옵션 고려): ".concat(e.zigzagProductCode," → ").concat(t.productName," [").concat(t.optionName,"]")),a.barcode=t.barcode,a.purchaseName=t.purchaseName||t.productName,a.customProductCode=t.customProductCode||"",a.matchType="zigzag_code_exact",a.matchSimilarity=1,a.matchedProductName=t.productName,a.matchedProductOption=t.optionName,a}console.log('\uD83D\uDD0D 지그재그 코드 "'.concat(e.zigzagProductCode,'"와 사입상품명 유사도 매칭 시도...'));let r=null,n=e.zigzagProductCode.toLowerCase().trim();for(let e of t)if(e.purchaseName&&"string"==typeof e.purchaseName){let t=e.purchaseName.toLowerCase().trim();if(t.includes(n)||n.includes(t))(!r||.9>r.similarity)&&(r={product:e,similarity:.9,matchType:"지그재그코드-사입명 포함관계"},console.log("\uD83D\uDCCC 포함관계 발견 (유사도: ".concat("0.90",'): "').concat(n,'" ↔ "').concat(t,'"')));else{let o=k(n,t);o>.4&&(!r||o>r.similarity)&&(r={product:e,similarity:o,matchType:"지그재그코드-사입명 유사도"},console.log("\uD83D\uDCCA 유사도 매칭 (유사도: ".concat(o.toFixed(2),'): "').concat(n,'" ↔ "').concat(t,'"')))}}if(r&&r.similarity>.5)return console.log("✅ 지그재그 코드 기반 매칭 성공 (".concat(r.matchType,", 유사도: ").concat(r.similarity.toFixed(2),")")),a.barcode=r.product.barcode,a.purchaseName=r.product.purchaseName||r.product.productName,a.customProductCode=r.product.customProductCode||r.product.zigzagProductCode||"",a.matchType=r.matchType,a.matchSimilarity=r.similarity,a.matchedProductName=r.product.productName,a.matchedProductOption=r.product.optionName,a;console.log("❌ 지그재그 코드 기반 매칭 실패: ".concat(e.zigzagProductCode))}if(e.productName){console.log('\uD83D\uDD0D 상품명 매칭 시작: "'.concat(e.productName,'"'));let o=t.filter(t=>{var o,r;return t.productName&&t.productName.toLowerCase().trim()===(null===(o=e.productName)||void 0===o?void 0:o.toLowerCase().trim())||t.purchaseName&&t.purchaseName.toLowerCase().trim()===(null===(r=e.productName)||void 0===r?void 0:r.toLowerCase().trim())});console.log("\uD83D\uDCCB 완전 일치 상품: ".concat(o.length,"개"));let r=[];if(0===o.length){console.log("\uD83D\uDD0D 키워드 기반 정확 매칭 시도...");let o=R(e.productName);console.log("   반품 상품 키워드: [".concat(o.join(", "),"]")),r=t.filter(e=>{if(!e.productName&&!e.purchaseName)return!1;let t=R(e.productName||e.purchaseName||"");if(console.log('   상품 "'.concat(e.productName||e.purchaseName,'" 키워드: [').concat(t.join(", "),"]")),o.length>0&&t.length>0){let e=o.filter(e=>t.includes(e)),r=e.length/Math.max(o.length,t.length);return console.log("   공통 키워드: [".concat(e.join(", "),"] (").concat(e.length,"개)")),console.log("   키워드 유사도: ".concat(r.toFixed(2))),r>=.8}return!1}),console.log("\uD83D\uDCCB 키워드 기반 정확 매칭: ".concat(r.length,"개"))}let n=o.length>0?o:r;if(n.length>0){let t=s(n);if(t){let r=o.length>0?"name_exact":"name_keyword_exact";return console.log("✅ 상품명 정확 매칭 성공 (".concat(r,", 옵션 고려): ").concat(e.productName," → ").concat(t.productName," [").concat(t.optionName,"]")),a.barcode=t.barcode,a.customProductCode=t.customProductCode||t.zigzagProductCode||"",a.purchaseName=t.purchaseName||t.productName,a.zigzagProductCode=t.zigzagProductCode||"",a.matchType=r,a.matchSimilarity=1,a.matchedProductName=t.productName,a.matchedProductOption=t.optionName,a}console.log("❌ 상품명 정확 매칭 실패: 옵션명 매칭 불가 (".concat(e.optionName,")"))}let c=t.filter(t=>t.productName&&e.productName&&(t.productName.toLowerCase().includes(e.productName.toLowerCase())||e.productName.toLowerCase().includes(t.productName.toLowerCase()))||t.purchaseName&&e.productName&&(t.purchaseName.toLowerCase().includes(e.productName.toLowerCase())||e.productName.toLowerCase().includes(t.purchaseName.toLowerCase())));if(c.length>0){let t=s(c);if(t)return console.log("✅ 상품명 부분 매칭 성공 (옵션 고려): ".concat(e.productName," → ").concat(t.productName," [").concat(t.optionName,"]")),a.barcode=t.barcode,a.customProductCode=t.customProductCode||t.zigzagProductCode||"",a.purchaseName=t.purchaseName||t.productName,a.zigzagProductCode=t.zigzagProductCode||"",a.matchType="name_partial",a.matchSimilarity=.8,a.matchedProductName=t.productName,a.matchedProductOption=t.optionName,a;console.log("❌ 상품명 부분 매칭 실패: 옵션명 매칭 불가 (".concat(e.optionName,")"))}let l=[];for(let o of(console.log('\uD83D\uDD0D 유사도 매칭 시작: "'.concat(e.productName,'"')),t)){if(o.productName&&e.productName){let t=k(o.productName,e.productName);t>.7&&(console.log('\uD83D\uDCCA 상품명 유사도: "'.concat(o.productName,'" (').concat(t.toFixed(2),")")),l.push({product:o,similarity:t}))}if(o.purchaseName&&e.productName){let t=k(o.purchaseName,e.productName);t>.75&&(console.log('\uD83D\uDCCA 사입명 유사도: "'.concat(o.purchaseName,'" (').concat(t.toFixed(2),")")),l.push({product:o,similarity:t}))}}if(l.length>0){l.sort((e,t)=>t.similarity-e.similarity);let t=s(l.filter(e=>e.similarity>=l[0].similarity-.1).map(e=>e.product));if(t){let o=l.find(e=>e.product===t);return console.log("✅ 상품명 유사도 매칭 성공 (옵션 고려): ".concat(e.productName," → ").concat(t.productName," [").concat(t.optionName,"] (유사도: ").concat(null==o?void 0:o.similarity.toFixed(2),")")),a.barcode=t.barcode,a.customProductCode=t.customProductCode||t.zigzagProductCode||"",a.purchaseName=t.purchaseName||t.productName,a.zigzagProductCode=t.zigzagProductCode||"",a.matchType="name_similarity",a.matchSimilarity=(null==o?void 0:o.similarity)||.6,a.matchedProductName=t.productName,a.matchedProductOption=t.optionName,a}console.log("❌ 상품명 유사도 매칭 실패: 옵션명 매칭 불가 (".concat(e.optionName,")"))}}return console.log("❌ 매칭 실패: ".concat(e.productName)),a.matchType="no_match",a.matchSimilarity=0,a}let eX=e=>e.map(e=>({trackingNumber:e.pickupTrackingNumber||e.returnTrackingNumber||"no-tracking",items:[e],totalQuantity:e.quantity||1,isGroup:!1})),eZ=e=>{let{items:t}=e,a=eX(t);return(0,r.jsxs)("table",{className:"min-w-full border-collapse main-table ".concat(eb.autoTextSize.enabled?"auto-text-size-enabled":""),children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"bg-gray-50",children:[(0,r.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 text-center col-actions",children:(0,r.jsx)("input",{type:"checkbox",checked:U,onChange:eL,className:"w-5 h-5"})}),(0,r.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 w-24 col-customer-name",children:"고객명"}),(0,r.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 col-order-number",children:"주문번호"}),(0,r.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 col-product-name",children:"사입상품명"}),(0,r.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 col-option-name",children:"옵션명"}),(0,r.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 w-12 col-quantity",children:"수량"}),(0,r.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 col-return-reason",children:"반품사유"}),(0,r.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 col-tracking-number",children:"수거송장번호"}),(0,r.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 col-barcode",children:"바코드번호"})]})}),(0,r.jsx)("tbody",{children:a.map((e,a)=>{let n=e.items[0],l=t.findIndex(e=>e.id===n.id),s=A.includes(l);return(0,r.jsxs)("tr",{className:"hover:bg-blue-50 ".concat(eE(n.returnReason)?"text-red-500":""),children:[(0,r.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 col-actions",children:(0,r.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,r.jsx)("input",{type:"checkbox",checked:s,onChange:e=>{e.target.checked?B(e=>[...e,l]):B(e=>e.filter(e=>e!==l))},className:"w-5 h-5"})})}),(0,r.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 whitespace-nowrap overflow-hidden text-ellipsis max-w-[120px] col-customer-name",children:n.customerName}),(0,r.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 whitespace-nowrap overflow-hidden text-ellipsis col-order-number",children:n.orderNumber}),(0,r.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 col-product-name",children:(0,r.jsx)("div",{className:n.barcode?"whitespace-nowrap overflow-hidden text-ellipsis":"whitespace-normal break-words line-clamp-2",children:eV(n)})}),(0,r.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 whitespace-nowrap overflow-hidden text-ellipsis col-option-name",children:c(n.optionName)}),(0,r.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 whitespace-nowrap text-center col-quantity",children:n.quantity}),(0,r.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 whitespace-nowrap overflow-hidden text-ellipsis max-w-[150px] cursor-pointer col-return-reason",onClick:()=>eE(n.returnReason)&&ek(n),children:te(n)}),(0,r.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 col-tracking-number",children:(0,r.jsx)("div",{className:"font-mono text-sm whitespace-nowrap bg-blue-100 px-2 py-1 rounded text-center",children:n.pickupTrackingNumber&&""!==n.pickupTrackingNumber?n.pickupTrackingNumber:n.returnTrackingNumber&&""!==n.returnTrackingNumber?n.returnTrackingNumber:"-"})}),(0,r.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 col-barcode",children:eb.barcodeFormat.enabled&&n.barcode&&"-"!==n.barcode?(0,r.jsxs)("div",{className:"barcode-field ".concat(eb.barcodeFormat.enabled?"enabled":""),style:{lineHeight:"".concat(eb.barcodeFormat.lineHeight),fontSize:"".concat(eb.barcodeFormat.mainCodeSize,"rem")},children:[(0,r.jsx)("div",{className:"main-code",style:{fontSize:"".concat(eb.barcodeFormat.mainCodeSize,"rem"),lineHeight:"1.2"},children:n.barcode}),(()=>{let e=o.products.find(e=>e.barcode===n.barcode);return e?(0,r.jsxs)("div",{className:"sub-info",style:{fontSize:"".concat(eb.barcodeFormat.subInfoSize,"rem"),lineHeight:"1.2"},children:["(",e.purchaseName," ",e.optionName,")"]}):null})()]}):(0,r.jsxs)("div",{className:"text-xs",children:[(0,r.jsx)("div",{className:"font-mono font-semibold",children:n.barcode||"-"}),n.barcode&&"-"!==n.barcode&&(()=>{let e=o.products.find(e=>e.barcode===n.barcode);return e?(0,r.jsxs)("div",{className:"main-barcode-info",title:"".concat(e.purchaseName," ").concat(e.optionName),children:["(",e.purchaseName," ",e.optionName,")"]}):null})()]})})]},n.id)})})]})},[eG,e$]=(0,a.useState)(0),[eQ,e0]=(0,a.useState)([]),[e1,e2]=(0,a.useState)(0),[e3,e4]=(0,a.useState)(""),[e5,e6]=(0,a.useState)([]);(0,a.useEffect)(()=>{let e=document.createElement("style");return e.innerHTML="\n      dialog {\n        position: fixed !important;\n        margin: auto !important;\n        border: none !important;\n        border-radius: 0.5rem !important;\n        padding: 1rem !important;\n        background: white !important;\n        max-width: 95vw !important;\n        max-height: 90vh !important;\n        overflow: auto !important;\n      }\n      dialog::backdrop {\n        background-color: rgba(0, 0, 0, 0.4) !important;\n      }\n      .popup-layer {\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2) !important;\n      }\n    ",document.head.appendChild(e),()=>{document.head.removeChild(e)}},[]),(0,a.useEffect)(()=>{if(o.completedReturns.length>0){let e=[...new Set(o.completedReturns.map(e=>new Date(e.completedAt).toLocaleDateString()))].sort((e,t)=>new Date(t).getTime()-new Date(e).getTime());e6(e),e4(e[0]||""),e2(0)}},[o.completedReturns]);let e8=(0,a.useMemo)(()=>!e3||eU?[]:o.completedReturns.filter(e=>new Date(e.completedAt).toLocaleDateString()===e3),[o.completedReturns,e3,eU]),e7=e=>{let t;0!==e5.length&&(e2(t="prev"===e&&e1<e5.length-1?e1+1:"next"===e&&e1>0?e1-1:"prev"===e?0:e5.length-1),e4(e5[t]),g("".concat(new Date(e5[t]).toLocaleDateString("ko-KR")," 날짜의 데이터로 이동했습니다.")))},e9=e=>{e7(e)},te=e=>{let t=e.returnReason;return e.detailReason&&""!==e.detailReason.trim()&&!t.toLowerCase().includes(e.detailReason.toLowerCase())&&(t+=" (".concat(e.detailReason,")")),t},tt=async e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){Z(!0),g("스마트스토어 상품 데이터를 처리 중입니다...");try{let e=await new Promise((e,t)=>{let o=new FileReader;o.onload=o=>{try{if(!o.target||!o.target.result)throw Error("파일 데이터를 읽을 수 없습니다.");let t=new Uint8Array(o.target.result),r=n.ij(t,{type:"array"});if(!r||!r.SheetNames||0===r.SheetNames.length)throw Error("엑셀 파일에 시트가 없습니다.");let a=r.Sheets[r.SheetNames[0]];if(!a)throw Error("엑셀 시트를 읽을 수 없습니다.");let c=n.P6.sheet_to_json(a,{header:1});if(!c||0===c.length)throw Error("엑셀 파일에 데이터가 없습니다.");console.log("스마트스토어 엑셀 데이터 로드 완료:",{행수:c.length,첫번째행:c[0]});let l=function(e){for(let t=0;t<Math.min(10,e.length);t++){let o=e[t];if(o&&["상품코드","상품명","옵션명"].reduce((e,t)=>o.some(e=>"string"==typeof e&&e.includes&&e.includes(t))?e+1:e,0)>=2)return t}return -1}(c);if(-1===l)throw Error("스마트스토어 상품 데이터 헤더 행을 찾을 수 없습니다.");let s=c[l].map(e=>String(e||"").trim()),i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=s.findIndex(t=>t===e);if(-1===o&&(o=s.findIndex(t=>t.includes(e))),-1===o&&t.length>0){for(let e of t)if(o=s.findIndex(t=>t===e),-1!==o||(o=s.findIndex(t=>t.includes(e)),-1!==o))break}return o},d=i("상품코드",["상품 코드","product_code","productCode"]),u=i("상품명",["상품 이름","product_name","productName"]),m=i("옵션명",["옵션","option_name","optionName"]),p=i("바코드",["바코드번호","barcode"]),h=i("카테고리",["분류","category"]),g=i("가격",["판매가","price"]),x=i("재고",["수량","stock"]);if(-1===d||-1===u)throw Error("필수 열(상품코드, 상품명)을 찾을 수 없습니다.");console.log("스마트스토어 컬럼 인덱스:",{상품코드:d,상품명:u,옵션명:m,바코드:p,카테고리:h,가격:g,재고:x});let b=[],f=new Map;for(let e=l+1;e<c.length;e++){let t,o;let r=c[e];if(!r||0===r.length)continue;let a="";if(void 0!==r[d]&&null!==r[d]&&(a=String(r[d]).trim()),!a){console.warn("행 ".concat(e+1,": 상품코드 없음, 건너뜀"));continue}if(f.has(a)){console.log("중복 상품코드 무시: ".concat(a));continue}let n="";if(void 0!==r[u]&&null!==r[u]&&(n=String(r[u]).trim()),!n){console.warn("행 ".concat(e+1,": 상품명 없음, 건너뜀"));continue}let l="";-1!==m&&void 0!==r[m]&&null!==r[m]&&(l=String(r[m]).trim());let s="";-1!==p&&void 0!==r[p]&&null!==r[p]&&(s=String(r[p]).trim());let i="";if(-1!==h&&void 0!==r[h]&&null!==r[h]&&(i=String(r[h]).trim()),-1!==g&&void 0!==r[g]&&null!==r[g]){let e=String(r[g]).trim();e&&!isNaN(Number(e))&&(t=Number(e))}if(-1!==x&&void 0!==r[x]&&null!==r[x]){let e=String(r[x]).trim();e&&!isNaN(Number(e))&&(o=Number(e))}let N={id:function(e,t){let o=(e||"").toString().trim(),r=(t||"").toString().trim(),a=Date.now(),n=Math.floor(1e4*Math.random());return"smartstore_".concat(o,"_").concat(r.substring(0,10),"_").concat(a,"_").concat(n)}(a,n),productCode:a,productName:n,optionName:l,barcode:s||void 0,category:i||void 0,price:t,stock:o};f.set(a,!0),b.push(N)}console.log("".concat(b.length,"개의 스마트스토어 상품 데이터가 추출되었습니다.")),e(b)}catch(e){console.error("스마트스토어 엑셀 파싱 오류:",e),t(Error("스마트스토어 엑셀 파일을 처리하는 중 오류가 발생했습니다."))}},o.onerror=()=>{t(Error("스마트스토어 엑셀 파일을 읽는 중 오류가 발생했습니다."))},o.readAsArrayBuffer(r)});Y(e),localStorage.setItem("smartStoreProducts",JSON.stringify(e));let t=o.pendingReturns.filter(e=>!e.barcode);if(t.length>0){let r=t.map(t=>C(t,e)),a=o.pendingReturns.map(e=>r.find(t=>t.id===e.id)||e);d({type:"SET_RETURNS",payload:{...o,pendingReturns:a}})}g("".concat(e.length,"개의 스마트스토어 상품이 업로드되었습니다."))}catch(e){console.error("스마트스토어 업로드 오류:",e),g("스마트스토어 업로드 중 오류가 발생했습니다: ".concat(e instanceof Error?e.message:"알 수 없는 오류"))}finally{Z(!1),e.target.value=""}}},[to,tr]=(0,a.useState)(""),[ta,tn]=(0,a.useState)(null),[tc,tl]=(0,a.useState)(null),ts=()=>{let e=to.trim();if(!e){g("수거송장번호를 입력해주세요.");return}let t=o.pendingReturns.filter(t=>t.pickupTrackingNumber&&t.pickupTrackingNumber===e||t.returnTrackingNumber&&t.returnTrackingNumber===e);if(0===t.length){g("'".concat(e,"' 수거송장번호로 등록된 반품이 없습니다.")),tl(!1),tr("");return}tl(!0),p(!0);let r=new Date,a=new Date(r.getFullYear(),r.getMonth(),r.getDate());a.setHours(0,0,0,0);let n=t.map(t=>t.pickupTrackingNumber||t.returnTrackingNumber!==e?{...t,status:"COMPLETED",completedAt:a}:{...t,pickupTrackingNumber:e,status:"COMPLETED",completedAt:a}),c=[...n,...o.completedReturns],l=o.pendingReturns.filter(t=>!(t.pickupTrackingNumber&&t.pickupTrackingNumber===e||t.returnTrackingNumber&&t.returnTrackingNumber===e));d({type:"SET_RETURNS",payload:{...o,pendingReturns:l,completedReturns:c}}),localStorage.setItem("pendingReturns",JSON.stringify(l)),localStorage.setItem("completedReturns",JSON.stringify(c)),localStorage.setItem("lastUpdated",new Date().toISOString());let s=a.toLocaleDateString();if(s!==e3){e4(s);let e=e5.indexOf(s);e>=0?e2(e):(e6([s,...e5]),e2(0))}g("'".concat(e,"' 수거송장번호로 ").concat(n.length,"개 항목이 입고 처리되었습니다.")),tr(""),p(!1)},[ti,td]=(0,a.useState)(null),tu=e=>{ec(e),td(e),ea(!0),e$(e=>e+10)},tm=()=>{if(0===A.length)return;p(!0);let e=A.map(e=>e8[e]),t=e.map(e=>{let{completedAt:t,status:o,...r}=e;return{...r,status:"PENDING"}}),r=o.completedReturns.filter(t=>!e.some(e=>e.orderNumber===t.orderNumber&&e.productName===t.productName&&e.optionName===t.optionName&&e.returnTrackingNumber===t.returnTrackingNumber)),a=[...o.pendingReturns,...t];d({type:"SET_RETURNS",payload:{...o,pendingReturns:a,completedReturns:r}}),localStorage.setItem("pendingReturns",JSON.stringify(a)),localStorage.setItem("completedReturns",JSON.stringify(r)),localStorage.setItem("lastUpdated",new Date().toISOString()),g("".concat(A.length,"개의 항목이 입고전 목록으로 되돌아갔습니다.")),B([]),H(!1),p(!1)},tp=()=>{if(0===A.length){g("재매칭할 항목을 선택해주세요.");return}ec(A.map(e=>e8[e])[0]),ea(!0),A.length>1&&g("".concat(A.length,"개 항목이 선택되었습니다. 첫 번째 항목부터 재매칭을 진행합니다."))},th=()=>{if(0===A.length){g("날짜를 변경할 항목을 선택해주세요.");return}eh(new Date().toISOString().split("T")[0]),em(!0)},tg=e=>{if(0===A.length)return;p(!0);let t=A.map(e=>e8[e]),r=t.map(t=>({...t,completedAt:new Date(e)})),a=[...o.completedReturns.filter(e=>!t.some(t=>t.orderNumber===e.orderNumber&&t.productName===e.productName&&t.optionName===e.optionName&&t.returnTrackingNumber===e.returnTrackingNumber)),...r];d({type:"SET_RETURNS",payload:{...o,completedReturns:a}}),localStorage.setItem("completedReturns",JSON.stringify(a)),localStorage.setItem("lastUpdated",new Date().toISOString()),g("".concat(A.length,"개 항목의 날짜가 ").concat(new Date(e).toLocaleDateString("ko-KR"),"로 변경되었습니다.")),B([]),H(!1),em(!1),p(!1)};return(0,r.jsxs)("main",{className:"min-h-screen p-4 md:p-6",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold mb-6",children:"반품 관리 시스템"}),h&&(0,r.jsx)("div",{className:"mb-4 p-3 rounded ".concat(!1===tc?"bg-pink-100 text-red-800":!0===tc?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"),children:h}),(0,r.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 mb-6",children:[(0,r.jsx)("button",{className:"px-4 py-2 text-white rounded ".concat(et.testButton),onClick:()=>{try{p(!0),g("로컬 저장소 상태를 확인 중...");let e=localStorage.getItem("pendingReturns"),t=localStorage.getItem("completedReturns"),o=localStorage.getItem("products"),r=localStorage.getItem("lastUpdated"),a=e?JSON.parse(e).length:0,n=t?JSON.parse(t).length:0,c=o?JSON.parse(o).length:0,l=0;for(let e in localStorage)localStorage.hasOwnProperty(e)&&(l+=localStorage[e].length);let s=(l/1048576).toFixed(2),i="\n        로컬 저장소 상태:\n        • 입고전 반품: ".concat(a,"개\n        • 입고완료 반품: ").concat(n,"개  \n        • 상품 데이터: ").concat(c,"개\n        • 저장소 사용량: ").concat(s,"MB\n        • 마지막 업데이트: ").concat(r?new Date(r).toLocaleString():"없음","\n      ");g(i),console.log("로컬 저장소 상태:",{pendingReturns:a,completedReturns:n,products:c,totalSizeMB:s,lastUpdated:r})}catch(e){g("로컬 저장소 확인 실패: ".concat(e instanceof Error?e.message:"알 수 없는 오류")),console.error("로컬 저장소 확인 실패:",e)}finally{p(!1)}},disabled:m,children:"저장소 상태 확인"}),(0,r.jsx)("button",{className:"px-4 py-2 text-white rounded ".concat(et.firebaseButton),onClick:()=>{p(!0),g("데이터를 백업 중입니다...");try{let e={pendingReturns:o.pendingReturns,completedReturns:o.completedReturns,products:o.products,exportDate:new Date().toISOString(),version:"1.0"},t=JSON.stringify(e,null,2),r=new Blob([t],{type:"application/json"}),a=URL.createObjectURL(r),n=document.createElement("a");n.href=a,n.download="반품데이터_백업_".concat(new Date().toISOString().split("T")[0],".json"),n.click(),URL.revokeObjectURL(a),g("데이터 백업이 완료되었습니다. 다운로드 폴더를 확인하세요.")}catch(e){console.error("백업 오류:",e),g("데이터 백업 중 오류가 발생했습니다.")}finally{p(!1)}},disabled:m,children:"데이터 백업"}),(0,r.jsxs)("label",{className:"px-4 py-2 text-white rounded text-center cursor-pointer bg-purple-500 hover:bg-purple-600",htmlFor:"restoreFile",children:["데이터 복원",(0,r.jsx)("input",{type:"file",id:"restoreFile",accept:".json",onChange:e=>{var t;let o=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!o)return;p(!0),g("백업 데이터를 복원 중입니다...");let r=new FileReader;r.onload=t=>{try{var o;let e=JSON.parse(null===(o=t.target)||void 0===o?void 0:o.result);if(!e.version||!e.exportDate)throw Error("유효하지 않은 백업 파일입니다.");let r={pendingReturns:e.pendingReturns||[],completedReturns:e.completedReturns||[],products:e.products||[]};d({type:"SET_RETURNS",payload:r}),ej(r);let a=new Date(e.exportDate).toLocaleString();g("데이터 복원이 완료되었습니다. (백업 날짜: ".concat(a,")")),console.log("데이터 복원 완료:",{pendingReturns:r.pendingReturns.length,completedReturns:r.completedReturns.length,products:r.products.length,backupDate:a})}catch(e){console.error("복원 오류:",e),g("데이터 복원 중 오류가 발생했습니다: ".concat(e instanceof Error?e.message:"알 수 없는 오류"))}finally{p(!1),e.target.value=""}},r.onerror=()=>{g("파일을 읽는 중 오류가 발생했습니다."),p(!1),e.target.value=""},r.readAsText(o)},className:"hidden",disabled:m})]}),(0,r.jsxs)("label",{className:"px-4 py-2 text-white rounded text-center cursor-pointer ".concat(et.productButton),htmlFor:"productFile",children:["상품 업로드",(0,r.jsx)("input",{type:"file",id:"productFile",accept:".xlsx,.xls",onChange:e=>{if(!e.target.files||0===e.target.files.length)return;let t=e.target.files[0];p(!0),g("상품 데이터 파일을 처리 중입니다..."),s(t).then(e=>{if(0===e.length){g("파일에서 유효한 상품 데이터를 찾을 수 없습니다.");return}let t=[...o.products||[],...e];d({type:"SET_PRODUCTS",payload:t}),localStorage.setItem("products",JSON.stringify(t)),localStorage.setItem("lastUpdated",new Date().toISOString());let r=o.pendingReturns.filter(e=>!e.barcode);if(r.length>0){let t=0;r.forEach(o=>{let r=eY(o,e);r.barcode&&(t++,d({type:"UPDATE_RETURN",payload:r}))}),t>0?g("".concat(e.length,"개 상품이 추가되었습니다. ").concat(t,"개 반품 항목이 자동 매칭되었습니다.")):g("".concat(e.length,"개 상품이 추가되었습니다."))}else g("".concat(e.length,"개 상품이 추가되었습니다."))}).catch(e=>{console.error("상품 데이터 처리 오류:",e),g("상품 데이터 처리 중 오류가 발생했습니다: ".concat(e instanceof Error?e.message:String(e)))}).finally(()=>{p(!1),e.target.value=""})},ref:b,className:"hidden",disabled:m})]}),(0,r.jsx)("label",{className:"px-4 py-2 text-white rounded bg-purple-500 hover:bg-purple-600 cursor-pointer text-center",htmlFor:"smartStoreFile",children:"스마트스토어 업로드"}),(0,r.jsx)("input",{type:"file",id:"smartStoreFile",accept:".xlsx,.xls",onChange:tt,className:"hidden",disabled:m}),(0,r.jsxs)("label",{className:"px-4 py-2 text-white rounded text-center cursor-pointer ".concat(et.returnButton),htmlFor:"returnFile",children:["반품 업로드",(0,r.jsx)("input",{type:"file",id:"returnFile",accept:".xlsx,.xls",onChange:e=>{if(!e.target.files||0===e.target.files.length)return;let t=e.target.files[0];p(!0),g("반품 데이터 파일을 처리 중입니다..."),l(t).then(e=>{if(0===e.length){g("파일에서 유효한 반품 데이터를 찾을 수 없습니다.");return}let t=e.map(e=>({...e,returnReason:eF(e.returnReason)})),r={pendingReturns:o.pendingReturns,completedReturns:o.completedReturns,products:o.products},a=[...r.pendingReturns,...t];d({type:"SET_RETURNS",payload:{...r,pendingReturns:a}}),localStorage.setItem("pendingReturns",JSON.stringify(a)),localStorage.setItem("lastUpdated",new Date().toISOString()),g("".concat(t.length,"개 반품 항목이 성공적으로 추가되었습니다."))}).catch(e=>{console.error("반품 데이터 처리 오류:",e),g("반품 데이터 처리 중 오류가 발생했습니다: ".concat(e instanceof Error?e.message:String(e)))}).finally(()=>{p(!1),e.target.value=""})},ref:x,className:"hidden",disabled:m})]}),(0,r.jsx)("button",{className:"px-4 py-2 text-white rounded ".concat(et.productListButton),onClick:()=>{var e;$("smartstore"),null===(e=f.current)||void 0===e||e.showModal()},disabled:m,children:"상품 목록"}),(0,r.jsxs)("button",{className:"px-4 py-2 text-white rounded ".concat(et.pendingButton),onClick:()=>{es(!0),setTimeout(()=>{eb.autoTextSize.enabled&&(console.log("팝업 열림 - 오버플로우 감지 실행"),eP())},100)},disabled:m,children:["입고전 (",o.pendingReturns.length,")"]})]}),m&&(0,r.jsxs)("div",{className:"flex justify-center items-center my-4",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"}),(0,r.jsx)("span",{className:"ml-2",children:"처리 중..."})]}),(0,r.jsxs)("div",{className:"mb-6 p-4 border rounded-lg shadow-sm bg-white",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"수거송장번호로 입고"}),(0,r.jsxs)("div",{className:"flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2",children:[(0,r.jsx)("input",{type:"text",placeholder:"수거송장번호 입력 후 Enter 또는 입고 버튼 클릭",className:"flex-1 px-4 py-2 border border-gray-300 rounded",value:to,onChange:e=>tr(e.target.value),onKeyDown:e=>{if("Enter"===e.key){if(!to.trim()){g("수거송장번호를 입력해주세요.");return}ts()}}}),(0,r.jsx)("button",{className:"px-4 py-2 text-white rounded ".concat(et.trackingButton),onClick:ts,disabled:m||!to.trim(),children:"입고"})]})]}),(0,r.jsxs)("div",{className:"p-4 border rounded-lg shadow-sm bg-white",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"입고완료 반품 목록"}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{className:"px-3 py-1 text-white rounded ".concat(et.downloadButton),onClick:()=>{let e=[];if(eU&&eA.length>0?e=eA:e3&&e8.length>0?e=e8:o.completedReturns.length>0&&(e=o.completedReturns),0===e.length){g("다운로드할 입고 완료 데이터가 없습니다.");return}try{let t=e.filter(e=>e.barcode&&"-"!==e.barcode);if(0===t.length){g("바코드가 있는 항목이 없어서 CSV 파일을 생성할 수 없습니다.");return}let o=t.map(e=>({바코드번호:e.barcode||"",입고수량:e.quantity||1})),r=["바코드번호,입고수량",...o.map(e=>[e.바코드번호,e.입고수량].join(","))].join("\r\n"),a=new Blob(["\uFEFF"+r],{type:"text/csv"}),n=document.createElement("a"),c=URL.createObjectURL(a);n.setAttribute("href",c),n.setAttribute("download","입고잡기용_".concat(new Date().toISOString().split("T")[0],".csv")),n.setAttribute("type","text/csv"),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(c);let l="";eU?l="검색 결과 ":e3&&(l="".concat(new Date(e3).toLocaleDateString("ko-KR")," 날짜의 ")),g("".concat(l).concat(t.length,"개 항목이 입고잡기용 CSV 파일로 저장되었습니다. (바코드 미매칭 ").concat(e.length-t.length,"개 제외)"))}catch(e){console.error("CSV 생성 중 오류:",e),g("CSV 파일 생성 중 오류가 발생했습니다.")}},disabled:m||0===o.completedReturns.length,children:"목록 다운로드"}),(0,r.jsx)("button",{className:"px-3 py-1 text-white rounded bg-purple-500 hover:bg-purple-600",onClick:()=>{let e=[];if(eU&&eA.length>0?e=eA:e3&&e8.length>0?e=e8:o.completedReturns.length>0&&(e=o.completedReturns),0===e.length){g("다운로드할 입고 완료 데이터가 없습니다.");return}try{!function(e){let t=new Map;e.forEach(e=>{let o=e.pickupTrackingNumber||"no-tracking",r="".concat(e.customerName,"_").concat(e.orderNumber,"_").concat(o);t.has(r)||t.set(r,[]),t.get(r).push(e)});let o=[];t.forEach((e,t)=>{if(0===e.length)return;let r=e[0],a=r.customerName,n=r.returnReason,c=r.completedAt?new Date(r.completedAt).toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\./g,"/"):"",l=new Map;e.forEach(e=>{let t=e.purchaseName||e.productName||"",o=e.optionName||"",r=o?"".concat(t,"-").concat(o):t;l.has(r)?l.get(r).quantity+=e.quantity:l.set(r,{quantity:e.quantity,purchaseName:t,optionName:o})});let s=e.reduce((e,t)=>e+t.quantity,0);Array.from(l.entries()).forEach((e,t)=>{let[r,l]=e;o.push([c,0===t?a:"",0===t?n:"",r,0===t?"".concat(s,"개"):""])})});let r=[["날짜","고객명","반품사유","사입상품명","총 수량"],...o],a=n.P6.book_new(),c=n.P6.aoa_to_sheet(r);c["!cols"]=[{wch:12},{wch:10},{wch:15},{wch:30},{wch:10}];let l=[];for(let e=0;e<r.length;e++)l.push({hpt:20});c["!rows"]=l;let s=[],i=1;t.forEach((e,t)=>{if(0===e.length)return;let o=new Map;e.forEach(e=>{let t=e.purchaseName||e.productName||"",r=e.optionName||"",a=r?"".concat(t,"-").concat(r):t;o.has(a)?o.get(a).quantity+=e.quantity:o.set(a,{quantity:e.quantity,purchaseName:t,optionName:r})});let r=Array.from(o.entries()).length;r>1&&(s.push({s:{r:i,c:1},e:{r:i+r-1,c:1}}),s.push({s:{r:i,c:2},e:{r:i+r-1,c:2}}),s.push({s:{r:i,c:4},e:{r:i+r-1,c:4}})),i+=r}),c["!merges"]=s;for(let e=0;e<r.length;e++)for(let t=0;t<r[e].length;t++){let o=n.P6.encode_cell({r:e,c:t});c[o]&&(c[o].s={font:{name:"맑은 고딕",sz:10,bold:!1},alignment:{horizontal:"center",vertical:"center",wrapText:!0},border:{top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}},fill:{fgColor:{rgb:"FFFFFF"}}})}for(let e=0;e<r[0].length;e++){let t=n.P6.encode_cell({r:0,c:e});c[t]&&(c[t].s={font:{name:"맑은 고딕",sz:10,bold:!0},alignment:{horizontal:"center",vertical:"center",wrapText:!0},border:{top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}},fill:{fgColor:{rgb:"F0F0F0"}}})}n.P6.book_append_sheet(a,c,"입고완료 반품목록");let d="입고완료_반품목록_".concat(new Date().toISOString().split("T")[0],".xlsx");n.NC(a,d)}(e);let t="";eU?t="검색 결과 ":e3&&(t="".concat(new Date(e3).toLocaleDateString("ko-KR")," 날짜의 ")),g("".concat(t).concat(e.length,"개 항목이 엑셀 파일로 저장되었습니다."))}catch(e){console.error("엑셀 생성 중 오류:",e),g("엑셀 파일 생성 중 오류가 발생했습니다.")}},disabled:m||0===o.completedReturns.length,children:"셀 복사용 다운로드"})]})]}),(0,r.jsxs)("div",{className:"flex flex-col md:flex-row mb-4 space-y-2 md:space-y-0 md:space-x-2",children:[(0,r.jsx)("input",{type:"text",placeholder:"고객명 또는 주문번호로 검색",className:"flex-1 px-4 py-2 border border-gray-300 rounded",value:e_,onChange:e=>eM(e.target.value),onKeyPress:e=>"Enter"===e.key&&eq()}),(0,r.jsx)("button",{className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded",onClick:eq,children:"검색"}),eU&&(0,r.jsx)("button",{className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded",onClick:()=>{eM(""),eB([]),eH(!1)},children:"검색 취소"})]}),!eU&&e5.length>0&&(0,r.jsxs)("div",{className:"flex items-center justify-center mb-4 p-2 bg-gray-100 rounded-md",children:[(0,r.jsx)("button",{className:"px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded-l-md",onClick:()=>e9("prev"),children:"<"}),(0,r.jsx)("div",{className:"mx-3 font-medium",children:e3&&new Date(e3).toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"})}),(0,r.jsx)("button",{className:"px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded-r-md",onClick:()=>e9("next"),children:">"})]}),o.completedReturns.length>0?(0,r.jsxs)("div",{className:"space-y-6",children:[eU&&eW.length>0&&eW.map(e=>{let{date:t,items:o}=e;return(0,r.jsxs)("div",{id:"date-group-".concat(t),className:"border border-gray-200 rounded-md overflow-hidden",children:[(0,r.jsxs)("div",{className:"bg-gray-100 px-4 py-2 font-medium flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[new Date(t).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric",weekday:"long"}),(0,r.jsxs)("span",{className:"ml-2 text-gray-600 text-sm",children:["(",o.length,"개)"]})]}),A.length>0&&(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsxs)("button",{className:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded",onClick:tm,children:["되돌리기 (",A.length,")"]}),(0,r.jsxs)("button",{className:"px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded",onClick:tp,children:["재매칭 (",A.length,")"]}),(0,r.jsxs)("button",{className:"px-3 py-1 bg-green-500 hover:bg-green-600 text-white rounded",onClick:th,children:["날짜변경 (",A.length,")"]})]})]}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsx)(eZ,{items:o})})]},t)}),!eU&&e3&&(0,r.jsxs)("div",{className:"border border-gray-200 rounded-md overflow-hidden",children:[(0,r.jsxs)("div",{className:"bg-gray-100 px-4 py-2 font-medium flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[new Date(e3).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric",weekday:"long"}),(0,r.jsxs)("span",{className:"ml-2 text-gray-600 text-sm",children:["(",e8.length,"개)"]})]}),A.length>0&&(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsxs)("button",{className:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded",onClick:tm,children:["되돌리기 (",A.length,")"]}),(0,r.jsxs)("button",{className:"px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded",onClick:tp,children:["재매칭 (",A.length,")"]}),(0,r.jsxs)("button",{className:"px-3 py-1 bg-green-500 hover:bg-green-600 text-white rounded",onClick:th,children:["날짜변경 (",A.length,")"]})]})]}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsx)(eZ,{items:e8})})]})]}):(0,r.jsx)("p",{children:"입고완료된 반품이 없습니다."})]}),W&&Q&&(0,r.jsx)(N,{isOpen:W,onClose:()=>{tr(""),tn(null),g("수거송장번호 입력이 취소되었습니다.")},returnItem:Q,onSave:eI,zIndex:1e3+eG}),(0,r.jsx)(w,{isOpen:el,onClose:()=>{es(!1),F([])},items:o.pendingReturns,selectedItems:L,onRefresh:()=>{p(!0),g("데이터를 새로고침 중입니다...");let e=[...o.completedReturns.map(e=>({...e,priority:1})),...o.pendingReturns.map(e=>({...e,priority:2}))];if(e.length>0){let t=new Map,r=0;e.sort((e,t)=>e.priority-t.priority),e.forEach(e=>{let o="".concat(e.customerName,"_").concat(e.orderNumber,"_").concat(e.purchaseName||e.productName,"_").concat(e.optionName),a=t.get(o);if(a){let n=e.pickupTrackingNumber&&""!==e.pickupTrackingNumber,c=a.pickupTrackingNumber&&""!==a.pickupTrackingNumber;n&&!c?(t.set(o,e),console.log("수거송장번호 업데이트: ".concat(o," - 수거송장번호 추가"))):e.priority<a.priority?(t.set(o,e),console.log("중복 항목 교체 (우선순위): ".concat(o," - 입고완료 항목으로 교체"))):console.log("중복 항목 제외 (낮은 우선순위): ".concat(o)),r++}else t.set(o,e)});let a=Array.from(t.values()),n=a.filter(e=>1===e.priority),c=a.filter(e=>2===e.priority),l=n.map(e=>{let{priority:t,...o}=e;return o}),s=c.map(e=>{let{priority:t,...o}=e;return o}),i=o.completedReturns.length-l.length,u=o.pendingReturns.length-s.length;r>0&&(console.log("전체 중복 제거: 총 ".concat(r,"개 항목 제거됨 (입고완료: ").concat(i,"개, 입고전: ").concat(u,"개)")),d({type:"SET_RETURNS",payload:{...o,completedReturns:l,pendingReturns:s}}))}if(o.pendingReturns.length>0&&o.products.length>0){let e=o.pendingReturns.map(e=>eY(e,o.products)),t=e.filter(e=>e.barcode).length-o.pendingReturns.filter(e=>e.barcode).length;t>0?(d({type:"SET_RETURNS",payload:{...o,pendingReturns:e}}),g("새로고침 완료: ".concat(t,"개 상품이 자동 매칭되었습니다."))):g("새로고침 완료. 매칭할 상품이 없습니다.")}else g("새로고침 완료.");setTimeout(()=>{p(!1)},500)},onProcessSelected:()=>{if(0===L.length)return;let e=L.map(e=>o.pendingReturns[e]);o.products.length>0&&(e=e.map(e=>e.barcode&&"-"!==e.barcode?e:eY(e,o.products))),d({type:"SET_RETURNS",payload:{pendingReturns:o.pendingReturns.filter(t=>!e.some(e=>e.id===t.id)),completedReturns:[...o.completedReturns,...e],products:o.products}}),F([]),I(!1),g("".concat(e.length,"개 항목을 입고 처리했습니다."))},onDeleteSelected:()=>{if(0===L.length){g("삭제할 항목을 선택해주세요.");return}p(!0),g("".concat(L.length,"개 항목을 삭제 중입니다...")),setTimeout(()=>{let e=o.pendingReturns.filter((e,t)=>!L.includes(t));d({type:"SET_RETURNS",payload:{...o,pendingReturns:e}}),F([]),p(!1),g("".concat(L.length,"개 항목이 삭제되었습니다."))},1e3)},onRematchSelected:()=>{if(0===L.length){g("재매칭할 항목을 선택해주세요.");return}ed(!0)},onItemSelect:(e,t)=>{let r=o.pendingReturns.findIndex(t=>t.id===e.id);t?F(e=>[...e,r]):F(e=>e.filter(e=>e!==r))},PendingItemsTable:e=>{let{items:t}=e,a=eX(t);return(0,r.jsxs)("table",{className:"pending-returns-table min-w-full divide-y divide-gray-200 ".concat(eb.autoTextSize.enabled?"auto-text-size-enabled":""),children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"col-actions px-1 py-1 text-center text-2xs font-medium text-gray-500 uppercase tracking-wider",children:(0,r.jsx)("input",{type:"checkbox",checked:O,onChange:eR,className:"w-4 h-4"})}),(0,r.jsx)("th",{className:"col-customer-name px-1 py-1 text-left text-2xs font-medium text-gray-500 uppercase tracking-wider",children:"고객명"}),(0,r.jsx)("th",{className:"col-order-number px-1 py-1 text-left text-2xs font-medium text-gray-500 uppercase tracking-wider",children:"주문번호"}),(0,r.jsx)("th",{className:"col-product-name px-1 py-1 text-left text-2xs font-medium text-gray-500 uppercase tracking-wider",children:"사입상품명"}),(0,r.jsx)("th",{className:"col-option-name px-1 py-1 text-left text-2xs font-medium text-gray-500 uppercase tracking-wider",children:"옵션"}),(0,r.jsx)("th",{className:"col-quantity px-1 py-1 text-left text-2xs font-medium text-gray-500 uppercase tracking-wider",children:"수량"}),(0,r.jsx)("th",{className:"col-return-reason px-1 py-1 text-left text-2xs font-medium text-gray-500 uppercase tracking-wider",children:"반품사유"}),(0,r.jsx)("th",{className:"col-tracking-number px-1 py-1 text-left text-2xs font-medium text-gray-500 uppercase tracking-wider",children:"수거송장번호"}),(0,r.jsx)("th",{className:"col-barcode px-1 py-1 text-left text-2xs font-medium text-gray-500 uppercase tracking-wider",children:"바코드번호"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:a.map((e,a)=>{let n=e.items[0],l=t.findIndex(e=>e.id===n.id),s=L.includes(l);return(0,r.jsxs)("tr",{className:"hover:bg-blue-50 ".concat(eT(n,l,t)),children:[(0,r.jsx)("td",{className:"col-actions px-1 py-1",children:(0,r.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,r.jsx)("input",{type:"checkbox",checked:s,onChange:e=>{e.target.checked?F(e=>[...e,l]):F(e=>e.filter(e=>e!==l))},className:"w-4 h-4"})})}),(0,r.jsx)("td",{className:"col-customer-name px-1 py-1 whitespace-nowrap overflow-hidden text-ellipsis max-w-[100px]",children:n.customerName}),(0,r.jsx)("td",{className:"col-order-number px-1 py-1 whitespace-nowrap overflow-hidden text-ellipsis",children:n.orderNumber}),(0,r.jsx)("td",{className:"col-product-name px-1 py-1",children:(0,r.jsx)("div",{className:n.barcode?"whitespace-nowrap overflow-hidden text-ellipsis":"whitespace-normal break-words line-clamp-2",children:eV(n)})}),(0,r.jsx)("td",{className:"col-option-name px-1 py-1 whitespace-nowrap overflow-hidden text-ellipsis",children:c(n.optionName)}),(0,r.jsx)("td",{className:"col-quantity px-1 py-1 whitespace-nowrap text-center",children:n.quantity}),(0,r.jsx)("td",{className:"col-return-reason px-1 py-1",children:(0,r.jsx)("div",{className:"cursor-pointer ".concat(eE(n.returnReason)?"text-red-500":""," whitespace-nowrap overflow-hidden text-ellipsis max-w-[120px]"),onClick:()=>eE(n.returnReason)&&ek(n),children:eF(n.returnReason)})}),(0,r.jsx)("td",{className:"col-tracking-number px-1 py-1",children:(0,r.jsx)("div",{className:"font-mono text-sm whitespace-nowrap bg-blue-100 px-1 py-0.5 rounded text-center",children:"no-tracking"===e.trackingNumber?"-":e.trackingNumber})}),(0,r.jsx)("td",{className:"col-barcode px-1 py-1",children:eb.barcodeFormat.enabled&&n.barcode&&"-"!==n.barcode?(0,r.jsxs)("div",{className:"barcode-field ".concat(eb.barcodeFormat.enabled?"enabled":""),style:{lineHeight:"".concat(eb.barcodeFormat.lineHeight),fontSize:"".concat(eb.barcodeFormat.mainCodeSize,"rem")},children:[(0,r.jsx)("div",{className:"main-code",style:{fontSize:"".concat(eb.barcodeFormat.mainCodeSize,"rem"),lineHeight:"1.2"},children:n.barcode}),(()=>{let e=o.products.find(e=>e.barcode===n.barcode);return e?(0,r.jsxs)("div",{className:"sub-info",style:{fontSize:"".concat(eb.barcodeFormat.subInfoSize,"rem"),lineHeight:"1.2"},children:["(",e.purchaseName," ",e.optionName,")"]}):null})()]}):(0,r.jsxs)("div",{className:"text-2xs",children:[(0,r.jsx)("div",{className:"font-mono font-semibold",children:n.barcode||"-"}),n.barcode&&"-"!==n.barcode&&(()=>{let e=o.products.find(e=>e.barcode===n.barcode);return e?(0,r.jsxs)("div",{className:"main-barcode-info",title:"".concat(e.purchaseName," ").concat(e.optionName),children:["(",e.purchaseName," ",e.optionName,")"]}):null})()]})})]},n.id)})})]})}}),(0,r.jsx)("dialog",{ref:f,className:"modal w-11/12 max-w-5xl p-0 rounded-lg shadow-xl",onClick:e=>{let t=e.currentTarget.getBoundingClientRect();if(e.clientX<t.left||e.clientX>t.right||e.clientY<t.top||e.clientY>t.bottom){e.currentTarget.close();let t=e.currentTarget.id;t&&(e0(e=>e.filter(e=>e!==t)),e$(e=>Math.max(0,e-10)))}},id:"productModal",children:(0,r.jsxs)("div",{className:"modal-box bg-white p-6",children:[(0,r.jsxs)("h3",{className:"font-bold text-lg mb-4 flex justify-between items-center",children:[(0,r.jsx)("span",{children:"상품 목록"}),(0,r.jsx)("button",{onClick:()=>{var e;return null===(e=f.current)||void 0===e?void 0:e.close()},className:"btn btn-sm btn-circle",children:"✕"})]}),(0,r.jsxs)("div",{className:"flex mb-4 border-b border-gray-200",children:[(0,r.jsxs)("button",{className:"px-4 py-2 font-medium text-sm border-b-2 transition-colors ".concat("smartstore"===G?"border-purple-500 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700"),onClick:()=>$("smartstore"),children:["스마트스토어 (",V.length,")"]}),(0,r.jsxs)("button",{className:"px-4 py-2 font-medium text-sm border-b-2 transition-colors ".concat("cellmate"===G?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),onClick:()=>$("cellmate"),children:["셀메이트 (",(null===(e=o.products)||void 0===e?void 0:e.length)||0,")"]})]}),"smartstore"===G?(0,r.jsx)("div",{children:V.length>0?(0,r.jsx)("div",{className:"overflow-x-auto max-h-[70vh]",children:(0,r.jsxs)("table",{className:"min-w-full border-collapse border border-gray-300",children:[(0,r.jsx)("thead",{className:"sticky top-0 bg-white",children:(0,r.jsxs)("tr",{className:"bg-gray-100",children:[(0,r.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"번호"}),(0,r.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"상품코드"}),(0,r.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"상품명"}),(0,r.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"옵션명"}),(0,r.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"바코드"}),(0,r.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"카테고리"}),(0,r.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"가격"}),(0,r.jsx)("th",{className:"px-2 py-2 border-x border-gray-300",children:"재고"})]})}),(0,r.jsx)("tbody",{children:V.map((e,t)=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 text-center",children:t+1}),(0,r.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 font-mono text-sm",children:e.productCode}),(0,r.jsx)("td",{className:"px-2 py-2 border-x border-gray-300",children:e.productName}),(0,r.jsx)("td",{className:"px-2 py-2 border-x border-gray-300",children:e.optionName}),(0,r.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 font-mono text-sm",children:e.barcode||"-"}),(0,r.jsx)("td",{className:"px-2 py-2 border-x border-gray-300",children:e.category||"-"}),(0,r.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 text-right",children:e.price?e.price.toLocaleString()+"원":"-"}),(0,r.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 text-right",children:e.stock||"-"})]},e.id))})]})}):(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,r.jsx)("p",{children:"스마트스토어 상품 데이터가 없습니다."}),(0,r.jsx)("p",{className:"text-sm mt-2",children:"스마트스토어 업로드 버튼을 통해 상품 데이터를 업로드하세요."})]})}):(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"mb-4 flex justify-end gap-2",children:[(0,r.jsxs)("button",{className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded flex items-center gap-1",onClick:()=>{p(!0),g("상품 데이터 중복 제거 중입니다...");try{let e=o.products||[];console.log("상품 중복 제거 시작: ".concat(e.length,"개"));let t=new Set,r=e.filter(e=>{let o="".concat(e.productName||"","_").concat(e.optionName||"","_").concat(e.barcode||"");return!t.has(o)&&(t.add(o),!0)}),a=e.length-r.length;a>0?(d({type:"SET_RETURNS",payload:{...o,products:r}}),localStorage.setItem("products",JSON.stringify(r)),g("상품 중복 제거 완료: ".concat(a,"개 중복 항목이 제거되었습니다.")),console.log("상품 중복 제거 완료: ".concat(e.length," → ").concat(r.length," (").concat(a,"개 제거)"))):(g("중복된 상품이 없습니다."),console.log("중복된 상품이 없음"))}catch(e){console.error("상품 중복 제거 오류:",e),g("상품 중복 제거 중 오류가 발생했습니다.")}finally{p(!1)}},disabled:!o.products||0===o.products.length,children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})}),"새로고침 (중복제거)"]}),(0,r.jsxs)("button",{className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded",onClick:eO,children:["전체 삭제 (",(null===(t=o.products)||void 0===t?void 0:t.length)||0,"개)"]})]}),o.products&&o.products.length>0?(0,r.jsx)("div",{className:"overflow-x-auto max-h-[70vh]",children:(0,r.jsxs)("table",{className:"min-w-full border-collapse border border-gray-300 main-table ".concat(eb.autoTextSize.enabled?"auto-text-size-enabled":""),children:[(0,r.jsx)("thead",{className:"sticky top-0 bg-white",children:(0,r.jsxs)("tr",{className:"bg-gray-100",children:[(0,r.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 col-actions",children:"번호"}),(0,r.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 col-product-name",children:"사입상품명"}),(0,r.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 col-product-name",children:"상품명"}),(0,r.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 col-option-name",children:"옵션명"}),(0,r.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 col-barcode",children:"바코드번호"}),(0,r.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 col-order-number",children:"자체상품코드"}),(0,r.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 col-order-number",children:"상품코드"})]})}),(0,r.jsx)("tbody",{children:o.products.map((e,t)=>(0,r.jsxs)("tr",{className:"border-t border-gray-300 hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 col-actions",children:t+1}),(0,r.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 col-product-name",children:e.purchaseName||"-"}),(0,r.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 col-product-name",children:e.productName}),(0,r.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 col-option-name",children:e.optionName||"-"}),(0,r.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 font-mono col-barcode",children:eb.barcodeFormat.enabled&&e.barcode&&e.barcode.includes("(")?(0,r.jsxs)("div",{className:"barcode-field ".concat(eb.barcodeFormat.enabled?"enabled":""),children:[(0,r.jsx)("div",{className:"main-code",children:e.barcode.split("(")[0].trim()}),(0,r.jsxs)("div",{className:"sub-info",children:["(",e.barcode.split("(")[1]]})]}):e.barcode}),(0,r.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 col-order-number",children:e.zigzagProductCode||"-"}),(0,r.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 col-order-number font-mono",children:e.customProductCode||"-"})]},e.id))})]})}):(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,r.jsx)("p",{children:"셀메이트 상품 데이터가 없습니다."}),(0,r.jsx)("p",{className:"text-sm mt-2",children:"상품 업로드 버튼을 통해 상품 데이터를 업로드하세요."})]})]}),(0,r.jsx)("div",{className:"modal-action mt-6",children:(0,r.jsx)("button",{className:"btn",onClick:()=>{var e;return null===(e=f.current)||void 0===e?void 0:e.close()},children:"닫기"})})]})}),er&&en&&(0,r.jsx)(y,{isOpen:er,onClose:()=>{ea(!1),ec(null),e$(e=>Math.max(0,e-10))},returnItem:en,products:o.products||[],onMatch:(e,t)=>{p(!0);let r={...e,barcode:t.barcode,purchaseName:t.purchaseName||t.productName,zigzagProductCode:t.zigzagProductCode||"",customProductCode:t.customProductCode||"",matchType:"manual",matchSimilarity:1,matchedProductName:t.productName};if(console.log("매칭 완료:",{원래상품명:e.productName,매칭된사입상품명:r.purchaseName,바코드:r.barcode}),o.pendingReturns.some(t=>t.id===e.id)){let t=o.pendingReturns.map(t=>t.id===e.id?r:t);d({type:"SET_RETURNS",payload:{...o,pendingReturns:t}}),localStorage.setItem("pendingReturns",JSON.stringify(t))}else{let t=o.completedReturns.map(t=>t.id===e.id?r:t);d({type:"SET_RETURNS",payload:{...o,completedReturns:t}}),localStorage.setItem("completedReturns",JSON.stringify(t))}localStorage.setItem("lastUpdated",new Date().toISOString()),ea(!1),p(!1),o.pendingReturns.some(t=>t.id===e.id)||(B([]),H(!1)),g('"'.concat(e.productName,'" 상품이 "').concat(t.purchaseName||t.productName,'"(으)로 매칭되었습니다.'))},zIndex:1e3+eG}),v&&z&&(0,r.jsx)(u,{isOpen:v,onClose:()=>{S(!1),e$(e=>Math.max(0,e-10))},returnItem:z,detailReason:T||"",onSave:eD,setDetailReason:E,zIndex:1e3+eG}),(0,r.jsx)(j,{isOpen:ei,onClose:()=>{ed(!1),F([])},selectedItems:L.map(e=>o.pendingReturns[e]).filter(Boolean),products:o.products||[],onRematch:(e,t)=>{let r=o.pendingReturns.find(t=>t.id===e);if(!r)return;let a=o.products.find(e=>e.barcode===t);if(!a)return;let n={...r,barcode:t,purchaseName:a.purchaseName||a.productName,zigzagProductCode:a.zigzagProductCode||"",matchType:"수동재매칭",matchSimilarity:1,matchedProductName:a.productName,matchedProductOption:a.optionName},c=o.pendingReturns.map(t=>t.id===e?n:t);d({type:"SET_RETURNS",payload:{...o,pendingReturns:c}}),localStorage.setItem("pendingReturns",JSON.stringify(c)),localStorage.setItem("lastUpdated",new Date().toISOString()),g('"'.concat(r.purchaseName,'" 항목이 "').concat(a.productName,'" (').concat(t,")로 재매칭되었습니다."))}}),eu&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",style:{zIndex:1e3+eG},onClick:()=>em(!1),children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-11/12 max-w-md p-6",onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("h3",{className:"font-bold text-lg mb-4 flex justify-between items-center",children:[(0,r.jsx)("span",{children:"날짜 변경"}),(0,r.jsx)("button",{onClick:()=>em(!1),className:"text-gray-500 hover:text-gray-700 text-xl font-bold",children:"✕"})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("p",{className:"text-gray-600 mb-4",children:["선택된 ",A.length,"개 항목의 날짜를 변경할 수 있습니다."]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"새로운 날짜 선택"}),(0,r.jsx)("input",{type:"date",value:ep,onChange:e=>eh(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,r.jsx)("button",{className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded",onClick:()=>em(!1),children:"취소"}),(0,r.jsx)("button",{className:"px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded",onClick:()=>ep&&tg(ep),disabled:!ep,children:"날짜 변경"})]})]})}),eg&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",style:{zIndex:1e3+eG},onClick:()=>ex(!1),children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-11/12 max-w-2xl p-6",onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("h3",{className:"font-bold text-lg mb-4 flex justify-between items-center",children:[(0,r.jsx)("span",{children:"표 및 텍스트 크기 조정"}),(0,r.jsx)("button",{onClick:()=>ex(!1),className:"text-gray-500 hover:text-gray-700 text-xl font-bold",children:"✕"})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-semibold text-md mb-3 text-indigo-600",children:"자동 텍스트 크기 조정"}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("input",{type:"checkbox",id:"autoTextSizeEnabled",checked:eb.autoTextSize.enabled,onChange:e=>eS("enabled",e.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"}),(0,r.jsx)("label",{htmlFor:"autoTextSizeEnabled",className:"text-sm font-medium text-gray-700",children:"자동 텍스트 크기 조정 활성화"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["최소 폰트 크기: ",eb.autoTextSize.minFontSize,"rem"]}),(0,r.jsx)("input",{type:"range",min:"0.3",max:"1.0",step:"0.1",value:eb.autoTextSize.minFontSize,onChange:e=>eS("minFontSize",Number(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["최대 폰트 크기: ",eb.autoTextSize.maxFontSize,"rem"]}),(0,r.jsx)("input",{type:"range",min:"1.0",max:"2.0",step:"0.1",value:eb.autoTextSize.maxFontSize,onChange:e=>eS("maxFontSize",Number(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("input",{type:"checkbox",id:"adjustForOverflow",checked:eb.autoTextSize.adjustForOverflow,onChange:e=>eS("adjustForOverflow",e.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"}),(0,r.jsx)("label",{htmlFor:"adjustForOverflow",className:"text-sm font-medium text-gray-700",children:"오버플로우 방지"})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-semibold text-md mb-3 text-teal-600",children:"바코드번호 필드 형식"}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("input",{type:"checkbox",id:"barcodeFormatEnabled",checked:eb.barcodeFormat.enabled,onChange:e=>ez("enabled",e.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"}),(0,r.jsx)("label",{htmlFor:"barcodeFormatEnabled",className:"text-sm font-medium text-gray-700",children:"바코드번호 특별 형식 활성화"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"메인 코드 크기 (rem)"}),(0,r.jsx)("input",{type:"number",min:"0.5",max:"2.0",step:"0.1",value:eb.barcodeFormat.mainCodeSize,onChange:e=>ez("mainCodeSize",Number(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"서브 정보 크기 (rem)"}),(0,r.jsx)("input",{type:"number",min:"0.3",max:"1.5",step:"0.1",value:eb.barcodeFormat.subInfoSize,onChange:e=>ez("subInfoSize",Number(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"줄 간격"}),(0,r.jsx)("input",{type:"number",min:"0.5",max:"2.0",step:"0.1",value:eb.barcodeFormat.lineHeight,onChange:e=>ez("lineHeight",Number(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]})]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2 mt-6",children:[(0,r.jsx)("button",{className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded",onClick:()=>ex(!1),children:"취소"}),(0,r.jsx)("button",{className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded",onClick:()=>{let e=document.documentElement;e.style.setProperty("--popup-width","".concat(eb.popupWidth,"vw")),e.style.setProperty("--popup-height","".concat(eb.popupHeight,"vh")),e.style.setProperty("--popup-table-font-size","".concat(eb.popupTableFontSize,"rem")),e.style.setProperty("--popup-barcode-font-size","".concat(eb.popupBarcodeFontSize,"rem")),e.style.setProperty("--popup-cell-padding","".concat(eb.popupCellPadding,"rem")),e.style.setProperty("--popup-line-height",eb.popupLineHeight.toString()),e.style.setProperty("--main-table-font-size","".concat(eb.mainTableFontSize,"rem")),e.style.setProperty("--main-barcode-font-size","".concat(eb.mainBarcodeFontSize,"rem")),e.style.setProperty("--main-cell-padding","".concat(eb.mainCellPadding,"rem")),e.style.setProperty("--main-line-height",eb.mainLineHeight.toString()),Object.entries(eb.columnAlignment).forEach(t=>{let[o,r]=t;e.style.setProperty("--column-".concat(o,"-alignment"),r)}),Object.entries(eb.columnWidths).forEach(t=>{let[o,r]=t;e.style.setProperty("--column-".concat(o,"-width"),"".concat(r,"px"))}),eb.columnWidths.mainBarcode&&e.style.setProperty("--column-main-barcode-width","".concat(eb.columnWidths.mainBarcode,"px")),Object.entries(eb.autoTextSize).forEach(t=>{let[o,r]=t;e.style.setProperty("--auto-text-size-".concat("enabled"===o?"enabled":"minFontSize"===o?"minFontSize":"maxFontSize"===o?"maxFontSize":"adjustForOverflow"===o?"adjustForOverflow":o),String(r))}),Object.entries(eb.barcodeFormat).forEach(t=>{let[o,r]=t;e.style.setProperty("--barcode-format-".concat("enabled"===o?"enabled":"mainCodeSize"===o?"mainCodeSize":"subInfoSize"===o?"subInfoSize":"lineHeight"===o?"lineHeight":o),String(r))}),localStorage.setItem("tableSettings",JSON.stringify(eb)),console.log("설정 적용 버튼 클릭 - 오버플로우 감지 실행"),eb.autoTextSize.enabled?(console.log("자동 텍스트 크기 조정이 활성화되어 있음 - 오버플로우 감지 실행"),setTimeout(()=>{console.log("설정 적용 후 오버플로우 감지 실행 중..."),eP()},100)):console.log("자동 텍스트 크기 조정이 비활성화되어 있음"),g("표 설정이 적용되었습니다. 설정을 저장했습니다."),ex(!1)},children:"설정 적용"})]})]})})]})}},2533:(e,t,o)=>{"use strict";o.d(t,{b:()=>d,u:()=>i});var r=o(7437),a=o(2265);function n(e){let t=e.toLowerCase();for(let e of["블랙","화이트","화이트","그레이","그레이","네이비","네이비","베이지","베이지","브라운","브라운","레드","레드","핑크","핑크","옐로우","옐로우","그린","그린","블루","블루","퍼플","퍼플","오렌지","오렌지","골드","골드","실버","실버","아이보리","아이보리","크림","크림","차콜","차콜","카키","카키","민트","민트","로즈","로즈","라벤더","라벤더","코랄","코랄","터콰이즈","터콰이즈","버건디","버건디","마린","마린","올리브","올리브","샌드","샌드","타우프","타우프","인디고","인디고"])if(t.includes(e.toLowerCase()))return e;return null}function c(e,t){let o=e.length>t.length?e:t,r=e.length>t.length?t:e;if(0===o.length)return 1;let a=function(e,t){let o=[];for(let e=0;e<=t.length;e++)o[e]=[e];for(let t=0;t<=e.length;t++)o[0][t]=t;for(let r=1;r<=t.length;r++)for(let a=1;a<=e.length;a++)t.charAt(r-1)===e.charAt(a-1)?o[r][a]=o[r-1][a-1]:o[r][a]=Math.min(o[r-1][a-1]+1,o[r][a-1]+1,o[r-1][a]+1);return o[t.length][e.length]}(o,r);return(o.length-a)/o.length}function l(e,t){switch(t.type){case"ADD_RETURN":return{...e,pendingReturns:[...e.pendingReturns,t.payload]};case"UPDATE_RETURN":return{...e,pendingReturns:e.pendingReturns.map(e=>e.id===t.payload.id?t.payload:e)};case"DELETE_RETURN":return{...e,pendingReturns:e.pendingReturns.filter(e=>e.id!==t.payload)};case"COMPLETE_RETURN":let o=e.pendingReturns.find(e=>e.id===t.payload);if(o)return{...e,pendingReturns:e.pendingReturns.filter(e=>e.id!==t.payload),completedReturns:[...e.completedReturns,o]};return e;case"ADD_PRODUCT":return{...e,products:[...e.products,t.payload]};case"UPDATE_PRODUCT":return{...e,products:e.products.map(e=>e.id===t.payload.id?t.payload:e)};case"DELETE_PRODUCT":return{...e,products:e.products.filter(e=>e.id!==t.payload)};case"SET_PRODUCTS":return{...e,products:t.payload};case"MATCH_PRODUCTS":let r=e.pendingReturns.map(t=>{if(t.barcode&&"-"!==t.barcode)return t;let o=e=>{if(0===e.length)return null;if(!t.optionName||""===t.optionName.trim())return e[0];let o=t.optionName.toLowerCase().trim(),r=e.map(e=>{if(!e.optionName)return{product:e,score:0,reason:"옵션명 없음"};let t=e.optionName.toLowerCase().trim(),r=0,a="";if(t===o)r=100,a="정확 일치";else if(t.includes(o)||o.includes(t))r=80,a="부분 일치";else{let e=n(o),l=n(t);if(e&&l&&e===l)r=60,a="색상 일치";else{let e=c(o,t);r=Math.round(50*e),a="유사도 ".concat(e.toFixed(2))}}return{product:e,score:r,reason:a}});r.sort((e,t)=>t.score-e.score);let a=r[0];return a.score>=30?a.product:null};if(t.zigzagProductCode&&"-"!==t.zigzagProductCode){let r=e.products.filter(e=>e.zigzagProductCode&&e.zigzagProductCode===t.zigzagProductCode);if(r.length>0){let e=o(r);if(e)return{...t,barcode:e.barcode||"",purchaseName:e.purchaseName||e.productName,matchSimilarity:1,matchType:"자체상품코드 정확 매칭"}}}let r=null,a=t.productName.toLowerCase().trim();for(let t of e.products){let e=c(a,t.productName.toLowerCase().trim());e>.7&&(!r||e>r.similarity)&&(r={product:t,similarity:e})}if(r){let e=o([r.product]);if(e)return{...t,barcode:e.barcode||"",purchaseName:e.purchaseName||e.productName,matchSimilarity:r.similarity,matchType:"상품명 유사도 매칭"}}return t});return{...e,pendingReturns:r};case"SET_RETURNS":return t.payload;case"CLEAR_ALL":return{pendingReturns:[],completedReturns:[],products:[]};default:return e}}let s=(0,a.createContext)(null);function i(e){let{children:t}=e,[o,n]=(0,a.useReducer)(l,{pendingReturns:[],completedReturns:[],products:[]});return(0,r.jsx)(s.Provider,{value:{state:o,dispatch:n},children:t})}function d(){let e=(0,a.useContext)(s);if(!e)throw Error("useReturnState must be used within a ReturnProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[425,130,215,744],()=>t(4856)),_N_E=e.O()}]);