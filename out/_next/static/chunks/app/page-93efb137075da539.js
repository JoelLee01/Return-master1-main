(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{67:()=>{},2061:()=>{},4856:(e,t,r)=>{Promise.resolve().then(r.bind(r,8804))},8804:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>R});var a=r(7437),o=r(2265),n=r(7800);function l(e){if(!e)return"";let t=e.trim(),r=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/사이즈\s*:\s*/g,"")).replace(/컬러\s*:\s*/g,"")).replace(/색상\s*:\s*/g,"")).replace(/사이즈\s*선택\s*:\s*/g,"")).replace(/컬러\s*선택\s*:\s*/g,"")).replace(/색상\s*선택\s*:\s*/g,"")).replace(/길이\s*선택\s*:\s*/g,"")).replace(/\([^)]*\)/g,"")).replace(/\b[Oo]ne\s*[Ss]ize\b/g,"")).replace(/\s+/g," ").trim()).replace(/\//g,",")).split(",").map(e=>e.trim());if(r.length>=2)return r.filter(e=>e).join(",");{let e=r[0];return/^[SMLX]+$/i.test(e)?e.toUpperCase():e}}async function c(e){return new Promise((t,r)=>{let a=new FileReader;a.onload=e=>{try{let r=new Uint8Array(e.target.result),a=n.ij(r,{type:"array"}),o=a.SheetNames[0],c=a.Sheets[o],s=n.P6.sheet_to_json(c,{header:1}),i=-1;for(let e=0;e<Math.min(10,s.length);e++)if(s[e].map(e=>String(e||"").toLowerCase()).some(e=>e.includes("주문번호")||e.includes("상품명")||e.includes("고객명"))){i=e;break}if(-1===i)throw Error("유효한 헤더를 찾을 수 없습니다. 엑셀 형식을 확인해주세요.");let d=s[i],u=e=>d.findIndex(t=>"string"==typeof t&&t.toLowerCase().includes(e.toLowerCase())),m=(e,t)=>{for(let r of t){let t=u(r);if(-1!==t&&e[t])return String(e[t])}return""},p=[];for(let e=i+1;e<s.length;e++){let t=s[e];if(!t||0===t.length)continue;let r=m(t,["주문번호","주문 번호","주문no","주문 no","order","오더 번호"]),a=m(t,["상품명","품명","item","제품명","상품 명"]);if(!r||!a)continue;let o=m(t,["옵션명","옵션","옵션정보","옵션 정보","선택 옵션","옵션 내역"]),n=l(o),c={id:function(e,t,r,a){let o=(e||"").toString().trim(),n=(t||"").toString().trim(),l=(r||"").toString().trim(),c=Date.now(),s=Math.floor(1e4*Math.random());return"".concat(o,"_").concat(n.substring(0,10),"_").concat(l.substring(0,5),"_").concat(a,"_").concat(c,"_").concat(s)}(r,a,n,parseInt(m(t,["수량","주문수량","입고수량","반품수량","quantity"]),10)||1),orderNumber:r,customerName:m(t,["고객명","주문자","구매자","customer","구매자명","고객 이름"]),productName:a,optionName:n,quantity:parseInt(m(t,["수량","주문수량","입고수량","반품수량","quantity"]),10)||1,returnReason:m(t,["반품사유","반품 사유","사유","메모","반품메모","반품 메모"]),returnTrackingNumber:m(t,["반품송장번호","반품운송장","반품 송장","반품송장","송장번호","송장"]),pickupTrackingNumber:m(t,["수거송장번호","수거운송장","수거 송장","수거송장","픽업송장번호","픽업 송장번호"]),status:"PENDING",barcode:"",zigzagProductCode:m(t,["자체상품코드","지그재그코드","상품코드"]),customProductCode:m(t,["자체상품코드","지그재그코드","상품코드"])};p.push(c)}console.log("".concat(p.length,"개의 반품 항목이 추출되었습니다.")),t(p)}catch(e){console.error("엑셀 파싱 오류:",e),r(Error("엑셀 파일을 처리하는 중 오류가 발생했습니다."))}},a.onerror=()=>{r(Error("엑셀 파일을 읽는 중 오류가 발생했습니다."))},a.readAsArrayBuffer(e)})}function s(e){return new Promise((t,r)=>{let a=new FileReader;a.onload=e=>{try{if(!e.target||!e.target.result)throw Error("파일 데이터를 읽을 수 없습니다.");let r=new Uint8Array(e.target.result),a=n.ij(r,{type:"array"});if(!a||!a.SheetNames||0===a.SheetNames.length)throw Error("엑셀 파일에 시트가 없습니다.");let o=a.Sheets[a.SheetNames[0]];if(!o)throw Error("엑셀 시트를 읽을 수 없습니다.");let c=n.P6.sheet_to_json(o,{header:1});if(!c||0===c.length)throw Error("엑셀 파일에 데이터가 없습니다.");console.log("엑셀 데이터 로드 완료:",{행수:c.length,첫번째행:c[0]});let s=function(e){for(let t=0;t<Math.min(10,e.length);t++){let r=e[t];if(r&&["상품명","바코드","옵션"].reduce((e,t)=>r.some(e=>"string"==typeof e&&e.includes&&e.includes(t))?e+1:e,0)>=2)return t}return -1}(c);if(-1===s)throw Error("상품 데이터 헤더 행을 찾을 수 없습니다.");let i=c[s].map(e=>String(e||"").trim()),d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=i.findIndex(t=>t===e);if(-1===r&&(r=i.findIndex(t=>t.includes(e))),-1===r&&t.length>0){for(let e of t)if(r=i.findIndex(t=>t===e),-1!==r||(r=i.findIndex(t=>t.includes(e)),-1!==r))break}return r},u=d("상품명",["제품명","품명"]),m=d("바코드번호",["바코드"]),p=d("옵션명",["옵션","옵션정보"]),h=d("사입상품명",["사입명","매입상품명"]),g=d("자체상품코드",["지그재그코드","상품코드"]);if(-1===u||-1===m)throw Error("필수 열(상품명, 바코드번호)을 찾을 수 없습니다.");console.log("컬럼 인덱스:",{상품명:u,바코드번호:m,옵션명:p,사입상품명:h,자체상품코드:g});let x=[],b=new Map;for(let e=s+1;e<c.length;e++){let t=c[e];if(!t||0===t.length)continue;let r="";if(void 0!==t[m]&&null!==t[m]&&(r=String(t[m]).trim()),!r){console.warn("행 ".concat(e+1,": 바코드 없음, 건너뜀"));continue}if(b.has(r)){console.log("중복 바코드 무시: ".concat(r));continue}let a="";if(void 0!==t[u]&&null!==t[u]&&(a=String(t[u]).trim()),!a){console.warn("행 ".concat(e+1,": 상품명 없음, 건너뜀"));continue}let o="";if(-1!==p&&void 0!==t[p]&&null!==t[p]){let e=String(t[p]);o=l(e)}let n="";-1!==h&&void 0!==t[h]&&null!==t[h]&&(n=String(t[h]).trim());let s="",i="";-1!==g&&void 0!==t[g]&&null!==t[g]&&(i=s=String(t[g]).trim());let d={id:function(e,t){let r=(e||"").toString().trim(),a=(t||"").toString().trim(),o=Date.now(),n=Math.floor(1e4*Math.random());return"".concat(r,"_").concat(a.substring(0,10),"_").concat(o,"_").concat(n)}(r,a),productName:a,barcode:r,optionName:o,purchaseName:n||"",zigzagProductCode:s,customProductCode:i};b.set(r,!0),x.push(d)}console.log("".concat(x.length,"개의 상품 데이터가 추출되었습니다.")),t(x)}catch(e){console.error("엑셀 파싱 오류:",e),r(Error("엑셀 파일을 처리하는 중 오류가 발생했습니다."))}},a.onerror=()=>{r(Error("엑셀 파일을 읽는 중 오류가 발생했습니다."))},a.readAsArrayBuffer(e)})}var i=r(2533);let d=e=>{let{isOpen:t,onClose:r,children:n,modalId:l}=e,c=(0,o.useRef)(l||"modal-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9))),s=(0,o.useRef)(null);return((0,o.useEffect)(()=>(t?("undefined"!=typeof document&&(document.body.style.overflow="hidden"),setTimeout(()=>{if(s.current){let e=s.current.querySelector("textarea"),t=s.current.querySelector("input"),r=s.current.querySelector('button, [tabindex]:not([tabindex="-1"]), input, select, textarea, a[href]');e?e.focus():t?t.focus():r&&r.focus()}},100)):"undefined"!=typeof document&&(document.body.style.overflow=""),()=>{"undefined"!=typeof document&&(document.body.style.overflow="")}),[t]),(0,o.useEffect)(()=>{let e=e=>{"Escape"===e.key&&r()};return t&&window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[t,r]),t)?(0,a.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",onClick:e=>{e.target===e.currentTarget&&r()},style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1e4},role:"dialog","aria-modal":"true","data-modal-id":c.current,children:(0,a.jsx)("div",{className:"relative",ref:s,tabIndex:-1,style:{maxWidth:"var(--popup-width)",maxHeight:"var(--popup-height)",overflow:"auto",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.2)"},children:n})}):null},u=e=>{let{isOpen:t,onClose:r,onSave:n,returnItem:l,detailReason:c,setDetailReason:s,zIndex:i}=e,[u,m]=(0,o.useState)(c);return((0,o.useEffect)(()=>{m(c)},[c]),t&&l)?(0,a.jsx)(d,{isOpen:t,onClose:r,children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-11/12 max-w-xl",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-red-600 to-red-700 p-4 text-white",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"반품 사유 상세"}),(0,a.jsx)("button",{onClick:r,className:"text-white hover:text-gray-200",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),s(u),n(u)},className:"p-6",children:[(0,a.jsxs)("div",{className:"mb-6 grid grid-cols-1 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"주문 정보"}),(0,a.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-200",children:[(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"고객명:"})," ",l.customerName]}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"주문번호:"})," ",l.orderNumber]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"상품 정보"}),(0,a.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-200",children:[(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"상품명:"})," ",l.productName]}),l.optionName&&(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"옵션:"})," ",l.optionName]}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"수량:"})," ",l.quantity]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"반품 사유"}),(0,a.jsx)("div",{className:"bg-pink-50 p-3 rounded-lg border border-pink-200 text-red-800",children:l.returnReason})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{htmlFor:"detailReason",className:"block text-sm font-medium text-gray-700",children:"상세 사유"}),(0,a.jsx)("textarea",{id:"detailReason",className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:4,value:u,onChange:e=>m(e.target.value),placeholder:"반품 상세 사유를 입력하세요"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"취소"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"저장"})]})]})]})}):null};var m=r(4887);class p{static getInstance(){return p.instance||(p.instance=new p),p.instance}createModalContainer(){if(!this.isClient||"undefined"==typeof document)return;let e=document.getElementById("global-modal-container");e&&e.remove(),this.modalContainer=document.createElement("div"),this.modalContainer.id="global-modal-container",this.modalContainer.style.position="fixed",this.modalContainer.style.top="0",this.modalContainer.style.left="0",this.modalContainer.style.width="100%",this.modalContainer.style.height="100%",this.modalContainer.style.pointerEvents="none",this.modalContainer.style.zIndex="10000",document.body.appendChild(this.modalContainer)}addModal(e,t){this.isClient&&"undefined"!=typeof document&&(this.modalContainer||this.createModalContainer(),this.removeModal(e),this.activeModals.add(e),this.modalElements.set(e,t),this.modalContainer&&(this.modalContainer.appendChild(t),t.style.pointerEvents="auto",console.log("모달 추가: ".concat(e,", 총 모달 수: ").concat(this.activeModals.size))))}removeModal(e){if(!this.isClient)return;let t=this.modalElements.get(e);t&&t.parentNode&&t.parentNode.removeChild(t),this.activeModals.delete(e),this.modalElements.delete(e),console.log("모달 제거: ".concat(e,", 남은 모달 수: ").concat(this.activeModals.size))}bringToFront(e){if(!this.isClient)return;let t=this.modalElements.get(e);t&&this.modalContainer&&(this.modalContainer.appendChild(t),console.log("모달 최상위로 이동: ".concat(e)))}getActiveModals(){return Array.from(this.activeModals)}clearAll(){this.isClient&&(this.activeModals.clear(),this.modalElements.clear(),this.modalContainer&&(this.modalContainer.innerHTML=""))}constructor(){this.modalContainer=null,this.activeModals=new Set,this.modalElements=new Map,this.isClient=!1,this.isClient=!0,this.createModalContainer()}}let h=null,g=()=>(h||(h=p.getInstance()),h),x=(e,t)=>{g().addModal(e,t)},b=e=>{g().removeModal(e)},N=e=>{let{children:t,isOpen:r,onClose:n,zIndex:l}=e,c=(0,o.useRef)(null),s=(0,o.useRef)("modal-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)));if((0,o.useEffect)(()=>(r&&c.current&&(document.body.style.overflow="hidden",x(s.current,c.current),setTimeout(()=>{if(c.current){let e=c.current.querySelector('button, [tabindex]:not([tabindex="-1"]), input, select, textarea, a[href]');e?e.focus():c.current.focus()}},50)),()=>{"undefined"!=typeof document&&(document.body.style.overflow=""),r&&b(s.current)}),[r]),(0,o.useEffect)(()=>{let e=e=>{"Escape"===e.key&&n()};return r&&window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[r,n]),!r)return null;let i=(0,a.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",onClick:e=>{c.current&&!c.current.contains(e.target)&&n()},style:{position:"fixed",inset:0,zIndex:l||1e4},role:"dialog","aria-modal":"true",children:(0,a.jsx)("div",{className:"relative",ref:c,tabIndex:-1,style:{maxWidth:"95vw",maxHeight:"90vh",overflow:"auto",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.2)"},children:t})});return(0,m.createPortal)(i,document.body)},y=e=>{let{isOpen:t,onClose:r,returnItem:n,onSave:l,zIndex:c}=e,[s,i]=(0,o.useState)((null==n?void 0:n.returnTrackingNumber)||"");return t?(0,a.jsx)(N,{isOpen:t,onClose:r,zIndex:c,children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-96 max-w-full",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-800 p-4 text-white",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"반품송장번호 입력"}),(0,a.jsx)("button",{onClick:r,className:"text-white hover:text-gray-200",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}),(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-500 mb-2",children:"주문 정보"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 bg-gray-50 p-3 rounded border border-gray-200",children:[(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"고객명:"})," ",n.customerName]}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"주문번호:"})," ",n.orderNumber]}),(0,a.jsxs)("div",{className:"text-sm sm:col-span-2",children:[(0,a.jsx)("span",{className:"font-medium",children:"상품명:"})," ",n.productName]})]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"반품 송장번호"}),(0,a.jsx)("input",{type:"text",value:s,onChange:e=>i(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"송장번호를 입력하세요"})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"취소"}),(0,a.jsx)("button",{type:"button",onClick:()=>{l(s)},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"저장"})]})]})]})}):null},f=e=>{let{isOpen:t,onClose:r,returnItem:n,products:l,onMatch:c,zIndex:s}=e,[i,u]=(0,o.useState)(""),[m,p]=(0,o.useState)([]),[h,g]=(0,o.useState)(!1);(0,o.useEffect)(()=>{t&&(u(""),p([]),g(!1))},[t]);let x=()=>{if(!i.trim()){p([]),g(!1);return}let e=i.toLowerCase().trim();p(l.filter(t=>t.productName&&t.productName.toLowerCase().includes(e)||t.purchaseName&&t.purchaseName.toLowerCase().includes(e))),g(!0)};return t?(0,a.jsx)(d,{isOpen:t,onClose:r,children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-11/12 max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-cyan-600 p-4 text-white",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold",children:"상품 매칭"}),(0,a.jsx)("button",{onClick:r,className:"text-white hover:text-gray-200",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,a.jsxs)("div",{className:"p-4 border-b",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h4",{className:"text-lg font-medium mb-2",children:"선택된 반품 항목"}),(0,a.jsx)("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-200",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"상품명:"})," ",n.productName]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"주문번호:"})," ",n.orderNumber]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"고객명:"})," ",n.customerName]}),n.optionName&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"옵션:"})," ",n.optionName]})]})})]}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("input",{type:"text",className:"flex-1 px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:i,onChange:e=>{u(e.target.value)},placeholder:"상품명 또는 사입상품명으로 검색",onKeyPress:e=>{"Enter"===e.key&&x()}}),(0,a.jsx)("button",{className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",onClick:x,children:"검색"})]})})]}),(0,a.jsx)("div",{className:"flex-1 overflow-auto",children:h?m.length>0?(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50 sticky top-0",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-2/3",children:"사입상품명"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"옵션명"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"바코드"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"매칭"})]})}),(0,a.jsx)("tbody",{children:m.map((e,t)=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-500 break-words",children:e.purchaseName||"-"}),(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:e.optionName||"-"}),(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-mono",children:e.barcode||"-"}),(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-medium",children:(0,a.jsx)("button",{onClick:()=>c(n,e),className:"text-blue-600 hover:text-blue-900 bg-blue-100 hover:bg-blue-200 px-3 py-1 rounded-full transition-colors",children:"매칭"})})]},e.id||t))})]}):(0,a.jsx)("div",{className:"p-8 text-center text-gray-500",children:(0,a.jsx)("p",{children:"검색 결과가 없습니다."})}):(0,a.jsx)("div",{className:"p-8 text-center text-gray-500",children:(0,a.jsx)("p",{children:"상품명 또는 사입상품명으로 검색하세요."})})}),(0,a.jsx)("div",{className:"bg-gray-50 p-4 flex justify-end",children:(0,a.jsx)("button",{onClick:r,className:"px-4 py-2 border border-gray-300 bg-white rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none",children:"닫기"})})]})}):null},j=e=>{let{isOpen:t,onClose:r,items:o,selectedItems:n,onRefresh:l,onProcessSelected:c,onDeleteSelected:s,onRematchSelected:i,onItemSelect:u,PendingItemsTable:m}=e;return(0,a.jsx)(d,{isOpen:t,onClose:r,children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full overflow-hidden flex flex-col",style:{maxWidth:"var(--popup-width)",maxHeight:"var(--popup-height)"},children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-cyan-600 p-4 text-white",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold",children:"입고전 반품 목록"}),(0,a.jsx)("button",{onClick:r,className:"text-white hover:text-gray-200",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,a.jsx)("div",{className:"flex-1 overflow-auto p-6",children:o&&o.length>0?(0,a.jsx)("div",{className:"overflow-x-auto max-h-[70vh]",children:(0,a.jsx)(m,{items:o})}):(0,a.jsx)("p",{className:"text-center text-gray-500 py-8",children:"대기 중인 반품이 없습니다."})}),(0,a.jsxs)("div",{className:"bg-gray-50 p-4 flex flex-wrap gap-2 justify-end",children:[(0,a.jsx)("button",{className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-md transition-colors",onClick:l,children:"새로고침"}),n.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{className:"px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-md transition-colors",onClick:c,children:["선택항목 입고처리 (",n.length,"개)"]}),(0,a.jsxs)("button",{className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-md transition-colors",onClick:s,children:["선택항목 삭제 (",n.length,"개)"]})]}),n.length>0&&(0,a.jsxs)("button",{className:"px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-md transition-colors",onClick:i,children:["재매칭 (",n.length,"개)"]}),(0,a.jsx)("button",{className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-md transition-colors",onClick:r,children:"닫기"})]})]})})},v=e=>{let{isOpen:t,onClose:r,selectedItems:n,products:l,onRematch:c}=e,[s,i]=(0,o.useState)(0),[u,m]=(0,o.useState)(""),[p,h]=(0,o.useState)([]),g=n[s];(0,o.useEffect)(()=>{u.trim()?h(l.filter(e=>{var t,r,a,o;return(null===(t=e.productName)||void 0===t?void 0:t.toLowerCase().includes(u.toLowerCase()))||(null===(r=e.purchaseName)||void 0===r?void 0:r.toLowerCase().includes(u.toLowerCase()))||(null===(a=e.optionName)||void 0===a?void 0:a.toLowerCase().includes(u.toLowerCase()))||(null===(o=e.barcode)||void 0===o?void 0:o.toLowerCase().includes(u.toLowerCase()))}).slice(0,20)):h(l.slice(0,20))},[u,l]);let x=e=>{g&&(c(g.id,e.barcode),s<n.length-1?(i(s+1),m("")):(i(0),m(""),r()))},b=()=>{i(0),m(""),r()};return g?(0,a.jsx)(d,{isOpen:t,onClose:r,children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 p-4 text-white",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("h3",{className:"text-xl font-semibold",children:["수동 재매칭 (",s+1,"/",n.length,")"]}),(0,a.jsx)("button",{onClick:b,className:"text-white hover:text-gray-200",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,a.jsxs)("div",{className:"flex-1 overflow-auto p-6",children:[(0,a.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg mb-4",children:[(0,a.jsx)("h4",{className:"font-semibold text-blue-800 mb-2",children:"재매칭할 반품 아이템:"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"구매자:"})," ",g.customerName]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"상품명:"})," ",g.purchaseName]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"옵션:"})," ",g.optionName]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"현재 바코드:"}),(0,a.jsx)("span",{className:"text-red-600 font-mono",children:g.barcode||"매칭 안됨"})]})]})]}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("input",{type:"text",placeholder:"상품명, 옵션명, 바코드로 검색...",value:u,onChange:e=>m(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})}),(0,a.jsxs)("div",{className:"overflow-y-auto max-h-[50vh]",children:[(0,a.jsxs)("table",{className:"w-full border-collapse",children:[(0,a.jsx)("thead",{className:"bg-gray-100 sticky top-0",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"p-2 text-left border",children:"바코드"}),(0,a.jsx)("th",{className:"p-2 text-left border",children:"상품명"}),(0,a.jsx)("th",{className:"p-2 text-left border",children:"사입상품명"}),(0,a.jsx)("th",{className:"p-2 text-left border",children:"옵션명"}),(0,a.jsx)("th",{className:"p-2 text-left border",children:"액션"})]})}),(0,a.jsx)("tbody",{children:p.map((e,t)=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50 border-b",children:[(0,a.jsx)("td",{className:"p-2 border font-mono text-sm",children:e.barcode}),(0,a.jsx)("td",{className:"p-2 border text-sm",children:e.productName}),(0,a.jsx)("td",{className:"p-2 border text-sm",children:e.purchaseName}),(0,a.jsx)("td",{className:"p-2 border text-sm",children:e.optionName}),(0,a.jsx)("td",{className:"p-2 border",children:(0,a.jsx)("button",{onClick:()=>x(e),className:"px-3 py-1 bg-purple-500 hover:bg-purple-600 text-white rounded text-sm transition-colors",children:"선택"})})]},t))})]}),0===p.length&&(0,a.jsx)("p",{className:"text-center text-gray-500 py-4",children:"검색 결과가 없습니다."})]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 p-4 flex justify-between",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>{s>0&&(i(s-1),m(""))},disabled:0===s,className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 disabled:bg-gray-300 text-white rounded-md transition-colors",children:"이전"}),(0,a.jsx)("button",{onClick:()=>{s<n.length-1&&(i(s+1),m(""))},disabled:s===n.length-1,className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 disabled:bg-gray-300 text-white rounded-md transition-colors",children:"다음"})]}),(0,a.jsx)("button",{onClick:b,className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-md transition-colors",children:"닫기"})]})]})}):null},w=console.error,C=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];try{w(...t)}catch(e){}};function S(e,t){if(!e||!t)return 0;e=e.toLowerCase().trim(),t=t.toLowerCase().trim();let r=e.length,a=t.length;if(Math.abs(r-a)>.3*Math.min(r,a))return 0;let o=Array(r+1).fill(null).map(()=>Array(a+1).fill(0));for(let e=0;e<=r;e++)o[e][0]=e;for(let e=0;e<=a;e++)o[0][e]=e;for(let n=1;n<=r;n++)for(let r=1;r<=a;r++){let a=e[n-1]===t[r-1]?0:1;o[n][r]=Math.min(o[n-1][r]+1,o[n][r-1]+1,o[n-1][r-1]+a)}let n=Math.max(r,a);return 1-o[r][a]/n}function R(){let{returnState:e,dispatch:t}=(0,i.b)(),[r,d]=(0,o.useState)(!1),[m,p]=(0,o.useState)(""),h=(0,o.useRef)(null),g=(0,o.useRef)(null);(0,o.useRef)(null);let x=(0,o.useRef)(null);(0,o.useRef)(null),(0,o.useRef)(null);let[b,N]=(0,o.useState)(!1),[w,R]=(0,o.useState)(null),[k,P]=(0,o.useState)(""),[z,D]=(0,o.useState)([]),[T,E]=(0,o.useState)(!1),[L,_]=(0,o.useState)(null),[O,I]=(0,o.useState)([]),[M,F]=(0,o.useState)(!1),[A,U]=(0,o.useState)(null),[B,W]=(0,o.useState)(!1),[q,H]=(0,o.useState)(null),[J,K]=(0,o.useState)({testButton:"bg-blue-500 hover:bg-blue-600",firebaseButton:"bg-indigo-500 hover:bg-indigo-600",productButton:"bg-green-500 hover:bg-green-600",returnButton:"bg-blue-500 hover:bg-blue-600",productListButton:"bg-purple-500 hover:bg-purple-600",pendingButton:"bg-yellow-500 hover:bg-yellow-600",downloadButton:"bg-teal-500 hover:bg-teal-600",trackingButton:"bg-blue-500 hover:bg-blue-600"}),[G,V]=(0,o.useState)(!1),[Y,X]=(0,o.useState)(null),[$,Q]=(0,o.useState)(!1),[Z,ee]=(0,o.useState)(!1),[et,er]=(0,o.useState)(!1),[ea,eo]=(0,o.useState)(""),[en,el]=(0,o.useState)(!1),[ec,es]=(0,o.useState)({popupWidth:81,popupHeight:67.5,popupTableFontSize:1,popupBarcodeFontSize:.7,popupCellPadding:.5,popupLineHeight:1.2,mainTableFontSize:1,mainBarcodeFontSize:.7,mainCellPadding:.75,mainLineHeight:1.2,columnAlignment:{customerName:"center",orderNumber:"center",productName:"left",optionName:"center",quantity:"center",returnReason:"left",trackingNumber:"center",barcode:"left",actions:"center"},columnWidths:{customerName:120,orderNumber:100,productName:200,optionName:120,quantity:80,returnReason:150,trackingNumber:120,barcode:180,actions:120}});(0,o.useCallback)((e,t)=>(C("[".concat(t,"] 오류:"),e),p("".concat(t," 중 오류가 발생했습니다: ").concat(e instanceof Error?e.message:"알 수 없는 오류")),null),[]);let ei=()=>{try{localStorage.getItem("returnData")&&(console.log("기존 returnData 정리 중..."),localStorage.removeItem("returnData"));let e=e=>{let t=localStorage.getItem(e);if(!t)return[];try{if(t.includes('"pN"')||t.includes('"oN"')||t.includes('"cN"'))return eu(t);return JSON.parse(t)}catch(t){return console.error("".concat(e," 데이터 로드 오류:"),t),[]}},r=e("pendingReturns"),a=e("completedReturns"),o=e("products"),n=localStorage.getItem("lastUpdated");(r.length>0||a.length>0||o.length>0)&&(t({type:"SET_RETURNS",payload:{pendingReturns:r,completedReturns:a,products:o}}),p("마지막 업데이트: ".concat(new Date(n||"").toLocaleString())))}catch(e){console.error("로컬 데이터 로드 오류:",e),p("로컬 데이터를 불러오는 중 오류가 발생했습니다.")}},ed=e=>{try{return JSON.stringify(e).replace(/("productName")/g,'"pN"').replace(/("optionName")/g,'"oN"').replace(/("customerName")/g,'"cN"').replace(/("returnReason")/g,'"rR"').replace(/("barcode")/g,'"bc"').replace(/("quantity")/g,'"qty"').replace(/("zigzagProductCode")/g,'"zpc"').replace(/("purchaseName")/g,'"pnm"')}catch(t){return console.error("데이터 압축 오류:",t),JSON.stringify(e)}},eu=e=>{try{let t=e.replace(/("pN")/g,'"productName"').replace(/("oN")/g,'"optionName"').replace(/("cN")/g,'"customerName"').replace(/("rR")/g,'"returnReason"').replace(/("bc")/g,'"barcode"').replace(/("qty")/g,'"quantity"').replace(/("zpc")/g,'"zigzagProductCode"').replace(/("pnm")/g,'"purchaseName"');return JSON.parse(t)}catch(t){return console.error("데이터 압축 해제 오류:",t),JSON.parse(e)}},em=e=>{try{let t=(e,t)=>{try{let r=ed(t);return localStorage.setItem(e,r),!0}catch(r){if("QuotaExceededError"===r.name){if(console.warn("".concat(e," 저장 실패 - 할당량 초과, 데이터 크기 줄이기 시도")),Array.isArray(t)&&t.length>100){let r=t.slice(-100);try{let a=ed(r);return localStorage.setItem(e,a),console.log("".concat(e," 데이터 크기 축소 저장 성공 (").concat(t.length," -> ").concat(r.length,")")),!0}catch(t){console.error("".concat(e," 축소 저장도 실패:"),t)}}return!1}throw r}},r=t("pendingReturns",e.pendingReturns||[]),a=t("completedReturns",e.completedReturns||[]),o=t("products",e.products||[]);return localStorage.setItem("lastUpdated",new Date().toISOString()),r&&a&&o||p("일부 데이터가 크기 제한으로 인해 축소 저장되었습니다."),!0}catch(e){return console.error("로컬 스토리지 저장 오류:",e),p("데이터 저장 중 오류가 발생했습니다. 브라우저 저장공간을 확인해주세요."),!1}},ep=(0,o.useCallback)(()=>{try{em(e),console.log("로컬 데이터 자동 저장 완료")}catch(e){console.error("자동 저장 실패:",e)}},[e]);(0,o.useEffect)(()=>{if(e.pendingReturns.length>0||e.completedReturns.length>0||e.products.length>0){let e=setTimeout(()=>{ep()},1e3);return()=>clearTimeout(e)}},[e,ep]);let eh=()=>{try{let e=0;for(let t in localStorage)localStorage.hasOwnProperty(t)&&(e+=localStorage[t].length);e>5242880&&(console.log("로컬 스토리지 용량 정리 시작..."),["returnData","returnData_backup"].forEach(e=>{localStorage.getItem(e)&&(localStorage.removeItem(e),console.log("".concat(e," 삭제됨")))}),p("로컬 스토리지 정리 완료"))}catch(e){console.error("스토리지 정리 오류:",e)}};(0,o.useEffect)(()=>{eh(),ei(),localStorage.getItem("pendingReturns")||localStorage.getItem("completedReturns")||p("로컬 저장소에서 데이터를 불러왔습니다. 엑셀 파일을 업로드하여 시작하세요.")},[]),(0,o.useEffect)(()=>{let e=localStorage.getItem("buttonColors");if(e)try{K(JSON.parse(e))}catch(e){console.error("색상 설정 로드 오류:",e)}},[]),(0,o.useEffect)(()=>{let e=localStorage.getItem("tableSettings");if(e)try{let t=JSON.parse(e);es(t);let r=document.documentElement;r.style.setProperty("--popup-width","".concat(t.popupWidth,"vw")),r.style.setProperty("--popup-height","".concat(t.popupHeight,"vh")),r.style.setProperty("--popup-table-font-size","".concat(t.popupTableFontSize,"rem")),r.style.setProperty("--popup-barcode-font-size","".concat(t.popupBarcodeFontSize,"rem")),r.style.setProperty("--popup-cell-padding","".concat(t.popupCellPadding,"rem")),r.style.setProperty("--popup-line-height",t.popupLineHeight.toString()),r.style.setProperty("--main-table-font-size","".concat(t.mainTableFontSize,"rem")),r.style.setProperty("--main-barcode-font-size","".concat(t.mainBarcodeFontSize,"rem")),r.style.setProperty("--main-cell-padding","".concat(t.mainCellPadding,"rem")),r.style.setProperty("--main-line-height",t.mainLineHeight.toString()),t.columnAlignment&&Object.entries(t.columnAlignment).forEach(e=>{let[t,a]=e;r.style.setProperty("--column-".concat(t,"-alignment"),a)}),t.columnWidths&&Object.entries(t.columnWidths).forEach(e=>{let[t,a]=e;r.style.setProperty("--column-".concat(t,"-width"),"".concat(a,"px"))})}catch(e){console.error("표 설정 로드 오류:",e)}},[]);let eg=(e,t)=>{let r={...ec,[e]:t};es(r),localStorage.setItem("tableSettings",JSON.stringify(r))},ex=(e,t)=>{let r={...ec};r.columnAlignment[e]=t,es(r),localStorage.setItem("tableSettings",JSON.stringify(r)),document.documentElement.style.setProperty("--column-".concat(e,"-alignment"),t)},eb=(e,t)=>{let r={...ec};r.columnWidths[e]=t,es(r),localStorage.setItem("tableSettings",JSON.stringify(r)),document.documentElement.style.setProperty("--column-".concat(e,"-width"),"".concat(t,"px"))};(0,o.useCallback)(async(e,t)=>{try{C("".concat("products"===t?"상품":"반품"," 엑셀 파일 처리 시작:"),e.name);let r="products"===t?await s(e):await c(e);return C("".concat("products"===t?"상품":"반품"," 엑셀 파일 처리 완료:"),{파일명:e.name,데이터길이:r.length}),r}catch(e){throw Error("엑셀 파일 처리 오류: ".concat(e instanceof Error?e.message:"알 수 없는 오류"))}},[]),(0,o.useCallback)((e,t)=>{let r=[];for(let a=0;a<e.length;a+=t)r.push(e.slice(a,a+t));return r},[]);let eN=()=>{T?D([]):D(e.pendingReturns.map((e,t)=>t)),E(!T),_(null)},ey=e=>{R(e),P(e.detailReason||""),N(!0),eB(e=>e+10)},ef=(0,o.useCallback)(e=>{w&&(t({type:"UPDATE_RETURN_REASON",payload:{id:w.id,detailReason:e}}),N(!1),eB(e=>Math.max(0,e-10)),p("반품 사유 상세 정보가 저장되었습니다."))},[w,t]),ej=(e,t,r)=>t>0&&r[t-1].orderNumber===e.orderNumber?"bg-gray-50":"",ev=e=>!!e&&"string"==typeof e&&(e.includes("불량")||e.includes("하자")||e.includes("파손"));(0,o.useCallback)(e=>{X(e),V(!0),eB(e=>e+10)},[]);let ew=()=>{M?I([]):I(eX.map((e,t)=>t)),F(!M),U(null)},eC=e=>{if(!e||"string"!=typeof e)return"";let t=e.toLowerCase();return t.includes("불실")||t.includes("변심")||t.includes("단순")?"단순변심":t.includes("실못")||t.includes("잘못")&&t.includes("주문")?"주문실수":t.includes("파손")||t.includes("불량")?"파손 및 불량":e},eS=(0,o.useCallback)(()=>{if(!e.products||0===e.products.length){p("삭제할 상품 데이터가 없습니다.");return}confirm("정말로 모든 상품 데이터를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.")&&(t({type:"SET_PRODUCTS",payload:[]}),em({...e,products:[]}),p("모든 상품 데이터가 삭제되었습니다."))},[e,t,em]);(0,o.useCallback)(e=>{H(e),W(!0),eB(e=>e+10)},[]);let eR=(0,o.useCallback)(r=>{if(!q)return;let a={...q,returnTrackingNumber:r.trim()};if(r.trim()){t({type:"REMOVE_PENDING_RETURN",payload:{id:a.id}});let e={...a,status:"COMPLETED",completedAt:new Date};t({type:"ADD_COMPLETED_RETURN",payload:e}),p("".concat(e.productName," 상품이 입고완료 처리되었습니다."))}else t({type:"UPDATE_PENDING_RETURN",payload:a}),p("반품송장번호가 업데이트되었습니다.");em(e),W(!1),H(null),eB(e=>Math.max(0,e-10))},[q,t,e,em]),[ek,eP]=(0,o.useState)(""),[ez,eD]=(0,o.useState)([]),[eT,eE]=(0,o.useState)(!1),eL=()=>{if(!ek.trim()){eE(!1),eD([]);return}let t=ek.toLowerCase().trim(),r=e.completedReturns.filter(e=>e.customerName&&e.customerName.toLowerCase().includes(t)||e.orderNumber&&e.orderNumber.toLowerCase().includes(t));eD(r),eE(!0),0===r.length?p("검색 결과가 없습니다."):p("".concat(r.length,"개의 검색 결과를 찾았습니다."))},e_=e=>{let t={};return e.forEach(e=>{if(e.completedAt){let r=new Date(e.completedAt),a=new Date(r.getFullYear(),r.getMonth(),r.getDate()).toISOString().split("T")[0];t[a]||(t[a]=[]),t[a].push(e)}}),Object.entries(t).sort((e,t)=>{let[r]=e,[a]=t;return a.localeCompare(r)}).map(e=>{let[t,r]=e;return{date:t,items:r}})};(0,o.useMemo)(()=>Object.entries(e.completedReturns.reduce((e,t)=>{if(!t.completedAt)return e;let r=new Date(t.completedAt),a=new Date(r.getFullYear(),r.getMonth(),r.getDate()).toLocaleDateString();return e[a]||(e[a]=[]),e[a].push(t),e},{})).map(e=>{let[t,r]=e;return{date:t,items:r.sort((e,t)=>new Date(t.completedAt).getTime()-new Date(e.completedAt).getTime())}}).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),[e.completedReturns]);let eO=(0,o.useMemo)(()=>eT&&0!==ez.length?e_(ez):[],[eT,ez]),eI=e=>e.barcode&&"-"!==e.barcode?e.purchaseName&&"-"!==e.purchaseName?(0,a.jsx)("span",{children:e.purchaseName}):(0,a.jsx)("span",{children:e.productName}):(0,a.jsx)("button",{className:"text-blue-600 hover:text-blue-800 underline",onClick:()=>e9(e),children:e.productName});function eM(e,t){var r,a;let o={...e};if(e.barcode&&"-"!==e.barcode)return e;let n=t=>{if(!e.optionName||0===t.length)return t[0]||null;let r=e.optionName.toLowerCase().trim(),a=t.find(e=>e.optionName&&e.optionName.toLowerCase().trim()===r);if(a)return console.log("✅ 옵션명 정확 매칭: ".concat(e.optionName," → ").concat(a.optionName)),a;console.log('\uD83D\uDD0D 색상 기반 매칭 시도: "'.concat(e.optionName,'"'));let o=c(r);if(console.log('추출된 색상: "'.concat(o,'"')),o){let e=t.filter(e=>!!e.optionName&&c(e.optionName.toLowerCase().trim())===o);if(e.length>0)return console.log("✅ 색상 기반 매칭 성공: ".concat(o," → ").concat(e[0].optionName)),e[0]}console.log('\uD83D\uDD0D 콤마 기준 분리 매칭 시도: "'.concat(e.optionName,'"'));let n=r.split(",").map(e=>e.trim()).filter(e=>e.length>0);if(console.log("분리된 부분들: [".concat(n.join(", "),"]")),n.length>1){let r=null,a=0;for(let e of t){if(!e.optionName)continue;let t=e.optionName.toLowerCase().trim().split(",").map(e=>e.trim()).filter(e=>e.length>0),o=0;for(let e of n)for(let r of t)if(e===r||e.includes(r)||r.includes(e)){o++;break}if(o>0){let l=o/Math.max(n.length,t.length);console.log("  - ".concat(e.optionName,": ").concat(o,"/").concat(n.length," 부분 매칭, 점수: ").concat(l.toFixed(2))),l>a&&l>=.5&&(a=l,r=e)}}if(r)return console.log("✅ 콤마 기준 분리 매칭 성공: ".concat(e.optionName," → ").concat(r.optionName," (점수: ").concat(a.toFixed(2),")")),r}let s=null,i=.7;for(let e of t)if(e.optionName){let t=S(r,e.optionName.toLowerCase().trim());t>i&&(i=t,s=e)}if(s)return console.log("✅ 옵션명 유사도 매칭: ".concat(e.optionName," → ").concat(s.optionName," (유사도: ").concat(i.toFixed(2),")")),s;console.log('\uD83D\uDD0D 옵션명 부분 매칭 시도: "'.concat(e.optionName,'"'));let d=null,u=0,m=l(r);for(let e of(console.log("반품 옵션 키워드: [".concat(m.join(", "),"]")),t))if(e.optionName){let t=l(e.optionName.toLowerCase().trim()),r=m.filter(e=>t.some(t=>!!(t===e||e.length>=3&&t.includes(e)||t.length>=3&&e.includes(t))));if(r.length>0){let a=r.length/Math.max(m.length,t.length)*.8+r.length/m.length*.2;console.log("  - ".concat(e.optionName,": 공통키워드 ").concat(r.length,"개 [").concat(r.join(", "),"], 점수: ").concat(a.toFixed(2))),a>u&&a>=.4&&(u=a,d=e,console.log("    → 현재 최고 점수로 선택됨"))}else console.log("  - ".concat(e.optionName,": 공통키워드 없음"))}return d?(console.log("✅ 옵션명 부분 매칭 성공: ".concat(e.optionName," → ").concat(d.optionName," (점수: ").concat(u.toFixed(2),")")),d):(console.log("⚠️ 옵션명 매칭 실패, 매칭 불가: ".concat(e.optionName)),null)},l=e=>e.replace(/[\[\]]/g,"").split(/[,\/:\-\s]+/).map(e=>e.trim()).filter(e=>e.length>0&&"선택"!==e),c=e=>{for(let t of["블랙","화이트","네이비","그레이","베이지","레드","블루","그린","옐로우","퍼플","핑크","오렌지","브라운","카멜","민트","아이보리","소라","곤색","연두","다크그레이","연핑크","오트밀","연겨자","회색","검정","곤색","아쿠아블루","메란지","라이트민트","연핑크","베이지"])if(e.includes(t.toLowerCase()))return t.toLowerCase();return null},s=(null===(r=e.purchaseName)||void 0===r?void 0:r.toLowerCase())||"",i=(null===(a=e.optionName)||void 0===a?void 0:a.toLowerCase())||"";if(s.includes("연채원")&&s.includes("607")){if(console.log('\uD83D\uDD0D 연채원 607 특별 매칭 시도: "'.concat(e.purchaseName,'" - "').concat(e.optionName,'"')),i.includes("블랙")&&i.includes("1사이즈")){console.log("\uD83D\uDD0D 블랙,1사이즈 특별 강화 매칭 시도");let e=t.find(e=>"B-10231420001"===e.barcode||"B-10231420001"===e.customProductCode);if(e)return console.log("✅ 블랙,1사이즈 특별 바코드 매칭 성공: B-10231420001"),o.barcode=e.barcode,o.purchaseName=e.purchaseName||e.productName,o.zigzagProductCode=e.zigzagProductCode||"",o.matchType="연채원607_블랙1사이즈_특별매칭",o.matchSimilarity=1,o.matchedProductName=e.productName,o.matchedProductOption=e.optionName,o;let r=t.find(e=>e.optionName&&"블랙,1사이즈"===e.optionName.toLowerCase().trim()&&e.purchaseName&&e.purchaseName.toLowerCase().includes("연채원")&&e.purchaseName.toLowerCase().includes("607"));if(r)return console.log("✅ 블랙,1사이즈 정확 매칭 성공: ".concat(r.barcode)),o.barcode=r.barcode,o.purchaseName=r.purchaseName||r.productName,o.zigzagProductCode=r.zigzagProductCode||"",o.matchType="연채원607_블랙1사이즈_정확매칭",o.matchSimilarity=1,o.matchedProductName=r.productName,o.matchedProductOption=r.optionName,o}let r=t.filter(e=>e.optionName&&e.optionName.toLowerCase().trim()===i.trim());if(r.length>0)return console.log('✅ 연채원 607 정확한 옵션명 매칭: "'.concat(i,'" → "').concat(r[0].optionName,'"')),o.barcode=r[0].barcode,o.purchaseName=r[0].purchaseName||r[0].productName,o.zigzagProductCode=r[0].zigzagProductCode||"",o.matchType="연채원607_정확옵션매칭",o.matchSimilarity=1,o.matchedProductName=r[0].productName,o.matchedProductOption=r[0].optionName,o;let a=i.split(",").map(e=>e.trim()).filter(e=>e.length>0);if(console.log("분리된 옵션 부분: [".concat(a.join(", "),"]")),a.length>=2){let e=a.find(e=>["블랙","화이트","네이비","그레이","베이지","레드","블루","그린"].includes(e)),r=a.find(e=>e.includes("사이즈")||/^\d+$/.test(e)||/^[SMLX]+$/i.test(e));console.log('색상 부분: "'.concat(e,'", 사이즈 부분: "').concat(r,'"'));let n=t.filter(e=>e.purchaseName&&e.purchaseName.toLowerCase().includes("연채원")&&e.purchaseName.toLowerCase().includes("607"));if(console.log("연채원 607 사입상품명 상품들: ".concat(n.length,"개")),n.length>0){if("블랙"===e){let e=n.filter(e=>e.optionName&&e.optionName.toLowerCase().includes("블랙"));if(console.log("연채원 607 + 블랙 색상 상품들: ".concat(e.length,"개")),e.length>0){if(r){let t=e.filter(e=>e.optionName&&e.optionName.toLowerCase().includes(r.toLowerCase()));if(t.length>0)return console.log('✅ 연채원 607 + 블랙 + 사이즈 매칭: "'.concat(i,'" → "').concat(t[0].optionName,'"')),o.barcode=t[0].barcode,o.purchaseName=t[0].purchaseName||t[0].productName,o.zigzagProductCode=t[0].zigzagProductCode||"",o.matchType="연채원607_사입명색상사이즈매칭",o.matchSimilarity=.98,o.matchedProductName=t[0].productName,o.matchedProductOption=t[0].optionName,o}return console.log('✅ 연채원 607 + 블랙 색상 매칭: "'.concat(i,'" → "').concat(e[0].optionName,'"')),o.barcode=e[0].barcode,o.purchaseName=e[0].purchaseName||e[0].productName,o.zigzagProductCode=e[0].zigzagProductCode||"",o.matchType="연채원607_사입명색상매칭",o.matchSimilarity=.95,o.matchedProductName=e[0].productName,o.matchedProductOption=e[0].optionName,o}}let t=null,l=0;for(let e of n){if(!e.optionName)continue;let r=e.optionName.toLowerCase().trim().split(",").map(e=>e.trim()).filter(e=>e.length>0),o=0;for(let e of a)for(let t of r)if(e===t){o++;break}if(o>0){let n=o/Math.max(a.length,r.length);console.log("  - ".concat(e.optionName,": ").concat(o,"/").concat(a.length," 정확 매칭, 점수: ").concat(n.toFixed(2))),n>l&&(l=n,t=e)}}if(t&&l>=.5)return console.log('✅ 연채원 607 + 옵션 부분 매칭: "'.concat(i,'" → "').concat(t.optionName,'" (점수: ').concat(l.toFixed(2),")")),o.barcode=t.barcode,o.purchaseName=t.purchaseName||t.productName,o.zigzagProductCode=t.zigzagProductCode||"",o.matchType="연채원607_사입명옵션매칭",o.matchSimilarity=l,o.matchedProductName=t.productName,o.matchedProductOption=t.optionName,o}}if(i.includes("블랙")){let e=t.find(e=>"B-10231420001"===e.barcode||"B-10231420001"===e.customProductCode);if(e)return console.log("✅ 연채원 607 블랙 바코드 매칭: B-10231420001"),o.barcode=e.barcode,o.purchaseName=e.purchaseName||e.productName,o.zigzagProductCode=e.zigzagProductCode||"",o.matchType="연채원607_바코드매칭",o.matchSimilarity=.8,o.matchedProductName=e.productName,o.matchedProductOption=e.optionName,o}}if(o.barcode&&"-"!==o.barcode)return console.log("✅ 연채원 607 특별 매칭 완료: ".concat(o.barcode)),o;if(e.customProductCode&&"-"!==e.customProductCode){console.log('\uD83D\uDD0D 자체상품코드 "'.concat(e.customProductCode,'"로 매칭 시도...'));let r=t.filter(t=>t.customProductCode&&t.customProductCode.toLowerCase().trim()===e.customProductCode.toLowerCase().trim()||t.zigzagProductCode&&t.zigzagProductCode.toLowerCase().trim()===e.customProductCode.toLowerCase().trim());if(r.length>0){let t=n(r);if(t)return console.log("✅ 자체상품코드 정확 매칭 성공 (옵션 고려): ".concat(e.customProductCode," → ").concat(t.purchaseName||t.productName," [").concat(t.optionName,"]")),o.barcode=t.barcode,o.purchaseName=t.purchaseName||t.productName,o.zigzagProductCode=t.zigzagProductCode||"",o.matchType="custom_code_exact",o.matchSimilarity=1,o.matchedProductName=t.productName,o.matchedProductOption=t.optionName,o;console.log("❌ 자체상품코드 매칭 실패: 옵션명 매칭 불가 (".concat(e.optionName,")"))}console.log('\uD83D\uDD0D 자체상품코드 "'.concat(e.customProductCode,'"와 사입상품명 유사도 매칭 시도...'));let a=null,l=e.customProductCode.toLowerCase().trim();for(let e of t)if(e.purchaseName&&"string"==typeof e.purchaseName){let t=e.purchaseName.toLowerCase().trim();if(t.includes(l)||l.includes(t))(!a||.95>a.similarity)&&(a={product:e,similarity:.95,matchType:"자체상품코드-사입명 포함관계"},console.log("\uD83D\uDCCC 포함관계 발견 (유사도: ".concat("0.95",'): "').concat(l,'" ↔ "').concat(t,'"')));else{let r=S(l,t);r>.4&&(!a||r>a.similarity)&&(a={product:e,similarity:r,matchType:"자체상품코드-사입명 유사도"},console.log("\uD83D\uDCCA 유사도 매칭 (유사도: ".concat(r.toFixed(2),'): "').concat(l,'" ↔ "').concat(t,'"')))}}if(a&&a.similarity>.5)return console.log("✅ 자체상품코드 기반 매칭 성공 (".concat(a.matchType,", 유사도: ").concat(a.similarity.toFixed(2),")")),o.barcode=a.product.barcode,o.purchaseName=a.product.purchaseName||a.product.productName,o.zigzagProductCode=a.product.zigzagProductCode||e.zigzagProductCode,o.customProductCode=a.product.customProductCode||a.product.zigzagProductCode||"",o.matchType=a.matchType,o.matchSimilarity=a.similarity,o.matchedProductName=a.product.productName,o.matchedProductOption=a.product.optionName,o;console.log("❌ 자체상품코드 기반 매칭 실패: ".concat(e.customProductCode))}if(e.purchaseName&&"-"!==e.purchaseName){let r=t.filter(t=>{var r;return t.purchaseName&&t.purchaseName.toLowerCase().trim()===(null===(r=e.purchaseName)||void 0===r?void 0:r.toLowerCase().trim())});if(r.length>0){let t=n(r);if(t)return console.log("✅ 사입상품명 매칭 성공 (옵션 고려): ".concat(e.purchaseName," → ").concat(t.productName," [").concat(t.optionName,"]")),o.barcode=t.barcode,o.customProductCode=t.customProductCode||t.zigzagProductCode||"",o.zigzagProductCode=t.zigzagProductCode||"",o.matchType="purchase_name_match",o.matchSimilarity=1,o.matchedProductName=t.productName,o.matchedProductOption=t.optionName,o;console.log("❌ 사입상품명 매칭 실패: 옵션명 매칭 불가 (".concat(e.optionName,")"))}}if(e.zigzagProductCode&&"-"!==e.zigzagProductCode){console.log('\uD83D\uDD0D 지그재그 상품코드 "'.concat(e.zigzagProductCode,'"로 매칭 시도...'));let r=t.filter(t=>t.zigzagProductCode&&t.zigzagProductCode.toLowerCase().trim()===e.zigzagProductCode.toLowerCase().trim());if(r.length>0){let t=n(r);if(t)return console.log("✅ 지그재그 상품코드 정확 매칭 성공 (옵션 고려): ".concat(e.zigzagProductCode," → ").concat(t.productName," [").concat(t.optionName,"]")),o.barcode=t.barcode,o.purchaseName=t.purchaseName||t.productName,o.customProductCode=t.customProductCode||"",o.matchType="zigzag_code_exact",o.matchSimilarity=1,o.matchedProductName=t.productName,o.matchedProductOption=t.optionName,o}console.log('\uD83D\uDD0D 지그재그 코드 "'.concat(e.zigzagProductCode,'"와 사입상품명 유사도 매칭 시도...'));let a=null,l=e.zigzagProductCode.toLowerCase().trim();for(let e of t)if(e.purchaseName&&"string"==typeof e.purchaseName){let t=e.purchaseName.toLowerCase().trim();if(t.includes(l)||l.includes(t))(!a||.9>a.similarity)&&(a={product:e,similarity:.9,matchType:"지그재그코드-사입명 포함관계"},console.log("\uD83D\uDCCC 포함관계 발견 (유사도: ".concat("0.90",'): "').concat(l,'" ↔ "').concat(t,'"')));else{let r=S(l,t);r>.4&&(!a||r>a.similarity)&&(a={product:e,similarity:r,matchType:"지그재그코드-사입명 유사도"},console.log("\uD83D\uDCCA 유사도 매칭 (유사도: ".concat(r.toFixed(2),'): "').concat(l,'" ↔ "').concat(t,'"')))}}if(a&&a.similarity>.5)return console.log("✅ 지그재그 코드 기반 매칭 성공 (".concat(a.matchType,", 유사도: ").concat(a.similarity.toFixed(2),")")),o.barcode=a.product.barcode,o.purchaseName=a.product.purchaseName||a.product.productName,o.customProductCode=a.product.customProductCode||a.product.zigzagProductCode||"",o.matchType=a.matchType,o.matchSimilarity=a.similarity,o.matchedProductName=a.product.productName,o.matchedProductOption=a.product.optionName,o;console.log("❌ 지그재그 코드 기반 매칭 실패: ".concat(e.zigzagProductCode))}if(e.productName){let r=t.filter(t=>{var r,a;return t.productName&&t.productName.toLowerCase().trim()===(null===(r=e.productName)||void 0===r?void 0:r.toLowerCase().trim())||t.purchaseName&&t.purchaseName.toLowerCase().trim()===(null===(a=e.productName)||void 0===a?void 0:a.toLowerCase().trim())});if(r.length>0){let t=n(r);if(t)return console.log("✅ 상품명 정확 매칭 성공 (옵션 고려): ".concat(e.productName," → ").concat(t.productName," [").concat(t.optionName,"]")),o.barcode=t.barcode,o.customProductCode=t.customProductCode||t.zigzagProductCode||"",o.purchaseName=t.purchaseName||t.productName,o.zigzagProductCode=t.zigzagProductCode||"",o.matchType="name_exact",o.matchSimilarity=1,o.matchedProductName=t.productName,o.matchedProductOption=t.optionName,o;console.log("❌ 상품명 정확 매칭 실패: 옵션명 매칭 불가 (".concat(e.optionName,")"))}let a=t.filter(t=>t.productName&&e.productName&&(t.productName.toLowerCase().includes(e.productName.toLowerCase())||e.productName.toLowerCase().includes(t.productName.toLowerCase()))||t.purchaseName&&e.productName&&(t.purchaseName.toLowerCase().includes(e.productName.toLowerCase())||e.productName.toLowerCase().includes(t.purchaseName.toLowerCase())));if(a.length>0){let t=n(a);if(t)return console.log("✅ 상품명 부분 매칭 성공 (옵션 고려): ".concat(e.productName," → ").concat(t.productName," [").concat(t.optionName,"]")),o.barcode=t.barcode,o.customProductCode=t.customProductCode||t.zigzagProductCode||"",o.purchaseName=t.purchaseName||t.productName,o.zigzagProductCode=t.zigzagProductCode||"",o.matchType="name_partial",o.matchSimilarity=.8,o.matchedProductName=t.productName,o.matchedProductOption=t.optionName,o;console.log("❌ 상품명 부분 매칭 실패: 옵션명 매칭 불가 (".concat(e.optionName,")"))}let l=[];for(let r of t){if(r.productName&&e.productName){let t=S(r.productName.toLowerCase(),e.productName.toLowerCase());t>.6&&l.push({product:r,similarity:t})}if(r.purchaseName&&e.productName){let t=S(r.purchaseName.toLowerCase(),e.productName.toLowerCase());t>.6&&l.push({product:r,similarity:t})}}if(l.length>0){l.sort((e,t)=>t.similarity-e.similarity);let t=n(l.filter(e=>e.similarity>=l[0].similarity-.1).map(e=>e.product));if(t){let r=l.find(e=>e.product===t);return console.log("✅ 상품명 유사도 매칭 성공 (옵션 고려): ".concat(e.productName," → ").concat(t.productName," [").concat(t.optionName,"] (유사도: ").concat(null==r?void 0:r.similarity.toFixed(2),")")),o.barcode=t.barcode,o.customProductCode=t.customProductCode||t.zigzagProductCode||"",o.purchaseName=t.purchaseName||t.productName,o.zigzagProductCode=t.zigzagProductCode||"",o.matchType="name_similarity",o.matchSimilarity=(null==r?void 0:r.similarity)||.6,o.matchedProductName=t.productName,o.matchedProductOption=t.optionName,o}console.log("❌ 상품명 유사도 매칭 실패: 옵션명 매칭 불가 (".concat(e.optionName,")"))}}return console.log("❌ 매칭 실패: ".concat(e.productName)),o.matchType="no_match",o.matchSimilarity=0,o}let eF=e=>e.map(e=>({trackingNumber:e.pickupTrackingNumber||e.returnTrackingNumber||"no-tracking",items:[e],totalQuantity:e.quantity||1,isGroup:!1})),eA=t=>{let{items:r}=t,o=eF(r);return(0,a.jsxs)("table",{className:"min-w-full border-collapse main-table",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-50",children:[(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 text-center col-actions",children:(0,a.jsx)("input",{type:"checkbox",checked:M,onChange:ew,className:"w-5 h-5"})}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 w-24 col-customer-name",children:"고객명"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 col-order-number",children:"주문번호"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 col-product-name",children:"사입상품명"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 col-option-name",children:"옵션명"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 w-12 col-quantity",children:"수량"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 col-return-reason",children:"반품사유"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 col-tracking-number",children:"수거송장번호"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 col-barcode",children:"바코드번호"})]})}),(0,a.jsx)("tbody",{children:o.map((t,o)=>{let n=t.items[0],c=r.findIndex(e=>e.id===n.id),s=O.includes(c);return(0,a.jsxs)("tr",{className:"hover:bg-blue-50 ".concat(ev(n.returnReason)?"text-red-500":""),children:[(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 col-actions",children:(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)("input",{type:"checkbox",checked:s,onChange:e=>{e.target.checked?I(e=>[...e,c]):I(e=>e.filter(e=>e!==c))},className:"w-5 h-5"})})}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 whitespace-nowrap overflow-hidden text-ellipsis max-w-[120px] col-customer-name",children:n.customerName}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 whitespace-nowrap overflow-hidden text-ellipsis col-order-number",children:n.orderNumber}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 col-product-name",children:(0,a.jsx)("div",{className:n.barcode?"whitespace-nowrap overflow-hidden text-ellipsis":"whitespace-normal break-words line-clamp-2",children:eI(n)})}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 whitespace-nowrap overflow-hidden text-ellipsis col-option-name",children:l(n.optionName)}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 whitespace-nowrap text-center col-quantity",children:n.quantity}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 whitespace-nowrap overflow-hidden text-ellipsis max-w-[150px] cursor-pointer col-return-reason",onClick:()=>ev(n.returnReason)&&ey(n),children:eZ(n)}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 col-tracking-number",children:(0,a.jsx)("div",{className:"font-mono text-sm whitespace-nowrap bg-blue-100 px-2 py-1 rounded text-center",children:"no-tracking"===t.trackingNumber?"-":t.trackingNumber})}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 col-barcode",children:(0,a.jsxs)("div",{className:"text-xs",children:[(0,a.jsx)("div",{className:"font-mono font-semibold",children:n.barcode||"-"}),n.barcode&&"-"!==n.barcode&&(()=>{let t=e.products.find(e=>e.barcode===n.barcode);return t?(0,a.jsxs)("div",{className:"main-barcode-info",title:"".concat(t.purchaseName," ").concat(t.optionName),children:["(",t.purchaseName," ",t.optionName,")"]}):null})()]})})]},n.id)})})]})},[eU,eB]=(0,o.useState)(0),[eW,eq]=(0,o.useState)([]),[eH,eJ]=(0,o.useState)(0),[eK,eG]=(0,o.useState)(""),[eV,eY]=(0,o.useState)([]);(0,o.useEffect)(()=>{let e=document.createElement("style");return e.innerHTML="\n      dialog {\n        position: fixed !important;\n        margin: auto !important;\n        border: none !important;\n        border-radius: 0.5rem !important;\n        padding: 1rem !important;\n        background: white !important;\n        max-width: 95vw !important;\n        max-height: 90vh !important;\n        overflow: auto !important;\n      }\n      dialog::backdrop {\n        background-color: rgba(0, 0, 0, 0.4) !important;\n      }\n      .popup-layer {\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2) !important;\n      }\n    ",document.head.appendChild(e),()=>{document.head.removeChild(e)}},[]),(0,o.useEffect)(()=>{if(e.completedReturns.length>0){let t=[...new Set(e.completedReturns.map(e=>new Date(e.completedAt).toLocaleDateString()))].sort((e,t)=>new Date(t).getTime()-new Date(e).getTime());eY(t),eG(t[0]||""),eJ(0)}},[e.completedReturns]);let eX=(0,o.useMemo)(()=>!eK||eT?[]:e.completedReturns.filter(e=>new Date(e.completedAt).toLocaleDateString()===eK),[e.completedReturns,eK,eT]),e$=e=>{let t;0!==eV.length&&(eJ(t="prev"===e&&eH<eV.length-1?eH+1:"next"===e&&eH>0?eH-1:"prev"===e?0:eV.length-1),eG(eV[t]),p("".concat(new Date(eV[t]).toLocaleDateString("ko-KR")," 날짜의 데이터로 이동했습니다.")))},eQ=e=>{e$(e)},eZ=e=>{let t=e.returnReason;return e.detailReason&&""!==e.detailReason.trim()&&!t.toLowerCase().includes(e.detailReason.toLowerCase())&&(t+=" (".concat(e.detailReason,")")),t},[e0,e1]=(0,o.useState)(""),[e2,e4]=(0,o.useState)(null),[e3,e5]=(0,o.useState)(null),e6=()=>{let r=e0.trim();if(!r){p("수거송장번호를 입력해주세요.");return}let a=e.pendingReturns.filter(e=>e.pickupTrackingNumber&&e.pickupTrackingNumber===r||e.returnTrackingNumber&&e.returnTrackingNumber===r);if(0===a.length){p("'".concat(r,"' 수거송장번호로 등록된 반품이 없습니다.")),e5(!1),e1("");return}e5(!0),d(!0);let o=new Date,n=new Date(o.getFullYear(),o.getMonth(),o.getDate());n.setHours(0,0,0,0);let l=a.map(e=>({...e,status:"COMPLETED",completedAt:n})),c=[...l,...e.completedReturns],s=e.pendingReturns.filter(e=>!(e.pickupTrackingNumber&&e.pickupTrackingNumber===r||e.returnTrackingNumber&&e.returnTrackingNumber===r));t({type:"SET_RETURNS",payload:{...e,pendingReturns:s,completedReturns:c}}),localStorage.setItem("pendingReturns",JSON.stringify(s)),localStorage.setItem("completedReturns",JSON.stringify(c)),localStorage.setItem("lastUpdated",new Date().toISOString());let i=n.toLocaleDateString();if(i!==eK){eG(i);let e=eV.indexOf(i);e>=0?eJ(e):(eY([i,...eV]),eJ(0))}p("'".concat(r,"' 수거송장번호로 ").concat(l.length,"개 항목이 입고 처리되었습니다.")),e1(""),d(!1)},[e7,e8]=(0,o.useState)(null),e9=e=>{X(e),e8(e),V(!0),eB(e=>e+10)},te=()=>{if(0===O.length)return;d(!0);let r=O.map(e=>eX[e]),a=r.map(e=>{let{completedAt:t,status:r,...a}=e;return{...a,status:"PENDING"}}),o=e.completedReturns.filter(e=>!r.some(t=>t.orderNumber===e.orderNumber&&t.productName===e.productName&&t.optionName===e.optionName&&t.returnTrackingNumber===e.returnTrackingNumber)),n=[...e.pendingReturns,...a];t({type:"SET_RETURNS",payload:{...e,pendingReturns:n,completedReturns:o}}),localStorage.setItem("pendingReturns",JSON.stringify(n)),localStorage.setItem("completedReturns",JSON.stringify(o)),localStorage.setItem("lastUpdated",new Date().toISOString()),p("".concat(O.length,"개의 항목이 입고전 목록으로 되돌아갔습니다.")),I([]),F(!1),d(!1)},tt=()=>{if(0===O.length){p("재매칭할 항목을 선택해주세요.");return}X(O.map(e=>eX[e])[0]),V(!0),O.length>1&&p("".concat(O.length,"개 항목이 선택되었습니다. 첫 번째 항목부터 재매칭을 진행합니다."))},tr=()=>{if(0===O.length){p("날짜를 변경할 항목을 선택해주세요.");return}eo(new Date().toISOString().split("T")[0]),er(!0)},ta=r=>{if(0===O.length)return;d(!0);let a=O.map(e=>eX[e]),o=a.map(e=>({...e,completedAt:new Date(r)})),n=[...e.completedReturns.filter(e=>!a.some(t=>t.orderNumber===e.orderNumber&&t.productName===e.productName&&t.optionName===e.optionName&&t.returnTrackingNumber===e.returnTrackingNumber)),...o];t({type:"SET_RETURNS",payload:{...e,completedReturns:n}}),localStorage.setItem("completedReturns",JSON.stringify(n)),localStorage.setItem("lastUpdated",new Date().toISOString()),p("".concat(O.length,"개 항목의 날짜가 ").concat(new Date(r).toLocaleDateString("ko-KR"),"로 변경되었습니다.")),I([]),F(!1),er(!1),d(!1)};return(0,a.jsxs)("main",{className:"min-h-screen p-4 md:p-6",children:[m&&(0,a.jsx)("div",{className:"mb-4 p-3 rounded ".concat(!1===e3?"bg-pink-100 text-red-800":!0===e3?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"),children:m}),(0,a.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 mb-6",children:[(0,a.jsx)("button",{className:"px-4 py-2 text-white rounded ".concat(J.testButton),onClick:()=>{try{d(!0),p("로컬 저장소 상태를 확인 중...");let e=localStorage.getItem("pendingReturns"),t=localStorage.getItem("completedReturns"),r=localStorage.getItem("products"),a=localStorage.getItem("lastUpdated"),o=e?JSON.parse(e).length:0,n=t?JSON.parse(t).length:0,l=r?JSON.parse(r).length:0,c=0;for(let e in localStorage)localStorage.hasOwnProperty(e)&&(c+=localStorage[e].length);let s=(c/1048576).toFixed(2),i="\n        로컬 저장소 상태:\n        • 입고전 반품: ".concat(o,"개\n        • 입고완료 반품: ").concat(n,"개  \n        • 상품 데이터: ").concat(l,"개\n        • 저장소 사용량: ").concat(s,"MB\n        • 마지막 업데이트: ").concat(a?new Date(a).toLocaleString():"없음","\n      ");p(i),console.log("로컬 저장소 상태:",{pendingReturns:o,completedReturns:n,products:l,totalSizeMB:s,lastUpdated:a})}catch(e){p("로컬 저장소 확인 실패: ".concat(e instanceof Error?e.message:"알 수 없는 오류")),console.error("로컬 저장소 확인 실패:",e)}finally{d(!1)}},disabled:r,children:"저장소 상태 확인"}),(0,a.jsx)("button",{className:"px-4 py-2 text-white rounded ".concat(J.firebaseButton),onClick:()=>{d(!0),p("데이터를 백업 중입니다...");try{let t={pendingReturns:e.pendingReturns,completedReturns:e.completedReturns,products:e.products,exportDate:new Date().toISOString(),version:"1.0"},r=JSON.stringify(t,null,2),a=new Blob([r],{type:"application/json"}),o=URL.createObjectURL(a),n=document.createElement("a");n.href=o,n.download="반품데이터_백업_".concat(new Date().toISOString().split("T")[0],".json"),n.click(),URL.revokeObjectURL(o),p("데이터 백업이 완료되었습니다. 다운로드 폴더를 확인하세요.")}catch(e){console.error("백업 오류:",e),p("데이터 백업 중 오류가 발생했습니다.")}finally{d(!1)}},disabled:r,children:"데이터 백업"}),(0,a.jsxs)("label",{className:"px-4 py-2 text-white rounded text-center cursor-pointer bg-purple-500 hover:bg-purple-600",htmlFor:"restoreFile",children:["데이터 복원",(0,a.jsx)("input",{type:"file",id:"restoreFile",accept:".json",onChange:e=>{var r;let a=null===(r=e.target.files)||void 0===r?void 0:r[0];if(!a)return;d(!0),p("백업 데이터를 복원 중입니다...");let o=new FileReader;o.onload=r=>{try{var a;let e=JSON.parse(null===(a=r.target)||void 0===a?void 0:a.result);if(!e.version||!e.exportDate)throw Error("유효하지 않은 백업 파일입니다.");let o={pendingReturns:e.pendingReturns||[],completedReturns:e.completedReturns||[],products:e.products||[]};t({type:"SET_RETURNS",payload:o}),em(o);let n=new Date(e.exportDate).toLocaleString();p("데이터 복원이 완료되었습니다. (백업 날짜: ".concat(n,")")),console.log("데이터 복원 완료:",{pendingReturns:o.pendingReturns.length,completedReturns:o.completedReturns.length,products:o.products.length,backupDate:n})}catch(e){console.error("복원 오류:",e),p("데이터 복원 중 오류가 발생했습니다: ".concat(e instanceof Error?e.message:"알 수 없는 오류"))}finally{d(!1),e.target.value=""}},o.onerror=()=>{p("파일을 읽는 중 오류가 발생했습니다."),d(!1),e.target.value=""},o.readAsText(a)},className:"hidden",disabled:r})]}),(0,a.jsxs)("label",{className:"px-4 py-2 text-white rounded text-center cursor-pointer ".concat(J.productButton),htmlFor:"productFile",children:["상품 업로드",(0,a.jsx)("input",{type:"file",id:"productFile",accept:".xlsx,.xls",onChange:r=>{if(!r.target.files||0===r.target.files.length)return;let a=r.target.files[0];d(!0),p("상품 데이터 파일을 처리 중입니다..."),s(a).then(r=>{if(0===r.length){p("파일에서 유효한 상품 데이터를 찾을 수 없습니다.");return}t({type:"ADD_PRODUCTS",payload:r});let a=[...e.products,...r];localStorage.setItem("products",JSON.stringify(a)),localStorage.setItem("lastUpdated",new Date().toISOString());let o=e.pendingReturns.filter(e=>!e.barcode);if(o.length>0){let e=0;o.forEach(a=>{let o=eM(a,r);o.barcode&&(e++,t({type:"UPDATE_RETURN_ITEM",payload:o}))}),e>0?p("".concat(r.length,"개 상품이 추가되었습니다. ").concat(e,"개 반품 항목이 자동 매칭되었습니다.")):p("".concat(r.length,"개 상품이 추가되었습니다."))}else p("".concat(r.length,"개 상품이 추가되었습니다."))}).catch(e=>{console.error("상품 데이터 처리 오류:",e),p("상품 데이터 처리 중 오류가 발생했습니다: ".concat(e instanceof Error?e.message:String(e)))}).finally(()=>{d(!1),r.target.value=""})},ref:g,className:"hidden",disabled:r})]}),(0,a.jsxs)("label",{className:"px-4 py-2 text-white rounded text-center cursor-pointer ".concat(J.returnButton),htmlFor:"returnFile",children:["반품 업로드",(0,a.jsx)("input",{type:"file",id:"returnFile",accept:".xlsx,.xls",onChange:r=>{if(!r.target.files||0===r.target.files.length)return;let a=r.target.files[0];d(!0),p("반품 데이터 파일을 처리 중입니다..."),c(a).then(r=>{if(0===r.length){p("파일에서 유효한 반품 데이터를 찾을 수 없습니다.");return}let a=r.map(e=>({...e,returnReason:eC(e.returnReason)}));t({type:"ADD_RETURNS",payload:a});let o=[...e.pendingReturns,...a];localStorage.setItem("pendingReturns",JSON.stringify(o)),localStorage.setItem("lastUpdated",new Date().toISOString()),p("".concat(a.length,"개 반품 항목이 성공적으로 추가되었습니다."))}).catch(e=>{console.error("반품 데이터 처리 오류:",e),p("반품 데이터 처리 중 오류가 발생했습니다: ".concat(e instanceof Error?e.message:String(e)))}).finally(()=>{d(!1),r.target.value=""})},ref:h,className:"hidden",disabled:r})]}),(0,a.jsx)("button",{className:"px-4 py-2 text-white rounded ".concat(J.productListButton),onClick:()=>{var e;return null===(e=x.current)||void 0===e?void 0:e.showModal()},disabled:r,children:"상품 목록"}),(0,a.jsxs)("button",{className:"px-4 py-2 text-white rounded ".concat(J.pendingButton),onClick:()=>Q(!0),disabled:r,children:["입고전 (",e.pendingReturns.length,")"]}),(0,a.jsx)("button",{className:"px-4 py-2 text-white rounded bg-orange-500 hover:bg-orange-600",onClick:()=>el(!0),disabled:r,children:"표 크기 조정"})]}),r&&(0,a.jsxs)("div",{className:"flex justify-center items-center my-4",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"}),(0,a.jsx)("span",{className:"ml-2",children:"처리 중..."})]}),(0,a.jsxs)("div",{className:"mb-6 p-4 border rounded-lg shadow-sm bg-white",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"수거송장번호로 입고"}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2",children:[(0,a.jsx)("input",{type:"text",placeholder:"수거송장번호 입력 후 Enter 또는 입고 버튼 클릭",className:"flex-1 px-4 py-2 border border-gray-300 rounded",value:e0,onChange:e=>e1(e.target.value),onKeyDown:e=>{if("Enter"===e.key){if(!e0.trim()){p("수거송장번호를 입력해주세요.");return}e6()}}}),(0,a.jsx)("button",{className:"px-4 py-2 text-white rounded ".concat(J.trackingButton),onClick:e6,disabled:r||!e0.trim(),children:"입고"})]})]}),(0,a.jsxs)("div",{className:"p-4 border rounded-lg shadow-sm bg-white",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"입고완료 반품 목록"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{className:"px-3 py-1 text-white rounded ".concat(J.downloadButton),onClick:()=>{let t=[];if(eT&&ez.length>0?t=ez:eK&&eX.length>0?t=eX:e.completedReturns.length>0&&(t=e.completedReturns),0===t.length){p("다운로드할 입고 완료 데이터가 없습니다.");return}try{let e=t.filter(e=>e.barcode&&"-"!==e.barcode);if(0===e.length){p("바코드가 있는 항목이 없어서 CSV 파일을 생성할 수 없습니다.");return}let r=e.map(e=>({바코드번호:e.barcode||"",입고수량:e.quantity||1})),a=["바코드번호,입고수량",...r.map(e=>[e.바코드번호,e.입고수량].join(","))].join("\r\n"),o=new Blob(["\uFEFF"+a],{type:"text/csv"}),n=document.createElement("a"),l=URL.createObjectURL(o);n.setAttribute("href",l),n.setAttribute("download","입고잡기용_".concat(new Date().toISOString().split("T")[0],".csv")),n.setAttribute("type","text/csv"),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(l);let c="";eT?c="검색 결과 ":eK&&(c="".concat(new Date(eK).toLocaleDateString("ko-KR")," 날짜의 ")),p("".concat(c).concat(e.length,"개 항목이 입고잡기용 CSV 파일로 저장되었습니다. (바코드 미매칭 ").concat(t.length-e.length,"개 제외)"))}catch(e){console.error("CSV 생성 중 오류:",e),p("CSV 파일 생성 중 오류가 발생했습니다.")}},disabled:r||0===e.completedReturns.length,children:"목록 다운로드"}),(0,a.jsx)("button",{className:"px-3 py-1 text-white rounded bg-purple-500 hover:bg-purple-600",onClick:()=>{let t=[];if(eT&&ez.length>0?t=ez:eK&&eX.length>0?t=eX:e.completedReturns.length>0&&(t=e.completedReturns),0===t.length){p("다운로드할 입고 완료 데이터가 없습니다.");return}try{!function(e){let t=new Map;e.forEach(e=>{let r=e.pickupTrackingNumber||"no-tracking";t.has(r)||t.set(r,[]),t.get(r).push(e)});let r=[];t.forEach((e,t)=>{if(0===e.length)return;let a=e[0],o=a.customerName,n=a.returnReason,l=a.completedAt?new Date(a.completedAt).toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\./g,"/"):"",c=new Map;e.forEach(e=>{let t=e.purchaseName||e.productName||"",r=e.optionName||"",a=r?"".concat(t,"-").concat(r):t;c.has(a)?c.get(a).quantity+=e.quantity:c.set(a,{quantity:e.quantity,purchaseName:t,optionName:r})});let s=e.reduce((e,t)=>e+t.quantity,0);Array.from(c.entries()).forEach((e,t)=>{let[a,c]=e;r.push([l,0===t?o:"",0===t?n:"",a,0===t?"".concat(s,"개"):""])})});let a=[["날짜","고객명","반품사유","사입상품명","총 수량"],...r],o=n.P6.book_new(),l=n.P6.aoa_to_sheet(a);l["!cols"]=[{wch:12},{wch:10},{wch:15},{wch:30},{wch:10}];let c=[];for(let e=0;e<a.length;e++)c.push({hpt:20});l["!rows"]=c;let s=[],i=1;t.forEach((e,t)=>{if(0===e.length)return;let r=new Map;e.forEach(e=>{let t=e.purchaseName||e.productName||"",a=e.optionName||"",o=a?"".concat(t,"-").concat(a):t;r.has(o)?r.get(o).quantity+=e.quantity:r.set(o,{quantity:e.quantity,purchaseName:t,optionName:a})});let a=Array.from(r.entries()).length;a>1&&(s.push({s:{r:i,c:1},e:{r:i+a-1,c:1}}),s.push({s:{r:i,c:2},e:{r:i+a-1,c:2}}),s.push({s:{r:i,c:4},e:{r:i+a-1,c:4}})),i+=a}),l["!merges"]=s;for(let e=0;e<a.length;e++)for(let t=0;t<a[e].length;t++){let r=n.P6.encode_cell({r:e,c:t});l[r]&&(l[r].s={font:{name:"맑은 고딕",sz:10,bold:!1},alignment:{horizontal:"center",vertical:"center",wrapText:!0},border:{top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}},fill:{fgColor:{rgb:"FFFFFF"}}})}for(let e=0;e<a[0].length;e++){let t=n.P6.encode_cell({r:0,c:e});l[t]&&(l[t].s={font:{name:"맑은 고딕",sz:10,bold:!0},alignment:{horizontal:"center",vertical:"center",wrapText:!0},border:{top:{style:"thin"},bottom:{style:"thin"},left:{style:"thin"},right:{style:"thin"}},fill:{fgColor:{rgb:"F0F0F0"}}})}n.P6.book_append_sheet(o,l,"입고완료 반품목록");let d="입고완료_반품목록_".concat(new Date().toISOString().split("T")[0],".xlsx");n.NC(o,d)}(t);let e="";eT?e="검색 결과 ":eK&&(e="".concat(new Date(eK).toLocaleDateString("ko-KR")," 날짜의 ")),p("".concat(e).concat(t.length,"개 항목이 엑셀 파일로 저장되었습니다."))}catch(e){console.error("엑셀 생성 중 오류:",e),p("엑셀 파일 생성 중 오류가 발생했습니다.")}},disabled:r||0===e.completedReturns.length,children:"셀 복사용 다운로드"})]})]}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row mb-4 space-y-2 md:space-y-0 md:space-x-2",children:[(0,a.jsx)("input",{type:"text",placeholder:"고객명 또는 주문번호로 검색",className:"flex-1 px-4 py-2 border border-gray-300 rounded",value:ek,onChange:e=>eP(e.target.value),onKeyPress:e=>"Enter"===e.key&&eL()}),(0,a.jsx)("button",{className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded",onClick:eL,children:"검색"}),eT&&(0,a.jsx)("button",{className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded",onClick:()=>{eP(""),eD([]),eE(!1)},children:"검색 취소"})]}),!eT&&eV.length>0&&(0,a.jsxs)("div",{className:"flex items-center justify-center mb-4 p-2 bg-gray-100 rounded-md",children:[(0,a.jsx)("button",{className:"px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded-l-md",onClick:()=>eQ("prev"),children:"<"}),(0,a.jsx)("div",{className:"mx-3 font-medium",children:eK&&new Date(eK).toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"})}),(0,a.jsx)("button",{className:"px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded-r-md",onClick:()=>eQ("next"),children:">"})]}),e.completedReturns.length>0?(0,a.jsxs)("div",{className:"space-y-6",children:[eT&&eO.length>0&&eO.map(e=>{let{date:t,items:r}=e;return(0,a.jsxs)("div",{id:"date-group-".concat(t),className:"border border-gray-200 rounded-md overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-gray-100 px-4 py-2 font-medium flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[new Date(t).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric",weekday:"long"}),(0,a.jsxs)("span",{className:"ml-2 text-gray-600 text-sm",children:["(",r.length,"개)"]})]}),O.length>0&&(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)("button",{className:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded",onClick:te,children:["되돌리기 (",O.length,")"]}),(0,a.jsxs)("button",{className:"px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded",onClick:tt,children:["재매칭 (",O.length,")"]}),(0,a.jsxs)("button",{className:"px-3 py-1 bg-green-500 hover:bg-green-600 text-white rounded",onClick:tr,children:["날짜변경 (",O.length,")"]})]})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsx)(eA,{items:r})})]},t)}),!eT&&eK&&(0,a.jsxs)("div",{className:"border border-gray-200 rounded-md overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-gray-100 px-4 py-2 font-medium flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[new Date(eK).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric",weekday:"long"}),(0,a.jsxs)("span",{className:"ml-2 text-gray-600 text-sm",children:["(",eX.length,"개)"]})]}),O.length>0&&(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)("button",{className:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded",onClick:te,children:["되돌리기 (",O.length,")"]}),(0,a.jsxs)("button",{className:"px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded",onClick:tt,children:["재매칭 (",O.length,")"]}),(0,a.jsxs)("button",{className:"px-3 py-1 bg-green-500 hover:bg-green-600 text-white rounded",onClick:tr,children:["날짜변경 (",O.length,")"]})]})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsx)(eA,{items:eX})})]})]}):(0,a.jsx)("p",{children:"입고완료된 반품이 없습니다."})]}),B&&q&&(0,a.jsx)(y,{isOpen:B,onClose:()=>{e1(""),e4(null),p("수거송장번호 입력이 취소되었습니다.")},returnItem:q,onSave:eR,zIndex:1e3+eU}),(0,a.jsx)(j,{isOpen:$,onClose:()=>{Q(!1),D([])},items:e.pendingReturns,selectedItems:z,onRefresh:()=>{if(d(!0),p("데이터를 새로고침 중입니다..."),e.pendingReturns.length>0){let r=new Set(e.completedReturns.map(e=>"".concat(e.customerName,"_").concat(e.orderNumber,"_").concat(e.purchaseName||e.productName,"_").concat(e.optionName,"_").concat(e.returnTrackingNumber))),a=new Map;e.pendingReturns.forEach(e=>{let t="".concat(e.customerName,"_").concat(e.orderNumber,"_").concat(e.purchaseName||e.productName,"_").concat(e.optionName,"_").concat(e.returnTrackingNumber);if(r.has(t)){console.log("중복 항목 제외 (이미 입고완료): ".concat(t));return}a.has(t)||a.set(t,e)});let o=Array.from(a.values()),n=e.pendingReturns.length-o.length;n>0&&(console.log("중복 제거: ".concat(n,"개 항목 제거됨")),t({type:"SET_RETURNS",payload:{...e,pendingReturns:o}}))}if(e.pendingReturns.length>0&&e.products.length>0){let r=e.pendingReturns.map(t=>eM(t,e.products)),a=r.filter(e=>e.barcode).length-e.pendingReturns.filter(e=>e.barcode).length;a>0?(t({type:"SET_RETURNS",payload:{...e,pendingReturns:r}}),p("새로고침 완료: ".concat(a,"개 상품이 자동 매칭되었습니다."))):p("새로고침 완료. 매칭할 상품이 없습니다.")}else p("새로고침 완료.");setTimeout(()=>{d(!1)},500)},onProcessSelected:()=>{if(0===z.length)return;let r=z.map(t=>e.pendingReturns[t]);e.products.length>0&&(r=r.map(t=>t.barcode&&"-"!==t.barcode?t:eM(t,e.products))),t({type:"PROCESS_RETURNS",payload:r}),D([]),E(!1),p("".concat(r.length,"개 항목을 입고 처리했습니다."))},onDeleteSelected:()=>{if(0===z.length){p("삭제할 항목을 선택해주세요.");return}d(!0),p("".concat(z.length,"개 항목을 삭제 중입니다...")),setTimeout(()=>{let r=e.pendingReturns.filter((e,t)=>!z.includes(t));t({type:"SET_RETURNS",payload:{...e,pendingReturns:r}}),D([]),d(!1),p("".concat(z.length,"개 항목이 삭제되었습니다."))},1e3)},onRematchSelected:()=>{if(0===z.length){p("재매칭할 항목을 선택해주세요.");return}ee(!0)},onItemSelect:(t,r)=>{let a=e.pendingReturns.findIndex(e=>e.id===t.id);r?D(e=>[...e,a]):D(e=>e.filter(e=>e!==a))},PendingItemsTable:t=>{let{items:r}=t,o=eF(r);return(0,a.jsxs)("table",{className:"pending-returns-table min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"col-actions px-1 py-1 text-center text-2xs font-medium text-gray-500 uppercase tracking-wider",children:(0,a.jsx)("input",{type:"checkbox",checked:T,onChange:eN,className:"w-4 h-4"})}),(0,a.jsx)("th",{className:"col-customer-name px-1 py-1 text-left text-2xs font-medium text-gray-500 uppercase tracking-wider",children:"고객명"}),(0,a.jsx)("th",{className:"col-order-number px-1 py-1 text-left text-2xs font-medium text-gray-500 uppercase tracking-wider",children:"주문번호"}),(0,a.jsx)("th",{className:"col-product-name px-1 py-1 text-left text-2xs font-medium text-gray-500 uppercase tracking-wider",children:"사입상품명"}),(0,a.jsx)("th",{className:"col-option-name px-1 py-1 text-left text-2xs font-medium text-gray-500 uppercase tracking-wider",children:"옵션"}),(0,a.jsx)("th",{className:"col-quantity px-1 py-1 text-left text-2xs font-medium text-gray-500 uppercase tracking-wider",children:"수량"}),(0,a.jsx)("th",{className:"col-return-reason px-1 py-1 text-left text-2xs font-medium text-gray-500 uppercase tracking-wider",children:"반품사유"}),(0,a.jsx)("th",{className:"col-tracking-number px-1 py-1 text-left text-2xs font-medium text-gray-500 uppercase tracking-wider",children:"수거송장번호"}),(0,a.jsx)("th",{className:"col-barcode px-1 py-1 text-left text-2xs font-medium text-gray-500 uppercase tracking-wider",children:"바코드번호"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:o.map((t,o)=>{let n=t.items[0],c=r.findIndex(e=>e.id===n.id),s=z.includes(c);return(0,a.jsxs)("tr",{className:"hover:bg-blue-50 ".concat(ej(n,c,r)),children:[(0,a.jsx)("td",{className:"col-actions px-1 py-1",children:(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)("input",{type:"checkbox",checked:s,onChange:e=>{e.target.checked?D(e=>[...e,c]):D(e=>e.filter(e=>e!==c))},className:"w-4 h-4"})})}),(0,a.jsx)("td",{className:"col-customer-name px-1 py-1 whitespace-nowrap overflow-hidden text-ellipsis max-w-[100px]",children:n.customerName}),(0,a.jsx)("td",{className:"col-order-number px-1 py-1 whitespace-nowrap overflow-hidden text-ellipsis",children:n.orderNumber}),(0,a.jsx)("td",{className:"col-product-name px-1 py-1",children:(0,a.jsx)("div",{className:n.barcode?"whitespace-nowrap overflow-hidden text-ellipsis":"whitespace-normal break-words line-clamp-2",children:eI(n)})}),(0,a.jsx)("td",{className:"col-option-name px-1 py-1 whitespace-nowrap overflow-hidden text-ellipsis",children:l(n.optionName)}),(0,a.jsx)("td",{className:"col-quantity px-1 py-1 whitespace-nowrap text-center",children:n.quantity}),(0,a.jsx)("td",{className:"col-return-reason px-1 py-1",children:(0,a.jsx)("div",{className:"cursor-pointer ".concat(ev(n.returnReason)?"text-red-500":""," whitespace-nowrap overflow-hidden text-ellipsis max-w-[120px]"),onClick:()=>ev(n.returnReason)&&ey(n),children:eC(n.returnReason)})}),(0,a.jsx)("td",{className:"col-tracking-number px-1 py-1",children:(0,a.jsx)("div",{className:"font-mono text-2xs whitespace-nowrap bg-blue-100 px-1 py-0.5 rounded text-center",children:"no-tracking"===t.trackingNumber?"-":t.trackingNumber})}),(0,a.jsx)("td",{className:"col-barcode px-1 py-1",children:(0,a.jsxs)("div",{className:"text-2xs",children:[(0,a.jsx)("div",{className:"font-mono font-semibold",children:n.barcode||"-"}),n.barcode&&"-"!==n.barcode&&(()=>{let t=e.products.find(e=>e.barcode===n.barcode);return t?(0,a.jsxs)("div",{className:"main-barcode-info",title:"".concat(t.purchaseName," ").concat(t.optionName),children:["(",t.purchaseName," ",t.optionName,")"]}):null})()]})})]},n.id)})})]})}}),(0,a.jsx)("dialog",{ref:x,className:"modal w-11/12 max-w-5xl p-0 rounded-lg shadow-xl",onClick:e=>{let t=e.currentTarget.getBoundingClientRect();if(e.clientX<t.left||e.clientX>t.right||e.clientY<t.top||e.clientY>t.bottom){e.currentTarget.close();let t=e.currentTarget.id;t&&(eq(e=>e.filter(e=>e!==t)),eB(e=>Math.max(0,e-10)))}},id:"productModal",children:(0,a.jsxs)("div",{className:"modal-box bg-white p-6",children:[(0,a.jsxs)("h3",{className:"font-bold text-lg mb-4 flex justify-between items-center",children:[(0,a.jsx)("span",{children:"상품 데이터 목록"}),(0,a.jsx)("button",{onClick:()=>{var e;return null===(e=x.current)||void 0===e?void 0:e.close()},className:"btn btn-sm btn-circle",children:"✕"})]}),(0,a.jsxs)("div",{className:"mb-4 flex justify-end gap-2",children:[(0,a.jsxs)("button",{className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded flex items-center gap-1",onClick:()=>{d(!0),p("상품 데이터 중복 제거 중입니다...");try{let r=e.products||[];console.log("상품 중복 제거 시작: ".concat(r.length,"개"));let a=new Set,o=r.filter(e=>{let t="".concat(e.productName||"","_").concat(e.optionName||"","_").concat(e.barcode||"");return!a.has(t)&&(a.add(t),!0)}),n=r.length-o.length;n>0?(t({type:"SET_RETURNS",payload:{...e,products:o}}),localStorage.setItem("products",JSON.stringify(o)),p("상품 중복 제거 완료: ".concat(n,"개 중복 항목이 제거되었습니다.")),console.log("상품 중복 제거 완료: ".concat(r.length," → ").concat(o.length," (").concat(n,"개 제거)"))):(p("중복된 상품이 없습니다."),console.log("중복된 상품이 없음"))}catch(e){console.error("상품 중복 제거 오류:",e),p("상품 중복 제거 중 오류가 발생했습니다.")}finally{d(!1)}},disabled:!e.products||0===e.products.length,children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})}),"새로고침 (중복제거)"]}),(0,a.jsx)("button",{className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded",onClick:eS,disabled:!e.products||0===e.products.length,children:"전체 삭제"})]}),e.products&&e.products.length>0?(0,a.jsx)("div",{className:"overflow-x-auto max-h-[70vh]",children:(0,a.jsxs)("table",{className:"min-w-full border-collapse border border-gray-300 main-table",children:[(0,a.jsx)("thead",{className:"sticky top-0 bg-white",children:(0,a.jsxs)("tr",{className:"bg-gray-100",children:[(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 col-actions",children:"번호"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 col-product-name",children:"사입상품명"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 col-product-name",children:"상품명"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 col-option-name",children:"옵션명"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 col-barcode",children:"바코드번호"}),(0,a.jsx)("th",{className:"px-2 py-2 border-x border-gray-300 col-order-number",children:"자체상품코드"})]})}),(0,a.jsx)("tbody",{children:e.products.map((e,t)=>(0,a.jsxs)("tr",{className:"border-t border-gray-300 hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 col-actions",children:t+1}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 col-product-name",children:e.purchaseName||"-"}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 col-product-name",children:e.productName}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 col-option-name",children:e.optionName||"-"}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 font-mono col-barcode",children:e.barcode}),(0,a.jsx)("td",{className:"px-2 py-2 border-x border-gray-300 col-order-number",children:e.zigzagProductCode||"-"})]},e.id))})]})}):(0,a.jsx)("p",{children:"상품 데이터가 없습니다."}),(0,a.jsx)("div",{className:"modal-action mt-6",children:(0,a.jsx)("button",{className:"btn",onClick:()=>{var e;return null===(e=x.current)||void 0===e?void 0:e.close()},children:"닫기"})})]})}),G&&Y&&(0,a.jsx)(f,{isOpen:G,onClose:()=>{V(!1),X(null),eB(e=>Math.max(0,e-10))},returnItem:Y,products:e.products||[],onMatch:(r,a)=>{d(!0);let o={...r,barcode:a.barcode,purchaseName:a.purchaseName||a.productName,zigzagProductCode:a.zigzagProductCode||"",customProductCode:a.customProductCode||"",matchType:"manual",matchSimilarity:1,matchedProductName:a.productName};if(console.log("매칭 완료:",{원래상품명:r.productName,매칭된사입상품명:o.purchaseName,바코드:o.barcode}),e.pendingReturns.some(e=>e.id===r.id)){let a=e.pendingReturns.map(e=>e.id===r.id?o:e);t({type:"SET_RETURNS",payload:{...e,pendingReturns:a}}),localStorage.setItem("pendingReturns",JSON.stringify(a))}else{let a=e.completedReturns.map(e=>e.id===r.id?o:e);t({type:"SET_RETURNS",payload:{...e,completedReturns:a}}),localStorage.setItem("completedReturns",JSON.stringify(a))}localStorage.setItem("lastUpdated",new Date().toISOString()),V(!1),d(!1),e.pendingReturns.some(e=>e.id===r.id)||(I([]),F(!1)),p('"'.concat(r.productName,'" 상품이 "').concat(a.purchaseName||a.productName,'"(으)로 매칭되었습니다.'))},zIndex:1e3+eU}),b&&w&&(0,a.jsx)(u,{isOpen:b,onClose:()=>{N(!1),eB(e=>Math.max(0,e-10))},returnItem:w,detailReason:k||"",onSave:ef,setDetailReason:P,zIndex:1e3+eU}),(0,a.jsx)(v,{isOpen:Z,onClose:()=>{ee(!1),D([])},selectedItems:z.map(t=>e.pendingReturns[t]).filter(Boolean),products:e.products||[],onRematch:(r,a)=>{let o=e.pendingReturns.find(e=>e.id===r);if(!o)return;let n=e.products.find(e=>e.barcode===a);if(!n)return;let l={...o,barcode:a,purchaseName:n.purchaseName||n.productName,zigzagProductCode:n.zigzagProductCode||"",matchType:"수동재매칭",matchSimilarity:1,matchedProductName:n.productName,matchedProductOption:n.optionName},c=e.pendingReturns.map(e=>e.id===r?l:e);t({type:"SET_RETURNS",payload:{...e,pendingReturns:c}}),localStorage.setItem("pendingReturns",JSON.stringify(c)),localStorage.setItem("lastUpdated",new Date().toISOString()),p('"'.concat(o.purchaseName,'" 항목이 "').concat(n.productName,'" (').concat(a,")로 재매칭되었습니다."))}}),et&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",style:{zIndex:1e3+eU},onClick:()=>er(!1),children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-11/12 max-w-md p-6",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("h3",{className:"font-bold text-lg mb-4 flex justify-between items-center",children:[(0,a.jsx)("span",{children:"날짜 변경"}),(0,a.jsx)("button",{onClick:()=>er(!1),className:"text-gray-500 hover:text-gray-700 text-xl font-bold",children:"✕"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("p",{className:"text-gray-600 mb-4",children:["선택된 ",O.length,"개 항목의 날짜를 변경할 수 있습니다."]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"새로운 날짜 선택"}),(0,a.jsx)("input",{type:"date",value:ea,onChange:e=>eo(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)("button",{className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded",onClick:()=>er(!1),children:"취소"}),(0,a.jsx)("button",{className:"px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded",onClick:()=>ea&&ta(ea),disabled:!ea,children:"날짜 변경"})]})]})}),en&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",style:{zIndex:1e3+eU},onClick:()=>el(!1),children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-11/12 max-w-2xl p-6",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("h3",{className:"font-bold text-lg mb-4 flex justify-between items-center",children:[(0,a.jsx)("span",{children:"표 및 텍스트 크기 조정"}),(0,a.jsx)("button",{onClick:()=>el(!1),className:"text-gray-500 hover:text-gray-700 text-xl font-bold",children:"✕"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold text-md mb-3 text-blue-600",children:"팝업 크기"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["팝업 너비: ",ec.popupWidth,"vw"]}),(0,a.jsx)("input",{type:"range",min:"50",max:"120",step:"1",value:ec.popupWidth,onChange:e=>eg("popupWidth",Number(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["팝업 높이: ",ec.popupHeight,"vh"]}),(0,a.jsx)("input",{type:"range",min:"40",max:"90",step:"0.5",value:ec.popupHeight,onChange:e=>eg("popupHeight",Number(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold text-md mb-3 text-green-600",children:"텍스트 크기"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["입고전 반품목록 테이블 폰트: ",ec.popupTableFontSize,"rem"]}),(0,a.jsx)("input",{type:"range",min:"0.5",max:"2.5",step:"0.1",value:ec.popupTableFontSize,onChange:e=>eg("popupTableFontSize",Number(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["입고전 반품목록 바코드 폰트: ",ec.popupBarcodeFontSize,"rem"]}),(0,a.jsx)("input",{type:"range",min:"0.3",max:"1.5",step:"0.1",value:ec.popupBarcodeFontSize,onChange:e=>eg("popupBarcodeFontSize",Number(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["메인 화면 테이블 폰트: ",ec.mainTableFontSize,"rem"]}),(0,a.jsx)("input",{type:"range",min:"0.5",max:"2.5",step:"0.1",value:ec.mainTableFontSize,onChange:e=>eg("mainTableFontSize",Number(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["메인 화면 바코드 폰트: ",ec.mainBarcodeFontSize,"rem"]}),(0,a.jsx)("input",{type:"range",min:"0.3",max:"1.5",step:"0.1",value:ec.mainBarcodeFontSize,onChange:e=>eg("mainBarcodeFontSize",Number(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold text-md mb-3 text-purple-600",children:"셀 설정"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["입고전 반품목록 셀 패딩: ",ec.popupCellPadding,"rem"]}),(0,a.jsx)("input",{type:"range",min:"0.1",max:"1.0",step:"0.1",value:ec.popupCellPadding,onChange:e=>eg("popupCellPadding",Number(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["입고전 반품목록 줄 높이: ",ec.popupLineHeight]}),(0,a.jsx)("input",{type:"range",min:"1.0",max:"2.0",step:"0.1",value:ec.popupLineHeight,onChange:e=>eg("popupLineHeight",Number(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["메인 화면 셀 패딩: ",ec.mainCellPadding,"rem"]}),(0,a.jsx)("input",{type:"range",min:"0.1",max:"1.0",step:"0.1",value:ec.mainCellPadding,onChange:e=>eg("mainCellPadding",Number(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["메인 화면 줄 높이: ",ec.mainLineHeight]}),(0,a.jsx)("input",{type:"range",min:"1.0",max:"2.0",step:"0.1",value:ec.mainLineHeight,onChange:e=>eg("mainLineHeight",Number(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold text-md mb-3 text-orange-600",children:"미리보기"}),(0,a.jsxs)("div",{className:"border rounded p-3 bg-gray-50",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500 mb-2",children:"현재 설정값"}),(0,a.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,a.jsxs)("div",{children:["팝업: ",ec.popupWidth,"vw \xd7 ",ec.popupHeight,"vh"]}),(0,a.jsxs)("div",{children:["입고전 반품목록 테이블 폰트: ",ec.popupTableFontSize,"rem"]}),(0,a.jsxs)("div",{children:["입고전 반품목록 바코드 폰트: ",ec.popupBarcodeFontSize,"rem"]}),(0,a.jsxs)("div",{children:["입고전 반품목록 셀 패딩: ",ec.popupCellPadding,"rem"]}),(0,a.jsxs)("div",{children:["입고전 반품목록 줄 높이: ",ec.popupLineHeight]}),(0,a.jsxs)("div",{children:["메인 화면 테이블 폰트: ",ec.mainTableFontSize,"rem"]}),(0,a.jsxs)("div",{children:["메인 화면 바코드 폰트: ",ec.mainBarcodeFontSize,"rem"]}),(0,a.jsxs)("div",{children:["메인 화면 셀 패딩: ",ec.mainCellPadding,"rem"]}),(0,a.jsxs)("div",{children:["메인 화면 줄 높이: ",ec.mainLineHeight]}),(0,a.jsxs)("div",{className:"mt-2 pt-2 border-t border-gray-300",children:[(0,a.jsx)("div",{className:"font-medium text-gray-700 mb-1",children:"컬럼 너비:"}),(0,a.jsxs)("div",{children:["고객명: ",ec.columnWidths.customerName,"px"]}),(0,a.jsxs)("div",{children:["주문번호: ",ec.columnWidths.orderNumber,"px"]}),(0,a.jsxs)("div",{children:["상품명: ",ec.columnWidths.productName,"px"]}),(0,a.jsxs)("div",{children:["옵션명: ",ec.columnWidths.optionName,"px"]}),(0,a.jsxs)("div",{children:["수량: ",ec.columnWidths.quantity,"px"]}),(0,a.jsxs)("div",{children:["반품사유: ",ec.columnWidths.returnReason,"px"]}),(0,a.jsxs)("div",{children:["송장번호: ",ec.columnWidths.trackingNumber,"px"]}),(0,a.jsxs)("div",{children:["바코드: ",ec.columnWidths.barcode,"px"]}),(0,a.jsxs)("div",{children:["액션: ",ec.columnWidths.actions,"px"]})]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold text-md mb-3 text-blue-600",children:"컬럼 정렬 설정"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"고객명 정렬"}),(0,a.jsxs)("select",{value:ec.columnAlignment.customerName,onChange:e=>ex("customerName",e.target.value),className:"w-full p-2 border border-gray-300 rounded",children:[(0,a.jsx)("option",{value:"left",children:"왼쪽"}),(0,a.jsx)("option",{value:"center",children:"가운데"}),(0,a.jsx)("option",{value:"right",children:"오른쪽"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"주문번호 정렬"}),(0,a.jsxs)("select",{value:ec.columnAlignment.orderNumber,onChange:e=>ex("orderNumber",e.target.value),className:"w-full p-2 border border-gray-300 rounded",children:[(0,a.jsx)("option",{value:"left",children:"왼쪽"}),(0,a.jsx)("option",{value:"center",children:"가운데"}),(0,a.jsx)("option",{value:"right",children:"오른쪽"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"상품명 정렬"}),(0,a.jsxs)("select",{value:ec.columnAlignment.productName,onChange:e=>ex("productName",e.target.value),className:"w-full p-2 border border-gray-300 rounded",children:[(0,a.jsx)("option",{value:"left",children:"왼쪽"}),(0,a.jsx)("option",{value:"center",children:"가운데"}),(0,a.jsx)("option",{value:"right",children:"오른쪽"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"옵션명 정렬"}),(0,a.jsxs)("select",{value:ec.columnAlignment.optionName,onChange:e=>ex("optionName",e.target.value),className:"w-full p-2 border border-gray-300 rounded",children:[(0,a.jsx)("option",{value:"left",children:"왼쪽"}),(0,a.jsx)("option",{value:"center",children:"가운데"}),(0,a.jsx)("option",{value:"right",children:"오른쪽"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"수량 정렬"}),(0,a.jsxs)("select",{value:ec.columnAlignment.quantity,onChange:e=>ex("quantity",e.target.value),className:"w-full p-2 border border-gray-300 rounded",children:[(0,a.jsx)("option",{value:"left",children:"왼쪽"}),(0,a.jsx)("option",{value:"center",children:"가운데"}),(0,a.jsx)("option",{value:"right",children:"오른쪽"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"반품사유 정렬"}),(0,a.jsxs)("select",{value:ec.columnAlignment.returnReason,onChange:e=>ex("returnReason",e.target.value),className:"w-full p-2 border border-gray-300 rounded",children:[(0,a.jsx)("option",{value:"left",children:"왼쪽"}),(0,a.jsx)("option",{value:"center",children:"가운데"}),(0,a.jsx)("option",{value:"right",children:"오른쪽"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"송장번호 정렬"}),(0,a.jsxs)("select",{value:ec.columnAlignment.trackingNumber,onChange:e=>ex("trackingNumber",e.target.value),className:"w-full p-2 border border-gray-300 rounded",children:[(0,a.jsx)("option",{value:"left",children:"왼쪽"}),(0,a.jsx)("option",{value:"center",children:"가운데"}),(0,a.jsx)("option",{value:"right",children:"오른쪽"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"바코드 정렬"}),(0,a.jsxs)("select",{value:ec.columnAlignment.barcode,onChange:e=>ex("barcode",e.target.value),className:"w-full p-2 border border-gray-300 rounded",children:[(0,a.jsx)("option",{value:"left",children:"왼쪽"}),(0,a.jsx)("option",{value:"center",children:"가운데"}),(0,a.jsx)("option",{value:"right",children:"오른쪽"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"액션 버튼 정렬"}),(0,a.jsxs)("select",{value:ec.columnAlignment.actions,onChange:e=>ex("actions",e.target.value),className:"w-full p-2 border border-gray-300 rounded",children:[(0,a.jsx)("option",{value:"left",children:"왼쪽"}),(0,a.jsx)("option",{value:"center",children:"가운데"}),(0,a.jsx)("option",{value:"right",children:"오른쪽"})]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold text-md mb-3 text-red-600",children:"컬럼 너비 설정 (px)"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["고객명 너비: ",ec.columnWidths.customerName,"px"]}),(0,a.jsx)("input",{type:"range",min:"80",max:"200",step:"5",value:ec.columnWidths.customerName,onChange:e=>eb("customerName",Number(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["주문번호 너비: ",ec.columnWidths.orderNumber,"px"]}),(0,a.jsx)("input",{type:"range",min:"80",max:"200",step:"5",value:ec.columnWidths.orderNumber,onChange:e=>eb("orderNumber",Number(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["상품명 너비: ",ec.columnWidths.productName,"px"]}),(0,a.jsx)("input",{type:"range",min:"120",max:"300",step:"10",value:ec.columnWidths.productName,onChange:e=>eb("productName",Number(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["옵션명 너비: ",ec.columnWidths.optionName,"px"]}),(0,a.jsx)("input",{type:"range",min:"80",max:"200",step:"5",value:ec.columnWidths.optionName,onChange:e=>eb("optionName",Number(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["수량 너비: ",ec.columnWidths.quantity,"px"]}),(0,a.jsx)("input",{type:"range",min:"60",max:"120",step:"5",value:ec.columnWidths.quantity,onChange:e=>eb("quantity",Number(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["반품사유 너비: ",ec.columnWidths.returnReason,"px"]}),(0,a.jsx)("input",{type:"range",min:"100",max:"250",step:"10",value:ec.columnWidths.returnReason,onChange:e=>eb("returnReason",Number(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["송장번호 너비: ",ec.columnWidths.trackingNumber,"px"]}),(0,a.jsx)("input",{type:"range",min:"80",max:"200",step:"5",value:ec.columnWidths.trackingNumber,onChange:e=>eb("trackingNumber",Number(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["바코드 너비: ",ec.columnWidths.barcode,"px"]}),(0,a.jsx)("input",{type:"range",min:"120",max:"300",step:"10",value:ec.columnWidths.barcode,onChange:e=>eb("barcode",Number(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["액션 버튼 너비: ",ec.columnWidths.actions,"px"]}),(0,a.jsx)("input",{type:"range",min:"80",max:"200",step:"5",value:ec.columnWidths.actions,onChange:e=>eb("actions",Number(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2 mt-6",children:[(0,a.jsx)("button",{className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded",onClick:()=>el(!1),children:"취소"}),(0,a.jsx)("button",{className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded",onClick:()=>{let e=document.documentElement;e.style.setProperty("--popup-width","".concat(ec.popupWidth,"vw")),e.style.setProperty("--popup-height","".concat(ec.popupHeight,"vh")),e.style.setProperty("--popup-table-font-size","".concat(ec.popupTableFontSize,"rem")),e.style.setProperty("--popup-barcode-font-size","".concat(ec.popupBarcodeFontSize,"rem")),e.style.setProperty("--popup-cell-padding","".concat(ec.popupCellPadding,"rem")),e.style.setProperty("--popup-line-height",ec.popupLineHeight.toString()),e.style.setProperty("--main-table-font-size","".concat(ec.mainTableFontSize,"rem")),e.style.setProperty("--main-barcode-font-size","".concat(ec.mainBarcodeFontSize,"rem")),e.style.setProperty("--main-cell-padding","".concat(ec.mainCellPadding,"rem")),e.style.setProperty("--main-line-height",ec.mainLineHeight.toString()),Object.entries(ec.columnAlignment).forEach(t=>{let[r,a]=t;e.style.setProperty("--column-".concat(r,"-alignment"),a)}),Object.entries(ec.columnWidths).forEach(t=>{let[r,a]=t;e.style.setProperty("--column-".concat(r,"-width"),"".concat(a,"px"))}),localStorage.setItem("tableSettings",JSON.stringify(ec)),p("표 설정이 적용되었습니다. 설정을 저장했습니다."),el(!1)},children:"설정 적용"})]})]})})]})}},2533:(e,t,r)=>{"use strict";r.d(t,{b:()=>i,m:()=>s});var a=r(7437),o=r(2265);let n={pendingReturns:[],completedReturns:[],products:[]};function l(e,t){switch(t.type){case"SET_RETURNS":return t.payload;case"ADD_RETURNS":return{...e,pendingReturns:[...e.pendingReturns,...t.payload]};case"ADD_PRODUCTS":return{...e,products:[...e.products,...t.payload]};case"SET_PRODUCTS":return{...e,products:t.payload};case"PROCESS_RETURNS":let r=t.payload,a=new Date,o=new Date(a.getFullYear(),a.getMonth(),a.getDate());o.setHours(0,0,0,0);let n=r.map(e=>({...e,status:"COMPLETED",completedAt:o})),l=e.pendingReturns.filter(e=>!r.some(t=>t.id===e.id));return{...e,pendingReturns:l,completedReturns:[...n,...e.completedReturns]};case"UPDATE_RETURN_REASON":return{...e,pendingReturns:e.pendingReturns.map(e=>e.id===t.payload.id?{...e,detailReason:t.payload.detailReason,returnReason:e.returnReason+(t.payload.detailReason?" (".concat(t.payload.detailReason,")"):"")}:e),completedReturns:e.completedReturns.map(e=>e.id===t.payload.id?{...e,detailReason:t.payload.detailReason,returnReason:e.returnReason.includes("(")?e.returnReason.split("(")[0].trim()+(t.payload.detailReason?" (".concat(t.payload.detailReason,")"):""):e.returnReason+(t.payload.detailReason?" (".concat(t.payload.detailReason,")"):"")}:e)};case"UPDATE_RETURN_ITEM":return{...e,pendingReturns:e.pendingReturns.map(e=>e.id===t.payload.id?t.payload:e)};case"MATCH_PRODUCTS":let c=e.pendingReturns.map(t=>{if(t.barcode&&"-"!==t.barcode)return t;let r=e=>{if(!t.optionName||0===e.length)return e[0]||null;let r=t.optionName.toLowerCase().trim(),a=e.find(e=>e.optionName&&e.optionName.toLowerCase().trim()===r);if(a)return a;let o=null,n=.7;for(let t of e)if(t.optionName){let e=t.optionName.toLowerCase().trim();(e.includes(r)||r.includes(e))&&.9>n&&(n=.9,o=t)}if(o)return o;let l=null,c=0,s=e=>e.replace(/[\[\]]/g,"").split(/[,\/:\-\s]+/).map(e=>e.trim()).filter(e=>e.length>0&&"선택"!==e),i=s(r);for(let t of e)if(t.optionName){let e=s(t.optionName.toLowerCase().trim()),r=i.filter(t=>e.some(e=>!!(e===t||t.length>=3&&e.includes(t)||e.length>=3&&t.includes(e))));if(r.length>0){let a=r.length/Math.max(i.length,e.length)*.8+r.length/i.length*.2;a>c&&a>=.4&&(c=a,l=t)}}return l||null};if(t.zigzagProductCode&&"-"!==t.zigzagProductCode){let a=e.products.filter(e=>e.zigzagProductCode&&e.zigzagProductCode===t.zigzagProductCode);if(a.length>0){let e=r(a);if(e)return{...t,barcode:e.barcode||"",purchaseName:e.purchaseName||e.productName,matchSimilarity:1,matchType:"자체상품코드 정확 매칭"}}let o=null,n=t.zigzagProductCode.toLowerCase().trim();for(let t of e.products)if(t.purchaseName&&"string"==typeof t.purchaseName){let e=t.purchaseName.toLowerCase().trim();if(e.includes(n)||n.includes(e))(!o||.95>o.similarity)&&(o={product:t,similarity:.95,matchType:"자체상품코드-사입명 포함관계"});else{let r=Math.min(n.length,e.length),a=Math.max(n.length,e.length);if(r>0&&a>0){let l=0;for(let t=0;t<r;t++)n[t]===e[t]&&l++;let c=l/a;c>.4&&(!o||c>o.similarity)&&(o={product:t,similarity:c,matchType:"자체상품코드-사입명 유사도"})}}}if(o&&o.similarity>.5)return{...t,barcode:o.product.barcode||"",purchaseName:o.product.purchaseName||o.product.productName,zigzagProductCode:o.product.zigzagProductCode||t.zigzagProductCode,customProductCode:o.product.customProductCode||o.product.zigzagProductCode||"",matchSimilarity:o.similarity,matchType:o.matchType}}if(t.productName){let a=e.products.filter(e=>e.productName&&"string"==typeof e.productName&&"string"==typeof t.productName&&e.productName.toLowerCase().trim()===t.productName.toLowerCase().trim());if(a.length>0){let e=r(a);if(e)return{...t,barcode:e.barcode||"",purchaseName:e.purchaseName||e.productName,zigzagProductCode:e.zigzagProductCode||"",matchSimilarity:1,matchType:"상품명 완전일치"}}let o=e.products.filter(e=>e.purchaseName&&"string"==typeof e.purchaseName&&"string"==typeof t.productName&&e.purchaseName.toLowerCase().trim()===t.productName.toLowerCase().trim());if(o.length>0){let e=r(o);if(e)return{...t,barcode:e.barcode||"",purchaseName:e.purchaseName||e.productName,zigzagProductCode:e.zigzagProductCode||"",matchSimilarity:1,matchType:"사입상품명 완전일치"}}let n=[];for(let r of e.products){if(r.productName&&t.productName&&"string"==typeof r.productName&&"string"==typeof t.productName){let e=r.productName.toLowerCase(),a=t.productName.toLowerCase();(e.includes(a)||a.includes(e))&&n.push(r)}if(r.purchaseName&&t.productName&&"string"==typeof r.purchaseName&&"string"==typeof t.productName){let e=r.purchaseName.toLowerCase(),a=t.productName.toLowerCase();(e.includes(a)||a.includes(e))&&n.push(r)}}if(n.length>0){let e=r(n);if(e)return{...t,barcode:e.barcode||"",purchaseName:e.purchaseName||e.productName,zigzagProductCode:e.zigzagProductCode||"",matchSimilarity:.7,matchType:"상품명 포함관계"}}}return t});return{...e,pendingReturns:c};case"REMOVE_PENDING_RETURNS":{let r=t.payload;return{...e,pendingReturns:e.pendingReturns.filter((e,t)=>!r.includes(t))}}case"REMOVE_PENDING_RETURN":{let r=t.payload.id;return{...e,pendingReturns:e.pendingReturns.filter(e=>e.id!==r)}}case"ADD_COMPLETED_RETURN":if(e.completedReturns.some(e=>e.id===t.payload.id))return e;return{...e,completedReturns:[...e.completedReturns,t.payload]};case"UPDATE_PENDING_RETURN":return{...e,pendingReturns:e.pendingReturns.map(e=>e.id===t.payload.id?t.payload:e)};default:return e}}let c=(0,o.createContext)(void 0);function s(e){let{children:t}=e,[r,s]=(0,o.useReducer)(l,n);return(0,a.jsx)(c.Provider,{value:{returnState:r,dispatch:s},children:t})}function i(){let e=(0,o.useContext)(c);if(void 0===e)throw Error("useReturnState must be used within a ReturnStateProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[425,130,215,744],()=>t(4856)),_N_E=e.O()}]);